/*! For license information please see maps.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.Maps=t(require("react")):e.Maps=t(e.React)}(self,(e=>(()=>{var t={5396:function(e){"use strict";e.exports=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),l=i.startsWith("2");if(u&&!l||!u&&l)n("JSAPI 与 Loca 版本不对应！！");else{u=o.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(e){a.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&h.push(t.plugins[l]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()},507:()=>{window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=function(){u||(u=!0,a())},r=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var i,o,a,s,u;if(r&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}i=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(i,0):(o=function(){document.removeEventListener("DOMContentLoaded",o,!1),i()},document.addEventListener("DOMContentLoaded",o,!1)):document.attachEvent&&(a=i,s=e.document,u=!1,function e(){try{s.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}n()}(),s.onreadystatechange=function(){"complete"==s.readyState&&(s.onreadystatechange=null,n())})}}catch(e){}}(window)},9417:(e,t)=>{"use strict";t.Tf=t.Bc=t.jp=t.fL=t.O6=t.rC=void 0,t.rC="l7plot-legend l7plot-legend__category",t.O6="l7plot-legend__title",t.fL="l7plot-legend__category-list",t.jp="l7plot-legend__list-item",t.Bc="l7plot-legend__category-marker",t.Tf="l7plot-legend__category-value",'<div class="'.concat(t.rC,'">\n  <div class="').concat(t.O6,'"></div>\n  <ul class="').concat(t.fL,'"></ul>\n</div>'),'<li class="'.concat(t.jp,'" data-index={index}>\n  <span class="').concat(t.Bc,'" style="background:{color}"></span>\n  <span class="').concat(t.Tf,'">{value}</span>\n</li>')},3555:(e,t)=>{"use strict";t.VI=t.bl=t.el=t.I8=t.O6=t.rC=void 0,t.rC="l7plot-legend l7plot-legend__continue",t.O6="l7plot-legend__title",t.I8="l7plot-legend__ribbon-container",t.el="l7plot-legend__ribbon",t.bl="l7plot-legend__gradient-bar",t.VI="l7plot-legend__value-range",'<div class="'.concat(t.rC,'">\n  <div class="').concat(t.O6,'"></div>\n  <div class="').concat(t.I8,'"></div>\n</div>'),'<div class="'.concat(t.el,'">\n  <span class="').concat(t.VI,'">{min}</span>\n  <div class="').concat(t.bl,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(t.VI,'">{max}</span>\n</div>')},9014:(e,t)=>{"use strict";t.Tf=t.bX=t.jp=t.fL=t.O6=t.rC=void 0,t.rC="l7plot-tooltip",t.O6="l7plot-tooltip__title",t.fL="l7plot-tooltip__list",t.jp="l7plot-tooltip__list-item",t.bX="l7plot-tooltip__name",t.Tf="l7plot-tooltip__value",'<div class="'.concat(t.rC,'">\n  <div class="').concat(t.O6,'"></div>\n  <ul class="').concat(t.fL,'"></ul>\n</div>'),'<li class="'.concat(t.jp,'" data-index={index}>\n  <span class="').concat(t.bX,'">{name}</span>\n  <span class="').concat(t.Tf,'">{value}</span>\n</li>')},1584:e=>{function t(e,t){if(0!==e.length){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],!t)}}function n(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}e.exports=function e(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)e(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)e(n.geometries[i],r);else if("Feature"===o)e(n.geometry,r);else if("Polygon"===o)t(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)t(n.coordinates[i],r);return n}},4744:e=>{"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},4320:e=>{"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,r,o,a){for(var s=0;s<t;s++)i(e,s,t,n,r,o,a);for(var u=0;u<n;u++)i(e,u*t,1,t,r,o,a)}function i(e,n,r,i,o,a,s){var u,l,c,h;for(a[0]=0,s[0]=-t,s[1]=t,u=0;u<i;u++)o[u]=e[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{h=a[l],c=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=t}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;h=a[l],e[n+u*r]=o[h]+(u-h)*(u-h)}}n.prototype._draw=function(e,n){var i,o,a,s,u,l,c,h,p,f=this.ctx.measureText(e),d=f.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(f.actualBoundingBoxAscent),h=this.buffer+Math.ceil(f.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(f.actualBoundingBoxRight-f.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-l,Math.ceil(f.actualBoundingBoxAscent+f.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,h=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(e,this.buffer,h),p=this.ctx.getImageData(c,l,o,s));var m=new Uint8ClampedArray(i*a);return function(e,n,r,i,o,a,s){a.fill(t,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var h=(l+u)*n+c+u,p=e.data[4*(l*i+c)+3]/255;if(1===p)a[h]=0,s[h]=t;else if(0===p)a[h]=t,s[h]=0;else{var f=Math.max(0,.5-p),d=Math.max(0,p-.5);a[h]=f*f,s[h]=d*d}}}(p,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(m,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:m,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},3056:e=>{function t(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},59:(e,t,n)=>{e.exports.VectorTile=n(3486),n(2754),n(2656)},3486:(e,t,n)=>{"use strict";var r=n(2656);function i(e,t,n){if(3===e){var i=new r(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},2754:(e,t,n)=>{"use strict";var r=n(4744);function i(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(o,this,t)}function o(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function a(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,o=0,a=0,s=0,u=[];e.pos<n;){if(o<=0){var l=e.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&u.push(t),t=[]),t.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&u.push(t),u},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},i.prototype.toGeoJSON=function(e,t,n){var r,o,s=this.extent*Math.pow(2,n),u=this.extent*e,l=this.extent*t,c=this.loadGeometry(),h=i.types[this.type];function p(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+l)/s;e[t]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(r=0;r<c.length;r++)f[r]=c[r][0];p(c=f);break;case 2:for(r=0;r<c.length;r++)p(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var s=a(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(c),r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)p(c[r][o])}1===c.length?c=c[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},2656:(e,t,n)=>{"use strict";var r=n(2754);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(o,this,t),this.length=this._features.length}function o(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)}},1034:e=>{"use strict";function t(e,t,r){r=r||2;var o,a,s,u,h,p,d,v=t&&t.length,m=v?t[0]*r:e.length,g=n(e,0,m,r,!0),y=[];if(!g||g.next===g.prev)return y;if(v&&(g=function(e,t,r,i){var o,a,s,u=[];for(o=0,a=t.length;o<a;o++)(s=n(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),u.push(f(s));for(u.sort(l),o=0;o<u.length;o++)r=c(u[o],r);return r}(e,t,g,r)),e.length>80*r){o=s=e[0],a=u=e[1];for(var _=r;_<m;_+=r)(h=e[_])<o&&(o=h),(p=e[_+1])<a&&(a=p),h>s&&(s=h),p>u&&(u=p);d=0!==(d=Math.max(s-o,u-a))?32767/d:0}return i(g,y,r,o,a,d,0),y}function n(e,t,n,r,i){var o,a;if(i===A(e,t,n,r)>0)for(o=t;o<n;o+=r)a=w(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=w(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(S(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(S(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,l,c,h,f){if(e){!f&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=p(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,l,c,h);for(var d,v,m=e;e.prev!==e.next;)if(d=e.prev,v=e.next,h?a(e,l,c,h):o(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),S(e),e=v.next,m=v.next;else if((e=v)===m){f?1===f?i(e=s(r(e),t,n),t,n,l,c,h,2):2===f&&u(e,t,n,l,c,h):i(r(e),t,n,l,c,h,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(m(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<u?s<l?s:l:u<l?u:l,p=i>o?i>a?i:a:o>a?o:a,f=s>u?s>l?s:l:u>l?u:l,v=r.next;v!==t;){if(v.x>=c&&v.x<=p&&v.y>=h&&v.y<=f&&d(i,s,o,u,a,l,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(m(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,h=o.y,f=a.y,v=s<u?s<l?s:l:u<l?u:l,g=c<h?c<f?c:f:h<f?h:f,y=s>u?s>l?s:l:u>l?u:l,_=c>h?c>f?c:f:h>f?h:f,x=p(v,g,t,n,r),b=p(y,_,t,n,r),E=e.prevZ,w=e.nextZ;E&&E.z>=x&&w&&w.z<=b;){if(E.x>=v&&E.x<=y&&E.y>=g&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,h,l,f,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,w.x>=v&&w.x<=y&&w.y>=g&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,h,l,f,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;E&&E.z>=x;){if(E.x>=v&&E.x<=y&&E.y>=g&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,h,l,f,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;w&&w.z<=b;){if(w.x>=v&&w.x<=y&&w.y>=g&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,h,l,f,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function s(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!g(o,a)&&y(o,i,i.next,a)&&b(o,a)&&b(a,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),S(i),S(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,o,a,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=E(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,t,n,o,a,s,0),void i(c,t,n,o,a,s,0)}l=l.next}u=u.next}while(u!==e)}function l(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,p=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<p?i:a,o,c,p,o<p?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),b(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var i=E(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function p(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function d(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||g(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=x(m(e,t,n)),o=x(m(e,t,r)),a=x(m(n,r,e)),s=x(m(n,r,t));return i!==o&&a!==s||!(0!==i||!_(e,n,t))||!(0!==o||!_(e,r,t))||!(0!==a||!_(n,e,r))||!(0!==s||!_(n,t,r))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function E(e,t){var n=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(e,t,n,r){var i=new T(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(A(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(A(e,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[p]-e[d])*(e[f+1]-e[p+1])-(e[p]-e[f])*(e[d+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},8625:e=>{function t(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var n=function(e,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],o)e.__resizeTrigger__=e,e.attachEvent("onresize",t);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var a=e.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=e,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",t)},a.type="text/html",r&&e.appendChild(a),a.data="about:blank",r||e.appendChild(a)}e.__resizeListeners__.push(n)};e.exports="undefined"==typeof window?n:n.bind(window),e.exports.unbind=function(e,n){var r=document.attachEvent,i=e.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=e.__resizeListeners__=[];if(!i.length){if(r)e.detachEvent("onresize",t);else if(e.__resizeTrigger__){var a=e.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",t),delete s.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}}},3024:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},623:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},7971:(e,t,n)=>{var r;!function(i,o,a,s){"use strict";var u,l=["","webkit","Moz","MS","ms","o"],c=o.createElement("div"),h="function",p=Math.round,f=Math.abs,d=Date.now;function v(e,t,n){return setTimeout(E(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function y(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var _=y((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===s)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),x=y((function(e,t){return _(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&u(r,n)}function E(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return typeof e==h?e.apply(t&&t[0]||s,t):e}function S(e,t){return e===s?t:e}function T(e,t,n){g(M(t),(function(t){e.addEventListener(t,n,!1)}))}function A(e,t,n){g(M(t),(function(t){e.removeEventListener(t,n,!1)}))}function C(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function R(e,t){return e.indexOf(t)>-1}function M(e){return e.trim().split(/\s+/g)}function k(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function I(e){return Array.prototype.slice.call(e,0)}function L(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];k(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function P(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<l.length;){if((r=(n=l[o])?n+i:t)in e)return r;o++}return s}var O=1;function D(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}var N="ontouchstart"in i,F=P(i,"PointerEvent")!==s,B=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z="touch",U="mouse",j=25,G=1,V=4,H=8,W=1,X=2,Z=4,q=8,Y=16,K=X|Z,Q=q|Y,J=K|Q,$=["x","y"],ee=["clientX","clientY"];function te(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function ne(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=t&G&&r-i==0,a=t&(V|H)&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=re(t)),i>1&&!n.firstMultiple?n.firstMultiple=re(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,l=t.center=ie(r);t.timeStamp=d(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=ue(u,l),t.distance=se(u,l),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};t.eventType!==G&&o.eventType!==V||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=ae(t.deltaX,t.deltaY);var c,h,p=oe(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=f(p.x)>f(p.y)?p.x:p.y,t.scale=a?(c=a.pointers,se((h=r)[0],h[1],ee)/se(c[0],c[1],ee)):1,t.rotation=a?function(e,t){return ue(t[1],t[0],ee)+ue(e[1],e[0],ee)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(t.eventType!=H&&(u>j||a.velocity===s)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,h=oe(u,l,c);r=h.x,i=h.y,n=f(h.x)>f(h.y)?h.x:h.y,o=ae(l,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var v=e.element;C(t.srcEvent.target,v)&&(v=t.srcEvent.target),t.target=v}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function re(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:p(e.pointers[n].clientX),clientY:p(e.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:t,center:ie(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ie(e){var t=e.length;if(1===t)return{x:p(e[0].clientX),y:p(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:p(n/t),y:p(r/t)}}function oe(e,t,n){return{x:t/e||0,y:n/e||0}}function ae(e,t){return e===t?W:f(e)>=f(t)?e<0?X:Z:t<0?q:Y}function se(e,t,n){n||(n=$);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function ue(e,t,n){n||(n=$);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}te.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)}};var le={mousedown:G,mousemove:2,mouseup:V},ce="mousedown",he="mousemove mouseup";function pe(){this.evEl=ce,this.evWin=he,this.pressed=!1,te.apply(this,arguments)}b(pe,te,{handler:function(e){var t=le[e.type];t&G&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=V),this.pressed&&(t&V&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:U,srcEvent:e}))}});var fe={pointerdown:G,pointermove:2,pointerup:V,pointercancel:H,pointerout:H},de={2:z,3:"pen",4:U,5:"kinect"},ve="pointerdown",me="pointermove pointerup pointercancel";function ge(){this.evEl=ve,this.evWin=me,te.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(ve="MSPointerDown",me="MSPointerMove MSPointerUp MSPointerCancel"),b(ge,te,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=fe[r],o=de[e.pointerType]||e.pointerType,a=o==z,s=k(t,e.pointerId,"pointerId");i&G&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):i&(V|H)&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var ye={touchstart:G,touchmove:2,touchend:V,touchcancel:H};function _e(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,te.apply(this,arguments)}function xe(e,t){var n=I(e.touches),r=I(e.changedTouches);return t&(V|H)&&(n=L(n.concat(r),"identifier",!0)),[n,r]}b(_e,te,{handler:function(e){var t=ye[e.type];if(t===G&&(this.started=!0),this.started){var n=xe.call(this,e,t);t&(V|H)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}}});var be={touchstart:G,touchmove:2,touchend:V,touchcancel:H},Ee="touchstart touchmove touchend touchcancel";function we(){this.evTarget=Ee,this.targetIds={},te.apply(this,arguments)}function Se(e,t){var n=I(e.touches),r=this.targetIds;if(t&(2|G)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=I(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return C(e.target,u)})),t===G)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),t&(V|H)&&delete r[a[i].identifier],i++;return s.length?[L(o.concat(s),"identifier",!0),s]:void 0}b(we,te,{handler:function(e){var t=be[e.type],n=Se.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}});var Te=2500;function Ae(){te.apply(this,arguments);var e=E(this.handler,this);this.touch=new we(this.manager,e),this.mouse=new pe(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ce(e,t){e&G?(this.primaryTouch=t.changedPointers[0].identifier,Re.call(this,t)):e&(V|H)&&Re.call(this,t)}function Re(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),Te)}}function Me(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(Ae,te,{handler:function(e,t,n){var r=n.pointerType==z,i=n.pointerType==U;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Ce.call(this,t,n);else if(i&&Me.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ke=P(c.style,"touchAction"),Ie=ke!==s,Le="compute",Pe="auto",Oe="manipulation",De="none",Ne="pan-x",Fe="pan-y",Be=function(){if(!Ie)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||i.CSS.supports("touch-action",n)})),e}();function ze(e,t){this.manager=e,this.set(t)}ze.prototype={set:function(e){e==Le&&(e=this.compute()),Ie&&this.manager.element.style&&Be[e]&&(this.manager.element.style[ke]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(R(e,De))return De;var t=R(e,Ne),n=R(e,Fe);return t&&n?De:t||n?t?Ne:Fe:R(e,Oe)?Oe:Pe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=R(r,De)&&!Be[De],o=R(r,Fe)&&!Be[Fe],a=R(r,Ne)&&!Be[Ne];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&n&K||a&&n&Q?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ue=1,je=32;function Ge(e){this.options=u({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Ue,this.simultaneous={},this.requireFail=[]}function Ve(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function He(e){return e==Y?"down":e==q?"up":e==X?"left":e==Z?"right":""}function We(e,t){var n=t.manager;return n?n.get(e):e}function Xe(){Ge.apply(this,arguments)}function Ze(){Xe.apply(this,arguments),this.pX=null,this.pY=null}function qe(){Xe.apply(this,arguments)}function Ye(){Ge.apply(this,arguments),this._timer=null,this._input=null}function Ke(){Xe.apply(this,arguments)}function Qe(){Xe.apply(this,arguments)}function Je(){Ge.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $e(e,t){return(t=t||{}).recognizers=S(t.recognizers,$e.defaults.preset),new et(e,t)}function et(e,t){this.options=u({},$e.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(F?ge:B?we:N?Ae:pe))(this,ne),this.touchAction=new ze(this,this.options.touchAction),tt(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function tt(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=P(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ge.prototype={defaults:{},set:function(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=We(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=We(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===k(t,e=We(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=We(e,this);var t=k(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Ve(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Ve(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=je},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(je|Ue)))return!1;e++}return!0},recognize:function(e){var t=u({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=je);56&this.state&&(this.state=Ue),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(Xe,Ge,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(n&H||!i)?16|t:r||i?n&V?8|t:2&t?4|t:2:je}}),b(Ze,Xe,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var e=this.options.direction,t=[];return e&K&&t.push(Fe),e&Q&&t.push(Ne),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&K?(i=0===o?W:o<0?X:Z,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?W:a<0?q:Y,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Xe.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=He(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(qe,Xe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Ye,Ge,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Pe]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(V|H)&&!i)this.reset();else if(e.eventType&G)this.reset(),this._timer=v((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&V)return 8;return je},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&V?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),b(Ke,Xe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Qe,Xe,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|Q,pointers:1},getTouchAction:function(){return Ze.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(K|Q)?t=e.overallVelocity:n&K?t=e.overallVelocityX:n&Q&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&e.eventType&V},emit:function(e){var t=He(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Je,Ge,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Oe]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&G&&0===this.count)return this.failTimeout();if(r&&i&&n){if(e.eventType!=V)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||se(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return je},failTimeout:function(){return this._timer=v((function(){this.state=je}),this.options.interval,this),je},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$e.VERSION="2.0.7",$e.defaults={domEvents:!1,touchAction:Le,enable:!0,inputTarget:null,inputClass:null,preset:[[Ke,{enable:!1}],[qe,{enable:!1},["rotate"]],[Qe,{direction:K}],[Ze,{direction:K},["swipe"]],[Je],[Je,{event:"doubletap",taps:2},["tap"]],[Ye]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},et.prototype={set:function(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Ge)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=k(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return g(M(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return g(M(e),(function(e){t?n[e]&&n[e].splice(k(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=o.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&tt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u($e,{INPUT_START:G,INPUT_MOVE:2,INPUT_END:V,INPUT_CANCEL:H,STATE_POSSIBLE:Ue,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:je,DIRECTION_NONE:W,DIRECTION_LEFT:X,DIRECTION_RIGHT:Z,DIRECTION_UP:q,DIRECTION_DOWN:Y,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:Q,DIRECTION_ALL:J,Manager:et,Input:te,TouchAction:ze,TouchInput:we,MouseInput:pe,PointerEventInput:ge,TouchMouseInput:Ae,SingleTouchInput:_e,Recognizer:Ge,AttrRecognizer:Xe,Tap:Je,Pan:Ze,Swipe:Qe,Pinch:qe,Rotate:Ke,Press:Ye,on:T,off:A,each:g,merge:x,extend:_,assign:u,inherit:b,bindFn:E,prefixed:P}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=$e,(r=function(){return $e}.call(t,n,t,e))===s||(e.exports=r)}(window,document)},1687:(e,t)=>{t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+f]=255&a,f+=d,a/=256,l-=8);e[n+f-d]|=128*v}},8536:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}},4746:(e,t,n)=>{"use strict";var r=n(8536);t.Z=function(e,t){return void 0===t&&(t=!0),{lazyInject:r.makePropertyInjectDecorator(e,t),lazyInjectNamed:r.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:r.makePropertyMultiInjectDecorator(e,t)}}},4934:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0;var r=n(2657),i=n(6984);function o(e,t,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var l=a[u];if(Array.isArray(l))for(var c=0,h=l;c<h.length;c++){var p=h[c];if(p.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+p.key.toString())}else l=[];l.push(i),a[u]=l,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function s(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([s(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},7265:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var r=n(2657),i=n(6984),o=n(5847),a=n(4934),s=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=s,t.inject=function(e){return function(t,n,s){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var u=new o.Metadata(i.INJECT_TAG,e);"number"==typeof s?a.tagParameter(t,n,s,u):a.tagProperty(t,n,u)}}},4939:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0;var r=n(2657),i=n(6984);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},7671:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0;var r=n(6984),i=n(5847),o=n(4934);t.multiInject=function(e){return function(t,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},690:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0;var r=n(6984),i=n(5847),o=n(4934);t.named=function(e){return function(t,n,a){var s=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},4583:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0;var r=n(6984),i=n(5847),o=n(4934);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},6570:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0;var r=n(2657),i=n(6984),o=n(5847);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},7030:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0;var r=n(5847),i=n(4934);t.tagged=function(e,t){return function(n,o,a){var s=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},7343:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0;var r=n(6984),i=n(5847),o=n(4934);t.targetName=function(e){return function(t,n,a){var s=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,s)}}},1737:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0;var r=n(6984),i=n(5847),o=n(4934);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},822:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(9772),i=n(4749),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===r.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},338:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0,t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},2657:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},9772:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0,t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},6984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]},293:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=n(822),s=n(2657),u=n(9772),l=n(6984),c=n(8802),h=n(4060),p=n(9997),f=n(3517),d=n(4749),v=n(1025),m=n(4884),g=n(2376),y=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=u.BindingScopeEnum.Transient;else if(t.defaultScope!==u.BindingScopeEnum.Singleton&&t.defaultScope!==u.BindingScopeEnum.Transient&&t.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new e,s=o([t,n],r).map((function(e){return h.getBindingDictionary(e)})),u=h.getBindingDictionary(a);return s.forEach((function(e){var t;t=u,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n,r=(n=t.id,function(e){return e.moduleId===n});e._bindingDictionary.removeByCondition(r)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(e,t);return this._bindingDictionary.add(e,n),new f.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(s.CANNOT_UNBIND+" "+v.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new g.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,l.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=h.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,u.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,l.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,u.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,l.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,u={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=h.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),p.resolve(n)}},e}();t.Container=y},9231:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var r=n(4749);t.ContainerModule=function(e){this.id=r.id(),this.registry=e};t.AsyncContainerModule=function(e){this.id=r.id(),this.registry=e}},4884:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n},2376:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var r=n(2657),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=i},7758:(e,t,n)=>{"use strict";t.GW=t.zY=t.f3=t.b2=t.W2=void 0,n(6984);var r=n(293);Object.defineProperty(t,"W2",{enumerable:!0,get:function(){return r.Container}});n(9772),n(9231);var i=n(4939);Object.defineProperty(t,"b2",{enumerable:!0,get:function(){return i.injectable}});n(7030),n(690);var o=n(7265);Object.defineProperty(t,"f3",{enumerable:!0,get:function(){return o.inject}});n(4583),n(1737),n(7671),n(7343);var a=n(6570);Object.defineProperty(t,"zY",{enumerable:!0,get:function(){return a.postConstruct}});n(8802),n(4749);var s=n(4934);Object.defineProperty(t,"GW",{enumerable:!0,get:function(){return s.decorate}});n(9838),n(1025),n(6810)},3878:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(4749),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},5847:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(6984),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},8802:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var r=n(6984),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},26:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;t.Plan=function(e,t){this.parentContext=e,this.rootRequest=t}},4060:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0;var r=n(338),i=n(2657),o=n(9772),a=n(6984),s=n(6644),u=n(1025),l=n(3878),c=n(5847),h=n(26),p=n(9560),f=n(7772),d=n(5981);function v(e){return e._bindingDictionary}function m(e,t,n,o,a){var s,l=y(n.container,a.serviceIdentifier);return l.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),l=y(n.container,a.serviceIdentifier)),s=t?l:l.filter((function(e){var t=new f.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=u.getServiceIdentifierAsString(e),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;throw a=u.getServiceIdentifierAsString(e),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function g(e,t,n,r,a,s){var u,l;if(null===a){u=m(e,t,r,null,s),l=new f.Request(n,r,null,u,s);var c=new h.Plan(r,l);r.addPlan(c)}else u=m(e,t,r,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(t){var n=null;if(s.isArray())n=l.addChildRequest(t.serviceIdentifier,t,s);else{if(t.cache)return;n=l}if(t.type===o.BindingTypeEnum.Instance&&null!==t.implementationType){var a=p.getDependencies(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var u=p.getBaseClassDependencyCount(e,t.implementationType);if(a.length<u){var c=i.ARGUMENTS_LENGTH_MISMATCH(p.getFunctionName(t.implementationType));throw new Error(c)}}a.forEach((function(t){g(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function y(e,t){var n=[],r=v(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=y(e.parent,t)),n}t.getBindingDictionary=v,t.plan=function(e,t,n,r,i,o,h,p){void 0===p&&(p=!1);var f=new l.Context(t),v=function(e,t,n,r,i,o){var s=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new c.Metadata(s,n),l=new d.Target(t,"",n,u);if(void 0!==i){var h=new c.Metadata(i,o);l.metadata.push(h)}return l}(n,r,i,0,o,h);try{return g(e,p,i,f,null,v),f}catch(e){throw s.isStackOverflowExeption(e)&&f.plan&&u.circularDependencyToException(f.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",t,new c.Metadata(n,r)),a=new l.Context(e);return new f.Request(t,a,null,[],i)}},3680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n},9560:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var i=n(7265),o=n(2657),a=n(9772),s=n(6984),u=n(1025);Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var l=n(5981);function c(e,t,n,i){var a=e.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(u)}var l=a.userGeneratedMetadata,c=Object.keys(l),f=0===n.length&&c.length>0,d=c.length>n.length,v=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=h(a,e,t,n,r);null!==s&&o.push(s)}return o}(i,t,s,l,f||d?c.length:n.length),m=p(e,n);return r(r([],v),m)}function h(e,t,n,r,s){var u=s[e.toString()]||[],c=f(u),h=!0!==c.unmanaged,p=r[e];if((p=c.inject||c.multiInject||p)instanceof i.LazyServiceIdentifer&&(p=p.unwrap()),h){if(!t&&(p===Object||p===Function||void 0===p)){var d=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(d)}var v=new l.Target(a.TargetTypeEnum.ConstructorArgument,c.targetName,p);return v.metadata=u,v}return null}function p(e,t){for(var n=e.getPropertiesMetadata(t),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=n[u],h=f(n[u]),d=h.targetName||u,v=h.inject||h.multiInject,m=new l.Target(a.TargetTypeEnum.ClassProperty,d,v);m.metadata=c,i.push(m)}var g=Object.getPrototypeOf(t.prototype).constructor;if(g!==Object){var y=p(e,g);i=r(r([],i),y)}return i}function f(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s.INJECT_TAG],multiInject:t[s.MULTI_INJECT_TAG],targetName:t[s.NAME_TAG],unmanaged:t[s.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return c(e,u.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(t,u.getFunctionName(r),r,!0),o=i.map((function(e){return e.metadata.filter((function(e){return e.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,l=i.length-a;return l>0?l:e(t,r)}return 0}},7772:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var r=n(4749),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},5981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var r=n(6984),i=n(4749),o=n(5847),a=n(3680),s=function(){function e(e,t,n,s){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++)if(n[t].key===e)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===r.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=s},1984:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0;var i=n(2657),o=n(9772),a=n(6984);t.resolveInstance=function(e,t,n){var s,u,l=null;t.length>0?(u=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n),l=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(l=new((s=e).bind.apply(s,r([void 0],u))),t,n)):l=new e;return function(e,t){if(Reflect.hasMetadata(a.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(i.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,l),l}},9997:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var r=n(2657),i=n(9772),o=n(6644),a=n(1025),s=n(1984),u=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},l=function e(t){return function(n){n.parentContext.setCurrentRequest(n);var o=n.bindings,l=n.childRequests,c=n.target&&n.target.isArray(),h=!(n.parentRequest&&n.parentRequest.target&&n.target&&n.parentRequest.target.matchesArray(n.target.serviceIdentifier));if(c&&h)return l.map((function(n){return e(t)(n)}));var p=null;if(!n.target.isOptional()||0!==o.length){var f=o[0],d=f.scope===i.BindingScopeEnum.Singleton,v=f.scope===i.BindingScopeEnum.Request;if(d&&f.activated)return f.cache;if(v&&null!==t&&t.has(f.id))return t.get(f.id);if(f.type===i.BindingTypeEnum.ConstantValue)p=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Function)p=f.cache,f.activated=!0;else if(f.type===i.BindingTypeEnum.Constructor)p=f.implementationType;else if(f.type===i.BindingTypeEnum.DynamicValue&&null!==f.dynamicValue)p=u("toDynamicValue",f.serviceIdentifier,(function(){return f.dynamicValue(n.parentContext)}));else if(f.type===i.BindingTypeEnum.Factory&&null!==f.factory)p=u("toFactory",f.serviceIdentifier,(function(){return f.factory(n.parentContext)}));else if(f.type===i.BindingTypeEnum.Provider&&null!==f.provider)p=u("toProvider",f.serviceIdentifier,(function(){return f.provider(n.parentContext)}));else{if(f.type!==i.BindingTypeEnum.Instance||null===f.implementationType){var m=a.getServiceIdentifierAsString(n.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+m)}p=s.resolveInstance(f.implementationType,l,e(t))}return"function"==typeof f.onActivation&&(p=f.onActivation(n.parentContext,p)),d&&(f.cache=p,f.activated=!0),v&&null!==t&&!t.has(f.id)&&t.set(f.id,p),p}}};t.resolve=function(e){return l(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},1042:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var r=n(9772),i=n(5429),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},5186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var r=n(1042),i=n(8245),o=n(5647),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},8245:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var r=n(5647),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},3517:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var r=n(2657),i=n(9772),o=n(5186),a=n(5429),s=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=s},5429:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var r=n(8245),i=n(5647),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},5647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var r=n(8245),i=n(9838),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},9838:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var r=n(6984),i=n(5847);t.traverseAncerstors=function e(t,n){var r=t.parentRequest;return null!==r&&(!!n(r)||e(r,n))};var o=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=o;var a=o(r.NAMED_TAG);t.namedConstraint=a,t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},6810:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0,t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}},6644:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0;var r=n(2657);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},4749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}},1025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0;var r=n(2657);function i(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function o(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||o(e.parentRequest,t))}function a(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=i,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=a(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(o(t,t.serviceIdentifier)){var n=function(e){return function e(t,n){void 0===n&&(n=[]);var r=i(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(t);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=a},2398:(e,t,n)=>{var r=n(1873)(n(1815),"DataView");e.exports=r},5607:(e,t,n)=>{var r=n(4191),i=n(7308),o=n(2692),a=n(1254),s=n(1787);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},3537:(e,t,n)=>{var r=n(4383),i=n(6806),o=n(9686),a=n(1789),s=n(1893);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},9070:(e,t,n)=>{var r=n(1873)(n(1815),"Map");e.exports=r},126:(e,t,n)=>{var r=n(1590),i=n(2994),o=n(3323),a=n(1229),s=n(802);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},4724:(e,t,n)=>{var r=n(1873)(n(1815),"Promise");e.exports=r},2059:(e,t,n)=>{var r=n(1873)(n(1815),"Set");e.exports=r},5901:(e,t,n)=>{var r=n(126),i=n(2372),o=n(7989);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},899:(e,t,n)=>{var r=n(3537),i=n(9334),o=n(9283),a=n(5331),s=n(8013),u=n(2498);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,e.exports=l},6122:(e,t,n)=>{var r=n(1815).Symbol;e.exports=r},8623:(e,t,n)=>{var r=n(1815).Uint8Array;e.exports=r},2469:(e,t,n)=>{var r=n(1873)(n(1815),"WeakMap");e.exports=r},7917:e=>{e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},9111:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},5766:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},5930:(e,t,n)=>{var r=n(1172);e.exports=function(e,t){return!(null==e||!e.length)&&r(e,t,0)>-1}},4909:e=>{e.exports=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}},8450:(e,t,n)=>{var r=n(8516),i=n(4205),o=n(7451),a=n(5254),s=n(2766),u=n(4778),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),h=!n&&!c&&a(e),p=!n&&!c&&!h&&u(e),f=n||c||h||p,d=f?r(e.length,String):[],v=d.length;for(var m in e)!t&&!l.call(e,m)||f&&("length"==m||h&&("offset"==m||"parent"==m)||p&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||s(m,v))||d.push(m);return d}},4308:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},8165:e=>{e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},9267:e=>{e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},6041:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},4971:e=>{e.exports=function(e){return e.split("")}},6053:e=>{var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},5596:(e,t,n)=>{var r=n(5447),i=n(9474);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},846:(e,t,n)=>{var r=n(5447),i=n(9474),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var a=e[t];o.call(e,t)&&i(a,n)&&(void 0!==n||t in e)||r(e,t,n)}},5290:(e,t,n)=>{var r=n(9474);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},368:(e,t,n)=>{var r=n(3547),i=n(9666);e.exports=function(e,t){return e&&r(t,i(t),e)}},4843:(e,t,n)=>{var r=n(3547),i=n(9951);e.exports=function(e,t){return e&&r(t,i(t),e)}},5447:(e,t,n)=>{var r=n(5301);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},3079:e=>{e.exports=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}},9878:(e,t,n)=>{var r=n(899),i=n(9111),o=n(846),a=n(368),s=n(4843),u=n(9694),l=n(5729),c=n(1030),h=n(8605),p=n(4237),f=n(7258),d=n(472),v=n(2118),m=n(7347),g=n(9393),y=n(7451),_=n(5254),x=n(3038),b=n(7276),E=n(5496),w=n(9666),S=n(9951),T="[object Arguments]",A="[object Function]",C="[object Object]",R={};R[T]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object DataView]"]=R["[object Boolean]"]=R["[object Date]"]=R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Map]"]=R["[object Number]"]=R[C]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object Symbol]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Error]"]=R[A]=R["[object WeakMap]"]=!1,e.exports=function e(t,n,M,k,I,L){var P,O=1&n,D=2&n,N=4&n;if(M&&(P=I?M(t,k,I,L):M(t)),void 0!==P)return P;if(!b(t))return t;var F=y(t);if(F){if(P=v(t),!O)return l(t,P)}else{var B=d(t),z=B==A||"[object GeneratorFunction]"==B;if(_(t))return u(t,O);if(B==C||B==T||z&&!I){if(P=D||z?{}:g(t),!O)return D?h(t,s(P,t)):c(t,a(P,t))}else{if(!R[B])return I?t:{};P=m(t,B,O)}}L||(L=new r);var U=L.get(t);if(U)return U;L.set(t,P),E(t)?t.forEach((function(r){P.add(e(r,n,M,r,t,L))})):x(t)&&t.forEach((function(r,i){P.set(i,e(r,n,M,i,t,L))}));var j=F?void 0:(N?D?f:p:D?S:w)(t);return i(j||t,(function(r,i){j&&(r=t[i=r]),o(P,i,e(r,n,M,i,t,L))})),P}},6170:(e,t,n)=>{var r=n(7276),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},3783:e=>{e.exports=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},2649:(e,t,n)=>{var r=n(8085)();e.exports=r},7275:(e,t,n)=>{var r=n(3975),i=n(6206);e.exports=function(e,t){for(var n=0,o=(t=r(t,e)).length;null!=e&&n<o;)e=e[i(t[n++])];return n&&n==o?e:void 0}},3678:(e,t,n)=>{var r=n(8165),i=n(7451);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},8663:(e,t,n)=>{var r=n(6122),i=n(9200),o=n(7002),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},1172:(e,t,n)=>{var r=n(3783),i=n(6223),o=n(7893);e.exports=function(e,t,n){return t==t?o(e,t,n):r(e,i,n)}},6881:e=>{e.exports=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}},7238:(e,t,n)=>{var r=n(8663),i=n(8857);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},4017:(e,t,n)=>{var r=n(468),i=n(8857);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},468:(e,t,n)=>{var r=n(899),i=n(9757),o=n(4033),a=n(6106),s=n(472),u=n(7451),l=n(5254),c=n(4778),h="[object Arguments]",p="[object Array]",f="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,m,g){var y=u(e),_=u(t),x=y?p:s(e),b=_?p:s(t),E=(x=x==h?f:x)==f,w=(b=b==h?f:b)==f,S=x==b;if(S&&l(e)){if(!l(t))return!1;y=!0,E=!1}if(S&&!E)return g||(g=new r),y||c(e)?i(e,t,n,v,m,g):o(e,t,x,n,v,m,g);if(!(1&n)){var T=E&&d.call(e,"__wrapped__"),A=w&&d.call(t,"__wrapped__");if(T||A){var C=T?e.value():e,R=A?t.value():t;return g||(g=new r),m(C,R,n,v,g)}}return!!S&&(g||(g=new r),a(e,t,n,v,m,g))}},6099:(e,t,n)=>{var r=n(472),i=n(8857);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},6223:e=>{e.exports=function(e){return e!=e}},328:(e,t,n)=>{var r=n(6001),i=n(7406),o=n(7276),a=n(9045),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,h=l.hasOwnProperty,p=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?p:s).test(a(e))}},2598:(e,t,n)=>{var r=n(472),i=n(8857);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},2655:(e,t,n)=>{var r=n(8663),i=n(5077),o=n(8857),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},9908:(e,t,n)=>{var r=n(6264),i=n(3791),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},4663:(e,t,n)=>{var r=n(7276),i=n(6264),o=n(9537),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&n.push(s);return n}},1669:(e,t,n)=>{var r=n(899),i=n(5596),o=n(2649),a=n(7006),s=n(7276),u=n(9951),l=n(5988);e.exports=function e(t,n,c,h,p){t!==n&&o(n,(function(o,u){if(p||(p=new r),s(o))a(t,n,u,c,e,h,p);else{var f=h?h(l(t,u),o,u+"",t,n,p):void 0;void 0===f&&(f=o),i(t,u,f)}}),u)}},7006:(e,t,n)=>{var r=n(5596),i=n(9694),o=n(9436),a=n(5729),s=n(9393),u=n(4205),l=n(7451),c=n(6155),h=n(5254),p=n(6001),f=n(7276),d=n(6416),v=n(4778),m=n(5988),g=n(4413);e.exports=function(e,t,n,y,_,x,b){var E=m(e,n),w=m(t,n),S=b.get(w);if(S)r(e,n,S);else{var T=x?x(E,w,n+"",e,t,b):void 0,A=void 0===T;if(A){var C=l(w),R=!C&&h(w),M=!C&&!R&&v(w);T=w,C||R||M?l(E)?T=E:c(E)?T=a(E):R?(A=!1,T=i(w,!0)):M?(A=!1,T=o(w,!0)):T=[]:d(w)||u(w)?(T=E,u(E)?T=g(E):f(E)&&!p(E)||(T=s(w))):A=!1}A&&(b.set(w,T),_(T,w,y,x,b),b.delete(w)),r(e,n,T)}}},9342:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},7537:(e,t,n)=>{var r=n(4308),i=n(1172),o=n(6881),a=n(7303),s=n(5729),u=Array.prototype.splice;e.exports=function(e,t,n,l){var c=l?o:i,h=-1,p=t.length,f=e;for(e===t&&(t=s(t)),n&&(f=r(e,a(n)));++h<p;)for(var d=0,v=t[h],m=n?n(v):v;(d=c(f,m,d,l))>-1;)f!==e&&u.call(f,d,1),u.call(e,d,1);return e}},7717:(e,t,n)=>{var r=n(3620),i=n(7576),o=n(5519);e.exports=function(e,t){return o(i(e,t,r),e+"")}},7104:(e,t,n)=>{var r=n(452),i=n(5301),o=n(3620),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},2785:e=>{e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}},8516:e=>{e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},3939:(e,t,n)=>{var r=n(6122),i=n(4308),o=n(7451),a=n(5876),s=r?r.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},6249:(e,t,n)=>{var r=n(5123),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},7303:e=>{e.exports=function(e){return function(t){return e(t)}}},4550:(e,t,n)=>{var r=n(5901),i=n(5930),o=n(4909),a=n(8231),s=n(4330),u=n(4554);e.exports=function(e,t,n){var l=-1,c=i,h=e.length,p=!0,f=[],d=f;if(n)p=!1,c=o;else if(h>=200){var v=t?null:s(e);if(v)return u(v);p=!1,c=a,d=new r}else d=t?[]:f;e:for(;++l<h;){var m=e[l],g=t?t(m):m;if(m=n||0!==m?m:0,p&&g==g){for(var y=d.length;y--;)if(d[y]===g)continue e;t&&d.push(g),f.push(m)}else c(d,g,n)||(d!==f&&d.push(g),f.push(m))}return f}},8231:e=>{e.exports=function(e,t){return e.has(t)}},3975:(e,t,n)=>{var r=n(7451),i=n(4936),o=n(1600),a=n(373);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},3480:(e,t,n)=>{var r=n(2785);e.exports=function(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:r(e,t,n)}},2457:(e,t,n)=>{var r=n(8623);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},9694:(e,t,n)=>{e=n.nmd(e);var r=n(1815),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=s?s(n):new e.constructor(n);return e.copy(r),r}},7882:(e,t,n)=>{var r=n(2457);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},1309:e=>{var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},2944:(e,t,n)=>{var r=n(6122),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},9436:(e,t,n)=>{var r=n(2457);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},5729:e=>{e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},3547:(e,t,n)=>{var r=n(846),i=n(5447);e.exports=function(e,t,n,o){var a=!n;n||(n={});for(var s=-1,u=t.length;++s<u;){var l=t[s],c=o?o(n[l],e[l],l,n,e):void 0;void 0===c&&(c=e[l]),a?i(n,l,c):r(n,l,c)}return n}},1030:(e,t,n)=>{var r=n(3547),i=n(7947);e.exports=function(e,t){return r(e,i(e),t)}},8605:(e,t,n)=>{var r=n(3547),i=n(6192);e.exports=function(e,t){return r(e,i(e),t)}},4804:(e,t,n)=>{var r=n(1815)["__core-js_shared__"];e.exports=r},2945:(e,t,n)=>{var r=n(7717),i=n(418);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,a)}return t}))}},8085:e=>{e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}},8065:(e,t,n)=>{var r=n(3480),i=n(8370),o=n(1721),a=n(373);e.exports=function(e){return function(t){t=a(t);var n=i(t)?o(t):void 0,s=n?n[0]:t.charAt(0),u=n?r(n,1).join(""):t.slice(1);return s[e]()+u}}},3602:(e,t,n)=>{var r=n(9267),i=n(3334),o=n(4836),a=RegExp("['’]","g");e.exports=function(e){return function(t){return r(o(i(t).replace(a,"")),e,"")}}},4330:(e,t,n)=>{var r=n(2059),i=n(2185),o=n(4554),a=r&&1/o(new r([,-0]))[1]==1/0?function(e){return new r(e)}:i;e.exports=a},5276:(e,t,n)=>{var r=n(9342)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});e.exports=r},5301:(e,t,n)=>{var r=n(1873),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},9757:(e,t,n)=>{var r=n(5901),i=n(6041),o=n(8231);e.exports=function(e,t,n,a,s,u){var l=1&n,c=e.length,h=t.length;if(c!=h&&!(l&&h>c))return!1;var p=u.get(e),f=u.get(t);if(p&&f)return p==t&&f==e;var d=-1,v=!0,m=2&n?new r:void 0;for(u.set(e,t),u.set(t,e);++d<c;){var g=e[d],y=t[d];if(a)var _=l?a(y,g,d,t,e,u):a(g,y,d,e,t,u);if(void 0!==_){if(_)continue;v=!1;break}if(m){if(!i(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,u)))return m.push(t)}))){v=!1;break}}else if(g!==y&&!s(g,y,n,a,u)){v=!1;break}}return u.delete(e),u.delete(t),v}},4033:(e,t,n)=>{var r=n(6122),i=n(8623),o=n(9474),a=n(9757),s=n(8783),u=n(4554),l=r?r.prototype:void 0,c=l?l.valueOf:void 0;e.exports=function(e,t,n,r,l,h,p){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!h(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var f=s;case"[object Set]":var d=1&r;if(f||(f=u),e.size!=t.size&&!d)return!1;var v=p.get(e);if(v)return v==t;r|=2,p.set(e,t);var m=a(f(e),f(t),r,l,h,p);return p.delete(e),m;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},6106:(e,t,n)=>{var r=n(4237),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var u=1&n,l=r(e),c=l.length;if(c!=r(t).length&&!u)return!1;for(var h=c;h--;){var p=l[h];if(!(u?p in t:i.call(t,p)))return!1}var f=s.get(e),d=s.get(t);if(f&&d)return f==t&&d==e;var v=!0;s.set(e,t),s.set(t,e);for(var m=u;++h<c;){var g=e[p=l[h]],y=t[p];if(o)var _=u?o(y,g,p,t,e,s):o(g,y,p,e,t,s);if(!(void 0===_?g===y||a(g,y,n,o,s):_)){v=!1;break}m||(m="constructor"==p)}if(v&&!m){var x=e.constructor,b=t.constructor;x==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(v=!1)}return s.delete(e),s.delete(t),v}},3518:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},4237:(e,t,n)=>{var r=n(3678),i=n(7947),o=n(9666);e.exports=function(e){return r(e,o,i)}},7258:(e,t,n)=>{var r=n(3678),i=n(6192),o=n(9951);e.exports=function(e){return r(e,o,i)}},110:(e,t,n)=>{var r=n(3913);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},1873:(e,t,n)=>{var r=n(328),i=n(4995);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},9051:(e,t,n)=>{var r=n(3585)(Object.getPrototypeOf,Object);e.exports=r},9200:(e,t,n)=>{var r=n(6122),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},7947:(e,t,n)=>{var r=n(5766),i=n(3395),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},6192:(e,t,n)=>{var r=n(8165),i=n(9051),o=n(7947),a=n(3395),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:a;e.exports=s},472:(e,t,n)=>{var r=n(2398),i=n(9070),o=n(4724),a=n(2059),s=n(2469),u=n(8663),l=n(9045),c="[object Map]",h="[object Promise]",p="[object Set]",f="[object WeakMap]",d="[object DataView]",v=l(r),m=l(i),g=l(o),y=l(a),_=l(s),x=u;(r&&x(new r(new ArrayBuffer(1)))!=d||i&&x(new i)!=c||o&&x(o.resolve())!=h||a&&x(new a)!=p||s&&x(new s)!=f)&&(x=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case v:return d;case m:return c;case g:return h;case y:return p;case _:return f}return t}),e.exports=x},4995:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},8370:e=>{var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},3653:e=>{var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},4191:(e,t,n)=>{var r=n(9386);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},7308:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},2692:(e,t,n)=>{var r=n(9386),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},1254:(e,t,n)=>{var r=n(9386),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},1787:(e,t,n)=>{var r=n(9386);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},2118:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},7347:(e,t,n)=>{var r=n(2457),i=n(7882),o=n(1309),a=n(2944),s=n(9436);e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Symbol]":return a(e)}}},9393:(e,t,n)=>{var r=n(6170),i=n(9051),o=n(6264);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},2766:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n}},418:(e,t,n)=>{var r=n(9474),i=n(9732),o=n(2766),a=n(7276);e.exports=function(e,t,n){if(!a(n))return!1;var s=typeof t;return!!("number"==s?i(n)&&o(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},4936:(e,t,n)=>{var r=n(7451),i=n(5876),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||a.test(e)||!o.test(e)||null!=t&&e in Object(t)}},3913:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},7406:(e,t,n)=>{var r,i=n(4804),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},6264:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},4383:e=>{e.exports=function(){this.__data__=[],this.size=0}},6806:(e,t,n)=>{var r=n(5290),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},9686:(e,t,n)=>{var r=n(5290);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},1789:(e,t,n)=>{var r=n(5290);e.exports=function(e){return r(this.__data__,e)>-1}},1893:(e,t,n)=>{var r=n(5290);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},1590:(e,t,n)=>{var r=n(5607),i=n(3537),o=n(9070);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},2994:(e,t,n)=>{var r=n(110);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},3323:(e,t,n)=>{var r=n(110);e.exports=function(e){return r(this,e).get(e)}},1229:(e,t,n)=>{var r=n(110);e.exports=function(e){return r(this,e).has(e)}},802:(e,t,n)=>{var r=n(110);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},8783:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},7879:(e,t,n)=>{var r=n(2713);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},9386:(e,t,n)=>{var r=n(1873)(Object,"create");e.exports=r},3791:(e,t,n)=>{var r=n(3585)(Object.keys,Object);e.exports=r},9537:e=>{e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},3971:(e,t,n)=>{e=n.nmd(e);var r=n(3518),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s},7002:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},3585:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},7576:(e,t,n)=>{var r=n(7917),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=o[a];return l[t]=n(u),r(e,this,l)}}},1815:(e,t,n)=>{var r=n(3518),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},5988:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},2372:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},7989:e=>{e.exports=function(e){return this.__data__.has(e)}},4554:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},5519:(e,t,n)=>{var r=n(7104),i=n(6749)(r);e.exports=i},6749:e=>{var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},9334:(e,t,n)=>{var r=n(3537);e.exports=function(){this.__data__=new r,this.size=0}},9283:e=>{e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},5331:e=>{e.exports=function(e){return this.__data__.get(e)}},8013:e=>{e.exports=function(e){return this.__data__.has(e)}},2498:(e,t,n)=>{var r=n(3537),i=n(9070),o=n(126);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},7893:e=>{e.exports=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}},1721:(e,t,n)=>{var r=n(4971),i=n(8370),o=n(4071);e.exports=function(e){return i(e)?o(e):r(e)}},1600:(e,t,n)=>{var r=n(7879),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(o,"$1"):n||e)})),t}));e.exports=a},6206:(e,t,n)=>{var r=n(5876);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},9045:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},5123:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},4071:e=>{var t="\\ud800-\\udfff",n="["+t+"]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^"+t+"]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",u="(?:"+r+"|"+i+")?",l="[\\ufe0e\\ufe0f]?",c=l+u+"(?:\\u200d(?:"+[o,a,s].join("|")+")"+l+u+")*",h="(?:"+[o+r+"?",r,a,s,n].join("|")+")",p=RegExp(i+"(?="+i+")|"+h+c,"g");e.exports=function(e){return e.match(p)||[]}},3351:e=>{var t="\\ud800-\\udfff",n="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+o+"]",s="\\d+",u="["+n+"]",l="["+r+"]",c="[^"+t+o+s+n+r+i+"]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",f="["+i+"]",d="(?:"+l+"|"+c+")",v="(?:"+f+"|"+c+")",m="(?:['’](?:d|ll|m|re|s|t|ve))?",g="(?:['’](?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_="[\\ufe0e\\ufe0f]?",x=_+y+"(?:\\u200d(?:"+["[^"+t+"]",h,p].join("|")+")"+_+y+")*",b="(?:"+[u,h,p].join("|")+")"+x,E=RegExp([f+"?"+l+"+"+m+"(?="+[a,f,"$"].join("|")+")",v+"+"+g+"(?="+[a,f+d,"$"].join("|")+")",f+"?"+d+"+"+m,f+"+"+g,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",s,b].join("|"),"g");e.exports=function(e){return e.match(E)||[]}},1676:(e,t,n)=>{var r=n(8705),i=n(3602)((function(e,t,n){return t=t.toLowerCase(),e+(n?r(t):t)}));e.exports=i},8705:(e,t,n)=>{var r=n(373),i=n(9411);e.exports=function(e){return i(r(e).toLowerCase())}},4552:(e,t,n)=>{var r=n(3079),i=n(7105);e.exports=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==t&&(t=(t=i(t))==t?t:0),r(i(e),t,n)}},2803:(e,t,n)=>{var r=n(9878);e.exports=function(e){return r(e,5)}},452:e=>{e.exports=function(e){return function(){return e}}},2837:(e,t,n)=>{var r=n(7276),i=n(1779),o=n(7105),a=Math.max,s=Math.min;e.exports=function(e,t,n){var u,l,c,h,p,f,d=0,v=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=u,r=l;return u=l=void 0,d=t,h=e.apply(r,n)}function _(e){var n=e-f;return void 0===f||n>=t||n<0||m&&e-d>=c}function x(){var e=i();if(_(e))return b(e);p=setTimeout(x,function(e){var n=t-(e-f);return m?s(n,c-(e-d)):n}(e))}function b(e){return p=void 0,g&&u?y(e):(u=l=void 0,h)}function E(){var e=i(),n=_(e);if(u=arguments,l=this,f=e,n){if(void 0===p)return function(e){return d=e,p=setTimeout(x,t),v?y(e):h}(f);if(m)return clearTimeout(p),p=setTimeout(x,t),y(f)}return void 0===p&&(p=setTimeout(x,t)),h}return t=o(t)||0,r(n)&&(v=!!n.leading,c=(m="maxWait"in n)?a(o(n.maxWait)||0,t):c,g="trailing"in n?!!n.trailing:g),E.cancel=function(){void 0!==p&&clearTimeout(p),d=0,u=f=l=p=void 0},E.flush=function(){return void 0===p?h:b(i())},E}},3334:(e,t,n)=>{var r=n(5276),i=n(373),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=i(e))&&e.replace(o,r).replace(a,"")}},9474:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},5399:(e,t,n)=>{var r=n(7275);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},3620:e=>{e.exports=function(e){return e}},4205:(e,t,n)=>{var r=n(7238),i=n(8857),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},7451:e=>{var t=Array.isArray;e.exports=t},9732:(e,t,n)=>{var r=n(6001),i=n(5077);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},6155:(e,t,n)=>{var r=n(9732),i=n(8857);e.exports=function(e){return i(e)&&r(e)}},676:(e,t,n)=>{var r=n(8663),i=n(8857);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==r(e)}},5254:(e,t,n)=>{e=n.nmd(e);var r=n(1815),i=n(1778),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,s=a&&a.exports===o?r.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;e.exports=u},4409:(e,t,n)=>{var r=n(4017);e.exports=function(e,t){return r(e,t)}},6001:(e,t,n)=>{var r=n(8663),i=n(7276);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},5077:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},3038:(e,t,n)=>{var r=n(6099),i=n(7303),o=n(3971),a=o&&o.isMap,s=a?i(a):r;e.exports=s},9673:e=>{e.exports=function(e){return null==e}},7307:(e,t,n)=>{var r=n(8663),i=n(8857);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==r(e)}},7276:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},8857:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},6416:(e,t,n)=>{var r=n(8663),i=n(9051),o=n(8857),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},5496:(e,t,n)=>{var r=n(2598),i=n(7303),o=n(3971),a=o&&o.isSet,s=a?i(a):r;e.exports=s},7405:(e,t,n)=>{var r=n(8663),i=n(7451),o=n(8857);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==r(e)}},5876:(e,t,n)=>{var r=n(8663),i=n(8857);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==r(e)}},4778:(e,t,n)=>{var r=n(2655),i=n(7303),o=n(3971),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},9484:e=>{e.exports=function(e){return void 0===e}},9666:(e,t,n)=>{var r=n(8450),i=n(9908),o=n(9732);e.exports=function(e){return o(e)?r(e):i(e)}},9951:(e,t,n)=>{var r=n(8450),i=n(4663),o=n(9732);e.exports=function(e){return o(e)?r(e,!0):i(e)}},2713:(e,t,n)=>{var r=n(126);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},3013:(e,t,n)=>{var r=n(1669),i=n(2945)((function(e,t,n){r(e,t,n)}));e.exports=i},1685:(e,t,n)=>{var r=n(1669),i=n(2945)((function(e,t,n,i){r(e,t,n,i)}));e.exports=i},2185:e=>{e.exports=function(){}},1779:(e,t,n)=>{var r=n(1815);e.exports=function(){return r.Date.now()}},4573:(e,t,n)=>{var r=n(7717)(n(2523));e.exports=r},2523:(e,t,n)=>{var r=n(7537);e.exports=function(e,t){return e&&e.length&&t&&t.length?r(e,t):e}},3395:e=>{e.exports=function(){return[]}},1778:e=>{e.exports=function(){return!1}},9871:(e,t,n)=>{var r=n(2837),i=n(7276);e.exports=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(e,t,{leading:o,maxWait:t,trailing:a})}},7105:(e,t,n)=>{var r=n(6249),i=n(7276),o=n(5876),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=s.test(e);return n||u.test(e)?l(e.slice(2),n?2:8):a.test(e)?NaN:+e}},4413:(e,t,n)=>{var r=n(3547),i=n(9951);e.exports=function(e){return r(e,i(e))}},373:(e,t,n)=>{var r=n(3939);e.exports=function(e){return null==e?"":r(e)}},8174:(e,t,n)=>{var r=n(4550);e.exports=function(e){return e&&e.length?r(e):[]}},9411:(e,t,n)=>{var r=n(8065)("toUpperCase");e.exports=r},4836:(e,t,n)=>{var r=n(6053),i=n(3653),o=n(373),a=n(3351);e.exports=function(e,t,n){return e=o(e),void 0===(t=n?void 0:t)?i(e)?a(e):r(e):e.match(t)||[]}},2145:function(e){e.exports=function(){"use strict";var e,t,n;function r(r,i){if(e)if(t){var o="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",a={};e(a),n=i(a),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=i;else e=i}return r(0,(function(e){function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=r;function r(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},r.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},r.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},r.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var i=o;function o(e,t){this.x=e,this.y=t}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function u(e,t,r,i){var o=new n(e,t,r,i);return function(e){return o.solve(e)}}var l=u(.25,.1,.25,1);function c(e,t,n){return Math.min(n,Math.max(t,e))}function h(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function p(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var o=i[r];for(var a in o)e[a]=o[a]}return e}var f=1;function d(){return f++}function v(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function m(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function g(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function y(e,t){return-1!==e.indexOf(t,e.length-t.length)}function _(e,t,n){var r={};for(var i in e)r[i]=t.call(n||this,e[i],i,e);return r}function x(e,t,n){var r={};for(var i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function b(e){return Array.isArray(e)?e.map(b):"object"==typeof e&&e?_(e,b):e}var E={};function w(e){E[e]||("undefined"!=typeof console&&console.warn(e),E[e]=!0)}function S(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function T(e){for(var t=0,n=0,r=e.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)t+=((a=e[i]).x-(o=e[n]).x)*(o.y+a.y);return t}function A(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,n,r,i){var o=r||i;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){var n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}var R=null;function M(e){if(null==R){var t=e.navigator?e.navigator.userAgent:null;R=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return R}function k(e){try{var t=a[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}var I,L,P,O,D=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),N=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,F=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,B={now:D,frame:function(e){var t=N(e);return{cancel:function(){return F(t)}}},getImageData:function(e,t){void 0===t&&(t=0);var n=a.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return I||(I=a.document.createElement("a")),I.href=e,I.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==L&&(L=a.matchMedia("(prefers-reduced-motion: reduce)")),L.matches)}},z={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(e){!j&&O&&(G?V(e):P=e)}},j=!1,G=!1;function V(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,O),e.isContextLost())return;U.supported=!0}catch(e){}e.deleteTexture(t),j=!0}a.document&&((O=a.document.createElement("img")).onload=function(){P&&V(P),P=null,G=!0},O.onerror=function(){j=!0,P=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",W=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function X(e){return 0===e.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var e=function(){for(var e="",t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},W.prototype.normalizeStyleURL=function(e,t){if(!X(e))return e;var n=K(e);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||t)},W.prototype.normalizeGlyphsURL=function(e,t){if(!X(e))return e;var n=K(e);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||t)},W.prototype.normalizeSourceURL=function(e,t){if(!X(e))return e;var n=K(e);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)},W.prototype.normalizeSpriteURL=function(e,t,n,r){var i=K(e);return X(e)?(i.path="/styles/v1"+i.path+"/sprite"+t+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+t+n,Q(i))},W.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!X(e))return e;var n=K(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(B.devicePixelRatio>=2||512===t?"@2x":"")+(U.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||z.ACCESS_TOKEN;return z.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},W.prototype.canonicalizeTileURL=function(e,t){var n=K(e);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return e;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return t&&(i=i.filter((function(e){return!e.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},W.prototype.canonicalizeTileset=function(e,t){for(var n=!!t&&X(t),r=[],i=0,o=e.tiles||[];i<o.length;i+=1){var a=o[i];q(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},W.prototype._makeAPIURL=function(e,t){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=K(z.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){var i=e.params.indexOf("secure");i>=0&&e.params.splice(i,1)}if("/"!==r.path&&(e.path=""+r.path+e.path),!z.REQUIRE_ACCESS_TOKEN)return Q(e);if(!(t=t||z.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return e.params=e.params.filter((function(e){return-1===e.indexOf("access_token")})),e.params.push("access_token="+t),Q(e)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function q(e){return Z.test(e)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(e){var t=e.match(Y);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Q(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function J(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(t[1]).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return null}}var $=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(e){var t,n=J(z.ACCESS_TOKEN);return t=n&&n.u?a.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))}))):z.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},$.prototype.fetchEventData=function(){var e=k("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{var r=a.localStorage.getItem(t);r&&(this.eventData=JSON.parse(r));var i=a.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){w("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var e=k("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{a.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){w("Unable to write to LocalStorage")}},$.prototype.processRequests=function(e){},$.prototype.postEvent=function(e,t,n,r){var i=this;if(z.EVENTS_URL){var o=K(z.EVENTS_URL);o.params.push("access_token="+(r||z.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:H,userId:this.anonId},s=t?p(a,t):a,u={url:Q(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=be(u,(function(e){i.pendingRequest=null,n(e),i.saveEventData(),i.processRequests(r)}))}},$.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var ee,te,ne=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(e,t,n,r){this.skuToken=n;var i=!(!r&&!z.ACCESS_TOKEN),o=Array.isArray(e)&&e.some((function(e){return X(e)||q(e)}));z.EVENTS_URL&&i&&o&&this.queueRequest({id:t,timestamp:Date.now()},r)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=v()),this.postEvent(i,{skuToken:this.skuToken},(function(e){e||r&&(t.success[r]=!0)}),e))}},t}($),re=new(function(e){function t(t){e.call(this,"appUserTurnstile"),this._customAccessToken=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(e,t){z.EVENTS_URL&&z.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return X(e)||q(e)}))&&this.queueRequest(Date.now(),t)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=J(z.ACCESS_TOKEN),r=n?n.u:z.ACCESS_TOKEN,i=r!==this.eventData.tokenU;m(this.anonId)||(this.anonId=v(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(e){e||(t.eventData.lastSuccess=o,t.eventData.tokenU=r)}),e)}},t}($)),ie=re.postTurnstileEvent.bind(re),oe=new ne,ae=oe.postMapLoadEvent.bind(oe),se=500,ue=50;function le(){a.caches&&!ee&&(ee=a.caches.open("mapbox-tiles"))}function ce(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var he,pe=1/0;function fe(){return null==he&&(he=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),he}var de={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(de);var ve,me,ge=function(e){function t(t,n,r){401===n&&q(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,t),this.status=n,this.url=r,this.name=this.constructor.name,this.message=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),ye=A()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},_e=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(ye())&&!/^\w+:/.test(n))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(e,t){var n,r=new a.AbortController,i=new a.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:ye(),signal:r.signal}),o=!1,s=!1,u=(n=i.url).indexOf("sku=")>0&&q(n);"json"===e.type&&i.headers.set("Accept","application/json");var l=function(n,r,o){if(!s){if(n&&"SecurityError"!==n.message&&w(n),r&&o)return c(r);var l=Date.now();a.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return c(n,r,l)}return t(new ge(n.statusText,n.status,e.url))})).catch((function(e){20!==e.code&&t(new Error(e.message))}))}},c=function(n,r,u){("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((function(e){s||(r&&u&&function(e,t,n){if(le(),ee){var r={status:t.status,statusText:t.statusText,headers:new a.Headers};t.headers.forEach((function(e,t){return r.headers.set(t,e)}));var i=C(t.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(e,t){if(void 0===te)try{new Response(new ReadableStream),te=!0}catch(e){te=!1}te?t(e.body):e.blob().then(t)}(t,(function(t){var n=new a.Response(t,r);le(),ee&&ee.then((function(t){return t.put(ce(e.url),n)})).catch((function(e){return w(e.message)}))})))}}(i,r,u),o=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(e){s||t(new Error(e.message))}))};return u?function(e,t){if(le(),!ee)return t(null);var n=ce(e.url);ee.then((function(e){e.match(n).then((function(r){var i=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),n=C(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}(i,l):l(null,null),{cancel:function(){s=!0,o||r.abort()}}}(e,t);if(A()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){var n=new a.XMLHttpRequest;for(var r in n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)n.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new ge(n.statusText,n.status,e.url))},n.send(e.body),{cancel:function(){return n.abort()}}}(e,t)},xe=function(e,t){return _e(p(e,{type:"arrayBuffer"}),t)},be=function(e,t){return _e(p(e,{method:"POST"}),t)},Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ve=[],me=0;function we(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Se(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}var Te=function(e,t){void 0===t&&(t={}),p(this,t),this.type=e},Ae=function(e){function t(t,n){void 0===n&&(n={}),e.call(this,"error",p({error:t},n))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Te),Ce=function(){};Ce.prototype.on=function(e,t){return this._listeners=this._listeners||{},we(e,t,this._listeners),this},Ce.prototype.off=function(e,t){return Se(e,t,this._listeners),Se(e,t,this._oneTimeListeners),this},Ce.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},we(e,t,this._oneTimeListeners),this},Ce.prototype.fire=function(e,t){"string"==typeof e&&(e=new Te(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,e);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];Se(n,s,this._oneTimeListeners),s.call(this,e)}var u=this._eventedParent;u&&(p(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof Ae&&console.error(e.error);return this},Ce.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ce.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var Re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Me=function(e,t,n,r){this.message=(e?e+": ":"")+n,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)};function ke(e){var t=e.value;return t?[new Me(e.key,t,"constants have been deprecated as of v8")]:[]}function Ie(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var o=i[r];for(var a in o)e[a]=o[a]}return e}function Le(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Pe(e){if(Array.isArray(e))return e.map(Pe);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var n in e)t[n]=Pe(e[n]);return t}return Le(e)}var Oe=function(e){function t(t,n){e.call(this,n),this.message=n,this.key=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),De=function(e,t){void 0===t&&(t=[]),this.parent=e,this.bindings={};for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};De.prototype.concat=function(e){return new De(this,e)},De.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},De.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Ne={kind:"null"},Fe={kind:"number"},Be={kind:"string"},ze={kind:"boolean"},Ue={kind:"color"},je={kind:"object"},Ge={kind:"value"},Ve={kind:"collator"},He={kind:"formatted"},We={kind:"resolvedImage"};function Xe(e,t){return{kind:"array",itemType:e,N:t}}function Ze(e){if("array"===e.kind){var t=Ze(e.itemType);return"number"==typeof e.N?"array<"+t+", "+e.N+">":"value"===e.itemType.kind?"array":"array<"+t+">"}return e.kind}var qe=[Ne,Fe,Be,ze,Ue,He,je,Xe(Ge),We];function Ye(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ye(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(var n=0,r=qe;n<r.length;n+=1)if(!Ye(r[n],t))return null}return"Expected "+Ze(e)+" but found "+Ze(t)+" instead."}function Ke(e,t){return t.some((function(t){return t.kind===e.kind}))}function Qe(e,t){return t.some((function(t){return"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e}))}var Je=t((function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function o(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function a(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),v=o(h[2]),m=v<=.5?v*(d+1):v+d-v*d,g=2*v-m;return[r(255*a(g,m,f+1/3)),r(255*a(g,m,f)),r(255*a(g,m,f-1/3)),p];default:return null}}return null}}catch(e){}})).parseCSSColor,$e=function(e,t,n,r){void 0===r&&(r=1),this.r=e,this.g=t,this.b=n,this.a=r};$e.parse=function(e){if(e){if(e instanceof $e)return e;if("string"==typeof e){var t=Je(e);if(t)return new $e(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},$e.prototype.toString=function(){var e=this.toArray(),t=e[1],n=e[2],r=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(n)+","+r+")"},$e.prototype.toArray=function(){var e=this.a;return 0===e?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},$e.black=new $e(0,0,0,1),$e.white=new $e(1,1,1,1),$e.transparent=new $e(0,0,0,0),$e.red=new $e(1,0,0,1);var et=function(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};et.prototype.compare=function(e,t){return this.collator.compare(e,t)},et.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var tt=function(e,t,n,r,i){this.text=e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i},nt=function(e){this.sections=e};nt.fromString=function(e){return new nt([new tt(e,null,null,null,null)])},nt.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length}))},nt.factory=function(e){return e instanceof nt?e:nt.fromString(e)},nt.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(e){return e.text})).join("")},nt.prototype.serialize=function(){for(var e=["format"],t=0,n=this.sections;t<n.length;t+=1){var r=n[t];if(r.image)e.push(["image",r.image.name]);else{e.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(i)}}return e};var rt=function(e){this.name=e.name,this.available=e.available};function it(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[e,t,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ot(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof $e)return!0;if(e instanceof et)return!0;if(e instanceof nt)return!0;if(e instanceof rt)return!0;if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t+=1)if(!ot(n[t]))return!1;return!0}if("object"==typeof e){for(var r in e)if(!ot(e[r]))return!1;return!0}return!1}function at(e){if(null===e)return Ne;if("string"==typeof e)return Be;if("boolean"==typeof e)return ze;if("number"==typeof e)return Fe;if(e instanceof $e)return Ue;if(e instanceof et)return Ve;if(e instanceof nt)return He;if(e instanceof rt)return We;if(Array.isArray(e)){for(var t,n=e.length,r=0,i=e;r<i.length;r+=1){var o=at(i[r]);if(t){if(t===o)continue;t=Ge;break}t=o}return Xe(t||Ge,n)}return je}function st(e){var t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof $e||e instanceof nt||e instanceof rt?e.toString():JSON.stringify(e)}rt.prototype.toString=function(){return this.name},rt.fromString=function(e){return e?new rt({name:e,available:!1}):null},rt.prototype.serialize=function(){return["image",this.name]};var ut=function(e,t){this.type=e,this.value=t};ut.parse=function(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!ot(e[1]))return t.error("invalid value");var n=e[1],r=at(n),i=t.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new ut(r,n)},ut.prototype.evaluate=function(){return this.value},ut.prototype.eachChild=function(){},ut.prototype.outputDefined=function(){return!0},ut.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $e?["rgba"].concat(this.value.toArray()):this.value instanceof nt?this.value.serialize():this.value};var lt=function(e){this.name="ExpressionEvaluationError",this.message=e};lt.prototype.toJSON=function(){return this.message};var ct={string:Be,number:Fe,boolean:ze,object:je},ht=function(e,t){this.type=e,this.args=t};ht.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n,r=1,i=e[0];if("array"===i){var o,a;if(e.length>2){var s=e[1];if("string"!=typeof s||!(s in ct)||"object"===s)return t.error('The item type argument of "array" must be one of string, number, boolean',1);o=ct[s],r++}else o=Ge;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],r++}n=Xe(o,a)}else n=ct[i];for(var u=[];r<e.length;r++){var l=t.parse(e[r],r,Ge);if(!l)return null;u.push(l)}return new ht(n,u)},ht.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var n=this.args[t].evaluate(e);if(!Ye(this.type,at(n)))return n;if(t===this.args.length-1)throw new lt("Expected value to be of type "+Ze(this.type)+", but found "+Ze(at(n))+" instead.")}return null},ht.prototype.eachChild=function(e){this.args.forEach(e)},ht.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},ht.prototype.serialize=function(){var e=this.type,t=[e.kind];if("array"===e.kind){var n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);var r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((function(e){return e.serialize()})))};var pt=function(e){this.type=He,this.sections=e};pt.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");for(var r=[],i=!1,o=1;o<=e.length-1;++o){var a=e[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=t.parse(a["font-scale"],1,Fe)))return null;var u=null;if(a["text-font"]&&!(u=t.parse(a["text-font"],1,Xe(Be))))return null;var l=null;if(a["text-color"]&&!(l=t.parse(a["text-color"],1,Ue)))return null;var c=r[r.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=t.parse(e[o],1,Ge);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new pt(r)},pt.prototype.evaluate=function(e){return new nt(this.sections.map((function(t){var n=t.content.evaluate(e);return at(n)===We?new tt("",n,null,null,null):new tt(st(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))},pt.prototype.eachChild=function(e){for(var t=0,n=this.sections;t<n.length;t+=1){var r=n[t];e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}},pt.prototype.outputDefined=function(){return!1},pt.prototype.serialize=function(){for(var e=["format"],t=0,n=this.sections;t<n.length;t+=1){var r=n[t];e.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),e.push(i)}return e};var ft=function(e){this.type=We,this.input=e};ft.parse=function(e,t){if(2!==e.length)return t.error("Expected two arguments.");var n=t.parse(e[1],1,Be);return n?new ft(n):t.error("No image name provided.")},ft.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=rt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n},ft.prototype.eachChild=function(e){e(this.input)},ft.prototype.outputDefined=function(){return!1},ft.prototype.serialize=function(){return["image",this.input.serialize()]};var dt={"to-boolean":ze,"to-color":Ue,"to-number":Fe,"to-string":Be},vt=function(e,t){this.type=e,this.args=t};vt.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var n=e[0];if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");for(var r=dt[n],i=[],o=1;o<e.length;o++){var a=t.parse(e[o],o,Ge);if(!a)return null;i.push(a)}return new vt(r,i)},vt.prototype.evaluate=function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){for(var t,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(t=i[r].evaluate(e))instanceof $e)return t;if("string"==typeof t){var o=e.parseColor(t);if(o)return o}else if(Array.isArray(t)&&!(n=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":it(t[0],t[1],t[2],t[3])))return new $e(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new lt(n||"Could not parse color from value '"+("string"==typeof t?t:String(JSON.stringify(t)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(e)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new lt("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?nt.fromString(st(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?rt.fromString(st(this.args[0].evaluate(e))):st(this.args[0].evaluate(e))},vt.prototype.eachChild=function(e){this.args.forEach(e)},vt.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},vt.prototype.serialize=function(){if("formatted"===this.type.kind)return new pt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ft(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild((function(t){e.push(t.serialize())})),e};var mt=["Unknown","Point","LineString","Polygon"],gt=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};gt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},gt.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?mt[this.feature.type]:this.feature.type:null},gt.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},gt.prototype.canonicalID=function(){return this.canonical},gt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},gt.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=$e.parse(e)),t};var yt=function(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r};yt.prototype.evaluate=function(e){return this._evaluate(e,this.args)},yt.prototype.eachChild=function(e){this.args.forEach(e)},yt.prototype.outputDefined=function(){return!1},yt.prototype.serialize=function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))},yt.parse=function(e,t){var n,r=e[0],i=yt.definitions[r];if(!i)return t.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(t){var n=t[0];return!Array.isArray(n)||n.length===e.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new Ut(t.registry,t.path,null,t.scope);for(var d=[],v=!1,m=1;m<e.length;m++){var g=e[m],y=Array.isArray(p)?p[m-1]:p.type,_=u.parse(g,1+d.length,y);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(p)?p[x]:p.type,E=d[x];u.concat(x+1).checkSubtype(b,E.type)}if(0===u.errors.length)return new yt(r,o,f,d)}}if(1===s.length)(n=t.errors).push.apply(n,u.errors);else{for(var w=(s.length?s:a).map((function(e){var t;return t=e[0],Array.isArray(t)?"("+t.map(Ze).join(", ")+")":"("+Ze(t.type)+"...)"})).join(" | "),S=[],T=1;T<e.length;T++){var A=t.parse(e[T],1+S.length);if(!A)return null;S.push(Ze(A.type))}t.error("Expected arguments of type "+w+", but found ("+S.join(", ")+") instead.")}return null},yt.register=function(e,t){for(var n in yt.definitions=t,t)e[n]=yt};var _t=function(e,t,n){this.type=Ve,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t};function xt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function bt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Et(e,t){var n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function wt(e,t,n){return t[1]>e[1]!=n[1]>e[1]&&e[0]<(n[0]-t[0])*(e[1]-t[1])/(n[1]-t[1])+t[0]}function St(e,t){for(var n,r,i,o,a,s,u,l=!1,c=0,h=t.length;c<h;c++)for(var p=t[c],f=0,d=p.length;f<d-1;f++){if((o=(n=e)[0]-(r=p[f])[0])*(u=n[1]-(i=p[f+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;wt(e,p[f],p[f+1])&&(l=!l)}return l}function Tt(e,t){for(var n=0;n<t.length;n++)if(St(e,t[n]))return!0;return!1}function At(e,t,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(e[0]-n[0])*o-i*(e[1]-n[1]),s=(t[0]-n[0])*o-i*(t[1]-n[1]);return a>0&&s<0||a<0&&s>0}function Ct(e,t,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(l=o[a])[0],c[1]-l[1]])[0]*(p=[(u=t)[0]-(s=e)[0],u[1]-s[1]])[1]-h[1]*p[0]&&At(s,u,l,c)&&At(l,c,s,u))return!0;var s,u,l,c,h,p;return!1}function Rt(e,t){for(var n=0;n<e.length;++n)if(!St(e[n],t))return!1;for(var r=0;r<e.length-1;++r)if(Ct(e[r],e[r+1],t))return!1;return!0}function Mt(e,t){for(var n=0;n<t.length;n++)if(Rt(e,t[n]))return!0;return!1}function kt(e,t,n){for(var r=[],i=0;i<e.length;i++){for(var o=[],a=0;a<e[i].length;a++){var s=Et(e[i][a],n);xt(t,s),o.push(s)}r.push(o)}return r}function It(e,t,n){for(var r=[],i=0;i<e.length;i++){var o=kt(e[i],t,n);r.push(o)}return r}function Lt(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){var i=.5*r,o=e[0]-n[0]>i?-r:n[0]-e[0]>i?r:0;0===o&&(o=e[0]-n[2]>i?-r:n[2]-e[0]>i?r:0),e[0]+=o}xt(t,e)}function Pt(e,t,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=e;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],p=[h.x+o[0],h.y+o[1]];Lt(p,t,n,i),a.push(p)}return a}function Ot(e,t,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,l=e;u<l.length;u+=1){for(var c=[],h=0,p=l[u];h<p.length;h+=1){var f=p[h],d=[f.x+a[0],f.y+a[1]];xt(t,d),c.push(d)}s.push(c)}if(t[2]-t[0]<=o/2){(i=t)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var v=0,m=s;v<m.length;v+=1)for(var g=0,y=m[v];g<y.length;g+=1)Lt(y[g],t,n,o)}return s}_t.parse=function(e,t){if(2!==e.length)return t.error("Expected one argument.");var n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");var r=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,ze);if(!r)return null;var i=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,ze);if(!i)return null;var o=null;return n.locale&&!(o=t.parse(n.locale,1,Be))?null:new _t(r,i,o)},_t.prototype.evaluate=function(e){return new et(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},_t.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},_t.prototype.outputDefined=function(){return!1},_t.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Dt=function(e,t){this.type=ze,this.geojson=e,this.geometries=t};function Nt(e){if(e instanceof yt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Dt)return!1;var t=!0;return e.eachChild((function(e){t&&!Nt(e)&&(t=!1)})),t}function Ft(e){if(e instanceof yt&&"feature-state"===e.name)return!1;var t=!0;return e.eachChild((function(e){t&&!Ft(e)&&(t=!1)})),t}function Bt(e,t){if(e instanceof yt&&t.indexOf(e.name)>=0)return!1;var n=!0;return e.eachChild((function(e){n&&!Bt(e,t)&&(n=!1)})),n}Dt.parse=function(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(ot(e[1])){var n=e[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Dt(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Dt(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Dt(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Dt.prototype.evaluate=function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){var o=kt(t.coordinates,r,i),a=Pt(e.geometry(),n,r,i);if(!bt(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!St(u[s],o))return!1}if("MultiPolygon"===t.type){var l=It(t.coordinates,r,i),c=Pt(e.geometry(),n,r,i);if(!bt(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Tt(p[h],l))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){var o=kt(t.coordinates,r,i),a=Ot(e.geometry(),n,r,i);if(!bt(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Rt(u[s],o))return!1}if("MultiPolygon"===t.type){var l=It(t.coordinates,r,i),c=Ot(e.geometry(),n,r,i);if(!bt(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Mt(p[h],l))return!1}return!0}(e,this.geometries)}return!1},Dt.prototype.eachChild=function(){},Dt.prototype.outputDefined=function(){return!0},Dt.prototype.serialize=function(){return["within",this.geojson]};var zt=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};zt.parse=function(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");var n=e[1];return t.scope.has(n)?new zt(n,t.scope.get(n)):t.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},zt.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},zt.prototype.eachChild=function(){},zt.prototype.outputDefined=function(){return!1},zt.prototype.serialize=function(){return["var",this.name]};var Ut=function(e,t,n,r,i){void 0===t&&(t=[]),void 0===r&&(r=new De),void 0===i&&(i=[]),this.registry=e,this.path=t,this.key=t.map((function(e){return"["+e+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function jt(e,t){for(var n,r=e.length-1,i=0,o=r,a=0;i<=o;)if((n=e[a=Math.floor((i+o)/2)])<=t){if(a===r||t<e[a+1])return a;i=a+1}else{if(!(n>t))throw new lt("Input is not a number.");o=a-1}return 0}Ut.prototype.parse=function(e,t,n,r,i){return void 0===i&&(i={}),t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)},Ut.prototype._parse=function(e,t){function n(e,t,n){return"assert"===n?new ht(t,[e]):"coerce"===n?new vt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=e[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(e,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,t.typeAnnotation||"coerce");else o=n(o,a,t.typeAnnotation||"assert")}if(!(o instanceof ut)&&"resolvedImage"!==o.type.kind&&function e(t){if(t instanceof zt)return e(t.boundExpression);if(t instanceof yt&&"error"===t.name)return!1;if(t instanceof _t)return!1;if(t instanceof Dt)return!1;var n=t instanceof vt||t instanceof ht,r=!0;return t.eachChild((function(t){r=n?r&&e(t):r&&t instanceof ut})),!!r&&Nt(t)&&Bt(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new gt;try{o=new ut(o.type,o.evaluate(u))}catch(e){return this.error(e.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ut.prototype.concat=function(e,t,n){var r="number"==typeof e?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Ut(this.registry,r,t||null,i,this.errors)},Ut.prototype.error=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=""+this.key+t.map((function(e){return"["+e+"]"})).join("");this.errors.push(new Oe(r,e))},Ut.prototype.checkSubtype=function(e,t){var n=Ye(e,t);return n&&this.error(n),n};var Gt=function(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function Vt(e,t,n){return e*(1-n)+t*n}Gt.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var n=t.parse(e[1],1,Fe);if(!n)return null;var r=[],i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(var o=1;o<e.length;o+=2){var a=1===o?-1/0:e[o],s=e[o+1],u=o,l=o+1;if("number"!=typeof a)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=t.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([a,c])}return new Gt(i,n,r)},Gt.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);var i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[jt(t,r)].evaluate(e)},Gt.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},Gt.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},Gt.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Ht=Object.freeze({__proto__:null,number:Vt,color:function(e,t,n){return new $e(Vt(e.r,t.r,n),Vt(e.g,t.g,n),Vt(e.b,t.b,n),Vt(e.a,t.a,n))},array:function(e,t,n){return e.map((function(e,r){return Vt(e,t[r],n)}))}}),Wt=6/29*3*(6/29),Xt=Math.PI/180,Zt=180/Math.PI;function qt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Wt+4/29}function Yt(e){return e>6/29?e*e*e:Wt*(e-4/29)}function Kt(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Qt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Jt(e){var t=Qt(e.r),n=Qt(e.g),r=Qt(e.b),i=qt((.4124564*t+.3575761*n+.1804375*r)/.95047),o=qt((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-qt((.0193339*t+.119192*n+.9503041*r)/1.08883)),alpha:e.a}}function $t(e){var t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Yt(t),n=.95047*Yt(n),r=1.08883*Yt(r),new $e(Kt(3.2404542*n-1.5371385*t-.4985314*r),Kt(-.969266*n+1.8760108*t+.041556*r),Kt(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function en(e,t,n){var r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var tn={forward:Jt,reverse:$t,interpolate:function(e,t,n){return{l:Vt(e.l,t.l,n),a:Vt(e.a,t.a,n),b:Vt(e.b,t.b,n),alpha:Vt(e.alpha,t.alpha,n)}}},nn={forward:function(e){var t=Jt(e),n=t.l,r=t.a,i=t.b,o=Math.atan2(i,r)*Zt;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:e.a}},reverse:function(e){var t=e.h*Xt,n=e.c;return $t({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:en(e.h,t.h,n),c:Vt(e.c,t.c,n),l:Vt(e.l,t.l,n),alpha:Vt(e.alpha,t.alpha,n)}}},rn=Object.freeze({__proto__:null,lab:tn,hcl:nn}),on=function(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function an(e,t,n,r){var i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}on.interpolationFactor=function(e,t,r,i){var o=0;if("exponential"===e.name)o=an(t,e.base,r,i);else if("linear"===e.name)o=an(t,1,r,i);else if("cubic-bezier"===e.name){var a=e.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(an(t,1,r,i))}return o},on.parse=function(e,t){var n=e[0],r=e[1],i=e[2],o=e.slice(3);if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(e){return"number"!=typeof e||e<0||e>1})))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(i=t.parse(i,2,Fe)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Ue:t.expectedType&&"value"!==t.expectedType.kind&&(l=t.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!=typeof h)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=t.parse(p,d,l);if(!v)return null;l=l||v.type,u.push([h,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new on(l,n,r,i,u):t.error("Type "+Ze(l)+" is not interpolatable.")},on.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);var i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);var o=jt(t,r),a=on.interpolationFactor(this.interpolation,r,t[o],t[o+1]),s=n[o].evaluate(e),u=n[o+1].evaluate(e);return"interpolate"===this.operator?Ht[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?nn.reverse(nn.interpolate(nn.forward(s),nn.forward(u),a)):tn.reverse(tn.interpolate(tn.forward(s),tn.forward(u),a))},on.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},on.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},on.prototype.serialize=function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t};var sn=function(e,t){this.type=e,this.args=t};sn.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var n=null,r=t.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=e.slice(1);o<a.length;o+=1){var s=t.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(e){return Ye(r,e.type)}));return new sn(u?Ge:n,i)},sn.prototype.evaluate=function(e){for(var t,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(e))&&n instanceof rt&&!n.available&&(t||(t=n.name),n=null,r===this.args.length&&(n=t)),null===n);i+=1);return n},sn.prototype.eachChild=function(e){this.args.forEach(e)},sn.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},sn.prototype.serialize=function(){var e=["coalesce"];return this.eachChild((function(t){e.push(t.serialize())})),e};var un=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};un.prototype.evaluate=function(e){return this.result.evaluate(e)},un.prototype.eachChild=function(e){for(var t=0,n=this.bindings;t<n.length;t+=1)e(n[t][1]);e(this.result)},un.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var n=[],r=1;r<e.length-1;r+=2){var i=e[r];if("string"!=typeof i)return t.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}var a=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return a?new un(n,a):null},un.prototype.outputDefined=function(){return this.result.outputDefined()},un.prototype.serialize=function(){for(var e=["let"],t=0,n=this.bindings;t<n.length;t+=1){var r=n[t];e.push(r[0],r[1].serialize())}return e.push(this.result.serialize()),e};var ln=function(e,t,n){this.type=e,this.index=t,this.input=n};ln.parse=function(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Fe),r=t.parse(e[2],2,Xe(t.expectedType||Ge));return n&&r?new ln(r.type.itemType,n,r):null},ln.prototype.evaluate=function(e){var t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new lt("Array index out of bounds: "+t+" < 0.");if(t>=n.length)throw new lt("Array index out of bounds: "+t+" > "+(n.length-1)+".");if(t!==Math.floor(t))throw new lt("Array index must be an integer, but found "+t+" instead.");return n[t]},ln.prototype.eachChild=function(e){e(this.index),e(this.input)},ln.prototype.outputDefined=function(){return!1},ln.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var cn=function(e,t){this.type=ze,this.needle=e,this.haystack=t};cn.parse=function(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Ge),r=t.parse(e[2],2,Ge);return n&&r?Ke(n.type,[ze,Be,Fe,Ne,Ge])?new cn(n,r):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ze(n.type)+" instead"):null},cn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Qe(t,["boolean","string","number","null"]))throw new lt("Expected first argument to be of type boolean, string, number or null, but found "+Ze(at(t))+" instead.");if(!Qe(n,["string","array"]))throw new lt("Expected second argument to be of type array or string, but found "+Ze(at(n))+" instead.");return n.indexOf(t)>=0},cn.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},cn.prototype.outputDefined=function(){return!0},cn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var hn=function(e,t,n){this.type=Fe,this.needle=e,this.haystack=t,this.fromIndex=n};hn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Ge),r=t.parse(e[2],2,Ge);if(!n||!r)return null;if(!Ke(n.type,[ze,Be,Fe,Ne,Ge]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ze(n.type)+" instead");if(4===e.length){var i=t.parse(e[3],3,Fe);return i?new hn(n,r,i):null}return new hn(n,r)},hn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Qe(t,["boolean","string","number","null"]))throw new lt("Expected first argument to be of type boolean, string, number or null, but found "+Ze(at(t))+" instead.");if(!Qe(n,["string","array"]))throw new lt("Expected second argument to be of type array or string, but found "+Ze(at(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)},hn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},hn.prototype.outputDefined=function(){return!1},hn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pn=function(e,t,n,r,i,o){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};pn.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var n,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(var i={},o=[],a=2;a<e.length-1;a+=2){var s=e[a],u=e[a+1];Array.isArray(s)||(s=[s]);var l=t.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,at(p)))return null}else n=at(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var f=t.parse(u,a,r);if(!f)return null;r=r||f.type,o.push(f)}var d=t.parse(e[1],1,Ge);if(!d)return null;var v=t.parse(e[e.length-1],e.length-1,r);return v?"value"!==d.type.kind&&t.concat(1).checkSubtype(n,d.type)?null:new pn(n,r,d,i,o,v):null},pn.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(at(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},pn.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},pn.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()},pn.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(t){return"number"===e.inputType.kind?Number(t):t},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];t.push(1===p.length?s(p[0]):p.map(s)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var fn=function(e,t,n){this.type=e,this.branches=t,this.otherwise=n};fn.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(var r=[],i=1;i<e.length-1;i+=2){var o=t.parse(e[i],i,ze);if(!o)return null;var a=t.parse(e[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=t.parse(e[e.length-1],e.length-1,n);return s?new fn(n,r,s):null},fn.prototype.evaluate=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var r=n[t],i=r[1];if(r[0].evaluate(e))return i.evaluate(e)}return this.otherwise.evaluate(e)},fn.prototype.eachChild=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var r=n[t],i=r[1];e(r[0]),e(i)}e(this.otherwise)},fn.prototype.outputDefined=function(){return this.branches.every((function(e){return e[1].outputDefined()}))&&this.otherwise.outputDefined()},fn.prototype.serialize=function(){var e=["case"];return this.eachChild((function(t){e.push(t.serialize())})),e};var dn=function(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r};function vn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function mn(e,t,n,r){return 0===r.compare(t,n)}function gn(e,t,n){var r="=="!==e&&"!="!==e;return function(){function i(e,t,n){this.type=ze,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}return i.parse=function(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var n=e[0],o=t.parse(e[1],1,Ge);if(!o)return null;if(!vn(n,o.type))return t.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Ze(o.type)+"'.");var a=t.parse(e[2],2,Ge);if(!a)return null;if(!vn(n,a.type))return t.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Ze(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot compare types '"+Ze(o.type)+"' and '"+Ze(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new ht(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new ht(o.type,[a])));var s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,Ve)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=at(o),u=at(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new lt('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=at(o),c=at(a);if("string"!==l.kind||"string"!==c.kind)return t(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):t(i,o,a)},i.prototype.eachChild=function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t},i}()}dn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1,Ge),r=t.parse(e[2],2,Fe);if(!n||!r)return null;if(!Ke(n.type,[Xe(Ge),Be,Ge]))return t.error("Expected first argument to be of type array or string, but found "+Ze(n.type)+" instead");if(4===e.length){var i=t.parse(e[3],3,Fe);return i?new dn(n.type,n,r,i):null}return new dn(n.type,n,r)},dn.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Qe(t,["string","array"]))throw new lt("Expected first argument to be of type array or string, but found "+Ze(at(t))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)},dn.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},dn.prototype.outputDefined=function(){return!1},dn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var yn=gn("==",(function(e,t,n){return t===n}),mn),_n=gn("!=",(function(e,t,n){return t!==n}),(function(e,t,n,r){return!mn(0,t,n,r)})),xn=gn("<",(function(e,t,n){return t<n}),(function(e,t,n,r){return r.compare(t,n)<0})),bn=gn(">",(function(e,t,n){return t>n}),(function(e,t,n,r){return r.compare(t,n)>0})),En=gn("<=",(function(e,t,n){return t<=n}),(function(e,t,n,r){return r.compare(t,n)<=0})),wn=gn(">=",(function(e,t,n){return t>=n}),(function(e,t,n,r){return r.compare(t,n)>=0})),Sn=function(e,t,n,r,i){this.type=Be,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Sn.parse=function(e,t){if(3!==e.length)return t.error("Expected two arguments.");var n=t.parse(e[1],1,Fe);if(!n)return null;var r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=t.parse(r.locale,1,Be)))return null;var o=null;if(r.currency&&!(o=t.parse(r.currency,1,Be)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=t.parse(r["min-fraction-digits"],1,Fe)))return null;var s=null;return r["max-fraction-digits"]&&!(s=t.parse(r["max-fraction-digits"],1,Fe))?null:new Sn(n,i,o,a,s)},Sn.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Sn.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Sn.prototype.outputDefined=function(){return!1},Sn.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Tn=function(e){this.type=Fe,this.input=e};Tn.parse=function(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found "+Ze(n.type)+" instead."):new Tn(n):null},Tn.prototype.evaluate=function(e){var t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new lt("Expected value to be of type string or array, but found "+Ze(at(t))+" instead.")},Tn.prototype.eachChild=function(e){e(this.input)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){var e=["length"];return this.eachChild((function(t){e.push(t.serialize())})),e};var An={"==":yn,"!=":_n,">":bn,"<":xn,">=":wn,"<=":En,array:ht,at:ln,boolean:ht,case:fn,coalesce:sn,collator:_t,format:pt,image:ft,in:cn,"index-of":hn,interpolate:on,"interpolate-hcl":on,"interpolate-lab":on,length:Tn,let:un,literal:ut,match:pn,number:ht,"number-format":Sn,object:ht,slice:dn,step:Gt,string:ht,"to-boolean":vt,"to-color":vt,"to-number":vt,"to-string":vt,var:zt,within:Dt};function Cn(e,t){var n=t[0],r=t[1],i=t[2],o=t[3];n=n.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);var a=o?o.evaluate(e):1,s=it(n,r,i,a);if(s)throw new lt(s);return new $e(n/255*a,r/255*a,i/255*a,a)}function Rn(e,t){return e in t}function Mn(e,t){var n=t[e];return void 0===n?null:n}function kn(e){return{type:e}}function In(e){return{result:"success",value:e}}function Ln(e){return{result:"error",value:e}}function Pn(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function On(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Dn(e){return!!e.expression&&e.expression.interpolated}function Nn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Fn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Bn(e){return e}function zn(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Un(e,t,n,r,i){return zn(typeof n===i?r[n]:void 0,e.default,t.default)}function jn(e,t,n){if("number"!==Nn(n))return zn(e.default,t.default);var r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];var i=jt(e.stops.map((function(e){return e[0]})),n);return e.stops[i][1]}function Gn(e,t,n){var r=void 0!==e.base?e.base:1;if("number"!==Nn(n))return zn(e.default,t.default);var i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];var o=jt(e.stops.map((function(e){return e[0]})),n),a=function(e,t,n,r){var i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],u=e.stops[o+1][1],l=Ht[t.type]||Bn;if(e.colorSpace&&"rgb"!==e.colorSpace){var c=rn[e.colorSpace];l=function(e,t){return c.reverse(c.interpolate(c.forward(e),c.forward(t),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var n=s.evaluate.apply(void 0,e),r=u.evaluate.apply(void 0,e);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function Vn(e,t,n){return"color"===t.type?n=$e.parse(n):"formatted"===t.type?n=nt.fromString(n.toString()):"resolvedImage"===t.type?n=rt.fromString(n.toString()):Nn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),zn(n,e.default,t.default)}yt.register(An,{error:[{kind:"error"},[Be],function(e,t){throw new lt(t[0].evaluate(e))}],typeof:[Be,[Ge],function(e,t){return Ze(at(t[0].evaluate(e)))}],"to-rgba":[Xe(Fe,4),[Ue],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[Ue,[Fe,Fe,Fe],Cn],rgba:[Ue,[Fe,Fe,Fe,Fe],Cn],has:{type:ze,overloads:[[[Be],function(e,t){return Rn(t[0].evaluate(e),e.properties())}],[[Be,je],function(e,t){var n=t[1];return Rn(t[0].evaluate(e),n.evaluate(e))}]]},get:{type:Ge,overloads:[[[Be],function(e,t){return Mn(t[0].evaluate(e),e.properties())}],[[Be,je],function(e,t){var n=t[1];return Mn(t[0].evaluate(e),n.evaluate(e))}]]},"feature-state":[Ge,[Be],function(e,t){return Mn(t[0].evaluate(e),e.featureState||{})}],properties:[je,[],function(e){return e.properties()}],"geometry-type":[Be,[],function(e){return e.geometryType()}],id:[Ge,[],function(e){return e.id()}],zoom:[Fe,[],function(e){return e.globals.zoom}],"heatmap-density":[Fe,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Fe,[],function(e){return e.globals.lineProgress||0}],accumulated:[Ge,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[Fe,kn(Fe),function(e,t){for(var n=0,r=0,i=t;r<i.length;r+=1)n+=i[r].evaluate(e);return n}],"*":[Fe,kn(Fe),function(e,t){for(var n=1,r=0,i=t;r<i.length;r+=1)n*=i[r].evaluate(e);return n}],"-":{type:Fe,overloads:[[[Fe,Fe],function(e,t){var n=t[1];return t[0].evaluate(e)-n.evaluate(e)}],[[Fe],function(e,t){return-t[0].evaluate(e)}]]},"/":[Fe,[Fe,Fe],function(e,t){var n=t[1];return t[0].evaluate(e)/n.evaluate(e)}],"%":[Fe,[Fe,Fe],function(e,t){var n=t[1];return t[0].evaluate(e)%n.evaluate(e)}],ln2:[Fe,[],function(){return Math.LN2}],pi:[Fe,[],function(){return Math.PI}],e:[Fe,[],function(){return Math.E}],"^":[Fe,[Fe,Fe],function(e,t){var n=t[1];return Math.pow(t[0].evaluate(e),n.evaluate(e))}],sqrt:[Fe,[Fe],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[Fe,[Fe],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[Fe,[Fe],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[Fe,[Fe],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[Fe,[Fe],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[Fe,[Fe],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[Fe,[Fe],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[Fe,[Fe],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[Fe,[Fe],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[Fe,[Fe],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[Fe,kn(Fe),function(e,t){return Math.min.apply(Math,t.map((function(t){return t.evaluate(e)})))}],max:[Fe,kn(Fe),function(e,t){return Math.max.apply(Math,t.map((function(t){return t.evaluate(e)})))}],abs:[Fe,[Fe],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[Fe,[Fe],function(e,t){var n=t[0].evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Fe,[Fe],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[Fe,[Fe],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[ze,[Be,Ge],function(e,t){var n=t[0],r=t[1];return e.properties()[n.value]===r.value}],"filter-id-==":[ze,[Ge],function(e,t){var n=t[0];return e.id()===n.value}],"filter-type-==":[ze,[Be],function(e,t){var n=t[0];return e.geometryType()===n.value}],"filter-<":[ze,[Be,Ge],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[ze,[Ge],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[ze,[Be,Ge],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[ze,[Ge],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[ze,[Be,Ge],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[ze,[Ge],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[ze,[Be,Ge],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[ze,[Ge],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[ze,[Ge],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[ze,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[ze,[Xe(Be)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ze,[Xe(Ge)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[ze,[Be,Xe(Ge)],function(e,t){var n=t[0];return t[1].value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[ze,[Be,Xe(Ge)],function(e,t){var n=t[0],r=t[1];return function(e,t,n,r){for(;n<=r;){var i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:ze,overloads:[[[ze,ze],function(e,t){var n=t[1];return t[0].evaluate(e)&&n.evaluate(e)}],[kn(ze),function(e,t){for(var n=0,r=t;n<r.length;n+=1)if(!r[n].evaluate(e))return!1;return!0}]]},any:{type:ze,overloads:[[[ze,ze],function(e,t){var n=t[1];return t[0].evaluate(e)||n.evaluate(e)}],[kn(ze),function(e,t){for(var n=0,r=t;n<r.length;n+=1)if(r[n].evaluate(e))return!0;return!1}]]},"!":[ze,[ze],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[ze,[Be],function(e,t){var n=e.globals&&e.globals.isSupportedScript;return!n||n(t[0].evaluate(e))}],upcase:[Be,[Be],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Be,[Be],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Be,kn(Ge),function(e,t){return t.map((function(t){return st(t.evaluate(e))})).join("")}],"resolved-locale":[Be,[Ve],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Hn=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new gt,this._defaultValue=t?function(e){return"color"===e.type&&Fn(e.default)?new $e(0,0,0,0):"color"===e.type?$e.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null};function Wn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in An}function Xn(e,t){var n=new Ut(An,[],t?function(e){var t={color:Ue,string:Be,number:Fe,enum:Be,boolean:ze,formatted:He,resolvedImage:We};return"array"===e.type?Xe(t[e.value]||Ge,e.length):t[e.type]}(t):void 0),r=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?In(new Hn(r,t)):Ln(n.errors)}Hn.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Hn.prototype.evaluate=function(e,t,n,r,i,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new lt("Expected value to be one of "+Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}};var Zn=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ft(t.expression)};Zn.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)},Zn.prototype.evaluate=function(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)};var qn=function(e,t,n,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ft(t.expression),this.interpolationType=r};function Yn(e,t){if("error"===(e=Xn(e,t)).result)return e;var n=e.value.expression,r=Nt(n);if(!r&&!Pn(t))return Ln([new Oe("","data expressions not supported")]);var i=Bt(n,["zoom"]);if(!i&&!On(t))return Ln([new Oe("","zoom expressions not supported")]);var o=function e(t){var n=null;if(t instanceof un)n=e(t.result);else if(t instanceof sn)for(var r=0,i=t.args;r<i.length&&!(n=e(i[r]));r+=1);else(t instanceof Gt||t instanceof on)&&t.input instanceof yt&&"zoom"===t.input.name&&(n=t);return n instanceof Oe||t.eachChild((function(t){var r=e(t);r instanceof Oe?n=r:!n&&r?n=new Oe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Oe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Oe?Ln([o]):o instanceof on&&!Dn(t)?Ln([new Oe("",'"interpolate" expressions cannot be used with this property')]):In(o?new qn(r?"camera":"composite",e.value,o.labels,o instanceof on?o.interpolation:void 0):new Zn(r?"constant":"source",e.value)):Ln([new Oe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}qn.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)},qn.prototype.evaluate=function(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)},qn.prototype.interpolationFactor=function(e,t,n){return this.interpolationType?on.interpolationFactor(this.interpolationType,e,t,n):0};var Kn=function(e,t){this._parameters=e,this._specification=t,Ie(this,function e(t,n){var r,i,o,a="color"===n.type,s=t.stops&&"object"==typeof t.stops[0][0],u=s||!(s||void 0!==t.property),l=t.type||(Dn(n)?"exponential":"interval");if(a&&((t=Ie({},t)).stops&&(t.stops=t.stops.map((function(e){return[e[0],$e.parse(e[1])]}))),t.default=$e.parse(t.default?t.default:n.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!rn[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);if("exponential"===l)r=Gn;else if("interval"===l)r=jn;else if("categorical"===l){r=Un,i=Object.create(null);for(var c=0,h=t.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof t.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Vn}if(s){for(var f={},d=[],v=0;v<t.stops.length;v++){var m=t.stops[v],g=m[0].zoom;void 0===f[g]&&(f[g]={zoom:g,type:t.type,property:t.property,default:t.default,stops:[]},d.push(g)),f[g].stops.push([m[0].value,m[1]])}for(var y=[],_=0,x=d;_<x.length;_+=1){var b=x[_];y.push([f[b].zoom,e(f[b],n)])}var E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:on.interpolationFactor.bind(void 0,E),zoomStops:y.map((function(e){return e[0]})),evaluate:function(e,r){var i=e.zoom;return Gn({stops:y,base:t.base},n,i).evaluate(i,r)}}}if(u){var w="exponential"===l?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:on.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map((function(e){return e[0]})),evaluate:function(e){return r(t,n,e.zoom,i,o)}}}return{kind:"source",evaluate:function(e,a){var s=a&&a.properties?a.properties[t.property]:void 0;return void 0===s?zn(t.default,n.default):r(t,n,s,i,o)}}}(this._parameters,this._specification))};function Qn(e){var t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},o=e.style,a=e.styleSpec,s=[],u=Nn(n);if("object"!==u)return[new Me(t,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=r[c]||r["*"],p=void 0;if(i[c])p=i[c];else if(r[c])p=Er;else if(i["*"])p=i["*"];else{if(!r["*"]){s.push(new Me(t,n[l],'unknown property "'+l+'"'));continue}p=Er}s=s.concat(p({key:(t?t+".":t)+l,value:n[l],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var f in r)i[f]||r[f].required&&void 0===r[f].default&&void 0===n[f]&&s.push(new Me(t,n,'missing required property "'+f+'"'));return s}function Jn(e){var t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,o=e.key,a=e.arrayElementValidator||Er;if("array"!==Nn(t))return[new Me(o,t,"array expected, "+Nn(t)+" found")];if(n.length&&t.length!==n.length)return[new Me(o,t,"array length "+n.length+" expected, length "+t.length+" found")];if(n["min-length"]&&t.length<n["min-length"])return[new Me(o,t,"array length at least "+n["min-length"]+" expected, length "+t.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Nn(n.value)&&(s=n.value);for(var u=[],l=0;l<t.length;l++)u=u.concat(a({array:t,arrayIndex:l,value:t[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function $n(e){var t=e.key,n=e.value,r=e.valueSpec,i=Nn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Me(t,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new Me(t,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new Me(t,n,n+" is greater than the maximum value "+r.maximum)]:[]}function er(e){var t,n,r,i=e.valueSpec,o=Le(e.value.type),a={},s="categorical"!==o&&void 0===e.value.property,u=!s,l="array"===Nn(e.value.stops)&&"array"===Nn(e.value.stops[0])&&"object"===Nn(e.value.stops[0][0]),c=Qn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===o)return[new Me(e.key,e.value,'identity function may not have a "stops" property')];var t=[],n=e.value;return t=t.concat(Jn({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Nn(n)&&0===n.length&&t.push(new Me(e.key,n,"array must have at least one stop")),t},default:function(e){return Er({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===o&&s&&c.push(new Me(e.key,e.value,'missing required property "property"')),"identity"===o||e.value.stops||c.push(new Me(e.key,e.value,'missing required property "stops"')),"exponential"===o&&e.valueSpec.expression&&!Dn(e.valueSpec)&&c.push(new Me(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(u&&!Pn(e.valueSpec)?c.push(new Me(e.key,e.value,"property functions not supported")):s&&!On(e.valueSpec)&&c.push(new Me(e.key,e.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==e.value.property||c.push(new Me(e.key,e.value,'"property" property is required')),c;function h(e){var t=[],o=e.value,s=e.key;if("array"!==Nn(o))return[new Me(s,o,"array expected, "+Nn(o)+" found")];if(2!==o.length)return[new Me(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==Nn(o[0]))return[new Me(s,o,"object expected, "+Nn(o[0])+" found")];if(void 0===o[0].zoom)return[new Me(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Me(s,o,"object stop key must have value")];if(r&&r>Le(o[0].zoom))return[new Me(s,o[0].zoom,"stop zoom values must appear in ascending order")];Le(o[0].zoom)!==r&&(r=Le(o[0].zoom),n=void 0,a={}),t=t.concat(Qn({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:$n,value:p}}))}else t=t.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},o));return Wn(Pe(o[1]))?t.concat([new Me(s+"[1]",o[1],"expressions are not allowed in function stops.")]):t.concat(Er({key:s+"[1]",value:o[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function p(e,r){var s=Nn(e.value),u=Le(e.value),l=null!==e.value?e.value:r;if(t){if(s!==t)return[new Me(e.key,l,s+" stop domain type must match previous stop domain type "+t)]}else t=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Me(e.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Pn(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(e.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new Me(e.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new Me(e.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new Me(e.key,l,"integer expected, found "+u)]}}function tr(e){var t=("property"===e.expressionContext?Yn:Xn)(Pe(e.value),e.valueSpec);if("error"===t.result)return t.value.map((function(t){return new Me(""+e.key+t.key,e.value,t.message)}));var n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Me(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ft(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ft(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Bt(n,["zoom","feature-state"]))return[new Me(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Nt(n))return[new Me(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nr(e){var t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Le(n))&&i.push(new Me(t,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Le(n))&&i.push(new Me(t,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function rr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,n=e.slice(1);t<n.length;t+=1){var r=n[t];if(!rr(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Kn.deserialize=function(e){return new Kn(e._parameters,e._specification)},Kn.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var ir={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function or(e){if(null==e)return{filter:function(){return!0},needGeometry:!1};rr(e)||(e=sr(e));var t=Xn(e,ir);if("error"===t.result)throw new Error(t.value.map((function(e){return e.key+": "+e.message})).join(", "));return{filter:function(e,n,r){return t.value.evaluate(e,n,{},r)},needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var n=1;n<t.length;n++)if(e(t[n]))return!0;return!1}(e)}}function ar(e,t){return e<t?-1:e>t?1:0}function sr(e){if(!e)return!0;var t,n=e[0];return e.length<=1?"any"!==n:"=="===n?ur(e[1],e[2],"=="):"!="===n?hr(ur(e[1],e[2],"==")):"<"===n||">"===n||"<="===n||">="===n?ur(e[1],e[2],n):"any"===n?(t=e.slice(1),["any"].concat(t.map(sr))):"all"===n?["all"].concat(e.slice(1).map(sr)):"none"===n?["all"].concat(e.slice(1).map(sr).map(hr)):"in"===n?lr(e[1],e.slice(2)):"!in"===n?hr(lr(e[1],e.slice(2))):"has"===n?cr(e[1]):"!has"===n?hr(cr(e[1])):"within"!==n||e}function ur(e,t,n){switch(e){case"$type":return["filter-type-"+n,t];case"$id":return["filter-id-"+n,t];default:return["filter-"+n,e,t]}}function lr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?["filter-in-large",e,["literal",t.sort(ar)]]:["filter-in-small",e,["literal",t]]}}function cr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function hr(e){return["!",e]}function pr(e){return rr(Pe(e.value))?tr(Ie({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(t){var n=t.value,r=t.key;if("array"!==Nn(n))return[new Me(r,n,"array expected, "+Nn(n)+" found")];var i,o=t.styleSpec,a=[];if(n.length<1)return[new Me(r,n,"filter array must have at least 1 element")];switch(a=a.concat(nr({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:t.style,styleSpec:t.styleSpec})),Le(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Le(n[1])&&a.push(new Me(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new Me(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=Nn(n[1]))&&a.push(new Me(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=Nn(n[s]),"$type"===Le(n[1])?a=a.concat(nr({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Me(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(e({key:r+"["+u+"]",value:n[u],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=Nn(n[1]),2!==n.length?a.push(new Me(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Me(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=Nn(n[1]),2!==n.length?a.push(new Me(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new Me(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(e)}function fr(e,t){var n=e.key,r=e.style,i=e.styleSpec,o=e.value,a=e.objectKey,s=i[t+"_"+e.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===t&&u&&s[u[1]]&&s[u[1]].transition)return Er({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=e.valueSpec||s[a];if(!c)return[new Me(n,o,'unknown property "'+a+'"')];if("string"===Nn(o)&&Pn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new Me(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===e.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new Me(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Fn(Pe(o))&&"identity"===Le(o.type)&&h.push(new Me(n,o,'"text-font" does not support identity functions'))),h.concat(Er({key:e.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:a}))}function dr(e){return fr(e,"paint")}function vr(e){return fr(e,"layout")}function mr(e){var t=[],n=e.value,r=e.key,i=e.style,o=e.styleSpec;n.type||n.ref||t.push(new Me(r,n,'either "type" or "ref" is required'));var a,s=Le(n.type),u=Le(n.ref);if(n.id)for(var l=Le(n.id),c=0;c<e.arrayIndex;c++){var h=i.layers[c];Le(h.id)===l&&t.push(new Me(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(e){e in n&&t.push(new Me(r,n[e],'"'+e+'" is prohibited for ref layers'))})),i.layers.forEach((function(e){Le(e.id)===u&&(a=e)})),a?a.ref?t.push(new Me(r,n.ref,"ref cannot reference another ref layer")):s=Le(a.type):t.push(new Me(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=i.sources&&i.sources[n.source],f=p&&Le(p.type);p?"vector"===f&&"raster"===s?t.push(new Me(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?t.push(new Me(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?t.push(new Me(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||t.push(new Me(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Me(r,n,'layer "'+n.id+'" must specify a "source-layer"')):t.push(new Me(r,n.source,'source "'+n.source+'" not found'))}else t.push(new Me(r,n,'missing required property "source"'));return t=t.concat(Qn({key:r,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Er({key:r+".type",value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"})},filter:pr,layout:function(e){return Qn({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return vr(Ie({layerType:s},e))}}})},paint:function(e){return Qn({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return dr(Ie({layerType:s},e))}}})}}}))}function gr(e){var t=e.value,n=e.key,r=Nn(t);return"string"!==r?[new Me(n,t,"string expected, "+r+" found")]:[]}var yr={promoteId:function(e){var t=e.key,n=e.value;if("string"===Nn(n))return gr({key:t,value:n});var r=[];for(var i in n)r.push.apply(r,gr({key:t+"."+i,value:n[i]}));return r}};function _r(e){var t=e.value,n=e.key,r=e.styleSpec,i=e.style;if(!t.type)return[new Me(n,t,'"type" is required')];var o,a=Le(t.type);switch(a){case"vector":case"raster":case"raster-dem":return Qn({key:n,value:t,valueSpec:r["source_"+a.replace("-","_")],style:e.style,styleSpec:r,objectElementValidators:yr});case"geojson":if(o=Qn({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:yr}),t.cluster)for(var s in t.clusterProperties){var u=t.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,tr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,tr({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Qn({key:n,value:t,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Qn({key:n,value:t,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Me(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nr({key:n+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function xr(e){var t=e.value,n=e.styleSpec,r=n.light,i=e.style,o=[],a=Nn(t);if(void 0===t)return o;if("object"!==a)return o.concat([new Me("light",t,"object expected, "+a+" found")]);for(var s in t){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Er({key:s,value:t[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Er({key:s,value:t[s],valueSpec:r[s],style:i,styleSpec:n}):[new Me(s,t[s],'unknown property "'+s+'"')])}return o}var br={"*":function(){return[]},array:Jn,boolean:function(e){var t=e.value,n=e.key,r=Nn(t);return"boolean"!==r?[new Me(n,t,"boolean expected, "+r+" found")]:[]},number:$n,color:function(e){var t=e.key,n=e.value,r=Nn(n);return"string"!==r?[new Me(t,n,"color expected, "+r+" found")]:null===Je(n)?[new Me(t,n,'color expected, "'+n+'" found')]:[]},constants:ke,enum:nr,filter:pr,function:er,layer:mr,object:Qn,source:_r,light:xr,string:gr,formatted:function(e){return 0===gr(e).length?[]:tr(e)},resolvedImage:function(e){return 0===gr(e).length?[]:tr(e)}};function Er(e){var t=e.value,n=e.valueSpec,r=e.styleSpec;return n.expression&&Fn(Le(t))?er(e):n.expression&&Wn(Pe(t))?tr(e):n.type&&br[n.type]?br[n.type](e):Qn(Ie({},e,{valueSpec:n.type?r[n.type]:n}))}function wr(e){var t=e.value,n=e.key,r=gr(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Me(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Me(n,t,'"glyphs" url must include a "{range}" token'))),r}function Sr(e,t){void 0===t&&(t=Re);var n=[];return n=n.concat(Er({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wr,"*":function(){return[]}}})),e.constants&&(n=n.concat(ke({key:"constants",value:e.constants,style:e,styleSpec:t}))),Tr(n)}function Tr(e){return[].concat(e).sort((function(e,t){return e.line-t.line}))}function Ar(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return Tr(e.apply(this,t))}}Sr.source=Ar(_r),Sr.light=Ar(xr),Sr.layer=Ar(mr),Sr.filter=Ar(pr),Sr.paintProperty=Ar(dr),Sr.layoutProperty=Ar(vr);var Cr=Sr,Rr=Cr.light,Mr=Cr.paintProperty,kr=Cr.layoutProperty;function Ir(e,t){var n=!1;if(t&&t.length)for(var r=0,i=t;r<i.length;r+=1)e.fire(new Ae(new Error(i[r].message))),n=!0;return n}var Lr=Pr;function Pr(e,t,n){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var c=n/t*e;this.min=-c,this.max=e+c}Pr.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Pr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Pr.prototype._insertCell=function(e,t,n,r,i,o){this.cells[i].push(o)},Pr.prototype.query=function(e,t,n,r,i){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,r,this._queryCell,s,{},i),s},Pr.prototype._queryCell=function(e,t,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):e<=c[f+2]&&t<=c[f+3]&&n>=c[f+0]&&r>=c[f+1])?(a[p]=!0,o.push(l[p])):a[p]=!1}}},Pr.prototype._forEachCell=function(e,t,n,r,i,o,a,s){for(var u=this._convertToCellCoord(e),l=this._convertToCellCoord(t),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,e,t,n,r,d,o,a,s))return}},Pr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Pr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Pr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+e.length]=o,i.set(this.keys,o),i[3+e.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Or=a.ImageData,Dr=a.ImageBitmap,Nr={};function Fr(e,t,n){void 0===n&&(n={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Nr[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}for(var Br in Fr("Object",Object),Lr.serialize=function(e,t){var n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},Lr.deserialize=function(e){return new Lr(e.buffer)},Fr("Grid",Lr),Fr("Color",$e),Fr("Error",Error),Fr("ResolvedImage",rt),Fr("StylePropertyFunction",Kn),Fr("StyleExpression",Hn,{omit:["_evaluator"]}),Fr("ZoomDependentExpression",qn),Fr("ZoomConstantExpression",Zn),Fr("CompoundExpression",yt,{omit:["_evaluate"]}),An)An[Br]._classRegistryKey||Fr("Expression_"+Br,An[Br]);function zr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ur(e){return Dr&&e instanceof Dr}function jr(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(zr(e)||Ur(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return t&&t.push(n.buffer),n}if(e instanceof Or)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var r=[],i=0,o=e;i<o.length;i+=1)r.push(jr(o[i],t));return r}if("object"==typeof e){var a=e.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(e,t):{};if(!a.serialize){for(var l in e)if(e.hasOwnProperty(l)&&!(Nr[s].omit.indexOf(l)>=0)){var c=e[l];u[l]=Nr[s].shallow.indexOf(l)>=0?c:jr(c,t)}e instanceof Error&&(u.message=e.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof e)}function Gr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||zr(e)||Ur(e)||ArrayBuffer.isView(e)||e instanceof Or)return e;if(Array.isArray(e))return e.map(Gr);if("object"==typeof e){var t=e.$name||"Object",n=Nr[t].klass;if(!n)throw new Error("can't deserialize unregistered class "+t);if(n.deserialize)return n.deserialize(e);for(var r=Object.create(n.prototype),i=0,o=Object.keys(e);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=e[a];r[a]=Nr[t].shallow.indexOf(a)>=0?s:Gr(s)}}return r}throw new Error("can't deserialize object of type "+typeof e)}var Vr=function(){this.first=!0};Vr.prototype.update=function(e,t){var n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))};var Hr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Wr(e){for(var t=0,n=e;t<n.length;t+=1)if(Xr(n[t].charCodeAt(0)))return!0;return!1}function Xr(e){return!(746!==e&&747!==e&&(e<4352||!(Hr["Bopomofo Extended"](e)||Hr.Bopomofo(e)||Hr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Hr["CJK Compatibility Ideographs"](e)||Hr["CJK Compatibility"](e)||Hr["CJK Radicals Supplement"](e)||Hr["CJK Strokes"](e)||!(!Hr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Hr["CJK Unified Ideographs Extension A"](e)||Hr["CJK Unified Ideographs"](e)||Hr["Enclosed CJK Letters and Months"](e)||Hr["Hangul Compatibility Jamo"](e)||Hr["Hangul Jamo Extended-A"](e)||Hr["Hangul Jamo Extended-B"](e)||Hr["Hangul Jamo"](e)||Hr["Hangul Syllables"](e)||Hr.Hiragana(e)||Hr["Ideographic Description Characters"](e)||Hr.Kanbun(e)||Hr["Kangxi Radicals"](e)||Hr["Katakana Phonetic Extensions"](e)||Hr.Katakana(e)&&12540!==e||!(!Hr["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Hr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Hr["Unified Canadian Aboriginal Syllabics"](e)||Hr["Unified Canadian Aboriginal Syllabics Extended"](e)||Hr["Vertical Forms"](e)||Hr["Yijing Hexagram Symbols"](e)||Hr["Yi Syllables"](e)||Hr["Yi Radicals"](e))))}function Zr(e){return!(Xr(e)||function(e){return!!(Hr["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Hr["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Hr["Letterlike Symbols"](e)||Hr["Number Forms"](e)||Hr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Hr["Control Pictures"](e)&&9251!==e||Hr["Optical Character Recognition"](e)||Hr["Enclosed Alphanumerics"](e)||Hr["Geometric Shapes"](e)||Hr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Hr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Hr["CJK Symbols and Punctuation"](e)||Hr.Katakana(e)||Hr["Private Use Area"](e)||Hr["CJK Compatibility Forms"](e)||Hr["Small Form Variants"](e)||Hr["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function qr(e){return e>=1424&&e<=2303||Hr["Arabic Presentation Forms-A"](e)||Hr["Arabic Presentation Forms-B"](e)}function Yr(e,t){return!(!t&&qr(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Hr.Khmer(e))}function Kr(e){for(var t=0,n=e;t<n.length;t+=1)if(qr(n[t].charCodeAt(0)))return!0;return!1}var Qr=null,Jr="unavailable",$r=null,ei=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Jr="error"),Qr&&Qr(e)};function ti(){ni.fire(new Te("pluginStateChange",{pluginStatus:Jr,pluginURL:$r}))}var ni=new Ce,ri=function(){return Jr},ii=function(){if("deferred"!==Jr||!$r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jr="loading",ti(),$r&&xe({url:$r},(function(e){e?ei(e):(Jr="loaded",ti())}))},oi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Jr||null!=oi.applyArabicShaping},isLoading:function(){return"loading"===Jr},setState:function(e){Jr=e.pluginStatus,$r=e.pluginURL},isParsed:function(){return null!=oi.applyArabicShaping&&null!=oi.processBidirectionalText&&null!=oi.processStyledBidirectionalText},getPluginURL:function(){return $r}},ai=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vr,this.transition={})};ai.prototype.isSupportedScript=function(e){return function(e,t){for(var n=0,r=e;n<r.length;n+=1)if(!Yr(r[n].charCodeAt(0),t))return!1;return!0}(e,oi.isLoaded())},ai.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ai.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}};var si=function(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Fn(e))return new Kn(e,t);if(Wn(e)){var n=Yn(e,t);if("error"===n.result)throw new Error(n.value.map((function(e){return e.key+": "+e.message})).join(", "));return n.value}var r=e;return"string"==typeof e&&"color"===t.type&&(r=$e.parse(e)),{kind:"constant",evaluate:function(){return r}}}(void 0===t?e.specification.default:t,e.specification)};si.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},si.prototype.possiblyEvaluate=function(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)};var ui=function(e){this.property=e,this.value=new si(e,void 0)};ui.prototype.transitioned=function(e,t){return new ci(this.property,this.value,t,p({},e.transition,this.transition),e.now)},ui.prototype.untransitioned=function(){return new ci(this.property,this.value,null,{},0)};var li=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};li.prototype.getValue=function(e){return b(this._values[e].value.value)},li.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ui(this._values[e].property)),this._values[e].value=new si(this._values[e].property,null===t?void 0:b(t))},li.prototype.getTransition=function(e){return b(this._values[e].transition)},li.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ui(this._values[e].property)),this._values[e].transition=b(t)||void 0},li.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t],i=this.getValue(r);void 0!==i&&(e[r]=i);var o=this.getTransition(r);void 0!==o&&(e[r+"-transition"]=o)}return e},li.prototype.transitioned=function(e,t){for(var n=new hi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(e,t._values[o])}return n},li.prototype.untransitioned=function(){for(var e=new hi(this._properties),t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t];e._values[r]=this._values[r].untransitioned()}return e};var ci=function(e,t,n,r,i){this.property=e,this.value=t,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};ci.prototype.possiblyEvaluate=function(e,t,n){var r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(e,t,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),i,function(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}(a))}return i};var hi=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};hi.prototype.possiblyEvaluate=function(e,t,n){for(var r=new di(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(e,t,n)}return r},hi.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var pi=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};pi.prototype.getValue=function(e){return b(this._values[e].value)},pi.prototype.setValue=function(e,t){this._values[e]=new si(this._values[e].property,null===t?void 0:b(t))},pi.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t],i=this.getValue(r);void 0!==i&&(e[r]=i)}return e},pi.prototype.possiblyEvaluate=function(e,t,n){for(var r=new di(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(e,t,n)}return r};var fi=function(e,t,n){this.property=e,this.value=t,this.parameters=n};fi.prototype.isConstant=function(){return"constant"===this.value.kind},fi.prototype.constantOr=function(e){return"constant"===this.value.kind?this.value.value:e},fi.prototype.evaluate=function(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)};var di=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};di.prototype.get=function(e){return this._values[e]};var vi=function(e){this.specification=e};vi.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},vi.prototype.interpolate=function(e,t,n){var r=Ht[this.specification.type];return r?r(e,t,n):e};var mi=function(e,t){this.specification=e,this.overrides=t};mi.prototype.possiblyEvaluate=function(e,t,n,r){return new fi(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)},mi.prototype.interpolate=function(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new fi(this,{kind:"constant",value:void 0},e.parameters);var r=Ht[this.specification.type];return r?new fi(this,{kind:"constant",value:r(e.value.value,t.value.value,n)},e.parameters):e},mi.prototype.evaluate=function(e,t,n,r,i,o){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,o)};var gi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(e,t,n,r){if(void 0===e.value)return new fi(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){var i=e.expression.evaluate(t,null,{},n,r),o="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,t);return new fi(this,{kind:"constant",value:a},t)}if("camera"===e.expression.kind){var s=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new fi(this,{kind:"constant",value:s},t)}return new fi(this,e.expression,t)},t.prototype.evaluate=function(e,t,n,r,i,o){if("source"===e.kind){var a=e.evaluate(t,n,r,i,o);return this._calculate(a,a,a,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value},t.prototype._calculate=function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}},t.prototype.interpolate=function(e){return e},t}(mi),yi=function(e){this.specification=e};yi.prototype.possiblyEvaluate=function(e,t,n,r){if(void 0!==e.value){if("constant"===e.expression.kind){var i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new ai(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ai(Math.floor(t.zoom),t)),e.expression.evaluate(new ai(Math.floor(t.zoom+1),t)),t)}},yi.prototype._calculate=function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}},yi.prototype.interpolate=function(e){return e};var _i=function(e){this.specification=e};_i.prototype.possiblyEvaluate=function(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)},_i.prototype.interpolate=function(){return!1};var xi=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var n=e[t];n.specification.overridable&&this.overridableProperties.push(t);var r=this.defaultPropertyValues[t]=new si(n,void 0),i=this.defaultTransitionablePropertyValues[t]=new ui(n);this.defaultTransitioningPropertyValues[t]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}};Fr("DataDrivenProperty",mi),Fr("DataConstantProperty",vi),Fr("CrossFadedDataDrivenProperty",gi),Fr("CrossFadedProperty",yi),Fr("ColorRampProperty",_i);var bi=function(e){function t(t,n){if(e.call(this),this.id=t.id,this.type=t.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new pi(n.layout)),n.paint)){for(var r in this._transitionablePaint=new li(n.paint),t.paint)this.setPaintProperty(r,t.paint[r],{validate:!1});for(var i in t.layout)this.setLayoutProperty(i,t.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new di(n.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)},t.prototype.setLayoutProperty=function(e,t,n){void 0===n&&(n={}),null!=t&&this._validate(kr,"layers."+this.id+".layout."+e,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)},t.prototype.getPaintProperty=function(e){return y(e,"-transition")?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)},t.prototype.setPaintProperty=function(e,t,n){if(void 0===n&&(n={}),null!=t&&this._validate(Mr,"layers."+this.id+".paint."+e,e,t,n))return!1;if(y(e,"-transition"))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;var r=this._transitionablePaint._values[e],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var s=this._transitionablePaint._values[e].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(e,a,s)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){},t.prototype._handleOverridablePaintPropertyUpdate=function(e,t,n){return!1},t.prototype.isHidden=function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility},t.prototype.updateTransitions=function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)},t.prototype.serialize=function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),x(e,(function(e,t){return!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)}))},t.prototype._validate=function(e,t,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Ir(this,e.call(Cr,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof fi&&Pn(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1},t}(Ce),Ei={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},wi=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Si=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ti(e,t){void 0===t&&(t=1);var n=0,r=0;return{members:e.map((function(e){var i=Ei[e.type].BYTES_PER_ELEMENT,o=n=Ai(n,Math.max(t,i)),a=e.components||1;return r=Math.max(r,i),n+=i*a,{name:e.name,type:e.type,components:a,offset:o}})),size:Ai(n,Math.max(r,t)),alignment:t}}function Ai(e,t){return Math.ceil(e/t)*t}Si.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Si.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Si.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Si.prototype.clear=function(){this.length=0},Si.prototype.resize=function(e){this.reserve(e),this.length=e},Si.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Si.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ci=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e},t}(Si);Ci.prototype.bytesPerElement=4,Fr("StructArrayLayout2i4",Ci);var Ri=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,e},t}(Si);Ri.prototype.bytesPerElement=8,Fr("StructArrayLayout4i8",Ri);var Mi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)},t.prototype.emplace=function(e,t,n,r,i,o,a){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,e},t}(Si);Mi.prototype.bytesPerElement=12,Fr("StructArrayLayout2i4i12",Mi);var ki=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)},t.prototype.emplace=function(e,t,n,r,i,o,a){var s=4*e,u=8*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,e},t}(Si);ki.prototype.bytesPerElement=8,Fr("StructArrayLayout2i4ub8",ki);var Ii=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e},t}(Si);Ii.prototype.bytesPerElement=8,Fr("StructArrayLayout2f8",Ii);var Li=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o,a,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,o,a,s,u,l)},t.prototype.emplace=function(e,t,n,r,i,o,a,s,u,l,c){var h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,e},t}(Si);Li.prototype.bytesPerElement=20,Fr("StructArrayLayout10ui20",Li);var Pi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o,a,s,u,l,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,r,i,o,a,s,u,l,c,h)},t.prototype.emplace=function(e,t,n,r,i,o,a,s,u,l,c,h,p){var f=12*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.uint16[f+4]=o,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=c,this.int16[f+10]=h,this.int16[f+11]=p,e},t}(Si);Pi.prototype.bytesPerElement=24,Fr("StructArrayLayout4i4ui4i24",Pi);var Oi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e},t}(Si);Oi.prototype.bytesPerElement=12,Fr("StructArrayLayout3f12",Oi);var Di=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint32[1*e+0]=t,e},t}(Si);Di.prototype.bytesPerElement=4,Fr("StructArrayLayout1ul4",Di);var Ni=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o,a,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,r,i,o,a,s,u)},t.prototype.emplace=function(e,t,n,r,i,o,a,s,u,l){var c=10*e,h=5*e;return this.int16[c+0]=t,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,e},t}(Si);Ni.prototype.bytesPerElement=20,Fr("StructArrayLayout6i1ul2ui20",Ni);var Fi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o)},t.prototype.emplace=function(e,t,n,r,i,o,a){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,e},t}(Si);Fi.prototype.bytesPerElement=12,Fr("StructArrayLayout2i2i2i12",Fi);var Bi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)},t.prototype.emplace=function(e,t,n,r,i,o){var a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,e},t}(Si);Bi.prototype.bytesPerElement=16,Fr("StructArrayLayout2f1f2i16",Bi);var zi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var o=12*e,a=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,e},t}(Si);zi.prototype.bytesPerElement=12,Fr("StructArrayLayout2ub2f12",zi);var Ui=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e},t}(Si);Ui.prototype.bytesPerElement=6,Fr("StructArrayLayout3ui6",Ui);var ji=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m){var g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m)},t.prototype.emplace=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g){var y=24*e,_=12*e,x=48*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint16[y+2]=r,this.uint16[y+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=l,this.uint16[y+12]=c,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[x+36]=f,this.uint8[x+37]=d,this.uint8[x+38]=v,this.uint32[_+10]=m,this.int16[y+22]=g,e},t}(Si);ji.prototype.bytesPerElement=48,Fr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ji);var Gi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g,y,_,x,b,E,w,S,T,A,C){var R=this.length;return this.resize(R+1),this.emplace(R,e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g,y,_,x,b,E,w,S,T,A,C)},t.prototype.emplace=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g,y,_,x,b,E,w,S,T,A,C,R){var M=34*e,k=17*e;return this.int16[M+0]=t,this.int16[M+1]=n,this.int16[M+2]=r,this.int16[M+3]=i,this.int16[M+4]=o,this.int16[M+5]=a,this.int16[M+6]=s,this.int16[M+7]=u,this.uint16[M+8]=l,this.uint16[M+9]=c,this.uint16[M+10]=h,this.uint16[M+11]=p,this.uint16[M+12]=f,this.uint16[M+13]=d,this.uint16[M+14]=v,this.uint16[M+15]=m,this.uint16[M+16]=g,this.uint16[M+17]=y,this.uint16[M+18]=_,this.uint16[M+19]=x,this.uint16[M+20]=b,this.uint16[M+21]=E,this.uint16[M+22]=w,this.uint32[k+12]=S,this.float32[k+13]=T,this.float32[k+14]=A,this.float32[k+15]=C,this.float32[k+16]=R,e},t}(Si);Gi.prototype.bytesPerElement=68,Fr("StructArrayLayout8i15ui1ul4f68",Gi);var Vi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.float32[1*e+0]=t,e},t}(Si);Vi.prototype.bytesPerElement=4,Fr("StructArrayLayout1f4",Vi);var Hi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e},t}(Si);Hi.prototype.bytesPerElement=6,Fr("StructArrayLayout3i6",Hi);var Wi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e},t}(Si);Wi.prototype.bytesPerElement=8,Fr("StructArrayLayout1ul2ui8",Wi);var Xi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e},t}(Si);Xi.prototype.bytesPerElement=4,Fr("StructArrayLayout2ui4",Xi);var Zi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint16[1*e+0]=t,e},t}(Si);Zi.prototype.bytesPerElement=2,Fr("StructArrayLayout1ui2",Zi);var qi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,e},t}(Si);qi.prototype.bytesPerElement=16,Fr("StructArrayLayout4f16",qi);var Yi=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,n),t}(wi);Yi.prototype.size=20;var Ki=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new Yi(this,e)},t}(Ni);Fr("CollisionBoxArray",Ki);var Qi=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(e){this._structArray.uint8[this._pos1+37]=e},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(e){this._structArray.uint8[this._pos1+38]=e},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(e){this._structArray.uint32[this._pos4+10]=e},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,n),t}(wi);Qi.prototype.size=48;var Ji=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new Qi(this,e)},t}(ji);Fr("PlacedSymbolArray",Ji);var $i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(e){this._structArray.uint32[this._pos4+12]=e},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,n),t}(wi);$i.prototype.size=68;var eo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new $i(this,e)},t}(Gi);Fr("SymbolInstanceArray",eo);var to=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(e){return this.float32[1*e+0]},t}(Vi);Fr("GlyphOffsetArray",to);var no=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(e){return this.int16[3*e+0]},t.prototype.gety=function(e){return this.int16[3*e+1]},t.prototype.gettileUnitDistanceFromAnchor=function(e){return this.int16[3*e+2]},t}(Hi);Fr("SymbolLineVertexArray",no);var ro=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,n),t}(wi);ro.prototype.size=8;var io=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new ro(this,e)},t}(Wi);Fr("FeatureIndexArray",io);var oo=Ti([{name:"a_pos",components:2,type:"Int16"}],4).members,ao=function(e){void 0===e&&(e=[]),this.segments=e};function so(e,t){return 256*(e=c(Math.floor(e),0,255))+c(Math.floor(t),0,255)}ao.prototype.prepareSegment=function(e,t,n,r){var i=this.segments[this.segments.length-1];return e>ao.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+ao.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!i||i.vertexLength+e>ao.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},ao.prototype.get=function(){return this.segments},ao.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var n=t[e];for(var r in n.vaos)n.vaos[r].destroy()}},ao.simpleSegment=function(e,t,n,r){return new ao([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},ao.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fr("SegmentVector",ao);var uo=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),lo=t((function(e){e.exports=function(e,t){var n,r,i,o,a,s,u,l;for(r=e.length-(n=3&e.length),i=t,a=3432918353,s=461845907,l=0;l<r;)u=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&e.charCodeAt(l+2))<<16;case 2:u^=(255&e.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),co=t((function(e){e.exports=function(e,t){for(var n,r=e.length,i=t^r,o=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),ho=lo,po=co;ho.murmur3=lo,ho.murmur2=po;var fo=function(){this.ids=[],this.positions=[],this.indexed=!1};fo.prototype.add=function(e,t,n,r){this.ids.push(mo(e)),this.positions.push(t,n,r)},fo.prototype.getPositions=function(e){for(var t=mo(e),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=t?r=i:n=i+1}for(var o=[];this.ids[n]===t;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},fo.serialize=function(e,t){var n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return function e(t,n,r,i){for(;r<i;){for(var o=t[r+i>>1],a=r-1,s=i+1;;){do{a++}while(t[a]<o);do{s--}while(t[s]>o);if(a>=s)break;go(t,a,s),go(n,3*a,3*s),go(n,3*a+1,3*s+1),go(n,3*a+2,3*s+2)}s-r<i-s?(e(t,n,r,s),r=s+1):(e(t,n,s+1,i),i=s)}}(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}},fo.deserialize=function(e){var t=new fo;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var vo=Math.pow(2,53)-1;function mo(e){var t=+e;return!isNaN(t)&&t<=vo?t:ho(String(e))}function go(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}Fr("FeaturePositionMap",fo);var yo=function(e,t){this.gl=e.gl,this.location=t},_o=function(e){function t(t,n){e.call(this,t,n),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))},t}(yo),xo=function(e){function t(t,n){e.call(this,t,n),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))},t}(yo),bo=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))},t}(yo),Eo=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))},t}(yo),wo=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))},t}(yo),So=function(e){function t(t,n){e.call(this,t,n),this.current=$e.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))},t}(yo),To=new Float32Array(16),Ao=function(e){function t(t,n){e.call(this,t,n),this.current=To}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(var t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}},t}(yo);function Co(e){return[so(255*e.r,255*e.g),so(255*e.b,255*e.a)]}var Ro=function(e,t,n){this.value=e,this.uniformNames=t.map((function(e){return"u_"+e})),this.type=n};Ro.prototype.setUniform=function(e,t,n){e.set(n.constantOr(this.value))},Ro.prototype.getBinding=function(e,t,n){return"color"===this.type?new So(e,t):new xo(e,t)};var Mo=function(e,t){this.uniformNames=t.map((function(e){return"u_"+e})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Mo.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Mo.prototype.setUniform=function(e,t,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&e.set(i)},Mo.prototype.getBinding=function(e,t,n){return"u_pattern"===n.substr(0,9)?new wo(e,t):new xo(e,t)};var ko=function(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:"a_"+e,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};ko.prototype.populatePaintArray=function(e,t,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new ai(0),t,{},r,[],i);this.paintVertexArray.resize(e),this._setPaintValue(o,e,a)},ko.prototype.updatePaintArray=function(e,t,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(e,t,i)},ko.prototype._setPaintValue=function(e,t,n){if("color"===this.type)for(var r=Co(n),i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=e;o<t;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},ko.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ko.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Io=function(e,t,n,r,i,o){this.expression=e,this.uniformNames=t.map((function(e){return"u_"+e+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:"a_"+e,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};Io.prototype.populatePaintArray=function(e,t,n,r,i){var o=this.expression.evaluate(new ai(this.zoom),t,{},r,[],i),a=this.expression.evaluate(new ai(this.zoom+1),t,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,o,a)},Io.prototype.updatePaintArray=function(e,t,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(e,t,i,o)},Io.prototype._setPaintValue=function(e,t,n,r){if("color"===this.type)for(var i=Co(n),o=Co(r),a=e;a<t;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},Io.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Io.prototype.setUniform=function(e,t){var n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=c(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)},Io.prototype.getBinding=function(e,t,n){return new xo(e,t)};var Lo=function(e,t,n,r,i,o){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Lo.prototype.populatePaintArray=function(e,t,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)},Lo.prototype.updatePaintArray=function(e,t,n,r,i){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],i)},Lo.prototype._setPaintValues=function(e,t,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=e;s<t;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Lo.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,uo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,uo.members,this.expression.isStateDependent))},Lo.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Po=function(e,t,n){this.binders={},this._buffers=[];var r=[];for(var i in e.paint._values)if(n(i)){var o=e.paint.get(i);if(o instanceof fi&&Pn(o.property.specification)){var a=Do(i,e.type),s=o.value,u=o.property.specification.type,l=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new Mo(s.value,a):new Ro(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||h){var p=No(i,u,"source");this.binders[i]=h?new Lo(s,u,l,t,p,e.id):new ko(s,a,u,p),r.push("/a_"+i)}else{var f=No(i,u,"composite");this.binders[i]=new Io(s,a,u,l,t,f),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Po.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof ko||t instanceof Io?t.maxValue:0},Po.prototype.populatePaintArrays=function(e,t,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof ko||a instanceof Io||a instanceof Lo)&&a.populatePaintArray(e,t,n,r,i)}},Po.prototype.setConstantPatternPositions=function(e,t){for(var n in this.binders){var r=this.binders[n];r instanceof Mo&&r.setConstantPatternPositions(e,t)}},Po.prototype.updatePaintArrays=function(e,t,n,r,i){var o=!1;for(var a in e)for(var s=0,u=t.getPositions(a);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof ko||p instanceof Io||p instanceof Lo)&&!0===p.expression.isStateDependent){var f=r.paint.get(h);p.expression=f.value,p.updatePaintArray(l.start,l.end,c,e[a],i),o=!0}}}return o},Po.prototype.defines=function(){var e=[];for(var t in this.binders){var n=this.binders[t];(n instanceof Ro||n instanceof Mo)&&e.push.apply(e,n.uniformNames.map((function(e){return"#define HAS_UNIFORM_"+e})))}return e},Po.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof ko||n instanceof Io)for(var r=0;r<n.paintVertexAttributes.length;r++)e.push(n.paintVertexAttributes[r].name);else if(n instanceof Lo)for(var i=0;i<uo.members.length;i++)e.push(uo.members[i].name)}return e},Po.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Ro||n instanceof Mo||n instanceof Io)for(var r=0,i=n.uniformNames;r<i.length;r+=1)e.push(i[r])}return e},Po.prototype.getPaintVertexBuffers=function(){return this._buffers},Po.prototype.getUniforms=function(e,t){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Ro||i instanceof Mo||i instanceof Io)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(t[s]){var u=i.getBinding(e,t[s],s);n.push({name:s,property:r,binding:u})}}}return n},Po.prototype.setUniforms=function(e,t,n,r){for(var i=0,o=t;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Po.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var n=this.binders[t];if(e&&n instanceof Lo){var r=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof ko||n instanceof Io)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Po.prototype.upload=function(e){for(var t in this.binders){var n=this.binders[t];(n instanceof ko||n instanceof Io||n instanceof Lo)&&n.upload(e)}this.updatePaintBuffers()},Po.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ko||t instanceof Io||t instanceof Lo)&&t.destroy()}};var Oo=function(e,t,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=e;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Po(o,t,n)}this.needsUpload=!1,this._featureMap=new fo,this._bufferOffset=0};function Do(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function No(e,t,n){var r={color:{source:Ii,composite:qi},number:{source:Vi,composite:Ii}},i=function(e){return{"line-pattern":{source:Li,composite:Li},"fill-pattern":{source:Li,composite:Li},"fill-extrusion-pattern":{source:Li,composite:Li}}[e]}(e);return i&&i[n]||r[t][n]}Oo.prototype.populatePaintArrays=function(e,t,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(e,t,r,i,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Oo.prototype.updatePaintArrays=function(e,t,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,t,a,r)||this.needsUpload}},Oo.prototype.get=function(e){return this.programConfigurations[e]},Oo.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Oo.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Fr("ConstantBinder",Ro),Fr("CrossFadedConstantBinder",Mo),Fr("SourceExpressionBinder",ko),Fr("CrossFadedCompositeBinder",Lo),Fr("CompositeExpressionBinder",Io),Fr("ProgramConfiguration",Po,{omit:["_buffers"]}),Fr("ProgramConfigurationSet",Oo);var Fo=Math.pow(2,14)-1,Bo=-Fo-1;function zo(e){for(var t=8192/e.extent,n=e.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*t),u=Math.round(a.y*t);a.x=c(s,Bo,Fo),a.y=c(u,Bo,Fo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function Uo(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?zo(e):[]}}function jo(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}var Go=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ci,this.indexArray=new Ui,this.segments=new ao,this.programConfigurations=new Oo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function Vo(e,t){for(var n=0;n<e.length;n++)if(Jo(t,e[n]))return!0;for(var r=0;r<t.length;r++)if(Jo(e,t[r]))return!0;return!!Zo(e,t)}function Ho(e,t,n){return!!Jo(e,t)||!!Yo(t,e,n)}function Wo(e,t){if(1===e.length)return Qo(t,e[0]);for(var n=0;n<t.length;n++)for(var r=t[n],i=0;i<r.length;i++)if(Jo(e,r[i]))return!0;for(var o=0;o<e.length;o++)if(Qo(t,e[o]))return!0;for(var a=0;a<t.length;a++)if(Zo(e,t[a]))return!0;return!1}function Xo(e,t,n){if(e.length>1){if(Zo(e,t))return!0;for(var r=0;r<t.length;r++)if(Yo(t[r],e,n))return!0}for(var i=0;i<e.length;i++)if(Yo(e[i],t,n))return!0;return!1}function Zo(e,t){if(0===e.length||0===t.length)return!1;for(var n=0;n<e.length-1;n++)for(var r=e[n],i=e[n+1],o=0;o<t.length-1;o++)if(qo(r,i,t[o],t[o+1]))return!0;return!1}function qo(e,t,n,r){return S(e,n,r)!==S(t,n,r)&&S(e,t,n)!==S(e,t,r)}function Yo(e,t,n){var r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(var i=1;i<t.length;i++)if(Ko(e,t[i-1],t[i])<r)return!0;return!1}function Ko(e,t,n){var r=t.distSqr(n);if(0===r)return e.distSqr(t);var i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function Qo(e,t){for(var n,r,i,o=!1,a=0;a<e.length;a++)for(var s=0,u=(n=e[a]).length-1;s<n.length;u=s++)(r=n[s]).y>t.y!=(i=n[u]).y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function Jo(e,t){for(var n=!1,r=0,i=e.length-1;r<e.length;i=r++){var o=e[r],a=e[i];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function $o(e,t,n){var r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;var o=S(e,t,n[0]);return o!==S(e,t,n[1])||o!==S(e,t,n[2])||o!==S(e,t,n[3])}function ea(e,t,n){var r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function ta(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function na(e,t,n,r,o){if(!t[0]&&!t[1])return e;var a=i.convert(t)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<e.length;u++)s.push(e[u].sub(a));return s}Go.prototype.populate=function(e,t,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.feature,c=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Uo(l,f);if(this.layers[0]._featureFilter.filter(new ai(this.zoom),d,n)){var v=o?o.evaluate(d,{},n):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:p,index:h,geometry:f?d.geometry:zo(l),patterns:{},sortKey:v};i.push(m)}}o&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,y=i;g<y.length;g+=1){var _=y[g],x=_.geometry,b=_.index,E=_.sourceLayerIndex,w=e[b].feature;this.addFeature(_,x,b,n),t.featureIndex.insert(w,x,b,E,this.index)}},Go.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Go.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oo),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.addFeature=function(e,t,n,r){for(var i=0,o=t;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),p=h.vertexLength;jo(this.layoutVertexArray,l,c,-1,-1),jo(this.layoutVertexArray,l,c,1,-1),jo(this.layoutVertexArray,l,c,1,1),jo(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r)},Fr("CircleBucket",Go,{omit:["layers"]});var ra=new xi({"circle-sort-key":new mi(Re.layout_circle["circle-sort-key"])}),ia={paint:new xi({"circle-radius":new mi(Re.paint_circle["circle-radius"]),"circle-color":new mi(Re.paint_circle["circle-color"]),"circle-blur":new mi(Re.paint_circle["circle-blur"]),"circle-opacity":new mi(Re.paint_circle["circle-opacity"]),"circle-translate":new vi(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new vi(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vi(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vi(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mi(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mi(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mi(Re.paint_circle["circle-stroke-opacity"])}),layout:ra},oa="undefined"!=typeof Float32Array?Float32Array:Array;function aa(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sa(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],_=n[0],x=n[1],b=n[2],E=n[3];return e[0]=_*r+x*s+b*h+E*v,e[1]=_*i+x*u+b*p+E*m,e[2]=_*o+x*l+b*f+E*g,e[3]=_*a+x*c+b*d+E*y,e[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*h+(E=n[7])*v,e[5]=_*i+x*u+b*p+E*m,e[6]=_*o+x*l+b*f+E*g,e[7]=_*a+x*c+b*d+E*y,e[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*h+(E=n[11])*v,e[9]=_*i+x*u+b*p+E*m,e[10]=_*o+x*l+b*f+E*g,e[11]=_*a+x*c+b*d+E*y,e[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*h+(E=n[15])*v,e[13]=_*i+x*u+b*p+E*m,e[14]=_*o+x*l+b*f+E*g,e[15]=_*a+x*c+b*d+E*y,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,n=arguments.length;n--;)t+=e[n]*e[n];return Math.sqrt(t)});var ua,la=sa;function ca(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}ua=new oa(3),oa!=Float32Array&&(ua[0]=0,ua[1]=0,ua[2]=0),function(){var e=new oa(4);oa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var ha=(function(){var e=new oa(2);oa!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(t){e.call(this,t,ia)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new Go(e)},t.prototype.queryRadius=function(e){var t=e;return ea("circle-radius",this,t)+ea("circle-stroke-width",this,t)+ta(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(e,t,n,r,i,o,a,s){for(var u=na(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(e,t){return e.map((function(e){return pa(e,t)}))}(u,s),p=c?l*a:l,f=0,d=r;f<d.length;f+=1)for(var v=0,m=d[f];v<m.length;v+=1){var g=m[v],y=c?g:pa(g,s),_=p,x=ca([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/x[3]),Ho(h,y,_))return!0}return!1},t}(bi));function pa(e,t){var n=ca([],[e.x,e.y,0,1],t);return new i(n[0]/n[3],n[1]/n[3])}var fa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Go);function da(e,t,n,r){var i=t.width,o=t.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return e.width=i,e.height=o,e.data=r,e}function va(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var o=da({},{width:r,height:i},n);ma(e,o,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=o.data}}function ma(e,t,n,r,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=e.data,s=t.data,u=0;u<i.height;u++)for(var l=((n.y+u)*e.width+n.x)*o,c=((r.y+u)*t.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return t}Fr("HeatmapBucket",fa,{omit:["layers"]});var ga=function(e,t){da(this,e,1,t)};ga.prototype.resize=function(e){va(this,e,1)},ga.prototype.clone=function(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))},ga.copy=function(e,t,n,r,i){ma(e,t,n,r,i,1)};var ya=function(e,t){da(this,e,4,t)};ya.prototype.resize=function(e){va(this,e,4)},ya.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},ya.prototype.clone=function(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))},ya.copy=function(e,t,n,r,i){ma(e,t,n,r,i,4)},Fr("AlphaImage",ga),Fr("RGBAImage",ya);var _a={paint:new xi({"heatmap-radius":new mi(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mi(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vi(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _i(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vi(Re.paint_heatmap["heatmap-opacity"])})};function xa(e){var t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new ya({width:n,height:r}),o=function(n,r,o){t[e.evaluationKey]=o;var a=e.expression.evaluate(t);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(e.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),h=e.clips[a];o(s,l,h.start*(1-c)+h.end*c)}else for(var p=0,f=0;p<n;p++,f+=4)o(0,f,p/(n-1));return i}var ba=function(e){function t(t){e.call(this,t,_a),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new fa(e)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){"heatmap-color"===e&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=xa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},t}(bi),Ea={paint:new xi({"hillshade-illumination-direction":new vi(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vi(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vi(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vi(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vi(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vi(Re.paint_hillshade["hillshade-accent-color"])})},wa=function(e){function t(t){e.call(this,t,Ea)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},t}(bi),Sa=Ti([{name:"a_pos",components:2,type:"Int16"}],4).members,Ta=Ca,Aa=Ca;function Ca(e,t,n){n=n||2;var r,i,o,a,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,p=Ra(e,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(e,t,n,r){var i,o,a,s=[];for(i=0,o=t.length;i<o;i++)(a=Ra(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(za(a));for(s.sort(Da),i=0;i<s.length;i++)Na(s[i],n),n=Ma(n,n.next);return n}(e,t,p,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return ka(p,f,n,r,i,l),f}function Ra(e,t,n,r,i){var o,a;if(i===Ja(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Ya(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Ya(o,e[o],e[o+1],a);return a&&Va(a,a.next)&&(Ka(a),a=a.next),a}function Ma(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Va(r,r.next)&&0!==Ga(r.prev,r,r.next))r=r.next;else{if(Ka(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function ka(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Ba(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?La(e,r,i,o):Ia(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),Ka(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?ka(e=Pa(Ma(e),t,n),t,n,r,i,o,2):2===a&&Oa(e,t,n,r,i,o):ka(Ma(e),t,n,r,i,o,1);break}}}function Ia(e){var t=e.prev,n=e,r=e.next;if(Ga(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Ua(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ga(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function La(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Ga(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Ba(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,t,n,r),c=Ba(s,u,t,n,r),h=e.prevZ,p=e.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==e.prev&&h!==e.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==e.prev&&h!==e.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==e.prev&&p!==e.next&&Ua(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Pa(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Va(i,o)&&Ha(i,r,r.next,o)&&Za(i,o)&&Za(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Ka(r),Ka(r.next),r=e=o),r=r.next}while(r!==e);return Ma(r)}function Oa(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ja(a,s)){var u=qa(a,s);return a=Ma(a,a.next),u=Ma(u,u.next),ka(a,t,n,r,i,o),void ka(u,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Da(e,t){return e.x-t.x}function Na(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ua(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Za(r,e)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&Fa(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(e,t)){var n=qa(t,e);Ma(t,t.next),Ma(n,n.next)}}function Fa(e,t){return Ga(e.prev,e,t.prev)<0&&Ga(t.next,e,e.next)<0}function Ba(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function za(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ua(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function ja(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ha(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Za(e,t)&&Za(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Ga(e.prev,e,t.prev)||Ga(e,t.prev,t))||Va(e,t)&&Ga(e.prev,e,e.next)>0&&Ga(t.prev,t,t.next)>0)}function Ga(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Va(e,t){return e.x===t.x&&e.y===t.y}function Ha(e,t,n,r){var i=Xa(Ga(e,t,n)),o=Xa(Ga(e,t,r)),a=Xa(Ga(n,r,e)),s=Xa(Ga(n,r,t));return i!==o&&a!==s||!(0!==i||!Wa(e,n,t))||!(0!==o||!Wa(e,r,t))||!(0!==a||!Wa(n,e,r))||!(0!==s||!Wa(n,t,r))}function Wa(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Xa(e){return e>0?1:e<0?-1:0}function Za(e,t){return Ga(e.prev,e,e.next)<0?Ga(e,t,e.next)>=0&&Ga(e,e.prev,t)>=0:Ga(e,t,e.prev)<0||Ga(e,e.next,t)<0}function qa(e,t){var n=new Qa(e.i,e.x,e.y),r=new Qa(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ya(e,t,n,r){var i=new Qa(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ka(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qa(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ja(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function $a(e,t,n,r,i){!function e(t,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var h=t[n],p=r,f=i;for(es(t,r,n),o(t[i],h)>0&&es(t,r,i);p<f;){for(es(t,p,f),p++,f--;o(t[p],h)<0;)p++;for(;o(t[f],h)>0;)f--}0===o(t[r],h)?es(t,r,f):es(t,++f,i),f<=n&&(r=f+1),n<=f&&(i=f-1)}}(e,t,n||0,r||e.length-1,i||ts)}function es(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function ts(e,t){return e<t?-1:e>t?1:0}function ns(e,t){var n=e.length;if(n<=1)return[e];for(var r,i,o=[],a=0;a<n;a++){var s=T(e[a]);0!==s&&(e[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[e[a]]):r.push(e[a]))}if(r&&o.push(r),t>1)for(var u=0;u<o.length;u++)o[u].length<=t||($a(o[u],t,1,o[u].length-1,rs),o[u]=o[u].slice(0,t));return o}function rs(e,t){return t.area-e.area}function is(e,t,n){for(var r=n.patternDependencies,i=!1,o=0,a=t;o<a.length;o+=1){var s=a[o].paint.get(e+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function os(e,t,n,r,i){for(var o=i.patternDependencies,a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.paint.get(e+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{},i.availableImages),h=l.evaluate({zoom:r},n,{},i.availableImages),p=l.evaluate({zoom:r+1},n,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,n.patterns[u.id]={min:c,mid:h,max:p}}}return n}Ca.deviation=function(e,t,n,r){var i=t&&t.length,o=Math.abs(Ja(e,0,i?t[0]*n:e.length,n));if(i)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(Ja(e,t[a]*n,a<s-1?t[a+1]*n:e.length,n));var u=0;for(a=0;a<r.length;a+=3){var l=r[a]*n,c=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((e[l]-e[h])*(e[c+1]-e[l+1])-(e[l]-e[c])*(e[h+1]-e[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},Ca.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&n.holes.push(r+=e[i-1].length)}return n},Ta.default=Aa;var as=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ci,this.indexArray=new Ui,this.indexArray2=new Xi,this.programConfigurations=new Oo(e.layers,e.zoom),this.segments=new ao,this.segments2=new ao,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};as.prototype.populate=function(e,t,n){this.hasPattern=is("fill",this.layers,t);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=e;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=Uo(u,p);if(this.layers[0]._featureFilter.filter(new ai(this.zoom),f,n)){var d=r?r.evaluate(f,{},n,t.availableImages):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:zo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var E=os("fill",this.layers,y,this.zoom,t);this.patternFeatures.push(E)}else this.addFeature(y,_,x,n,{});t.featureIndex.insert(e[x].feature,_,x,b,this.index)}},as.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},as.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,t,n)}},as.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},as.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},as.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sa),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},as.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},as.prototype.addFeature=function(e,t,n,r,i){for(var o=0,a=ns(t,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=h.vertexLength,f=[],d=[],v=0,m=s;v<m.length;v+=1){var g=m[v];if(0!==g.length){g!==s[0]&&d.push(f.length/2);var y=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),_=y.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(_+g.length-1,_),f.push(g[0].x),f.push(g[0].y);for(var x=1;x<g.length;x++)this.layoutVertexArray.emplaceBack(g[x].x,g[x].y),this.indexArray2.emplaceBack(_+x-1,_+x),f.push(g[x].x),f.push(g[x].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var b=Ta(f,d),E=0;E<b.length;E+=3)this.indexArray.emplaceBack(p+b[E],p+b[E+1],p+b[E+2]);h.vertexLength+=u,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Fr("FillBucket",as,{omit:["layers","patternFeatures"]});var ss=new xi({"fill-sort-key":new mi(Re.layout_fill["fill-sort-key"])}),us={paint:new xi({"fill-antialias":new vi(Re.paint_fill["fill-antialias"]),"fill-opacity":new mi(Re.paint_fill["fill-opacity"]),"fill-color":new mi(Re.paint_fill["fill-color"]),"fill-outline-color":new mi(Re.paint_fill["fill-outline-color"]),"fill-translate":new vi(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new vi(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new gi(Re.paint_fill["fill-pattern"])}),layout:ss},ls=function(e){function t(t){e.call(this,t,us)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,n){e.prototype.recalculate.call(this,t,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(e){return new as(e)},t.prototype.queryRadius=function(){return ta(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(e,t,n,r,i,o,a){return Wo(na(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},t.prototype.isTileClipped=function(){return!0},t}(bi),cs=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,hs=ps;function ps(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(fs,this,t)}function fs(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function ds(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)r+=((n=e[a]).x-(t=e[i]).x)*(t.y+n.y);return r}ps.types=["Unknown","Point","LineString","Polygon"],ps.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,o=0,a=0,s=0,u=[];e.pos<n;){if(o<=0){var l=e.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)a+=e.readSVarint(),s+=e.readSVarint(),1===r&&(t&&u.push(t),t=[]),t.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&u.push(t),u},ps.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},ps.prototype.toGeoJSON=function(e,t,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*e,s=this.extent*t,u=this.loadGeometry(),l=ps.types[this.type];function c(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=ds(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var vs=ms;function ms(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(gs,this,t),this.length=this._features.length}function gs(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}function ys(e,t,n){if(3===e){var r=new vs(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}ms.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new hs(this._pbf,t,this.extent,this._keys,this._values)};var _s={VectorTile:function(e,t){this.layers=e.readFields(ys,{},t)},VectorTileFeature:hs,VectorTileLayer:vs},xs=_s.VectorTileFeature.types,bs=Math.pow(2,13);function Es(e,t,n,r,i,o,a,s){e.emplaceBack(t,n,2*Math.floor(r*bs)+a,i*bs*2,o*bs*2,Math.round(s))}var ws=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Mi,this.indexArray=new Ui,this.programConfigurations=new Oo(e.layers,e.zoom),this.segments=new ao,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function Ss(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}ws.prototype.populate=function(e,t,n){this.features=[],this.hasPattern=is("fill-extrusion",this.layers,t);for(var r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,l=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=Uo(a,c);if(this.layers[0]._featureFilter.filter(new ai(this.zoom),h,n)){var p={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:zo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(os("fill-extrusion",this.layers,p,this.zoom,t)):this.addFeature(p,p.geometry,u,n,{}),t.featureIndex.insert(a,p.geometry,u,l,this.index,!0)}}},ws.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,t,n)}},ws.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},ws.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ws.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ws.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ws.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ws.prototype.addFeature=function(e,t,n,r,i){for(var o=0,a=ns(t,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,f=s;p<f.length;p+=1){var d=f[p];if(0!==d.length&&!((L=d).every((function(e){return e.x<0}))||L.every((function(e){return e.x>8192}))||L.every((function(e){return e.y<0}))||L.every((function(e){return e.y>8192}))))for(var v=0,m=0;m<d.length;m++){var g=d[m];if(m>=1){var y=d[m-1];if(!Ss(g,y)){h.vertexLength+4>ao.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=g.sub(y)._perp()._unit(),x=y.dist(g);v+x>32768&&(v=0),Es(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,v),Es(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,v),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,v+=x),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,v);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>ao.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===xs[e.type]){for(var E=[],w=[],S=h.vertexLength,T=0,A=s;T<A.length;T+=1){var C=A[T];if(0!==C.length){C!==s[0]&&w.push(E.length/2);for(var R=0;R<C.length;R++){var M=C[R];Es(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),E.push(M.x),E.push(M.y)}}}for(var k=Ta(E,w),I=0;I<k.length;I+=3)this.indexArray.emplaceBack(S+k[I],S+k[I+2],S+k[I+1]);h.primitiveLength+=k.length/3,h.vertexLength+=u}}var L;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Fr("FillExtrusionBucket",ws,{omit:["layers","features"]});var Ts={paint:new xi({"fill-extrusion-opacity":new vi(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mi(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vi(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vi(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gi(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mi(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mi(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vi(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},As=function(e){function t(t){e.call(this,t,Ts)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new ws(e)},t.prototype.queryRadius=function(){return ta(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(e,t,n,r,o,a,s,u){var l=na(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),p=function(e,t,n,r){for(var o=[],a=0,s=e;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];ca(l,l,t),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),f=function(e,t,n,r){for(var o=[],a=[],s=r[8]*t,u=r[9]*t,l=r[10]*t,c=r[11]*t,h=r[8]*n,p=r[9]*n,f=r[10]*n,d=r[11]*n,v=0,m=e;v<m.length;v+=1){for(var g=[],y=[],_=0,x=m[v];_<x.length;_+=1){var b=x[_],E=b.x,w=b.y,S=r[0]*E+r[4]*w+r[12],T=r[1]*E+r[5]*w+r[13],A=r[2]*E+r[6]*w+r[14],C=r[3]*E+r[7]*w+r[15],R=A+l,M=C+c,k=S+h,I=T+p,L=A+f,P=C+d,O=new i((S+s)/M,(T+u)/M);O.z=R/M,g.push(O);var D=new i(k/P,I/P);D.z=L/P,y.push(D)}o.push(g),a.push(y)}return[o,a]}(r,h,c,u);return function(e,t,n){var r=1/0;Wo(n,t)&&(r=Rs(n,t[0]));for(var i=0;i<t.length;i++)for(var o=t[i],a=e[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];Vo(n,l)&&(r=Math.min(r,Rs(n,l)))}return r!==1/0&&r}(f[0],f[1],p)},t}(bi);function Cs(e,t){return e.x*t.x+e.y*t.y}function Rs(e,t){if(1===e.length){for(var n,r=0,i=t[r++];!n||i.equals(n);)if(!(n=t[r++]))return 1/0;for(;r<t.length;r++){var o=t[r],a=e[0],s=n.sub(i),u=o.sub(i),l=a.sub(i),c=Cs(s,s),h=Cs(s,u),p=Cs(u,u),f=Cs(l,s),d=Cs(l,u),v=c*p-h*h,m=(p*f-h*d)/v,g=(c*d-h*f)/v,y=i.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(y))return y}return 1/0}for(var _=1/0,x=0,b=t;x<b.length;x+=1)_=Math.min(_,b[x].z);return _}var Ms=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ks=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Is=_s.VectorTileFeature.types,Ls=Math.cos(Math.PI/180*37.5),Ps=Math.pow(2,14)/.5,Os=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){t.gradients[e.id]={}})),this.layoutVertexArray=new ki,this.layoutVertexArray2=new Ii,this.indexArray=new Ui,this.programConfigurations=new Oo(e.layers,e.zoom),this.segments=new ao,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};Os.prototype.populate=function(e,t,n){this.hasPattern=is("line",this.layers,t);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=e;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=Uo(u,p);if(this.layers[0]._featureFilter.filter(new ai(this.zoom),f,n)){var d=r?r.evaluate(f,{},n):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:zo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var E=os("line",this.layers,y,this.zoom,t);this.patternFeatures.push(E)}else this.addFeature(y,_,x,n,{});t.featureIndex.insert(e[x].feature,_,x,b,this.index)}},Os.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Os.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,t,n)}},Os.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Os.prototype.upload=function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ks)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ms),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Os.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Os.prototype.addFeature=function(e,t,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(e,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),l=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var c=0,h=t;c<h.length;c+=1)this.addLine(h[c],e,a,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Os.prototype.addLine=function(e,t,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<e.length-1;a++)this.totalDistance+=e[a].dist(e[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Is[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var l=0;l<u-1&&e[l].equals(e[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),f=void 0,d=void 0,v=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=e[l].sub(c=e[u-2])._unit()._perp());for(var g=l;g<u;g++)if(!(d=g===u-1?s?e[l+1]:void 0:e[g+1])||!e[g].equals(d)){m&&(v=m),c&&(f=c),c=e[g],m=d?d.sub(c)._unit()._perp():v;var y=(v=v||m).add(m);0===y.x&&0===y.y||y._unit();var _=v.x*m.x+v.y*m.y,x=y.x*m.x+y.y*m.y,b=0!==x?1/x:1/0,E=2*Math.sqrt(2-2*x),w=x<Ls&&f&&d,S=v.x*m.y-v.y*m.x>0;if(w&&g>l){var T=c.dist(f);if(T>2*h){var A=c.sub(c.sub(f)._mult(h/T)._round());this.updateDistance(f,A),this.addCurrentVertex(A,v,0,0,p),f=A}}var C=f&&d,R=C?n:s?"butt":r;if(C&&"round"===R&&(b<o?R="miter":b<=2&&(R="fakeround")),"miter"===R&&b>i&&(R="bevel"),"bevel"===R&&(b>2&&(R="flipbevel"),b<i&&(R="miter")),f&&this.updateDistance(f,c),"miter"===R)y._mult(b),this.addCurrentVertex(c,y,0,0,p);else if("flipbevel"===R){if(b>100)y=m.mult(-1);else{var M=b*v.add(m).mag()/v.sub(m).mag();y._perp()._mult(M*(S?-1:1))}this.addCurrentVertex(c,y,0,0,p),this.addCurrentVertex(c,y.mult(-1),0,0,p)}else if("bevel"===R||"fakeround"===R){var k=-Math.sqrt(b*b-1),I=S?k:0,L=S?0:k;if(f&&this.addCurrentVertex(c,v,I,L,p),"fakeround"===R)for(var P=Math.round(180*E/Math.PI/20),O=1;O<P;O++){var D=O/P;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var F=m.sub(v)._mult(D)._add(v)._unit()._mult(S?-1:1);this.addHalfVertex(c,F.x,F.y,!1,S,0,p)}d&&this.addCurrentVertex(c,m,-I,-L,p)}else if("butt"===R)this.addCurrentVertex(c,y,0,0,p);else if("square"===R){var B=f?1:-1;this.addCurrentVertex(c,y,B,B,p)}else"round"===R&&(f&&(this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v,1,1,p,!0)),d&&(this.addCurrentVertex(c,m,-1,-1,p,!0),this.addCurrentVertex(c,m,0,0,p)));if(w&&g<u-1){var z=c.dist(d);if(z>2*h){var U=c.add(d.sub(c)._mult(h/z)._round());this.updateDistance(c,U),this.addCurrentVertex(U,m,0,0,p),c=U}}}}},Os.prototype.addCurrentVertex=function(e,t,n,r,i,o){void 0===o&&(o=!1);var a=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,i),this.addHalfVertex(e,a,s,o,!0,-r,i),this.distance>Ps/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,n,r,i,o))},Os.prototype.addHalfVertex=function(e,t,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ps-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(r?1:0),(e.y<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Os.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Os.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Fr("LineBucket",Os,{omit:["layers","patternFeatures"]});var Ds=new xi({"line-cap":new vi(Re.layout_line["line-cap"]),"line-join":new mi(Re.layout_line["line-join"]),"line-miter-limit":new vi(Re.layout_line["line-miter-limit"]),"line-round-limit":new vi(Re.layout_line["line-round-limit"]),"line-sort-key":new mi(Re.layout_line["line-sort-key"])}),Ns={paint:new xi({"line-opacity":new mi(Re.paint_line["line-opacity"]),"line-color":new mi(Re.paint_line["line-color"]),"line-translate":new vi(Re.paint_line["line-translate"]),"line-translate-anchor":new vi(Re.paint_line["line-translate-anchor"]),"line-width":new mi(Re.paint_line["line-width"]),"line-gap-width":new mi(Re.paint_line["line-gap-width"]),"line-offset":new mi(Re.paint_line["line-offset"]),"line-blur":new mi(Re.paint_line["line-blur"]),"line-dasharray":new yi(Re.paint_line["line-dasharray"]),"line-pattern":new gi(Re.paint_line["line-pattern"]),"line-gradient":new _i(Re.paint_line["line-gradient"])}),layout:Ds},Fs=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(t,n){return n=new ai(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),e.prototype.possiblyEvaluate.call(this,t,n)},t.prototype.evaluate=function(t,n,r,i){return n=p({},n,{zoom:Math.floor(n.zoom)}),e.prototype.evaluate.call(this,t,n,r,i)},t}(mi))(Ns.paint.properties["line-width"].specification);Fs.useIntegerZoom=!0;var Bs=function(e){function t(t){e.call(this,t,Ns),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(e){"line-gradient"===e&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Gt,this.gradientVersion=(this.gradientVersion+1)%s)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(t,n){e.prototype.recalculate.call(this,t,n),this.paint._values["line-floorwidth"]=Fs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},t.prototype.createBucket=function(e){return new Os(e)},t.prototype.queryRadius=function(e){var t=e,n=zs(ea("line-width",this,t),ea("line-gap-width",this,t)),r=ea("line-offset",this,t);return n/2+Math.abs(r)+ta(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(e,t,n,r,o,a,s){var u=na(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*zs(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(r=function(e,t){for(var n=[],r=new i(0,0),o=0;o<e.length;o++){for(var a=e[o],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],h=0===u?r:l.sub(a[u-1])._unit()._perp(),p=u===a.length-1?r:c.sub(l)._unit()._perp(),f=h._add(p)._unit();f._mult(1/(f.x*p.x+f.y*p.y)),s.push(f._mult(t)._add(l))}n.push(s)}return n}(r,c*s)),function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];if(e.length>=3)for(var o=0;o<i.length;o++)if(Jo(e,i[o]))return!0;if(Xo(e,i,n))return!0}return!1}(u,r,l)},t.prototype.isTileClipped=function(){return!0},t}(bi);function zs(e,t){return t>0?t+2*e:e}var Us=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),js=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vs=(Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Hs=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ws(e,t,n){return e.sections.forEach((function(e){e.text=function(e,t,n){var r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),oi.applyArabicShaping&&(e=oi.applyArabicShaping(e)),e}(e.text,t,n)})),e}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Zs=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},qs=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+f]=255&a,f+=d,a/=256,l-=8);e[n+f-d]|=128*v},Ys=Ks;function Ks(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ks.Varint=0,Ks.Fixed64=1,Ks.Bytes=2,Ks.Fixed32=5;var Qs="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Js(e){return e.type===Ks.Bytes?e.readVarint()+e.pos:e.pos+1}function $s(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eu(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function tu(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function nu(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function ru(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function iu(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function ou(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function au(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function su(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function uu(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function lu(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function cu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function hu(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function pu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function fu(e,t,n){1===e&&n.readMessage(du,t)}function du(e,t,n){if(3===e){var r=n.readMessage(vu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;t.push({id:r.id,bitmap:new ga({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function vu(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function mu(e){for(var t=0,n=0,r=0,i=e;r<i.length;r+=1){var o=i[r];t+=o.w*o.h,n=Math.max(n,o.w)}e.sort((function(e,t){return t.h-e.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],s=0,u=0,l=0,c=e;l<c.length;l+=1)for(var h=c[l],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:t/(s*u)||0}}Ks.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=cu(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=pu(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=cu(this.buf,this.pos)+4294967296*cu(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=cu(this.buf,this.pos)+4294967296*pu(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Zs(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zs(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return $s(e,r,t);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return $s(e,r,t);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return $s(e,r,t);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return $s(e,r,t);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return $s(e,r,t);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return $s(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qs?function(e,t,n){return Qs.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r="",i=t;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=e[i+2],128==(192&(o=e[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=e[i+2],s=e[i+3],128==(192&(o=e[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ks.Bytes)return e.push(this.readVarint(t));var n=Js(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSVarint());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ks.Bytes)return e.push(this.readBoolean());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFloat());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ks.Bytes)return e.push(this.readDouble());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFixed32());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSFixed32());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFixed64());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSFixed64());var t=Js(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ks.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ks.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ks.Fixed32)this.pos+=4;else{if(t!==Ks.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),hu(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),hu(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),hu(this.buf,-1&e,this.pos),hu(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),hu(this.buf,-1&e,this.pos),hu(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&eu(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),qs(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),qs(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&eu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,Ks.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,tu,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,nu,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,ou,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ru,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,iu,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,au,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,su,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,uu,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,lu,t)},writeBytesField:function(e,t){this.writeTag(e,Ks.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ks.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ks.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ks.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var gu=function(e,t){var n=t.pixelRatio,r=t.version,i=t.stretchX,o=t.stretchY,a=t.content;this.paddedRect=e,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},yu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yu.tlbr.get=function(){return this.tl.concat(this.br)},yu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gu.prototype,yu);var _u=function(e,t){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(e,n,i),this.addImages(t,r,i);var o=mu(i),a=new ya({width:o.w||1,height:o.h||1});for(var s in e){var u=e[s],l=n[s].paddedRect;ya.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in t){var h=t[c],p=r[c].paddedRect,f=p.x+1,d=p.y+1,v=h.data.width,m=h.data.height;ya.copy(h.data,a,{x:0,y:0},{x:f,y:d},h.data),ya.copy(h.data,a,{x:0,y:m-1},{x:f,y:d-1},{width:v,height:1}),ya.copy(h.data,a,{x:0,y:0},{x:f,y:d+m},{width:v,height:1}),ya.copy(h.data,a,{x:v-1,y:0},{x:f-1,y:d},{width:1,height:m}),ya.copy(h.data,a,{x:0,y:0},{x:f+v,y:d},{width:1,height:m})}this.image=a,this.iconPositions=n,this.patternPositions=r};_u.prototype.addImages=function(e,t,n){for(var r in e){var i=e[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),t[r]=new gu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},_u.prototype.patchUpdatedImages=function(e,t){for(var n in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)},_u.prototype.patchUpdatedImage=function(e,t,n){if(e&&t&&e.version!==t.version){e.version=t.version;var r=e.tl;n.update(t.data,void 0,{x:r[0],y:r[1]})}},Fr("ImagePosition",gu),Fr("ImageAtlas",_u);var xu={horizontal:1,vertical:2,horizontalOnly:3},bu=function(){this.scale=1,this.fontStack="",this.imageName=null};bu.forText=function(e,t){var n=new bu;return n.scale=e||1,n.fontStack=t,n},bu.forImage=function(e){var t=new bu;return t.imageName=e,t};var Eu=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function wu(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m,g=Eu.fromFeature(e,i);h===xu.vertical&&g.verticalizePunctuation();var y=oi.processBidirectionalText,_=oi.processStyledBidirectionalText;if(y&&1===g.sections.length){m=[];for(var x=0,b=y(g.toString(),ku(g,l,o,t,r,f,d));x<b.length;x+=1){var E=b[x],w=new Eu;w.text=E,w.sections=g.sections;for(var S=0;S<E.length;S++)w.sectionIndex.push(0);m.push(w)}}else if(_){m=[];for(var T=0,A=_(g.text,g.sectionIndex,ku(g,l,o,t,r,f,d));T<A.length;T+=1){var C=A[T],R=new Eu;R.text=C[0],R.sectionIndex=C[1],R.sections=g.sections,m.push(R)}}else m=function(e,t){for(var n=[],r=e.text,i=0,o=0,a=t;o<a.length;o+=1){var s=a[o];n.push(e.substring(i,s)),i=s}return i<r.length&&n.push(e.substring(i,r.length)),n}(g,ku(g,l,o,t,r,f,d));var M=[],k={positionedLines:M,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(e,t,n,r,i,o,a,s,u,l,c,h){for(var p=0,f=-17,d=0,v=0,m="right"===s?1:"left"===s?0:.5,g=0,y=0,_=i;y<_.length;y+=1){var x=_[y];x.trim();var b=x.getMaxScale(),E=24*(b-1),w={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=w;var S=w.positionedGlyphs,T=0;if(x.length()){for(var A=0;A<x.length();A++){var C=x.getSection(A),R=x.getSectionIndex(A),M=x.getCharCode(A),k=0,I=null,L=null,P=null,O=24,D=!(u===xu.horizontal||!c&&!Xr(M)||c&&(Su[M]||(H=M,Hr.Arabic(H)||Hr["Arabic Supplement"](H)||Hr["Arabic Extended-A"](H)||Hr["Arabic Presentation Forms-A"](H)||Hr["Arabic Presentation Forms-B"](H))));if(C.imageName){var N=r[C.imageName];if(!N)continue;P=C.imageName,e.iconsInText=e.iconsInText||!0,L=N.paddedRect;var F=N.displaySize;C.scale=24*C.scale/h,k=E+(24-F[1]*C.scale),O=(I={width:F[0],height:F[1],left:1,top:-3,advance:D?F[1]:F[0]}).advance;var B=D?F[0]*C.scale-24*b:F[1]*C.scale-24*b;B>0&&B>T&&(T=B)}else{var z=n[C.fontStack],U=z&&z[M];if(U&&U.rect)L=U.rect,I=U.metrics;else{var j=t[C.fontStack],G=j&&j[M];if(!G)continue;I=G.metrics}k=24*(b-C.scale)}D?(e.verticalizable=!0,S.push({glyph:M,imageName:P,x:p,y:f+k,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:R,metrics:I,rect:L}),p+=O*C.scale+l):(S.push({glyph:M,imageName:P,x:p,y:f+k,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:R,metrics:I,rect:L}),p+=I.advance*C.scale+l)}0!==S.length&&(d=Math.max(p-l,d),Lu(S,0,S.length-1,m,T)),p=0;var V=o*b+T;w.lineOffset=Math.max(T,E),f+=V,v=Math.max(V,v),++g}else f+=o,++g}var H,W=f- -17,X=Iu(a),Z=X.horizontalAlign,q=X.verticalAlign;(function(e,t,n,r,i,o,a,s,u){var l,c=(t-n)*i;l=o!==a?-s*r- -17:(-r*u+.5)*a;for(var h=0,p=e;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var v=d[f];v.x+=c,v.y+=l}})(e.positionedLines,m,Z,q,d,v,o,W,i.length),e.top+=-q*W,e.bottom=e.top+W,e.left+=-Z*d,e.right=e.left+d}(k,t,n,r,m,a,s,u,h,l,p,v),!function(e){for(var t=0,n=e;t<n.length;t+=1)if(0!==n[t].positionedGlyphs.length)return!1;return!0}(M)&&k}Eu.fromFeature=function(e,t){for(var n=new Eu,r=0;r<e.sections.length;r++){var i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n},Eu.prototype.length=function(){return this.text.length},Eu.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Eu.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Eu.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Eu.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n+1)||null,i=e.charCodeAt(n-1)||null;t+=r&&Zr(r)&&!Xs[e[n+1]]||i&&Zr(i)&&!Xs[e[n-1]]||!Xs[e[n]]?e[n]:Xs[e[n]]}return t}(this.text)},Eu.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Su[this.text.charCodeAt(t)];t++)e++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=e&&Su[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)},Eu.prototype.substring=function(e,t){var n=new Eu;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n},Eu.prototype.toString=function(){return this.text},Eu.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce((function(t,n){return Math.max(t,e.sections[n].scale)}),0)},Eu.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(bu.forText(e.scale,e.fontStack||t));for(var n=this.sections.length-1,r=0;r<e.text.length;++r)this.sectionIndex.push(n)},Eu.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(0!==t.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(bu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):w("Reached maximum number of images 6401")}else w("Can't add FormattedSection with an empty image.")},Eu.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Su={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tu={};function Au(e,t,n,r,i,o){if(t.imageName){var a=r[t.imageName];return a?a.displaySize[0]*t.scale*24/o+i:0}var s=n[t.fontStack],u=s&&s[e];return u?u.metrics.advance*t.scale+i:0}function Cu(e,t,n,r){var i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function Ru(e,t,n){var r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Mu(e,t,n,r,i,o){for(var a=null,s=Cu(t,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],h=Cu(t-c.x,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:e,x:t,priorBreak:a,badness:s}}function ku(e,t,n,r,i,o,a){if("point"!==o)return[];if(!e)return[];for(var s,u=[],l=function(e,t,n,r,i,o){for(var a=0,s=0;s<e.length();s++){var u=e.getSection(s);a+=Au(e.getCharCode(s),u,r,i,t,o)}return a/Math.max(1,Math.ceil(a/n))}(e,t,n,r,i,a),c=e.text.indexOf("​")>=0,h=0,p=0;p<e.length();p++){var f=e.getSection(p),d=e.getCharCode(p);if(Su[d]||(h+=Au(d,f,r,i,t,a)),p<e.length()-1){var v=!((s=d)<11904||!(Hr["Bopomofo Extended"](s)||Hr.Bopomofo(s)||Hr["CJK Compatibility Forms"](s)||Hr["CJK Compatibility Ideographs"](s)||Hr["CJK Compatibility"](s)||Hr["CJK Radicals Supplement"](s)||Hr["CJK Strokes"](s)||Hr["CJK Symbols and Punctuation"](s)||Hr["CJK Unified Ideographs Extension A"](s)||Hr["CJK Unified Ideographs"](s)||Hr["Enclosed CJK Letters and Months"](s)||Hr["Halfwidth and Fullwidth Forms"](s)||Hr.Hiragana(s)||Hr["Ideographic Description Characters"](s)||Hr["Kangxi Radicals"](s)||Hr["Katakana Phonetic Extensions"](s)||Hr.Katakana(s)||Hr["Vertical Forms"](s)||Hr["Yi Radicals"](s)||Hr["Yi Syllables"](s)));(Tu[d]||v||f.imageName)&&u.push(Mu(p+1,h,l,u,Ru(d,e.getCharCode(p+1),v&&c),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Mu(e.length(),h,l,u,0,!0))}function Iu(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Lu(e,t,n,r,i){if(r||i)for(var o=e[n],a=(e[n].x+o.metrics.advance*o.scale)*r,s=t;s<=n;s++)e[s].x-=a,e[s].y+=i}function Pu(e,t,n,r,i,o){var a,s=e.image;if(s.content){var u=s.content,l=s.pixelRatio||1;a=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,p,f,d=t.left*o,v=t.right*o;"width"===n||"both"===n?(f=i[0]+d-r[3],h=i[0]+v+r[1]):h=(f=i[0]+(d+v-s.displaySize[0])/2)+s.displaySize[0];var m=t.top*o,g=t.bottom*o;return"height"===n||"both"===n?(c=i[1]+m-r[0],p=i[1]+g+r[2]):p=(c=i[1]+(m+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:f,collisionPadding:a}}Tu[10]=!0,Tu[32]=!0,Tu[38]=!0,Tu[40]=!0,Tu[41]=!0,Tu[43]=!0,Tu[45]=!0,Tu[47]=!0,Tu[173]=!0,Tu[183]=!0,Tu[8203]=!0,Tu[8208]=!0,Tu[8211]=!0,Tu[8231]=!0;var Ou=function(e){function t(t,n,r,i){e.call(this,t,n),this.angle=r,void 0!==i&&(this.segment=i)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(i);function Du(e,t){var n=t.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ai(e+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=e;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<e+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new ai(s)),maxSize:n.evaluate(new ai(u)),interpolationType:i}}function Nu(e,t,n){var r=t.uSize,i=n.lowerSize;return"source"===e.kind?i/128:"composite"===e.kind?Vt(i/128,n.upperSize/128,t.uSizeT):r}function Fu(e,t){var n=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){var i=e.interpolationType,o=i?c(on.interpolationFactor(i,t,e.minZoom,e.maxZoom),0,1):0;"camera"===e.kind?r=Vt(e.minSize,e.maxSize,o):n=o}return{uSizeT:n,uSize:r}}Fr("Anchor",Ou);var Bu=Object.freeze({__proto__:null,getSizeData:Du,evaluateSizeForFeature:Nu,evaluateSizeForZoom:Fu,SIZE_PACK_FACTOR:128});function zu(e,t,n,r,i){if(void 0===t.segment)return!0;for(var o=t,a=t.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=e[a],h=e[a+1];if(!h)return!1;var p=e[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(h)}return!0}function Uu(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function ju(e,t,n){return e?.6*t*n:0}function Gu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Vu(e,t,n,r,i,o){for(var a=ju(n,i,o),s=Gu(n,r)*o,u=0,l=Uu(e)/2,c=0;c<e.length-1;c++){var h=e[c],p=e[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,v=Vt(h.x,p.x,d),m=Vt(h.y,p.y,d),g=new Ou(v,m,p.angleTo(h),c);return g._round(),!a||zu(e,g,s,a,t)?g:void 0}u+=f}}function Hu(e,t,n,r,i,o,a,s,u){var l=ju(r,o,a),c=Gu(r,i),h=c*a,p=0===e[0].x||e[0].x===u||0===e[0].y||e[0].y===u;return t-h<t/4&&(t=h+t/4),function e(t,n,r,i,o,a,s,u,l){for(var c=a/2,h=Uu(t),p=0,f=n-r,d=[],v=0;v<t.length-1;v++){for(var m=t[v],g=t[v+1],y=m.dist(g),_=g.angleTo(m);f+r<p+y;){var x=((f+=r)-p)/y,b=Vt(m.x,g.x,x),E=Vt(m.y,g.y,x);if(b>=0&&b<l&&E>=0&&E<l&&f-c>=0&&f+c<=h){var w=new Ou(b,E,_,v);w._round(),i&&!zu(t,w,a,i,o)||d.push(w)}}p+=y}return u||d.length||s||(d=e(t,p/2,r,i,o,a,s,!0,l)),d}(e,p?t/2*s%t:(c/2+2*o)*a*s%t,t,l,n,h,p,!1,u)}function Wu(e,t,n,r,o){for(var a=[],s=0;s<e.length;s++)for(var u=e[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<t&&p.x<t||(h.x<t?h=new i(t,h.y+(t-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<t&&(p=new i(t,h.y+(t-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<n&&p.y<n||(h.y<n?h=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round():p.y<n&&(p=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=r&&(p=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),l&&h.equals(l[l.length-1])||a.push(l=[h]),l.push(p)))))}return a}function Xu(e,t,n,r){var o=[],a=e.image,s=a.pixelRatio,u=a.paddedRect.w-2,l=a.paddedRect.h-2,c=e.right-e.left,h=e.bottom-e.top,p=a.stretchX||[[0,u]],f=a.stretchY||[[0,l]],d=function(e,t){return e+t[1]-t[0]},v=p.reduce(d,0),m=f.reduce(d,0),g=u-v,y=l-m,_=0,x=v,b=0,E=m,w=0,S=g,T=0,A=y;if(a.content&&r){var C=a.content;_=Zu(p,0,C[0]),b=Zu(f,0,C[1]),x=Zu(p,C[0],C[2]),E=Zu(f,C[1],C[3]),w=C[0]-_,T=C[1]-b,S=C[2]-C[0]-x,A=C[3]-C[1]-E}var R=function(r,o,u,l){var p=Yu(r.stretch-_,x,c,e.left),f=Ku(r.fixed-w,S,r.stretch,v),d=Yu(o.stretch-b,E,h,e.top),g=Ku(o.fixed-T,A,o.stretch,m),y=Yu(u.stretch-_,x,c,e.left),C=Ku(u.fixed-w,S,u.stretch,v),R=Yu(l.stretch-b,E,h,e.top),M=Ku(l.fixed-T,A,l.stretch,m),k=new i(p,d),I=new i(y,d),L=new i(y,R),P=new i(p,R),O=new i(f/s,g/s),D=new i(C/s,M/s),N=t*Math.PI/180;if(N){var F=Math.sin(N),B=Math.cos(N),z=[B,-F,F,B];k._matMult(z),I._matMult(z),P._matMult(z),L._matMult(z)}var U=r.stretch+r.fixed,j=o.stretch+o.fixed;return{tl:k,tr:I,bl:P,br:L,tex:{x:a.paddedRect.x+1+U,y:a.paddedRect.y+1+j,w:u.stretch+u.fixed-U,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:D,minFontScaleX:S/s/c,minFontScaleY:A/s/h,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var M=qu(p,g,v),k=qu(f,y,m),I=0;I<M.length-1;I++)for(var L=M[I],P=M[I+1],O=0;O<k.length-1;O++)o.push(R(L,k[O],P,k[O+1]));else o.push(R({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return o}function Zu(e,t,n){for(var r=0,i=0,o=e;i<o.length;i+=1){var a=o[i];r+=Math.max(t,Math.min(n,a[1]))-Math.max(t,Math.min(n,a[0]))}return r}function qu(e,t,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=e;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return r.push({fixed:t+1,stretch:n}),r}function Yu(e,t,n,r){return e/t*n+r}function Ku(e,t,n,r){return e-t*n/r}var Qu=function(e,t,n,r,o,a,s,u,l,c){if(this.boxStartIndex=e.length,l){var h=a.top,p=a.bottom,f=a.collisionPadding;f&&(h-=f[1],p+=f[3]);var d=p-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var v=a.top*s-u,m=a.bottom*s+u,g=a.left*s-u,y=a.right*s+u,_=a.collisionPadding;if(_&&(g-=_[0]*s,v-=_[1]*s,y+=_[2]*s,m+=_[3]*s),c){var x=new i(g,v),b=new i(y,v),E=new i(g,m),w=new i(y,m),S=c*Math.PI/180;x._rotate(S),b._rotate(S),E._rotate(S),w._rotate(S),g=Math.min(x.x,b.x,E.x,w.x),y=Math.max(x.x,b.x,E.x,w.x),v=Math.min(x.y,b.y,E.y,w.y),m=Math.max(x.y,b.y,E.y,w.y)}e.emplaceBack(t.x,t.y,g,v,y,m,n,r,o)}this.boxEndIndex=e.length},Ju=function(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=$u),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function $u(e,t){return e<t?-1:e>t?1:0}function el(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=e[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(a-r,s-o),p=h/2,f=new Ju([],tl);if(0===h)return new i(r,o);for(var d=r;d<a;d+=h)for(var v=o;v<s;v+=h)f.push(new nl(d+p,v+p,p,e));for(var m=function(e){for(var t=0,n=0,r=0,i=e[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,t+=3*c}return new nl(n/t,r/t,0,e)}(e),g=f.length;f.length;){var y=f.pop();(y.d>m.d||!m.d)&&(m=y,n&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,g)),y.max-m.d<=t||(f.push(new nl(y.p.x-(p=y.h/2),y.p.y-p,p,e)),f.push(new nl(y.p.x+p,y.p.y-p,p,e)),f.push(new nl(y.p.x-p,y.p.y+p,p,e)),f.push(new nl(y.p.x+p,y.p.y+p,p,e)),g+=4)}return n&&(console.log("num probes: "+g),console.log("best distance: "+m.d)),m.p}function tl(e,t){return t.max-e.max}function nl(e,t,n,r){this.p=new i(e,t),this.h=n,this.d=function(e,t){for(var n=!1,r=1/0,i=0;i<t.length;i++)for(var o=t[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>e.y!=c.y>e.y&&e.x<(c.x-l.x)*(e.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,Ko(e,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}Ju.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Ju.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Ju.prototype.peek=function(){return this.data[0]},Ju.prototype._up=function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r},Ju.prototype._down=function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var o=1+(e<<1),a=t[o],s=o+1;if(s<this.length&&n(t[s],a)<0&&(o=s,a=t[s]),n(a,i)>=0)break;t[e]=a,e=o}t[e]=i};var rl=Number.POSITIVE_INFINITY;function il(e,t){return t[1]!==rl?function(e,t,n){var r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,i]}(e,t[0],t[1]):function(e,t){var n=0,r=0;t<0&&(t=0);var i=t/Math.sqrt(2);switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}return[n,r]}(e,t[0])}function ol(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function al(e,t,n,r,o,a,s,u,l,c,h,p,f,d,v){var m=function(e,t,n,r,o,a,s,u){for(var l=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,p=t.positionedLines;h<p.length;h+=1)for(var f=p[h],d=0,v=f.positionedGlyphs;d<v.length;d+=1){var m=v[d];if(m.rect){var g=m.rect||{},y=4,_=!0,x=1,b=0,E=(o||u)&&m.vertical,w=m.metrics.advance*m.scale/2;if(u&&t.verticalizable&&(b=f.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var S=s[m.imageName];_=S.sdf,y=1/(x=S.pixelRatio)}var T=o?[m.x+w,m.y]:[0,0],A=o?[0,0]:[m.x+w+n[0],m.y+n[1]-b],C=[0,0];E&&(C=A,A=[0,0]);var R=(m.metrics.left-y)*m.scale-w+A[0],M=(-m.metrics.top-y)*m.scale+A[1],k=R+g.w*m.scale/x,I=M+g.h*m.scale/x,L=new i(R,M),P=new i(k,M),O=new i(R,I),D=new i(k,I);if(E){var N=new i(-w,w- -17),F=-Math.PI/2,B=12-w,z=new i(22-B,-(m.imageName?B:0)),U=new(Function.prototype.bind.apply(i,[null].concat(C)));L._rotateAround(F,N)._add(z)._add(U),P._rotateAround(F,N)._add(z)._add(U),O._rotateAround(F,N)._add(z)._add(U),D._rotateAround(F,N)._add(z)._add(U)}if(l){var j=Math.sin(l),G=Math.cos(l),V=[G,-j,j,G];L._matMult(V),P._matMult(V),O._matMult(V),D._matMult(V)}var H=new i(0,0),W=new i(0,0);c.push({tl:L,tr:P,bl:O,br:D,tex:g,writingMode:t.writingMode,glyphOffset:T,sectionIndex:m.sectionIndex,isSDF:_,pixelOffsetTL:H,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,o,a,s,r,e.allowVerticalPlacement),g=e.textSizeData,y=null;"source"===g.kind?(y=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&w(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((y=[128*d.compositeTextSizes[0].evaluate(s,{},v),128*d.compositeTextSizes[1].evaluate(s,{},v)])[0]>32640||y[1]>32640)&&w(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,m,y,u,a,s,c,t,l.lineStartIndex,l.lineLength,f,v);for(var _=0,x=h;_<x.length;_+=1)p[x[_]]=e.text.placedSymbolArray.length-1;return 4*m.length}function sl(e){for(var t in e)return e[t];return null}function ul(e,t,n,r){var i=e.compareText;if(t in i){for(var o=i[t],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[t]=[];return i[t].push(r),!1}var ll=_s.VectorTileFeature.types,cl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hl(e,t,n,r,i,o,a,s,u,l,c,h,p){var f=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),o,a,(f<<1)+(u?1:0),d,16*l,16*c,256*h,256*p)}function pl(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function fl(e){for(var t=0,n=e.sections;t<n.length;t+=1)if(Kr(n[t].text))return!0;return!1}var dl=function(e){this.layoutVertexArray=new Pi,this.indexArray=new Ui,this.programConfigurations=e,this.segments=new ao,this.dynamicLayoutVertexArray=new Oi,this.opacityVertexArray=new Di,this.placedSymbolArray=new Ji};dl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},dl.prototype.upload=function(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Us.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,js.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,cl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))},dl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fr("SymbolBuffers",dl);var vl=function(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ao,this.collisionVertexArray=new zi};vl.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fr("CollisionBuffers",vl);var ml=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=aa([]),this.placementViewportMatrix=aa([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Du(this.zoom,t["text-size"]),this.iconSizeData=Du(this.zoom,t["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(e){return xu[e]}))),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=e.sourceID};ml.prototype.createArrays=function(){this.text=new dl(new Oo(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new dl(new Oo(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new to,this.lineVertexArray=new no,this.symbolInstances=new eo},ml.prototype.calculateGlyphDependencies=function(e,t,n,r,i){for(var o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(n||r)&&i){var a=Xs[e.charAt(o)];a&&(t[a.charCodeAt(0)]=!0)}},ml.prototype.populate=function(e,t,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof nt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var h=t.iconDependencies,p=t.glyphDependencies,f=t.availableImages,d=new ai(this.zoom),v=0,m=e;v<m.length;v+=1){var g=m[v],y=g.feature,_=g.id,x=g.index,b=g.sourceLayerIndex,E=r._featureFilter.needGeometry,w=Uo(y,E);if(r._featureFilter.filter(d,w,n)){E||(w.geometry=zo(y));var S=void 0;if(u){var T=r.getValueAndResolveTokens("text-field",w,n,f),A=nt.factory(T);fl(A)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ri()||this.hasRTLText&&oi.isParsed())&&(S=Ws(A,r,w))}var C=void 0;if(l){var R=r.getValueAndResolveTokens("icon-image",w,n,f);C=R instanceof rt?R:rt.fromString(R)}if(S||C){var M=this.sortFeaturesByKey?c.evaluate(w,{},n):void 0;if(this.features.push({id:_,text:S,icon:C,index:x,sourceLayerIndex:b,geometry:w.geometry,properties:y.properties,type:ll[y.type],sortKey:M}),C&&(h[C.name]=!0),S){var k=o.evaluate(w,{},n).join(","),I="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xu.vertical)>=0;for(var L=0,P=S.sections;L<P.length;L+=1){var O=P[L];if(O.image)h[O.image.name]=!0;else{var D=Wr(S.toString()),N=O.fontStack||k,F=p[N]=p[N]||{};this.calculateGlyphDependencies(O.text,F,I,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(e){var t={},n={},r=[],i=0;function o(t){r.push(e[t]),i++}function a(e,t,i){var o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(e,n,i){var o=t[n];return delete t[n],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(e,t,n){var r=n?t[0][t[0].length-1]:t[0][0];return e+":"+r.x+":"+r.y}for(var l=0;l<e.length;l++){var c=e[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in t&&n[f]!==t[d]){var v=s(f,d,h),m=a(f,d,r[v].geometry);delete t[f],delete n[d],n[u(p,r[m].geometry,!0)]=m,r[v].geometry=null}else f in n?a(f,d,h):d in t?s(f,d,h):(o(l),t[f]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}},ml.prototype.update=function(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))},ml.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},ml.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ml.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ml.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ml.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ml.prototype.addToLineVertexArray=function(e,t){var n=this.lineVertexArray.length;if(void 0!==e.segment){for(var r=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]),o={},a=e.segment+1;a<t.length;a++)o[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:r},a<t.length-1&&(r+=t[a+1].dist(t[a]));for(var s=e.segment||0;s>=0;s--)o[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=t[s-1].dist(t[s]));for(var u=0;u<t.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},ml.prototype.addSymbols=function(e,t,n,r,i,o,a,s,u,l,c,h){for(var p=e.indexArray,f=e.layoutVertexArray,d=e.segments.prepareSegment(4*t.length,f,p,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,m=d.vertexLength,g=this.allowVerticalPlacement&&a===xu.vertical?Math.PI/2:0,y=o.text&&o.text.sections,_=0;_<t.length;_++){var x=t[_],b=x.tl,E=x.tr,w=x.bl,S=x.br,T=x.tex,A=x.pixelOffsetTL,C=x.pixelOffsetBR,R=x.minFontScaleX,M=x.minFontScaleY,k=x.glyphOffset,I=x.isSDF,L=x.sectionIndex,P=d.vertexLength,O=k[1];hl(f,s.x,s.y,b.x,O+b.y,T.x,T.y,n,I,A.x,A.y,R,M),hl(f,s.x,s.y,E.x,O+E.y,T.x+T.w,T.y,n,I,C.x,A.y,R,M),hl(f,s.x,s.y,w.x,O+w.y,T.x,T.y+T.h,n,I,A.x,C.y,R,M),hl(f,s.x,s.y,S.x,O+S.y,T.x+T.w,T.y+T.h,n,I,C.x,C.y,R,M),pl(e.dynamicLayoutVertexArray,s,g),p.emplaceBack(P,P+1,P+2),p.emplaceBack(P+1,P+2,P+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),_!==t.length-1&&L===t[_+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,o,o.index,{},h,y&&y[L])}e.placedSymbolArray.emplaceBack(s.x,s.y,v,this.glyphOffsetArray.length-v,m,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,c)},ml.prototype._addCollisionDebugVertex=function(e,t,n,r,i,o){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},ml.prototype.addCollisionDebugVertices=function(e,t,n,r,o,a,s){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=u.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,p=s.anchorX,f=s.anchorY;this._addCollisionDebugVertex(c,h,a,p,f,new i(e,t)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,t)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,r)),this._addCollisionDebugVertex(c,h,a,p,f,new i(e,r)),u.vertexLength+=4;var d=o.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},ml.prototype.addDebugCollisionBoxes=function(e,t,n,r){for(var i=e;i<t;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},ml.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vl(Fi,Vs.members,Xi),this.iconCollisionBox=new vl(Fi,Vs.members,Xi);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},ml.prototype._deserializeCollisionBoxesForSymbol=function(e,t,n,r,i,o,a,s,u){for(var l={},c=t;c<n;c++){var h=e.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var p=r;p<i;p++){var f=e.get(p);l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}for(var d=o;d<a;d++){var v=e.get(d);l.iconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},l.iconFeatureIndex=v.featureIndex;break}for(var m=s;m<u;m++){var g=e.get(m);l.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},l.verticalIconFeatureIndex=g.featureIndex;break}return l},ml.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},ml.prototype.hasTextData=function(){return this.text.segments.get().length>0},ml.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ml.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ml.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ml.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ml.prototype.addIndicesForPlacedSymbol=function(e,t){for(var n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)},ml.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var t=Math.sin(e),n=Math.cos(e),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(t*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(e,t){return r[e]-r[t]||i[t]-i[e]})),o},ml.prototype.addToSortKeyRanges=function(e,t){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},ml.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(e,n,r){e>=0&&r.indexOf(e)===n&&t.addIndicesForPlacedSymbol(t.text,e)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fr("SymbolBucket",ml,{omit:["layers","collisionBoxArray","features","compareText"]}),ml.MAX_GLYPHS=65535,ml.addDynamicAttributes=pl;var gl=new xi({"symbol-placement":new vi(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new vi(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vi(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mi(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vi(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vi(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new vi(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new vi(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vi(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new mi(Re.layout_symbol["icon-size"]),"icon-text-fit":new vi(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vi(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new mi(Re.layout_symbol["icon-image"]),"icon-rotate":new mi(Re.layout_symbol["icon-rotate"]),"icon-padding":new vi(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new vi(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new mi(Re.layout_symbol["icon-offset"]),"icon-anchor":new mi(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vi(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vi(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vi(Re.layout_symbol["text-rotation-alignment"]),"text-field":new mi(Re.layout_symbol["text-field"]),"text-font":new mi(Re.layout_symbol["text-font"]),"text-size":new mi(Re.layout_symbol["text-size"]),"text-max-width":new mi(Re.layout_symbol["text-max-width"]),"text-line-height":new vi(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new mi(Re.layout_symbol["text-letter-spacing"]),"text-justify":new mi(Re.layout_symbol["text-justify"]),"text-radial-offset":new mi(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vi(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new mi(Re.layout_symbol["text-anchor"]),"text-max-angle":new vi(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new vi(Re.layout_symbol["text-writing-mode"]),"text-rotate":new mi(Re.layout_symbol["text-rotate"]),"text-padding":new vi(Re.layout_symbol["text-padding"]),"text-keep-upright":new vi(Re.layout_symbol["text-keep-upright"]),"text-transform":new mi(Re.layout_symbol["text-transform"]),"text-offset":new mi(Re.layout_symbol["text-offset"]),"text-allow-overlap":new vi(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new vi(Re.layout_symbol["text-ignore-placement"]),"text-optional":new vi(Re.layout_symbol["text-optional"])}),yl={paint:new xi({"icon-opacity":new mi(Re.paint_symbol["icon-opacity"]),"icon-color":new mi(Re.paint_symbol["icon-color"]),"icon-halo-color":new mi(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new mi(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mi(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new vi(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new vi(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new mi(Re.paint_symbol["text-opacity"]),"text-color":new mi(Re.paint_symbol["text-color"],{runtimeType:Ue,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new mi(Re.paint_symbol["text-halo-color"]),"text-halo-width":new mi(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new mi(Re.paint_symbol["text-halo-blur"]),"text-translate":new vi(Re.paint_symbol["text-translate"]),"text-translate-anchor":new vi(Re.paint_symbol["text-translate-anchor"])}),layout:gl},_l=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ne,this.defaultValue=e};_l.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},_l.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},_l.prototype.outputDefined=function(){return!1},_l.prototype.serialize=function(){return null},Fr("FormatSectionOverride",_l,{omit:["defaultValue"]});var xl=function(e){function t(t){e.call(this,t,yl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,n){if(e.prototype.recalculate.call(this,t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(e,t,n,r){var i=this.layout.get(e).evaluate(t,{},n,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Wn(o.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,n){return n in e?String(e[n]):""}))}(t.properties,i)},t.prototype.createBucket=function(e){return new ml(e)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var e=0,n=yl.paint.overridableProperties;e<n.length;e+=1){var r=n[e];if(t.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new _l(o),s=new Hn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Zn("source",s):new qn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new fi(o.property,i,o.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(e,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&t.hasPaintOverride(this.layout,e)},t.hasPaintOverride=function(e,t){var n=e.get("text-field"),r=yl.paint.properties[t],i=!1,o=function(e){for(var t=0,n=e;t<n.length;t+=1)if(r.overrides&&r.overrides.hasOverride(n[t]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof nt)o(n.value.value.sections);else if("source"===n.value.kind){var a=n.value;a._styleExpression&&function e(t){i||(t instanceof ut&&at(t.value)===He?o(t.value.sections):t instanceof pt?o(t.sections):t.eachChild(e))}(a._styleExpression.expression)}return i},t}(bi),bl={paint:new xi({"background-color":new vi(Re.paint_background["background-color"]),"background-pattern":new yi(Re.paint_background["background-pattern"]),"background-opacity":new vi(Re.paint_background["background-opacity"])})},El=function(e){function t(t){e.call(this,t,bl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(bi),wl={paint:new xi({"raster-opacity":new vi(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new vi(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vi(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vi(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new vi(Re.paint_raster["raster-saturation"]),"raster-contrast":new vi(Re.paint_raster["raster-contrast"]),"raster-resampling":new vi(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new vi(Re.paint_raster["raster-fade-duration"])})},Sl=function(e){function t(t){e.call(this,t,wl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(bi),Tl=function(e){function t(t){e.call(this,t,{}),this.implementation=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},t.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},t.prototype.onRemove=function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},t}(bi),Al={circle:ha,heatmap:ba,hillshade:wa,fill:ls,"fill-extrusion":As,line:Bs,symbol:xl,background:El,raster:Sl},Cl=a.HTMLImageElement,Rl=a.HTMLCanvasElement,Ml=a.HTMLVideoElement,kl=a.ImageData,Il=a.ImageBitmap,Ll=function(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)};Ll.prototype.update=function(e,t,n){var r=e.width,i=e.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),o)this.size=[r,i],e instanceof Cl||e instanceof Rl||e instanceof Ml||e instanceof kl||Il&&e instanceof Il?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,e.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;e instanceof Cl||e instanceof Rl||e instanceof Ml||e instanceof kl||Il&&e instanceof Il?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Ll.prototype.bind=function(e,t,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)},Ll.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ll.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Pl=function(e){var t=this;this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Pl.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))},Pl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ol=function(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},g(["receive","process"],this),this.invoker=new Pl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=A()?e:a};function Dl(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}Ol.prototype.send=function(e,t,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=M(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:e,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:jr(t,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Ol.prototype.receive=function(e){var t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else A()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)},Ol.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Ol.prototype.processTask=function(e,t){var n=this;if("<response>"===t.type){var r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Gr(t.error)):r(null,Gr(t.data)))}else{var i=!1,o=M(this.globalScope)?void 0:[],a=t.hasCallback?function(t,r){i=!0,delete n.cancelCallbacks[e],n.target.postMessage({id:e,type:"<response>",sourceMapId:n.mapId,error:t?jr(t):null,data:jr(r,o)},o)}:function(e){i=!0},s=null,u=Gr(t.data);if(this.parent[t.type])s=this.parent[t.type](t.sourceMapId,u,a);else if(this.parent.getWorkerSource){var l=t.type.split(".");s=this.parent.getWorkerSource(t.sourceMapId,l[0],u.source)[l[1]](u,a)}else a(new Error("Could not find function "+t.type));!i&&s&&s.cancel&&(this.cancelCallbacks[e]=s.cancel)}},Ol.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Nl=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Nl.prototype.setNorthEast=function(e){return this._ne=e instanceof Fl?new Fl(e.lng,e.lat):Fl.convert(e),this},Nl.prototype.setSouthWest=function(e){return this._sw=e instanceof Fl?new Fl(e.lng,e.lat):Fl.convert(e),this},Nl.prototype.extend=function(e){var t,n,r=this._sw,i=this._ne;if(e instanceof Fl)t=e,n=e;else{if(!(e instanceof Nl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Nl.convert(e)):this.extend(Fl.convert(e)):this;if(n=e._ne,!(t=e._sw)||!n)return this}return r||i?(r.lng=Math.min(t.lng,r.lng),r.lat=Math.min(t.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Fl(t.lng,t.lat),this._ne=new Fl(n.lng,n.lat)),this},Nl.prototype.getCenter=function(){return new Fl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Nl.prototype.getSouthWest=function(){return this._sw},Nl.prototype.getNorthEast=function(){return this._ne},Nl.prototype.getNorthWest=function(){return new Fl(this.getWest(),this.getNorth())},Nl.prototype.getSouthEast=function(){return new Fl(this.getEast(),this.getSouth())},Nl.prototype.getWest=function(){return this._sw.lng},Nl.prototype.getSouth=function(){return this._sw.lat},Nl.prototype.getEast=function(){return this._ne.lng},Nl.prototype.getNorth=function(){return this._ne.lat},Nl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Nl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Nl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Nl.prototype.contains=function(e){var t=Fl.convert(e),n=t.lng,r=t.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},Nl.convert=function(e){return!e||e instanceof Nl?e:new Nl(e)};var Fl=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Fl.prototype.wrap=function(){return new Fl(h(this.lng,-180,180),this.lat)},Fl.prototype.toArray=function(){return[this.lng,this.lat]},Fl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Fl.prototype.distanceTo=function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))},Fl.prototype.toBounds=function(e){void 0===e&&(e=0);var t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new Nl(new Fl(this.lng-n,this.lat-t),new Fl(this.lng+n,this.lat+t))},Fl.convert=function(e){if(e instanceof Fl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Fl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Fl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Bl=2*Math.PI*6371008.8;function zl(e){return Bl*Math.cos(e*Math.PI/180)}function Ul(e){return(180+e)/360}function jl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Gl(e,t){return e/zl(t)}function Vl(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Hl=function(e,t,n){void 0===n&&(n=0),this.x=+e,this.y=+t,this.z=+n};Hl.fromLngLat=function(e,t){void 0===t&&(t=0);var n=Fl.convert(e);return new Hl(Ul(n.lng),jl(n.lat),Gl(t,n.lat))},Hl.prototype.toLngLat=function(){return new Fl(360*this.x-180,Vl(this.y))},Hl.prototype.toAltitude=function(){return this.z*zl(Vl(this.y))},Hl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Bl*(e=Vl(this.y),1/Math.cos(e*Math.PI/180));var e};var Wl=function(e,t,n){this.z=e,this.x=t,this.y=n,this.key=ql(0,e,e,t,n)};Wl.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Wl.prototype.url=function(e,t){var n,r,i,o,a,s=(r=this.y,i=this.z,o=Dl(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=Dl(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(e,t,n){for(var r,i="",o=e;o>0;o--)i+=(t&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Wl.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new i(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Wl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xl=function(e,t){this.wrap=e,this.canonical=t,this.key=ql(e,t.z,t.z,t.x,t.y)},Zl=function(e,t,n,r,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Wl(n,+r,+i),this.key=ql(t,e,n,r,i)};function ql(e,t,n,r,i){(e*=2)<0&&(e=-1*e-1);var o=1<<n;return(o*o*e+o*i+r).toString(36)+n.toString(36)+t.toString(36)}Zl.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Zl.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new Zl(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zl(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},Zl.prototype.calculateScaledKey=function(e,t){var n=this.canonical.z-e;return e>this.canonical.z?ql(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):ql(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)},Zl.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},Zl.prototype.children=function(e){if(this.overscaledZ>=e)return[new Zl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Zl(t,this.wrap,t,n,r),new Zl(t,this.wrap,t,n+1,r),new Zl(t,this.wrap,t,n,r+1),new Zl(t,this.wrap,t,n+1,r+1)]},Zl.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Zl.prototype.wrapped=function(){return new Zl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Zl.prototype.unwrapTo=function(e){return new Zl(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Zl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Zl.prototype.toUnwrapped=function(){return new Xl(this.wrap,this.canonical)},Zl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Zl.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Hl(e.x-this.wrap,e.y))},Fr("CanonicalTileID",Wl),Fr("OverscaledTileID",Zl,{omit:["posMatrix"]});var Yl=function(e,t,n){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return w('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var r=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Yl.prototype.get=function(e,t){var n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Yl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yl.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Yl.prototype._unpackMapbox=function(e,t,n){return(256*e*256+256*t+n)/10-1e4},Yl.prototype._unpackTerrarium=function(e,t,n){return 256*e+t+n/256-32768},Yl.prototype.getPixels=function(){return new ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yl.prototype.backfillBorder=function(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var r=t*this.dim,i=t*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-t*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.data[this._idx(c,l)]=e.data[this._idx(c+s,l+u)]},Fr("DEMData",Yl);var Kl=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}};Kl.prototype.encode=function(e){return this._stringToNumber[e]},Kl.prototype.decode=function(e){return this._numberToString[e]};var Ql=function(e,t,n,r,i){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=r,this.properties=e.properties,this.id=i},Jl={geometry:{configurable:!0}};Jl.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Jl.geometry.set=function(e){this._geometry=e},Ql.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e},Object.defineProperties(Ql.prototype,Jl);var $l=function(){this.state={},this.stateChanges={},this.deletedStates={}};$l.prototype.updateState=function(e,t,n){var r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},p(this.stateChanges[e][r],n),null===this.deletedStates[e])for(var i in this.deletedStates[e]={},this.state[e])i!==r&&(this.deletedStates[e][i]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][r])for(var o in this.deletedStates[e][r]={},this.state[e][r])n[o]||(this.deletedStates[e][r][o]=null);else for(var a in n)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][a]&&delete this.deletedStates[e][r][a]},$l.prototype.removeFeatureState=function(e,t,n){if(null!==this.deletedStates[e]){var r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}},$l.prototype.getState=function(e,t){var n=String(t),r=p({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var i=this.deletedStates[e][t];if(null===i)return{};for(var o in i)delete r[o]}return r},$l.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},$l.prototype.coalesceChanges=function(e,t){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),p(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,h=Object.keys(this.deletedStates[a][l]);c<h.length;c+=1)delete this.state[a][l][h[c]];s[l]=this.state[a][l]}n[a]=n[a]||{},p(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in e)e[f].setFeatureState(n,t)};var ec=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Lr(8192,16,0),this.grid3D=new Lr(8192,16,0),this.featureIndexArray=new io,this.promoteId=t};function tc(e,t,n,r,i){return _(e,(function(e,o){var a=t instanceof di?t.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function nc(e){for(var t=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=e;o<a.length;o+=1){var s=a[o];t=Math.min(t,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:t,minY:n,maxX:r,maxY:i}}function rc(e,t){return t-e}ec.prototype.insert=function(e,t,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<t.length;u++){for(var l=t[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new _s.VectorTile(new Ys(this.rawTileData)).layers,this.sourceLayerCoder=new Kl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(e,t,n,r){var o=this;this.loadVTLayers();for(var a=e.params||{},s=8192/e.tileSize/e.scale,u=or(a.filter),l=e.queryGeometry,c=e.queryPadding*s,h=nc(l),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),f=nc(e.cameraQueryGeometry),d=this.grid3D.query(f.minX-c,f.minY-c,f.maxX+c,f.maxY+c,(function(t,n,r,o){return function(e,t,n,r,o){for(var a=0,s=e;a<s.length;a+=1){var u=s[a];if(t<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var l=[new i(t,n),new i(t,o),new i(r,o),new i(r,n)];if(e.length>2)for(var c=0,h=l;c<h.length;c+=1)if(Jo(e,h[c]))return!0;for(var p=0;p<e.length-1;p++)if($o(e[p],e[p+1],l))return!0;return!1}(e.cameraQueryGeometry,t-c,n-c,r+c,o+c)})),v=0,m=d;v<m.length;v+=1)p.push(m[v]);p.sort(rc);for(var g,y={},_=function(i){var c=p[i];if(c!==g){g=c;var h=o.featureIndexArray.get(c),f=null;o.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,a.layers,a.availableImages,t,n,r,(function(t,n,r){return f||(f=zo(t)),n.queryIntersectsFeature(l,t,r,f,o.z,e.transform,s,e.pixelPosMatrix)}))}},x=0;x<p.length;x++)_(x);return y},ec.prototype.loadMatchingFeature=function(e,t,n,r,i,o,a,s,u,l,c){var h=this.bucketLayerIDs[t];if(!o||function(e,t){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(o,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(r);if(i.needGeometry){var v=Uo(d,!0);if(!i.filter(new ai(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!i.filter(new ai(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,f),g=0;g<h.length;g++){var y=h[g];if(!(o&&o.indexOf(y)<0)){var _=s[y];if(_){var x={};void 0!==m&&l&&(x=l.getState(_.sourceLayer||"_geojsonTileLayer",m));var b=p({},u[y]);b.paint=tc(b.paint,_.paint,d,x,a),b.layout=tc(b.layout,_.layout,d,x,a);var E=!c||c(d,_,x);if(E){var w=new Ql(d,this.z,this.x,this.y,m);w.layer=b;var S=e[y];void 0===S&&(S=e[y]=[]),S.push({featureIndex:r,feature:w,intersectionZ:E})}}}}}},ec.prototype.lookupSymbolFeatures=function(e,t,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var l=or(i),c=0,h=e;c<h.length;c+=1)this.loadMatchingFeature(u,n,r,h[c],l,o,a,s,t);return u},ec.prototype.hasLayer=function(e){for(var t=0,n=this.bucketLayerIDs;t<n.length;t+=1)for(var r=0,i=n[t];r<i.length;r+=1)if(e===i[r])return!0;return!1},ec.prototype.getId=function(e,t){var n=e.id;return this.promoteId&&"boolean"==typeof(n=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]])&&(n=Number(n)),n},Fr("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var ic=function(e,t){this.tileID=e,this.uid=d(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ic.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<B.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},ic.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},ic.prototype.loadVectorData=function(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var r in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var n={};if(!t)return n;for(var r=function(){var e=o[i],r=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(0!==r.length){e.layers=r,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return r.filter((function(t){return t.id===e}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=e}},i=0,o=e;i<o.length;i+=1)r();return n}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof ml){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof ml&&a.hasRTLText){this.hasRTLText=!0,oi.isLoading()||oi.isLoaded()||"deferred"!==ri()||ii();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new Ki},ic.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ic.prototype.getBucket=function(e){return this.buckets[e.id]},ic.prototype.upload=function(e){for(var t in this.buckets){var n=this.buckets[t];n.uploadPending()&&n.upload(e)}var r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ll(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ll(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},ic.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},ic.prototype.queryRenderedFeatures=function(e,t,n,r,i,o,a,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:a,queryPadding:this.queryPadding*u},e,t,n):{}},ic.prototype.querySourceFeatures=function(e,t){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=t?t.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=or(t&&t.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},p=0;p<o.length;p++){var f=o.feature(p);if(a.needGeometry){var d=Uo(f,!0);if(!a.filter(new ai(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new ai(this.tileID.overscaledZ),f))continue;var v=n.getId(f,i),m=new Ql(f,u,l,c,v);m.tile=h,e.push(m)}}},ic.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},ic.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ic.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var n=C(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{var o=this.expirationTime-t;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ic.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},ic.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(t.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=e[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=t&&t.style&&t.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},ic.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},ic.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()},ic.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ic.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=B.now()+e},ic.prototype.setDependencies=function(e,t){for(var n={},r=0,i=t;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[e]=n},ic.prototype.hasDependency=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=t;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var oc=a.performance,ac=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},oc.mark(this._marks.start)};ac.prototype.finish=function(){oc.mark(this._marks.end);var e=oc.getEntriesByName(this._marks.measure);return 0===e.length&&(oc.measure(this._marks.measure,this._marks.start,this._marks.end),e=oc.getEntriesByName(this._marks.measure),oc.clearMarks(this._marks.start),oc.clearMarks(this._marks.end),oc.clearMeasures(this._marks.measure)),e},e.Actor=Ol,e.AlphaImage=ga,e.CanonicalTileID=Wl,e.CollisionBoxArray=Ki,e.Color=$e,e.DEMData=Yl,e.DataConstantProperty=vi,e.DictionaryCoder=Kl,e.EXTENT=8192,e.ErrorEvent=Ae,e.EvaluationParameters=ai,e.Event=Te,e.Evented=Ce,e.FeatureIndex=ec,e.FillBucket=as,e.FillExtrusionBucket=ws,e.ImageAtlas=_u,e.ImagePosition=gu,e.LineBucket=Os,e.LngLat=Fl,e.LngLatBounds=Nl,e.MercatorCoordinate=Hl,e.ONE_EM=24,e.OverscaledTileID=Zl,e.Point=i,e.Point$1=i,e.Properties=xi,e.Protobuf=Ys,e.RGBAImage=ya,e.RequestManager=W,e.RequestPerformance=ac,e.ResourceType=de,e.SegmentVector=ao,e.SourceFeatureState=$l,e.StructArrayLayout1ui2=Zi,e.StructArrayLayout2f1f2i16=Bi,e.StructArrayLayout2i4=Ci,e.StructArrayLayout3ui6=Ui,e.StructArrayLayout4i8=Ri,e.SymbolBucket=ml,e.Texture=Ll,e.Tile=ic,e.Transitionable=li,e.Uniform1f=xo,e.Uniform1i=_o,e.Uniform2f=bo,e.Uniform3f=Eo,e.Uniform4f=wo,e.UniformColor=So,e.UniformMatrix4f=Ao,e.UnwrappedTileID=Xl,e.ValidationError=Me,e.WritingMode=xu,e.ZoomHistory=Vr,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},e.addDynamicAttributes=pl,e.asyncAll=function(e,t,n){if(!e.length)return n(null,[]);var r=e.length,i=new Array(e.length),o=null;e.forEach((function(e,a){t(e,(function(e,t){e&&(o=e),i[a]=t,0==--r&&n(o,i)}))}))},e.bezier=u,e.bindAll=g,e.browser=B,e.cacheEntryPossiblyAdded=function(e){++pe>ue&&(e.getActor().send("enforceCacheSizeLimit",se),pe=0)},e.clamp=c,e.clearTileCache=function(e){var t=a.caches.delete("mapbox-tiles");e&&t.catch(e).then((function(){return e()}))},e.clipLine=Wu,e.clone=function(e){var t=new oa(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=b,e.clone$2=function(e){var t=new oa(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.collisionCircleLayout=Hs,e.config=z,e.create=function(){var e=new oa(16);return oa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=function(){var e=new oa(9);return oa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},e.create$2=function(){var e=new oa(4);return oa!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.createCommonjsModule=t,e.createExpression=Xn,e.createLayout=Ti,e.createStyleLayer=function(e){return"custom"===e.type?new Tl(e):new Al[e.type](e)},e.cross=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e},e.deepEqual=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(t).length!==Object.keys(n).length)return!1;for(var i in t)if(!e(t[i],n[i]))return!1;return!0}return t===n},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.ease=l,e.emitValidationErrors=Ir,e.endsWith=y,e.enforceCacheSizeLimit=function(e){le(),ee&&ee.then((function(t){t.keys().then((function(n){for(var r=0;r<n.length-e;r++)t.delete(n[r])}))}))},e.evaluateSizeForFeature=Nu,e.evaluateSizeForZoom=Fu,e.evaluateVariableOffset=il,e.evented=ni,e.extend=p,e.featureFilter=or,e.filterObject=x,e.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.getAnchorAlignment=Iu,e.getAnchorJustification=ol,e.getArrayBuffer=xe,e.getImage=function e(t,n){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),me>=z.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return ve.push(r),r}me++;var i=!1,o=function(){if(!i)for(i=!0,me--;ve.length&&me<z.MAX_PARALLEL_IMAGE_REQUESTS;){var t=ve.shift();t.cancelled||(t.cancel=e(t.requestParameters,t.callback).cancel)}},s=xe(t,(function(e,t,r,i){o(),e?n(e):t&&(fe()?function(e,t){var n=new a.Blob([new Uint8Array(e)],{type:"image/png"});a.createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of "+e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(t,n):function(e,t,n,r){var i=new a.Image,o=a.URL;i.onload=function(){t(null,i),o.revokeObjectURL(i.src),i.onload=null,a.requestAnimationFrame((function(){i.src=Ee}))},i.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(e)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=e.byteLength?o.createObjectURL(s):Ee}(t,n,r,i))}));return{cancel:function(){s.cancel(),o()}}},e.getJSON=function(e,t){return _e(p(e,{type:"json"}),t)},e.getRTLTextPluginStatus=ri,e.getReferrer=ye,e.getVideo=function(e,t){var n,r,i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(var o=0;o<e.length;o++){var s=a.document.createElement("source");n=e[o],r=void 0,(r=a.document.createElement("a")).href=n,(r.protocol!==a.document.location.protocol||r.host!==a.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=e[o],i.appendChild(s)}return{cancel:function(){}}},e.identity=aa,e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,E=r*l-o*s,w=i*l-o*u,S=c*v-h*d,T=c*m-p*d,A=c*g-f*d,C=h*m-p*v,R=h*g-f*v,M=p*g-f*m,k=y*M-_*R+x*C+b*A-E*T+w*S;return k?(e[0]=(s*M-u*R+l*C)*(k=1/k),e[1]=(i*R-r*M-o*C)*k,e[2]=(v*w-m*E+g*b)*k,e[3]=(p*E-h*w-f*b)*k,e[4]=(u*A-a*M-l*T)*k,e[5]=(n*M-i*A+o*T)*k,e[6]=(m*x-d*w-g*_)*k,e[7]=(c*w-p*x+f*_)*k,e[8]=(a*R-s*A+l*S)*k,e[9]=(r*A-n*R-o*S)*k,e[10]=(d*E-v*x+g*y)*k,e[11]=(h*x-c*E-f*y)*k,e[12]=(s*T-a*C-u*S)*k,e[13]=(n*C-r*T+i*S)*k,e[14]=(v*_-d*b-m*y)*k,e[15]=(c*b-h*_+p*y)*k,e):null},e.isChar=Hr,e.isMapboxURL=X,e.keysDifference=function(e,t){var n=[];for(var r in e)r in t||n.push(r);return n},e.makeRequest=_e,e.mapObject=_,e.mercatorXfromLng=Ul,e.mercatorYfromLat=jl,e.mercatorZfromAltitude=Gl,e.mul=la,e.multiply=sa,e.mvt=_s,e.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},e.number=Vt,e.offscreenCanvasSupported=fe,e.ortho=function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e},e.parseGlyphPBF=function(e){return new Ys(e).readFields(fu,[])},e.pbf=Ys,e.performSymbolLayout=function(e,t,n,r,i,o,a){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var s=e.layers[0].layout,u=e.layers[0]._unevaluatedLayout._values,l={};if("composite"===e.textSizeData.kind){var c=e.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new ai(c.minZoom),a),u["text-size"].possiblyEvaluate(new ai(h),a)]}if("composite"===e.iconSizeData.kind){var p=e.iconSizeData,f=p.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new ai(p.minZoom),a),u["icon-size"].possiblyEvaluate(new ai(f),a)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new ai(e.zoom+1),a),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new ai(e.zoom+1),a),l.textMaxSize=u["text-size"].possiblyEvaluate(new ai(18));for(var d=24*s.get("text-line-height"),v="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),g=s.get("text-size"),y=function(){var o=x[_],u=s.get("text-font").evaluate(o,{},a).join(","),c=g.evaluate(o,{},a),h=l.layoutTextSize.evaluate(o,{},a),p=l.layoutIconSize.evaluate(o,{},a),f={horizontal:{},vertical:void 0},y=o.text,b=[0,0];if(y){var E=y.toString(),S=24*s.get("text-letter-spacing").evaluate(o,{},a),T=function(e){for(var t=0,n=e;t<n.length;t+=1)if(r=n[t].charCodeAt(0),Hr.Arabic(r)||Hr["Arabic Supplement"](r)||Hr["Arabic Extended-A"](r)||Hr["Arabic Presentation Forms-A"](r)||Hr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(E)?S:0,A=s.get("text-anchor").evaluate(o,{},a),C=s.get("text-variable-anchor");if(!C){var R=s.get("text-radial-offset").evaluate(o,{},a);b=R?il(A,[24*R,rl]):s.get("text-offset").evaluate(o,{},a).map((function(e){return 24*e}))}var M=v?"center":s.get("text-justify").evaluate(o,{},a),k=s.get("symbol-placement"),I="point"===k?24*s.get("text-max-width").evaluate(o,{},a):0,L=function(){e.allowVerticalPlacement&&Wr(E)&&(f.vertical=wu(y,t,n,i,u,I,d,A,"left",T,b,xu.vertical,!0,k,h,c))};if(!v&&C){for(var P="auto"===M?C.map((function(e){return ol(e)})):[M],O=!1,D=0;D<P.length;D++){var N=P[D];if(!f.horizontal[N])if(O)f.horizontal[N]=f.horizontal[0];else{var F=wu(y,t,n,i,u,I,d,"center",N,T,b,xu.horizontal,!1,k,h,c);F&&(f.horizontal[N]=F,O=1===F.positionedLines.length)}}L()}else{"auto"===M&&(M=ol(A));var B=wu(y,t,n,i,u,I,d,A,M,T,b,xu.horizontal,!1,k,h,c);B&&(f.horizontal[M]=B),L(),Wr(E)&&v&&m&&(f.vertical=wu(y,t,n,i,u,I,d,A,M,T,b,xu.vertical,!1,k,h,c))}}var z=void 0,U=!1;if(o.icon&&o.icon.name){var j=r[o.icon.name];j&&(z=function(e,t,n){var r=Iu(n),i=t[0]-e.displaySize[0]*r.horizontalAlign,o=t[1]-e.displaySize[1]*r.verticalAlign;return{image:e,top:o,bottom:o+e.displaySize[1],left:i,right:i+e.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),U=j.sdf,void 0===e.sdfIcons?e.sdfIcons=j.sdf:e.sdfIcons!==j.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==e.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var G=sl(f.horizontal)||f.vertical;e.iconsInText=!!G&&G.iconsInText,(G||z)&&function(e,t,n,r,i,o,a,s,u,l,c){var h=o.textMaxSize.evaluate(t,{});void 0===h&&(h=a);var p,f=e.layers[0].layout,d=f.get("icon-offset").evaluate(t,{},c),v=sl(n.horizontal),m=a/24,g=e.tilePixelRatio*m,y=e.tilePixelRatio*h/24,_=e.tilePixelRatio*s,x=e.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*e.tilePixelRatio,E=f.get("icon-padding")*e.tilePixelRatio,S=f.get("text-max-angle")/180*Math.PI,T="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),A="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),C=f.get("symbol-placement"),R=x/2,M=f.get("icon-text-fit");r&&"none"!==M&&(e.allowVerticalPlacement&&n.vertical&&(p=Pu(r,n.vertical,M,f.get("icon-text-fit-padding"),d,m)),v&&(r=Pu(r,v,M,f.get("icon-text-fit-padding"),d,m)));var k=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g,y,_,x,b,E,S,T){var A,C,R,M,k,I=e.addToLineVertexArray(t,n),L=0,P=0,O=0,D=0,N=-1,F=-1,B={},z=ho(""),U=0,j=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(U=(A=s.layout.get("text-offset").evaluate(x,{},S).map((function(e){return 24*e})))[0],j=A[1]):(U=24*s.layout.get("text-radial-offset").evaluate(x,{},S),j=rl),e.allowVerticalPlacement&&r.vertical){var G=s.layout.get("text-rotate").evaluate(x,{},S)+90;M=new Qu(u,t,l,c,h,r.vertical,p,f,d,G),a&&(k=new Qu(u,t,l,c,h,a,m,g,d,G))}if(i){var V=s.layout.get("icon-rotate").evaluate(x,{}),H="none"!==s.layout.get("icon-text-fit"),W=Xu(i,V,E,H),X=a?Xu(a,V,E,H):void 0;R=new Qu(u,t,l,c,h,i,m,g,!1,V),L=4*W.length;var Z=e.iconSizeData,q=null;"source"===Z.kind?(q=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&w(e.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===Z.kind&&((q=[128*b.compositeIconSizes[0].evaluate(x,{},S),128*b.compositeIconSizes[1].evaluate(x,{},S)])[0]>32640||q[1]>32640)&&w(e.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),e.addSymbols(e.icon,W,q,_,y,x,!1,t,I.lineStartIndex,I.lineLength,-1,S),N=e.icon.placedSymbolArray.length-1,X&&(P=4*X.length,e.addSymbols(e.icon,X,q,_,y,x,xu.vertical,t,I.lineStartIndex,I.lineLength,-1,S),F=e.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!C){z=ho(K.text);var Q=s.layout.get("text-rotate").evaluate(x,{},S);C=new Qu(u,t,l,c,h,K,p,f,d,Q)}var J=1===K.positionedLines.length;if(O+=al(e,t,K,o,s,d,x,v,I,r.vertical?xu.horizontal:xu.horizontalOnly,J?Object.keys(r.horizontal):[Y],B,N,b,S),J)break}r.vertical&&(D+=al(e,t,r.vertical,o,s,d,x,v,I,xu.vertical,["vertical"],B,F,b,S));var $=C?C.boxStartIndex:e.collisionBoxArray.length,ee=C?C.boxEndIndex:e.collisionBoxArray.length,te=M?M.boxStartIndex:e.collisionBoxArray.length,ne=M?M.boxEndIndex:e.collisionBoxArray.length,re=R?R.boxStartIndex:e.collisionBoxArray.length,ie=R?R.boxEndIndex:e.collisionBoxArray.length,oe=k?k.boxStartIndex:e.collisionBoxArray.length,ae=k?k.boxEndIndex:e.collisionBoxArray.length,se=-1,ue=function(e,t){return e&&e.circleDiameter?Math.max(e.circleDiameter,t):t};se=ue(C,se),se=ue(M,se),se=ue(R,se);var le=(se=ue(k,se))>-1?1:0;le&&(se*=T/24),e.glyphOffsetArray.length>=ml.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical||-1,N,F,z,$,ee,te,ne,re,ie,oe,ae,l,O,D,L,P,le,0,p,U,j,se)}(e,h,s,n,r,i,p,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,g,b,T,u,_,E,A,d,t,o,l,c,a)};if("line"===C)for(var I=0,L=Wu(t.geometry,0,0,8192,8192);I<L.length;I+=1)for(var P=L[I],O=0,D=Hu(P,x,S,n.vertical||v,r,24,y,e.overscaling,8192);O<D.length;O+=1){var N=D[O];v&&ul(e,v.text,R,N)||k(P,N)}else if("line-center"===C)for(var F=0,B=t.geometry;F<B.length;F+=1){var z=B[F];if(z.length>1){var U=Vu(z,S,n.vertical||v,r,24,y);U&&k(z,U)}}else if("Polygon"===t.type)for(var j=0,G=ns(t.geometry,0);j<G.length;j+=1){var V=G[j],H=el(V,16);k(V[0],new Ou(H.x,H.y,0))}else if("LineString"===t.type)for(var W=0,X=t.geometry;W<X.length;W+=1){var Z=X[W];k(Z,new Ou(Z[0].x,Z[0].y,0))}else if("Point"===t.type)for(var q=0,Y=t.geometry;q<Y.length;q+=1)for(var K=0,Q=Y[q];K<Q.length;K+=1){var J=Q[K];k([J],new Ou(J.x,J.y,0))}}(e,o,f,z,r,l,h,p,b,U,a)},_=0,x=e.features;_<x.length;_+=1)y();o&&e.generateCollisionDebugBuffers()},e.perspective=function(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+r)*(o=1/(r-i)),e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r];i in e&&(n[i]=e[i])}return n},e.plugin=oi,e.polygonIntersectsPolygon=Vo,e.postMapLoadEvent=ae,e.postTurnstileEvent=ie,e.potpack=mu,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.register=Fr,e.registerForPluginStateChange=function(e){return e({pluginStatus:Jr,pluginURL:$r}),ni.on("pluginStateChange",e),e},e.renderColorRamp=xa,e.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u,e},e.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+h*r,e[7]=u*i+p*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=h*i-s*r,e[11]=p*i-u*r,e},e.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+h*r,e[3]=u*i+p*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=h*i-s*r,e[7]=p*i-u*r,e},e.scale=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$1=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.scale$2=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},e.setCacheLimits=function(e,t){se=e,ue=t},e.setRTLTextPlugin=function(e,t,n){if(void 0===n&&(n=!1),"deferred"===Jr||"loading"===Jr||"loaded"===Jr)throw new Error("setRTLTextPlugin cannot be called multiple times.");$r=B.resolveURL(e),Jr="deferred",Qr=t,ti(),n||ii()},e.sphericalToCartesian=function(e){var t=e[0],n=e[1],r=e[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:t*Math.cos(n)*Math.sin(r),y:t*Math.sin(n)*Math.sin(r),z:t*Math.cos(r)}},e.sqrLen=function(e){var t=e[0],n=e[1];return t*t+n*n},e.styleSpec=Re,e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},e.symbolSize=Bu,e.transformMat3=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},e.transformMat4=ca,e.translate=function(e,t,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],m=n[1],g=n[2];return t===e?(e[12]=t[0]*v+t[4]*m+t[8]*g+t[12],e[13]=t[1]*v+t[5]*m+t[9]*g+t[13],e[14]=t[2]*v+t[6]*m+t[10]*g+t[14],e[15]=t[3]*v+t[7]*m+t[11]*g+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=p,e[10]=f,e[11]=d,e[12]=r*v+s*m+h*g+t[12],e[13]=i*v+u*m+p*g+t[13],e[14]=o*v+l*m+f*g+t[14],e[15]=a*v+c*m+d*g+t[15]),e},e.triggerPluginCompletionEvent=ei,e.uniqueId=d,e.validateCustomStyleLayer=function(e){var t=[],n=e.id;return void 0===n&&t.push({message:"layers."+n+': missing required property "id"'}),void 0===e.render&&t.push({message:"layers."+n+': missing required method "render"'}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),t},e.validateLight=Rr,e.validateStyle=Cr,e.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.vectorTile=_s,e.version="1.13.3",e.warnOnce=w,e.webpSupported=U,e.window=a,e.wrap=h})),r(0,(function(e){function t(e){var n=typeof e;if("number"===n||"boolean"===n||"string"===n||null==e)return JSON.stringify(e);if(Array.isArray(e)){for(var r="[",i=0,o=e;i<o.length;i+=1)r+=t(o[i])+",";return r+"]"}for(var a=Object.keys(e).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+t(e[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=e.refProperties;i<o.length;i+=1)r+="/"+t(n[o[i]]);return r}var r=function(e){this.keyCache={},e&&this.replace(e)};r.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[])},r.prototype.update=function(t,r){for(var i=this,o=0,a=t;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=e.createStyleLayer(s);u._featureFilter=e.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=r;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(e,t){for(var r={},i=0;i<e.length;i++){var o=t&&t[e[i].id]||n(e[i]);t&&(t[e[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(e[i])}var s=[];for(var u in r)s.push(r[u]);return s}(e.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(e){return i._layers[e.id]})),v=d[0];if("none"!==v.visibility){var m=v.source||"",g=this.familiesBySource[m];g||(g=this.familiesBySource[m]={});var y=v.sourceLayer||"_geojsonTileLayer",_=g[y];_||(_=g[y]=[]),_.push(d)}}};var i=function(t){var n={},r=[];for(var i in t){var o=t[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=e.potpack(r),h=new e.AlphaImage({width:c.w||1,height:c.h||1});for(var p in t){var f=t[p];for(var d in f){var v=f[+d];if(v&&0!==v.bitmap.width&&0!==v.bitmap.height){var m=n[p][d].rect;e.AlphaImage.copy(v.bitmap,h,{x:0,y:0},{x:m.x+1,y:m.y+1},v.bitmap)}}}this.image=h,this.positions=n};e.register("GlyphAtlas",i);var o=function(t){this.tileID=new e.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId};function a(t,n,r){for(var i=new e.EvaluationParameters(n),o=0,a=t;o<a.length;o+=1)a[o].recalculate(i,r)}function s(t,n){var r=e.getArrayBuffer(t.request,(function(t,r,i,o){t?n(t):r&&n(null,{vectorTile:new e.vectorTile.VectorTile(new e.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}o.prototype.parse=function(t,n,r,o,s){var u=this;this.status="parsing",this.data=t,this.collisionBoxArray=new e.CollisionBoxArray;var l=new e.DictionaryCoder(Object.keys(t.layers).sort()),c=new e.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,f,d,v={},m={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},g=n.familiesBySource[this.source];for(var y in g){var _=t.layers[y];if(_){1===_.version&&e.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=l.encode(y),b=[],E=0;E<_.length;E++){var w=_.feature(E),S=c.getId(w,y);b.push({feature:w,id:S,index:E,sourceLayerIndex:x})}for(var T=0,A=g[y];T<A.length;T+=1){var C=A[T],R=C[0];R.minzoom&&this.zoom<Math.floor(R.minzoom)||R.maxzoom&&this.zoom>=R.maxzoom||"none"!==R.visibility&&(a(C,this.zoom,r),(v[R.id]=R.createBucket({index:c.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,m,this.tileID.canonical),c.bucketLayerIDs.push(C.map((function(e){return e.id}))))}}}var M=e.mapObject(m.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(M).length?o.send("getGlyphs",{uid:this.uid,stacks:M},(function(e,t){h||(h=e,p=t,L.call(u))})):p={};var k=Object.keys(m.iconDependencies);k.length?o.send("getImages",{icons:k,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){h||(h=e,f=t,L.call(u))})):f={};var I=Object.keys(m.patternDependencies);function L(){if(h)return s(h);if(p&&f&&d){var t=new i(p),n=new e.ImageAtlas(f,d);for(var o in v){var u=v[o];u instanceof e.SymbolBucket?(a(u.layers,this.zoom,r),e.performSymbolLayout(u,p,t.positions,f,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof e.LineBucket||u instanceof e.FillBucket||u instanceof e.FillExtrusionBucket)&&(a(u.layers,this.zoom,r),u.addFeatures(m,this.tileID.canonical,n.patternPositions))}this.status="done",s(null,{buckets:e.values(v).filter((function(e){return!e.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:n,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?t.positions:null})}}I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){h||(h=e,d=t,L.call(u))})):d={},L.call(this)};var u=function(e,t,n,r){this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(t,n){var r=this,i=t.uid;this.loading||(this.loading={});var a=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.RequestPerformance(t.request),s=this.loading[i]=new o(t);s.abort=this.loadVectorData(t,(function(t,o){if(delete r.loading[i],t||!o)return s.status="done",r.loaded[i]=s,n(t);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(t,r){if(t||!r)return n(t);n(null,e.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},u.prototype.reloadTile=function(e,t){var n=this,r=this.loaded,i=e.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=e.showCollisionBoxes;var s=function(e,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),t(e,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(e,t){var n=this.loading,r=e.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),t()},u.prototype.removeTile=function(e,t){var n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()};var l=e.window.ImageBitmap,c=function(){this.loaded={}};function h(e,t){if(0!==e.length){p(e[0],t);for(var n=1;n<e.length;n++)p(e[n],!t)}}function p(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}c.prototype.loadTile=function(t,n){var r=t.uid,i=t.encoding,o=t.rawImageData,a=l&&o instanceof l?this.getImageData(o):o,s=new e.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},c.prototype.getImageData=function(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:n.width,height:n.height},n.data)},c.prototype.removeTile=function(e){var t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]};var f=e.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];t.push([new e.Point$1(i[0],i[1])])}return t}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new e.Point$1(h[0],h[1]))}o.push(u)}return o},d.prototype.toGeoJSON=function(e,t,n){return f.call(this,e,t,n)};var v=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t};v.prototype.feature=function(e){return new d(this._features[e])};var m=e.vectorTile.VectorTileFeature,g=y;function y(e,t){this.options=t||{},this.features=e,this.length=e.length}function _(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}y.prototype.feature=function(e){return new _(this.features[e],this.options.extent)},_.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var n=0;n<t.length;n++){for(var r=t[n],i=[],o=0;o<r.length;o++)i.push(new e.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var u=a[s];t=Math.min(t,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[t,r,n,i]},_.prototype.toGeoJSON=m.prototype.toGeoJSON;var x=E,b=g;function E(t){var n=new e.pbf;return function(e,t){for(var n in e.layers)t.writeMessage(3,w,e.layers[n])}(t,n),n.finish()}function w(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,S,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)t.writeMessage(4,M,o[n])}function S(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,T,e),t.writeVarintField(3,n.type),t.writeMessage(4,R,n)}function T(e,t){var n=e.feature,r=e.keys,i=e.values,o=e.keycache,a=e.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),o[s]=u=r.length-1),t.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=a[h];void 0===p&&(i.push(l),a[h]=p=i.length-1),t.writeVarint(p)}}function A(e,t){return(t<<3)+(7&e)}function C(e){return e<<1^e>>31}function R(e,t){for(var n=e.loadGeometry(),r=e.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),t.writeVarint(A(1,l));for(var c=3===r?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==r&&t.writeVarint(A(2,c-1));var p=u[h].x-i,f=u[h].y-o;t.writeVarint(C(p)),t.writeVarint(C(f)),i+=p,o+=f}3===r&&t.writeVarint(A(7,1))}}function M(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function k(e,t,n,r){I(e,n,r),I(t,2*n,2*r),I(t,2*n+1,2*r+1)}function I(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function L(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}x.fromVectorTileJs=E,x.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var r in e)n[r]=new g(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return E({layers:n})},x.GeoJSONWrapper=b;var P=function(e){return e[0]},O=function(e){return e[1]},D=function(e,t,n,r,i){void 0===t&&(t=P),void 0===n&&(n=O),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=e;for(var o=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(e.length),s=this.coords=new i(2*e.length),u=0;u<e.length;u++)a[u]=u,s[2*u]=t(e[u]),s[2*u+1]=n(e[u]);!function e(t,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function e(t,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);e(t,n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[2*r+a],f=i,d=o;for(k(t,n,i,r),n[2*o+a]>p&&k(t,n,i,o);f<d;){for(k(t,n,f,d),f++,d--;n[2*f+a]<p;)f++;for(;n[2*d+a]>p;)d--}n[2*i+a]===p?k(t,n,i,d):k(t,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(t,n,s,i,o,a%2),e(t,n,r,i,s-1,a+1),e(t,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};D.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)u=t[2*d+1],(s=t[2*d])>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((f+p)/2);u=t[2*v+1],(s=t[2*v])>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},D.prototype.within=function(e,t,n){return function(e,t,n,r,i,o){for(var a=[0,e.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)L(t[2*p],t[2*p+1],n,r)<=u&&s.push(e[p]);else{var f=Math.floor((h+c)/2),d=t[2*f],v=t[2*f+1];L(d,v,n,r)<=u&&s.push(e[f]);var m=(l+1)%2;(0===l?n-i<=d:r-i<=v)&&(a.push(h),a.push(f-1),a.push(m)),(0===l?n+i>=d:r+i>=v)&&(a.push(f+1),a.push(c),a.push(m))}}return s}(this.ids,this.coords,e,t,n,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},F=function(e){this.options=H(Object.create(N),e),this.trees=new Array(this.options.maxZoom+1)};function B(e,t,n,r,i){return{x:e,y:t,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function z(e,t){var n=e.geometry.coordinates,r=n[1];return{x:G(n[0]),y:V(r),zoom:1/0,index:t,parentId:-1}}function U(e){return{type:"Feature",id:e.id,properties:j(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function j(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return H(H({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function G(e){return e/360+.5}function V(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function H(e,t){for(var n in t)e[n]=t[n];return e}function W(e){return e.x}function X(e){return e.y}function Z(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function q(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Y(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)Y(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)Y(e,t[r][i])}(i),i}function Y(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)Q(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)Q(i[l],s);else if("LineString"===o)J(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)J(i[l],s=[],a,!1),e.push(q(u,"LineString",s,t.properties));return}$(i,s,a,!1)}else if("Polygon"===o)$(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)K(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];$(i[l],c,a,!0),s.push(c)}}e.push(q(u,o,s,t.properties))}}function Q(e,t){t.push(ee(e[0])),t.push(te(e[1])),t.push(0)}function J(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=ee(e[s][0]),l=te(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,function e(t,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=t[n],c=t[n+1],h=t[r],p=t[r+1],f=n+3;f<r;f+=3){var d=Z(t[f],t[f+1],l,c,h,p);if(d>a)o=f,a=d;else if(d===a){var v=Math.abs(f-s);v<u&&(o=f,u=v)}}a>i&&(o-n>3&&e(t,n,o,i),t[o+2]=a,r-o>3&&e(t,o,r,i))}(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function $(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];J(e[i],o,n,r),t.push(o)}}function ee(e){return e/360+.5}function te(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ne(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===p||"MultiPoint"===p)re(h,v,n,r,i);else if("LineString"===p)ie(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)ae(h,v,n,r,i,!1);else if("Polygon"===p)ae(h,v,n,r,i,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var g=[];ae(h[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push(q(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(q(c.id,p,v,c.tags))}}}return u.length?u:null}function re(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function ie(e,t,n,r,i,o,a){for(var s,u,l=oe(e),c=0===i?ue:le,h=e.start,p=0;p<e.length-3;p+=3){var f=e[p],d=e[p+1],v=e[p+2],m=e[p+3],g=e[p+4],y=0===i?f:d,_=0===i?m:g,x=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=c(l,f,d,m,g,n),a&&(l.start=h+s*u)):y>r?_<r&&(u=c(l,f,d,m,g,r),a&&(l.start=h+s*u)):se(l,f,d,v),_<n&&y>=n&&(u=c(l,f,d,m,g,n),x=!0),_>r&&y<=r&&(u=c(l,f,d,m,g,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),t.push(l),l=oe(e)),a&&(h+=s)}var b=e.length-3;f=e[b],d=e[b+1],v=e[b+2],(y=0===i?f:d)>=n&&y<=r&&se(l,f,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&se(l,l[0],l[1],l[2]),l.length&&t.push(l)}function oe(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ae(e,t,n,r,i,o){for(var a=0;a<e.length;a++)ie(e[a],t,n,r,i,o,!1)}function se(e,t,n,r){e.push(t),e.push(n),e.push(r)}function ue(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function le(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function ce(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=he(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(he(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(he(o.geometry[s][l],t));i.push(u)}n.push(q(o.id,a,i,o.tags))}return n}function he(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function pe(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(fe(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(fe(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function fe(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function de(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,ve(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function ve(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)me(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)me(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)me(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(p.id=t.id),e.features.push(p)}}function me(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ge(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)K(n,e.features[r],t,r);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=ne(e,1,-1-n,n,0,-1,2,t),o=ne(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=ne(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=ce(i,1).concat(r)),o&&(r=r.concat(ce(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(e,t,n){return 32*((1<<e)*n+t)+e}function _e(e,t){var n=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return t(null,null);var i=new v(r.features),o=x(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:i,rawData:o.buffer})}F.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var a="prepare "+e.length+" points";n&&console.time(a),this.points=e;for(var s=[],u=0;u<e.length;u++)e[u].geometry&&s.push(z(e[u],u));this.trees[i+1]=new D(s,W,X,o,Float32Array),n&&console.timeEnd(a);for(var l=i;l>=r;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new D(s,W,X,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},F.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,h=u.range(G(n),V(o),G(i),V(r));c<h.length;c+=1){var p=u.points[h[c]];l.push(p.numPoints?U(p):this.points[p.index])}return l},F.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===e&&s.push(c.numPoints?U(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},F.prototype.getLeaves=function(e,t,n){var r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r},F.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,l={features:[]};return this._addTileFeatures(r.range((t-a)/i,s,(t+1+a)/i,u),r.points,t,n,i,l),0===t&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,l),l.features.length?l:null},F.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},F.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},F.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?j(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},F.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))},F.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,t)),s=0;s<e.length;s++){var u=e[s];if(!(u.zoom<=t)){u.zoom=t;for(var l=this.trees[t+1],c=l.within(u.x,u.y,a),h=u.numPoints||1,p=h,f=0,d=c;f<d.length;f+=1){var v=l.points[d[f]];v.zoom>t&&(p+=v.numPoints||1)}if(p>=o){for(var m=u.x*h,g=u.y*h,y=i&&h>1?this._map(u,!0):null,_=(s<<5)+(t+1)+this.points.length,x=0,b=c;x<b.length;x+=1){var E=l.points[b[x]];if(!(E.zoom<=t)){E.zoom=t;var w=E.numPoints||1;m+=E.x*w,g+=E.y*w,E.parentId=_,i&&(y||(y=this._map(u,!0)),i(y,this._map(E)))}}u.parentId=_,n.push(B(m/p,g/p,_,p,y))}else if(n.push(u),p>1)for(var S=0,T=c;S<T.length;S+=1){var A=l.points[T[S]];A.zoom<=t||(A.zoom=t,n.push(A))}}}return n},F.prototype._getOriginId=function(e){return e-this.points.length>>5},F.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},F.prototype._map=function(e,t){if(e.numPoints)return t?H({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?H({},r):r},ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=ye(t,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=de(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==e.length){l>1&&console.time("clipping");var v,m,g,y,_,x,b=.5*u.buffer/u.extent,E=.5-b,w=.5+b,S=1+b;v=m=g=y=null,_=ne(e,c,n-b,n+w,0,p.minX,p.maxX,u),x=ne(e,c,n+E,n+S,0,p.minX,p.maxX,u),e=null,_&&(v=ne(_,c,r-b,r+w,1,p.minY,p.maxY,u),m=ne(_,c,r+E,r+S,1,p.minY,p.maxY,u),_=null),x&&(g=ne(x,c,r-b,r+w,1,p.minY,p.maxY,u),y=ne(x,c,r+E,r+S,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(m||[],t+1,2*n,2*r+1),s.push(g||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},ge.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=ye(e,t=(t%a+a)%a,n);if(this.tiles[s])return pe(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[ye(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?pe(this.tiles[s],i):null):null};var xe=function(t){function n(e,n,r,i){t.call(this,e,n,r,_e),i&&(this.loadGeoJSON=i)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new e.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)h(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)h(t.coordinates[r],n);return t}(a,!0);try{if(r.filter){var s=e.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(e){return e.key+": "+e.message})).join(", "));var u=a.features.filter((function(e){return s.value.evaluate({zoom:0},e)}));a={type:"FeatureCollection",features:u}}t._geoJSONIndex=r.cluster?new F(function(t){var n=t.superclusterOptions,r=t.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var h=c[l],p=r[h],f=p[0],d=e.createExpression(p[1]),v=e.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);i[h]=d.value,o[h]=v.value}return n.map=function(e){s.properties=e;for(var t={},n=0,r=u;n<r.length;n+=1){var o=r[n];t[o]=i[o].evaluate(a,s)}return t},n.reduce=function(e,t){s.properties=t;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=e[i],e[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(e,t){return new ge(e,t)}(a,r.geojsonVtOptions)}catch(o){return n(o)}t.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(e,n){var r=this.loaded;return r&&r[e.uid]?t.prototype.reloadTile.call(this,e,n):this.loadTile(e,n)},n.prototype.loadGeoJSON=function(t,n){if(t.request)e.getJSON(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()},n.prototype.getClusterExpansionZoom=function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}},n.prototype.getClusterChildren=function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}},n.prototype.getClusterLeaves=function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}},n}(u),be=function(t){var n=this;this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(n.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');n.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}};return be.prototype.setReferrer=function(e,t){this.referrer=t},be.prototype.setImages=function(e,t,n){for(var r in this.availableImages[e]=t,this.workerSources[e]){var i=this.workerSources[e][r];for(var o in i)i[o].availableImages=t}n()},be.prototype.setLayers=function(e,t,n){this.getLayerIndex(e).replace(t),n()},be.prototype.updateLayers=function(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()},be.prototype.loadTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).loadTile(t,n)},be.prototype.loadDEMTile=function(e,t,n){this.getDEMWorkerSource(e,t.source).loadTile(t,n)},be.prototype.reloadTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).reloadTile(t,n)},be.prototype.abortTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)},be.prototype.removeTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)},be.prototype.removeDEMTile=function(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)},be.prototype.removeSource=function(e,t,n){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,n):n()}},be.prototype.loadWorkerSource=function(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}},be.prototype.syncRTLPluginState=function(t,n,r){try{e.plugin.setState(n);var i=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=e.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(e){r(e.toString())}},be.prototype.getAvailableImages=function(e){var t=this.availableImages[e];return t||(t=[]),t},be.prototype.getLayerIndex=function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t},be.prototype.getWorkerSource=function(e,t,n){var r=this;return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:function(t,n,i){r.actor.send(t,n,i,e)}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][n]},be.prototype.getDEMWorkerSource=function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new c),this.demWorkerSources[e][t]},be.prototype.enforceCacheSizeLimit=function(t,n){e.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new be(self)),be})),r(0,(function(e){var t=e.createCommonjsModule((function(e){function t(e){return!n(e)}function n(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===r[n=e&&e.failIfMajorPerformanceCaveat]&&(r[n]=function(e){var n=function(e){var n=document.createElement("canvas"),r=Object.create(t.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(e);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}e.exports?e.exports=t:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=t,window.mapboxgl.notSupportedReason=n);var r={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(t,n,r){var i=e.window.document.createElement(t);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(t,n){return e.window.document.createElementNS(t,n)}},r=e.window.document&&e.window.document.documentElement.style;function i(e){if(!r)return e[0];for(var t=0;t<e.length;t++)if(e[t]in r)return e[t];return e[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},n.enableDrag=function(){r&&a&&(r[a]=o)};var s=i(["transform","WebkitTransform"]);n.setTransform=function(e,t){e.style[s]=t};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});e.window.addEventListener("test",l,l),e.window.removeEventListener("test",l,l)}catch(e){u=!1}n.addEventListener=function(e,t,n,r){void 0===r&&(r={}),e.addEventListener(t,n,"passive"in r&&u?r:r.capture)},n.removeEventListener=function(e,t,n,r){void 0===r&&(r={}),e.removeEventListener(t,n,"passive"in r&&u?r:r.capture)};var c=function t(n){n.preventDefault(),n.stopPropagation(),e.window.removeEventListener("click",t,!0)};function h(e){var t=e.userImage;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}n.suppressClick=function(){e.window.addEventListener("click",c,!0),e.window.setTimeout((function(){e.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(t,n){var r=t.getBoundingClientRect();return new e.Point(n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop)},n.touchPos=function(t,n){for(var r=t.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new e.Point(n[o].clientX-r.left-t.clientLeft,n[o].clientY-r.top-t.clientTop));return i},n.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},n.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var p=function(t){function n(){t.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(e){if(this.loaded!==e&&(this.loaded=e,e)){for(var t=0,n=this.requestors;t<n.length;t+=1){var r=n[t];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(e){return this.images[e]},n.prototype.addImage=function(e,t){this._validate(e,t)&&(this.images[e]=t)},n.prototype._validate=function(t,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(e,t){if(!e)return!0;for(var n=0,r=0,i=e;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||t<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))},n.prototype.updateImage=function(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0},n.prototype.removeImage=function(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(e,t){var n=!0;if(!this.isLoaded())for(var r=0,i=e;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})},n.prototype._notify=function(t,n){for(var r={},i=0,o=t;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new e.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:e.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var e=this.atlasImage;return{width:e.width,height:e.height}},n.prototype.getPattern=function(t){var n=this.patterns[t],r=this.getImage(t);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[t].position},n.prototype.bind=function(t){var n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var t=[];for(var n in this.patterns)t.push(this.patterns[n].bin);var r=e.potpack(t),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;e.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:p,height:f}),e.RGBAImage.copy(h,a,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),e.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),e.RGBAImage.copy(h,a,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),e.RGBAImage.copy(h,a,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(e.Evented),f=m,d=m,v=1e20;function m(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(e,t,n,r,i,o,a){for(var s=0;s<t;s++){for(var u=0;u<n;u++)r[u]=e[u*t+s];for(y(r,i,o,a,n),u=0;u<n;u++)e[u*t+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<t;s++)r[s]=e[u*t+s];for(y(r,i,o,a,t),s=0;s<t;s++)e[u*t+s]=Math.sqrt(i[s])}}function y(e,t,n,r,i){n[0]=0,r[0]=-v,r[1]=+v;for(var o=1,a=0;o<i;o++){for(var s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+v}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;t[o]=(o-n[a])*(o-n[a])+e[n[a]]}}m.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=t.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?v:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?v:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},f.default=d;var _=function(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}};_.prototype.setURL=function(e){this.url=e},_.prototype.getGlyphs=function(t,n){var r=this,i=[];for(var o in t)for(var a=0,s=t[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});e.asyncAll(i,(function(e,t){var n=e.stack,i=e.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void t(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)t(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])t(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],_.loadGlyphRange(n,s,r.url,r.requestManager,(function(e,t){if(t){for(var n in t)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=t[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(e,t);delete o.requests[s]}))),u.push((function(e,r){e?t(e):r&&t(null,{stack:n,id:i,glyph:r[i]||null})}))}}else t(null,{stack:n,id:i,glyph:a})}),(function(e,t){if(e)n(e);else if(t){for(var r={},i=0,o=t;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},_.prototype._doesCharSupportLocalGlyph=function(t){return!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t))},_.prototype._tinySDF=function(t,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=t.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=t.tinySDF=new _.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new e.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(t,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",a+"-"+s),e.ResourceType.Glyphs);e.getArrayBuffer(u,(function(t,n){if(t)o(t);else if(n){for(var r={},i=0,a=e.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},_.TinySDF=f;var x=function(){this.specification=e.styleSpec.light.position};x.prototype.possiblyEvaluate=function(t,n){return e.sphericalToCartesian(t.expression.evaluate(n))},x.prototype.interpolate=function(t,n,r){return{x:e.number(t.x,n.x,r),y:e.number(t.y,n.y,r),z:e.number(t.z,n.z,r)}};var b=new e.Properties({anchor:new e.DataConstantProperty(e.styleSpec.light.anchor),position:new x,color:new e.DataConstantProperty(e.styleSpec.light.color),intensity:new e.DataConstantProperty(e.styleSpec.light.intensity)}),E=function(t){function n(n){t.call(this),this._transitionable=new e.Transitionable(b),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(t,n){if(void 0===n&&(n={}),!this._validate(e.validateLight,t,n))for(var r in t){var i=t[r];e.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(e){this.properties=this._transitioning.possiblyEvaluate(e)},n.prototype._validate=function(t,n,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.styleSpec})))},n}(e.Evented),w=function(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};w.prototype.getDash=function(e,t){var n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]},w.prototype.getDashRanges=function(e,t,n){var r=[],i=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===e[0]});for(var s=e[0],u=1;u<e.length;u++){var l=e[u];r.push({left:i=s*n,right:o=(s+=l)*n,isDash:a=!a,zeroLength:0===l})}return r},w.prototype.addRoundDash=function(e,t,n){for(var r=t/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=e[a],u=0;u<this.width;u++){u/s.right>1&&(s=e[++a]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),p=void 0,f=i/n*(r+1);if(s.isDash){var d=r-Math.abs(f);p=Math.sqrt(h*h+d*d)}else p=r-Math.sqrt(h*h+f*f);this.data[o+u]=Math.max(0,Math.min(255,p+128))}},w.prototype.addRegularDash=function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],r=e[t+1];n.zeroLength?e.splice(t,1):r&&r.isDash===n.isDash&&(r.left=n.left,e.splice(t,1))}var i=e[0],o=e[e.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=e[s],l=0;l<this.width;l++){l/u.right>1&&(u=e[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),p=Math.min(c,h);this.data[a+l]=Math.max(0,Math.min(255,(u.isDash?p:-p)+128))}},w.prototype.addDash=function(t,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return e.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<t.length;a++)o+=t[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(t,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,l},w.prototype.bind=function(e){var t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))};var S=function t(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=e.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new t.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function T(t,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=e.pick(e.extend(o,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(e){return e.id}))),a.tiles=n.canonicalizeTileset(a,t.url),r(null,a)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url),e.ResourceType.Source),i):e.browser.frame((function(){return i(null,t)}))}S.prototype.broadcast=function(t,n,r){e.asyncAll(this.actors,(function(e,r){e.send(t,n,r)}),r=r||function(){})},S.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},S.prototype.remove=function(){this.actors.forEach((function(e){e.remove()})),this.actors=[],this.workerPool.release(this.id)},S.Actor=e.Actor;var A=function(t,n,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=r||24};A.prototype.validateBounds=function(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]},A.prototype.contains=function(t){var n=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=r&&t.x<o&&t.y>=i&&t.y<a};var C=function(t){function n(n,r,i,o){if(t.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(r,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new A(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles,t.map._requestManager._customAccessToken),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken,t.map._requestManager._customAccessToken),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setSourceProperty=function(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(e){var t=this;return this.setSourceProperty((function(){t._options.tiles=e})),this},n.prototype.setUrl=function(e){var t=this;return this.setSourceProperty((function(){t.url=e,t._options.url=e})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return e.extend({},this._options)},n.prototype.loadTile=function(t,n){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete t.request,t.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",i,o.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(e.Evented),R=function(t){function n(n,r,i,o){t.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},r),e.extend(this,e.pick(r,["url","scheme","tileSize"]))}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new A(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return e.extend({},this._options)},n.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},n.prototype.loadTile=function(t,n){var r=this,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(i,e.ResourceType.Tile),(function(i,o){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&t.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;t.texture=r.map.painter.getTileTexture(o.width),t.texture?t.texture.update(o,{useMipmap:!0}):(t.texture=new e.Texture(a,o,s.RGBA,{useMipmap:!0}),t.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(e,t){e.request&&(e.request.cancel(),delete e.request),t()},n.prototype.unloadTile=function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()},n.prototype.hasTransition=function(){return!1},n}(e.Evented),M=function(t){function n(n,r,i,o){t.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(t,n){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(e,r){e&&(t.state="errored",n(e)),r&&(t.dem=r,t.needsHillshadePrepare=!0,t.state="loaded",n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,o){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(r)t.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&e.offscreenCanvasSupported()?o:e.browser.getImageData(o,1),s={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:a,encoding:this.encoding};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)},n.prototype._getNeighboringTiles=function(t){var n=t.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?t.wrap-1:t.wrap,a=(n.x+1+r)%r,s=n.x+1===r?t.wrap+1:t.wrap,u={};return u[new e.OverscaledTileID(t.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new e.OverscaledTileID(t.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new e.OverscaledTileID(t.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new e.OverscaledTileID(t.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new e.OverscaledTileID(t.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new e.OverscaledTileID(t.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})},n}(R),k=function(t){function n(n,r,i,o){t.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=e.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)t.fire(new e.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(r.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event("data",r))}}))},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setData=function(t){var n=this;return this._data=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(t){if(t)n.fire(new e.ErrorEvent(t));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new e.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this},n.prototype.getClusterChildren=function(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this},n.prototype.getClusterLeaves=function(e,t,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:n},r),this},n.prototype._updateWorkerData=function(t){var n=this;this._loaded=!1;var r=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(e.browser.resolveURL(i),e.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(e,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),t(e))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(t,n){var r=this,i=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(i,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(e,o){return delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0},n.prototype.unloadTile=function(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return e.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(e.Evented),I=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),L=function(t){function n(e,n,r,i){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(t,n){var r=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new e.ErrorEvent(i)):o&&(r.image=o,t&&(r.coordinates=t),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(e){var t=this;return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(function(){t.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setCoordinates=function(t){var n=this;this.coordinates=t;var r=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=t;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-n,o-r),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new e.CanonicalTileID(c,Math.floor((n+i)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(e){return n.tileID.getTilePoint(e)._round()}));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(e.Evented),P=function(t){function n(e,n,r,i){t.call(this,e,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],e.ResourceType.Source).url);e.getVideo(this.urls,(function(n,r){t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(t.video=r,t.video.loop=!0,t.video.setAttribute("playsinline",""),t.video.addEventListener("playing",(function(){t.map.triggerRepaint()})),t.map&&t.video.play(),t._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(t){if(this.video){var n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=t}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(L),O=function(t){function n(n,r,i,o){t.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(e){return!Array.isArray(e)||2!==e.length||e.some((function(e){return"number"!=typeof e}))}))||this.fire(new e.ErrorEvent(new e.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.ErrorEvent(new e.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e+=1){var n=t[e];if(isNaN(n)||n<=0)return!0}return!1},n}(L),D={vector:C,raster:R,"raster-dem":M,geojson:k,video:P,image:L,canvas:O};function N(t,n){var r=e.identity([]);return e.translate(r,r,[1,1,0]),e.scale(r,r,[.5*t.width,.5*t.height,1]),e.multiply(r,r,t.calculatePosMatrix(n.toUnwrapped()))}function F(e,t,n,r,i,o){var a=function(e,t,n){if(e)for(var r=0,i=e;r<i.length;r+=1){var o=t[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in t){var s=t[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,t,e.id),s=o.maxPitchScaleFactor(),u=e.tilesIn(r,s,a);u.sort(B);for(var l=[],c=0,h=u;c<h.length;c+=1){var p=h[c];l.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(t,n,e._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,i,o,s,N(e.transform,p.tileID))})}var f=function(e){for(var t={},n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},p=t[l]=t[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];h[v.featureIndex]||(h[v.featureIndex]=!0,p.push(v))}}return t}(l);for(var d in f)f[d].forEach((function(t){var n=t.feature,r=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return f}function B(e,t){var n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var z=function(e,t){this.max=e,this.onRemove=t,this.reset()};z.prototype.reset=function(){for(var e in this.data)for(var t=0,n=this.data[e];t<n.length;t+=1){var r=n[t];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},z.prototype.add=function(e,t,n){var r=this,i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:t,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(e,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},z.prototype.has=function(e){return e.wrapped().key in this.data},z.prototype.getAndRemove=function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null},z.prototype._getAndRemoveByKey=function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value},z.prototype.getByKey=function(e){var t=this.data[e];return t?t[0].value:null},z.prototype.get=function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null},z.prototype.remove=function(e,t){if(!this.has(e))return this;var n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},z.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this},z.prototype.filter=function(e){var t=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];e(o.value)||t.push(o)}for(var a=0,s=t;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var U=function(e,t,n){this.context=e;var r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};U.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},U.prototype.updateData=function(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},G=function(e,t,n,r){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;var i=e.gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};G.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},G.prototype.updateData=function(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)},G.prototype.enableAttributes=function(e,t){for(var n=0;n<this.attributes.length;n++){var r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}},G.prototype.setVertexAttribPointers=function(e,t,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=t.attributes[i.name];void 0!==o&&e.vertexAttribPointer(o,i.components,e[j[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},G.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V=function(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(e){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var H=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getDefault=function(){return e.Color.transparent},n.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},n}(V),W=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 1},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)},t}(V),X=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)},t}(V),Z=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[!0,!0,!0,!0]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(V),q=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)},t}(V),Y=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 255},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)},t}(V),K=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},t.prototype.set=function(e){var t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)},t}(V),Q=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)},t}(V),J=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}},t}(V),$=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[0,1]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)},t}(V),ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}},t}(V),te=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.LESS},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)},t}(V),ne=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}},t}(V),re=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.ONE,e.ZERO]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)},t}(V),ie=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getDefault=function(){return e.Color.transparent},n.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},n}(V),oe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.FUNC_ADD},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)},t}(V),ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}},t}(V),se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.BACK},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)},t}(V),ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.CCW},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)},t}(V),le=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)},t}(V),ce=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.TEXTURE0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)},t}(V),he=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(V),pe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}},t}(V),fe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(V),de=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}},t}(V),ve=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}},t}(V),me=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1},t}(V),ge=function(e){function t(t){e.call(this,t),this.vao=t.extVertexArrayObject}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)},t}(V),ye=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 4},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}},t}(V),_e=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}},t}(V),xe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}},t}(V),be=function(e){function t(t,n){e.call(this,t),this.context=t,this.parent=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t}(V),Ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.setDirty=function(){this.dirty=!0},t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}},t}(be),we=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(be),Se=function(e,t,n,r){this.context=e,this.width=t,this.height=n;var i=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new Ee(e,i),r&&(this.depthAttachment=new we(e,i))};Se.prototype.destroy=function(){var e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){var n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)};var Te=function(e,t,n){this.func=e,this.mask=t,this.range=n};Te.ReadOnly=!1,Te.ReadWrite=!0,Te.disabled=new Te(519,Te.ReadOnly,[0,1]);var Ae=function(e,t,n,r,i,o){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var Ce=function(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n};Ce.disabled=new Ce(Ce.Replace=[1,0],e.Color.transparent,[!1,!1,!1,!1]),Ce.unblended=new Ce(Ce.Replace,e.Color.transparent,[!0,!0,!0,!0]),Ce.alphaBlended=new Ce([1,771],e.Color.transparent,[!0,!0,!0,!0]);var Re=function(e,t,n){this.enable=e,this.mode=t,this.frontFace=n};Re.disabled=new Re(!1,1029,2305),Re.backCCW=new Re(!0,1029,2305);var Me=function(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new W(this),this.clearStencil=new X(this),this.colorMask=new Z(this),this.depthMask=new q(this),this.stencilMask=new Y(this),this.stencilFunc=new K(this),this.stencilOp=new Q(this),this.stencilTest=new J(this),this.depthRange=new $(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ne(this),this.blendFunc=new re(this),this.blendColor=new ie(this),this.blendEquation=new oe(this),this.cullFace=new ae(this),this.cullFaceSide=new se(this),this.frontFace=new ue(this),this.program=new le(this),this.activeTexture=new ce(this),this.viewport=new he(this),this.bindFramebuffer=new pe(this),this.bindRenderbuffer=new fe(this),this.bindTexture=new de(this),this.bindVertexBuffer=new ve(this),this.bindElementBuffer=new me(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ge(this),this.pixelStoreUnpack=new ye(this),this.pixelStoreUnpackPremultiplyAlpha=new _e(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)};Me.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Me.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Me.prototype.createIndexBuffer=function(e,t){return new U(this,e,t)},Me.prototype.createVertexBuffer=function(e,t,n){return new G(this,e,t,n)},Me.prototype.createRenderbuffer=function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i},Me.prototype.createFramebuffer=function(e,t,n){return new Se(this,e,t,n)},Me.prototype.clear=function(e){var t=e.color,n=e.depth,r=this.gl,i=0;t&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Me.prototype.setCullFace=function(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))},Me.prototype.setDepthMode=function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)},Me.prototype.setStencilMode=function(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)},Me.prototype.setColorMode=function(t){e.deepEqual(t.blendFunction,Ce.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)},Me.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(t){function n(n,r,i){var o=this;t.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(t,n,r,i){var o=new D[n.type](t,n,r,i);if(o.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+o.id);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new z(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new e.SourceFeatureState}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)},n.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},n.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))},n.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return e.values(this._tiles).map((function(e){return e.tileID})).sort(Ie).map((function(e){return e.key}))},n.prototype.getRenderableIds=function(t){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,t)&&r.push(this._tiles[i]);return t?r.sort((function(t,r){var i=t.tileID,o=r.tileID,a=new e.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new e.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(e){return e.tileID.key})):r.map((function(e){return e.tileID})).sort(Ie).map((function(e){return e.key}))},n.prototype.hasRenderableParent=function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)},n.prototype._isIdRenderable=function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")},n.prototype._reloadTile=function(e,t){var n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))},n.prototype._tileLoaded=function(t,n,r,i){if(i)return t.state="errored",void(404!==i.status?this._source.fire(new e.ErrorEvent(i,{tile:t})):this.update(this.transform));t.timeAdded=e.browser.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID}))},n.prototype._backfillDEM=function(e){for(var t=this.getRenderableIds(),n=0;n<t.length;n++){var r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){var i=this.getTileByID(r);o(e,i),o(i,e)}}function o(e,t){e.needsHillshadePrepare=!0;var n=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(e){return this.getTileByID(e.key)},n.prototype.getTileByID=function(e){return this._tiles[e]},n.prototype._retainLoadedChildren=function(e,t,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>t+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>t;)if(e[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(e,t){if(e.key in this._loadedParentTiles){var n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(var r=e.overscaledZ-1;r>=t;r--){var i=e.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)},n.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/this._source.tileSize)+1,n=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(t*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(t){var r=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(t){return new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)})):(i=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(e){return r._source.hasTile(e)})))):i=[];var o=t.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(Le(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=e.browser.now())){var m=this.findLoadedParent(d,a);m&&(this._addTile(m.tileID),l[m.tileID.key]=m.tileID),c[f]=d}}for(var g in this._retainLoadedChildren(c,o,s,u),l)u[g]||(this._coveredTiles[g]=!0,u[g]=l[g])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,x=e.keysDifference(this._tiles,u);_<x.length;_+=1){var b=x[_],E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)},n.prototype._updateRetainedTiles=function(e,t){for(var r={},i={},o=Math.max(t-n.maxOverzooming,this._source.minzoom),a=Math.max(t+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=e;u<l.length;u+=1){var c=l[u],h=this._addTile(c);r[c.key]=c,h.hasData()||t<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,t,a,r);for(var p=0,f=e;p<f.length;p+=1){var d=f[p],v=this._tiles[d.key];if(!v.hasData()){if(t+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){r[m.key]=m;continue}}else{var y=d.children(this._source.maxzoom);if(r[y[0].key]&&r[y[1].key]&&r[y[2].key]&&r[y[3].key])continue}for(var _=v.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(v=this.getTile(b))&&_&&(v=this._addTile(b)),v&&(r[b.key]=b,_=v.wasRequested(),v.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],n=void 0,r=this._tiles[e].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=t;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(t){var n=this._tiles[t.key];if(n)return n;(n=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));var r=Boolean(n);return r||(n=new e.Tile(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n?(n.uses++,this._tiles[t.key]=n,r||this._source.fire(new e.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(e,t){var n=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((function(){n._reloadTile(e,"expired"),delete n._timers[e]}),r))},n.prototype._removeTile=function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))},n.prototype.clearTiles=function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(e);this._cache.reset()},n.prototype.tilesIn=function(t,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(t):t,u=t.map((function(e){return a.pointCoordinate(e)})),l=s.map((function(e){return a.pointCoordinate(e)})),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,v=0,m=l;v<m.length;v+=1){var g=m[v];h=Math.min(h,g.x),p=Math.min(p,g.y),f=Math.max(f,g.x),d=Math.max(d,g.y)}for(var y=function(t){var r=i._tiles[c[t]];if(!r.holdingForFade()){var s=r.tileID,v=Math.pow(2,a.zoom-r.tileID.overscaledZ),m=n*r.queryPadding*e.EXTENT/r.tileSize/v,g=[s.getTilePoint(new e.MercatorCoordinate(h,p)),s.getTilePoint(new e.MercatorCoordinate(f,d))];if(g[0].x-m<e.EXTENT&&g[0].y-m<e.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var y=u.map((function(e){return s.getTilePoint(e)})),_=l.map((function(e){return s.getTilePoint(e)}));o.push({tile:r,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)y(_);return o},n.prototype.getVisibleCoordinates=function(e){for(var t=this,n=this.getRenderableIds(e).map((function(e){return t._tiles[e].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Le(this._source.type))for(var t in this._tiles){var n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=e.browser.now())return!0}return!1},n.prototype.setFeatureState=function(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)},n.prototype.removeFeatureState=function(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)},n.prototype.getFeatureState=function(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)},n.prototype.setDependencies=function(e,t,n){var r=this._tiles[e];r&&r.setDependencies(t,n)},n.prototype.reloadTilesForDependencies=function(e,t){for(var n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(e,t)}))},n}(e.Evented);function Ie(e,t){var n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Le(e){return"raster"===e||"image"===e||"video"===e}function Pe(){return new e.window.Worker(Yi.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var Oe="mapboxgl_preloaded_worker_pool",De=function(){this.active={}};De.prototype.acquire=function(e){if(!this.workers)for(this.workers=[];this.workers.length<De.workerCount;)this.workers.push(new Pe);return this.active[e]=!0,this.workers.slice()},De.prototype.release=function(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},De.prototype.isPreloaded=function(){return!!this.active[Oe]},De.prototype.numActive=function(){return Object.keys(this.active).length};var Ne,Fe=Math.floor(e.browser.hardwareConcurrency/2);function Be(){return Ne||(Ne=new De),Ne}function ze(t,n){var r={};for(var i in t)"ref"!==i&&(r[i]=t[i]);return e.refProperties.forEach((function(e){e in n&&(r[e]=n[e])})),r}function Ue(e){e=e.slice();for(var t=Object.create(null),n=0;n<e.length;n++)t[e[n].id]=e[n];for(var r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=ze(e[r],t[e[r].ref]));return e}De.workerCount=Math.max(Math.min(Fe,6),1);var je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ge(e,t,n){n.push({command:je.addSource,args:[e,t[e]]})}function Ve(e,t,n){t.push({command:je.removeSource,args:[e]}),n[e]=!0}function He(e,t,n,r){Ve(e,n,r),Ge(e,t,n)}function We(t,n,r){var i;for(i in t[r])if(t[r].hasOwnProperty(i)&&"data"!==i&&!e.deepEqual(t[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!e.deepEqual(t[r][i],n[r][i]))return!1;return!0}function Xe(t,n,r,i,o,a){var s;for(s in n=n||{},t=t||{})t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function Ze(e){return e.id}function qe(e,t){return e[t.id]=t,e}var Ye=function(e,t){this.reset(e,t)};Ye.prototype.reset=function(e,t){this.points=e||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ye.prototype.lerp=function(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);for(var n=1,r=this._distances[n],i=t*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Ke=function(e,t,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0};function Qe(t,n,r,i,o){var a=e.create();return n?(e.scale(a,a,[1/o,1/o,1]),r||e.rotateZ(a,a,i.angle)):e.multiply(a,i.labelPlaneMatrix,t),a}function Je(t,n,r,i,o){if(n){var a=e.clone(t);return e.scale(a,a,[o,o,1]),r||e.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function $e(t,n){var r=[t.x,t.y,0,1];ct(r,r,n);var i=r[3];return{point:new e.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function et(e,t){return.5+e/t*.5}function tt(e,t){var n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function nt(t,n,r,i,o,a,s,u){var l=i?t.textSizeData:t.iconSizeData,c=e.evaluateSizeForZoom(l,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],p=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;p.clear();for(var f=t.lineVertexArray,d=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=r.transform.width/r.transform.height,m=!1,g=0;g<d.length;g++){var y=d.get(g);if(y.hidden||y.writingMode===e.WritingMode.vertical&&!m)lt(y.numGlyphs,p);else{m=!1;var _=[y.anchorX,y.anchorY,0,1];if(e.transformMat4(_,_,n),tt(_,h)){var x=et(r.transform.cameraToCenterDistance,_[3]),b=e.evaluateSizeForFeature(l,c,y),E=s?b/x:b*x,w=new e.Point(y.anchorX,y.anchorY),S=$e(w,o).point,T={},A=ot(y,E,!1,u,n,o,a,t.glyphOffsetArray,f,p,S,w,T,v);m=A.useVertical,(A.notEnoughRoom||m||A.needsFlipping&&ot(y,E,!0,u,n,o,a,t.glyphOffsetArray,f,p,S,w,T,v).notEnoughRoom)&&lt(y.numGlyphs,p)}else lt(y.numGlyphs,p)}}i?t.text.dynamicLayoutVertexBuffer.updateData(p):t.icon.dynamicLayoutVertexBuffer.updateData(p)}function rt(e,t,n,r,i,o,a,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,d=t.getoffsetX(s.glyphStartIndex),v=t.getoffsetX(h-1),m=st(e*d,n,r,i,o,a,s.segment,p,f,u,l,c);if(!m)return null;var g=st(e*v,n,r,i,o,a,s.segment,p,f,u,l,c);return g?{first:m,last:g}:null}function it(t,n,r,i){return t===e.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(t===e.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function ot(t,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,m=n/24,g=t.lineOffsetX*m,y=t.lineOffsetY*m;if(t.numGlyphs>1){var _=t.glyphStartIndex+t.numGlyphs,x=t.lineStartIndex,b=t.lineStartIndex+t.lineLength,E=rt(m,u,g,y,r,h,p,t,l,a,f);if(!E)return{notEnoughRoom:!0};var w=$e(E.first.point,s).point,S=$e(E.last.point,s).point;if(i&&!r){var T=it(t.writingMode,w,S,d);if(T)return T}v=[E.first];for(var A=t.glyphStartIndex+1;A<_-1;A++)v.push(st(m*u.getoffsetX(A),g,y,r,h,p,t.segment,x,b,l,a,f));v.push(E.last)}else{if(i&&!r){var C=$e(p,o).point,R=t.lineStartIndex+t.segment+1,M=new e.Point(l.getx(R),l.gety(R)),k=$e(M,o),I=k.signedDistanceFromCamera>0?k.point:at(p,M,C,1,o),L=it(t.writingMode,C,I,d);if(L)return L}var P=st(m*u.getoffsetX(t.glyphStartIndex),g,y,r,h,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,a,f);if(!P)return{notEnoughRoom:!0};v=[P]}for(var O=0,D=v;O<D.length;O+=1){var N=D[O];e.addDynamicAttributes(c,N.point,N.angle)}return{}}function at(e,t,n,r,i){var o=$e(e.add(e.sub(t)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function st(t,n,r,i,o,a,s,u,l,c,h,p){var f=i?t-n:t+n,d=f>0?1:-1,v=0;i&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var m=d>0?u+s:u+s+1,g=o,y=o,_=0,x=0,b=Math.abs(f),E=[];_+x<=b;){if((m+=d)<u||m>=l)return null;if(y=g,E.push(g),void 0===(g=p[m])){var w=new e.Point(c.getx(m),c.gety(m)),S=$e(w,h);if(S.signedDistanceFromCamera>0)g=p[m]=S.point;else{var T=m-d;g=at(0===_?a:new e.Point(c.getx(T),c.gety(T)),w,y,b-_+1,h)}}_+=x,x=y.dist(g)}var A=(b-_)/x,C=g.sub(y),R=C.mult(A)._add(y);R._add(C._unit()._perp()._mult(r*d));var M=v+Math.atan2(g.y-y.y,g.x-y.x);return E.push(R),{point:R,angle:M,path:E}}Ke.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ke.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Ke.prototype.insertCircle=function(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)},Ke.prototype._insertBoxCell=function(e,t,n,r,i,o){this.boxCells[i].push(o)},Ke.prototype._insertCircleCell=function(e,t,n,r,i,o){this.circleCells[i].push(o)},Ke.prototype._query=function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(e,t,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Ke.prototype._queryCircle=function(e,t,n,r,i){var o=e-n,a=e+n,s=t-n,u=t+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},Ke.prototype.query=function(e,t,n,r,i){return this._query(e,t,n,r,!1,i)},Ke.prototype.hitTest=function(e,t,n,r,i){return this._query(e,t,n,r,!0,i)},Ke.prototype.hitTestCircle=function(e,t,n,r){return this._queryCircle(e,t,n,!0,r)},Ke.prototype._queryCell=function(e,t,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(e<=c[d+2]&&t<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[i];if(null!==v)for(var m=this.circles,g=0,y=v;g<y.length;g+=1){var _=y[g];if(!u.circle[_]){u.circle[_]=!0;var x=3*_;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],e,t,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var b=m[x],E=m[x+1],w=m[x+2];o.push({key:this.circleKeys[_],x1:b-w,y1:E-w,x2:b+w,y2:E+w})}}}},Ke.prototype._queryCellCircle=function(e,t,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var m=this.circleCells[i];if(null!==m)for(var g=this.circles,y=0,_=m;y<_.length;y+=1){var x=_[y];if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circlesCollide(g[b],g[b+1],g[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Ke.prototype._forEachCell=function(e,t,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(e),l=this._convertToYCellCoord(t),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++)if(i.call(this,e,t,n,r,this.xCellCount*f+p,o,a,s))return},Ke.prototype._convertToXCellCoord=function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))},Ke.prototype._convertToYCellCoord=function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))},Ke.prototype._circlesCollide=function(e,t,n,r,i,o){var a=r-e,s=i-t,u=n+o;return u*u>a*a+s*s},Ke.prototype._circleAndRectCollide=function(e,t,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(e-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(t-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=n*n};var ut=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lt(e,t){for(var n=0;n<e;n++){var r=t.length;t.resize(r+4),t.float32.set(ut,3*r)}}function ct(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}var ht=function(e,t,n){void 0===t&&(t=new Ke(e.width+200,e.height+200,25)),void 0===n&&(n=new Ke(e.width+200,e.height+200,25)),this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200};function pt(t,n,r){return n*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}ht.prototype.placeCollisionBox=function(e,t,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY),a=n*o.perspectiveRatio,s=e.x1*a+o.point.x,u=e.y1*a+o.point.y,l=e.x2*a+o.point.x,c=e.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!t&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},ht.prototype.placeCollisionCircles=function(t,n,r,i,o,a,s,u,l,c,h,p,f){var d=[],v=new e.Point(n.anchorX,n.anchorY),m=$e(v,a),g=et(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),y=(c?o/g:o*g)/e.ONE_EM,_=$e(v,s).point,x=rt(y,i,n.lineOffsetX*y,n.lineOffsetY*y,!1,_,v,n,r,s,{}),b=!1,E=!1,w=!0;if(x){for(var S=.5*p*g+f,T=new e.Point(-100,-100),A=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Ye,R=x.first,M=x.last,k=[],I=R.path.length-1;I>=1;I--)k.push(R.path[I]);for(var L=1;L<M.path.length;L++)k.push(M.path[L]);var P=2.5*S;if(u){var O=k.map((function(e){return $e(e,u)}));k=O.some((function(e){return e.signedDistanceFromCamera<=0}))?[]:O.map((function(e){return e.point}))}var D=[];if(k.length>0){for(var N=k[0].clone(),F=k[0].clone(),B=1;B<k.length;B++)N.x=Math.min(N.x,k[B].x),N.y=Math.min(N.y,k[B].y),F.x=Math.max(F.x,k[B].x),F.y=Math.max(F.y,k[B].y);D=N.x>=T.x&&F.x<=A.x&&N.y>=T.y&&F.y<=A.y?[k]:F.x<T.x||N.x>A.x||F.y<T.y||N.y>A.y?[]:e.clipLine([k],T.x,T.y,A.x,A.y)}for(var z=0,U=D;z<U.length;z+=1){var j;C.reset(U[z],.25*S),j=C.length<=.5*S?1:Math.ceil(C.paddedLength/P)+1;for(var G=0;G<j;G++){var V=G/Math.max(j-1,1),H=C.lerp(V),W=H.x+100,X=H.y+100;d.push(W,X,S,0);var Z=W-S,q=X-S,Y=W+S,K=X+S;if(w=w&&this.isOffscreen(Z,q,Y,K),E=E||this.isInsideGrid(Z,q,Y,K),!t&&this.grid.hitTestCircle(W,X,S,h)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!E?[]:d,offscreen:w,collisionDetected:b}},ht.prototype.queryRenderedSymbols=function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=t;s<u.length;s+=1){var l=u[s],c=new e.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var h={},p={},f=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));f<d.length;f+=1){var v=d[f],m=v.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new e.Point(v.x1,v.y1),new e.Point(v.x2,v.y1),new e.Point(v.x2,v.y2),new e.Point(v.x1,v.y2)];e.polygonIntersectsPolygon(n,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]=[]),p[m.bucketInstanceId].push(m.featureIndex))}}return p},ht.prototype.insertCollisionBox=function(e,t,n,r,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},e[0],e[1],e[2],e[3])},ht.prototype.insertCollisionCircles=function(e,t,n,r,i){for(var o=t?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<e.length;s+=4)o.insertCircle(a,e[s],e[s+1],e[s+2])},ht.prototype.projectAndGetPerspectiveRatio=function(t,n,r){var i=[n,r,0,1];return ct(i,i,t),{point:new e.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},ht.prototype.isOffscreen=function(e,t,n,r){return n<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary},ht.prototype.isInsideGrid=function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary},ht.prototype.getViewportMatrix=function(){var t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t};var ft=function(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n};ft.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var dt=function(e,t,n,r,i){this.text=new ft(e?e.text:null,t,n,i),this.icon=new ft(e?e.icon:null,t,r,i)};dt.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var vt=function(e,t,n){this.text=e,this.icon=t,this.skipFade=n},mt=function(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]},gt=function(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},yt=function(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}};function _t(t,n,r,i,o){var a=e.getAnchorAlignment(t),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=e.evaluateVariableOffset(t,i);return new e.Point(s+l[0]*o,u+l[1]*o)}function xt(t,n,r,i,o,a){var s=t.x1,u=t.x2,l=t.y1,c=t.y2,h=t.anchorPointX,p=t.anchorPointY,f=new e.Point(n,r);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}yt.prototype.get=function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}}}return this.collisionGroups[e]};var bt=function(e,t,n,r){this.transform=e.clone(),this.collisionIndex=new ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new yt(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function Et(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}bt.prototype.getBucketParts=function(t,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/e.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===u.get("text-pitch-alignment"),f="map"===u.get("text-rotation-alignment"),d=pt(r,1,this.transform.zoom),v=Qe(h,p,f,this.transform,d),m=null;if(p){var g=Je(h,p,f,this.transform,d);m=e.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[o.bucketInstanceId]=new gt(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var y={bucket:o,layout:u,posMatrix:h,textLabelPlaneMatrix:v,labelToScreenMatrix:m,scale:l,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,x=o.sortKeyRanges;_<x.length;_+=1){var b=x[_];t.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:y})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}},bt.prototype.attemptAnchorPlacement=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,m=[h.textOffset0,h.textOffset1],g=_t(e,n,r,m,i),y=this.collisionIndex.placeCollisionBox(xt(t,g.x,g.y,o,a,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(xt(d,g.x,g.y,o,a,this.transform.angle),c,s,u,l.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(v=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:n,height:r,anchor:e,textBoxScale:i,prevAnchor:v},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:g,placedGlyphBoxes:y}):void 0},bt.prototype.placeLayerBucketPart=function(t,n,r){var i=this,o=t.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,l=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,p=o.holdingForFade,f=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,v=o.collisionGroup,m=s.get("text-optional"),g=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),E="none"!==s.get("icon-text-fit"),w="viewport-y"===s.get("symbol-z-order"),S=y&&(_||!a.hasIconData()||g),T=_&&(y||!a.hasTextData()||m);!a.collisionArrays&&f&&a.deserializeCollisionBoxes(f);var A=function(t,o){if(!n[t.crossTileID])if(p)i.placements[t.crossTileID]=new vt(!1,!1,!1);else{var f,w=!1,A=!1,C=!0,R=null,M={box:null,offscreen:null},k={box:null,offscreen:null},I=null,L=null,P=0,O=0,D=0;o.textFeatureIndex?P=o.textFeatureIndex:t.useRuntimeCollisionCircles&&(P=t.featureIndex),o.verticalTextFeatureIndex&&(O=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var F=function(n){var r=e.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[t.crossTileID];o&&(i.placedOrientations[t.crossTileID]=o,i.markUsedOrientation(a,r=o,t))}return r},B=function(n,r){if(a.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===e.WritingMode.vertical?(M=r(),k=M):M=n(),!(M&&M.box&&M.box.length));i+=1);else M=n()};if(s.get("text-variable-anchor")){var z=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[t.crossTileID]){var U=i.prevPlacement.variableOffsets[t.crossTileID];z.indexOf(U.anchor)>0&&(z=z.filter((function(e){return e!==U.anchor}))).unshift(U.anchor)}var j=function(e,n,r){for(var o=e.x2-e.x1,s=e.y2-e.y1,l=t.textBoxScale,c=E&&!_?n:null,p={box:[],offscreen:!1},f=y?2*z.length:z.length,d=0;d<f;++d){var m=i.attemptAnchorPlacement(z[d%z.length],e,o,s,l,x,b,h,u,v,d>=z.length,t,a,r,c);if(m&&(p=m.placedGlyphBoxes)&&p.box&&p.box.length){w=!0,R=m.shift;break}}return p};B((function(){return j(N,o.iconBox,e.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(M&&M.box&&M.box.length)&&t.numVerticalGlyphVertices>0&&n?j(n,o.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),M&&(w=M.box,C=M.offscreen);var G=F(M&&M.box);if(!w&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[t.crossTileID];V&&(i.variableOffsets[t.crossTileID]=V,i.markUsedJustification(a,V.anchor,t,G))}}else{var H=function(e,n){var r=i.collisionIndex.placeCollisionBox(e,y,h,u,v.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,t),i.placedOrientations[t.crossTileID]=n),r};B((function(){return H(N,e.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?H(n,e.WritingMode.vertical):{box:null,offscreen:null}})),F(M&&M.box&&M.box.length)}}if(w=(f=M)&&f.box&&f.box.length>0,C=f&&f.offscreen,t.useRuntimeCollisionCircles){var W=a.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),X=e.evaluateSizeForFeature(a.textSizeData,d,W),Z=s.get("text-padding");I=i.collisionIndex.placeCollisionCircles(y,W,a.lineVertexArray,a.glyphOffsetArray,X,u,l,c,r,b,v.predicate,t.collisionCircleDiameter,Z),w=y||I.circles.length>0&&!I.collisionDetected,C=C&&I.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var q=function(e){var t=E&&R?xt(e,R.x,R.y,x,b,i.transform.angle):e;return i.collisionIndex.placeCollisionBox(t,_,h,u,v.predicate)};A=k&&k.box&&k.box.length&&o.verticalIconBox?(L=q(o.verticalIconBox)).box.length>0:(L=q(o.iconBox)).box.length>0,C=C&&L.offscreen}var Y=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,K=g||0===t.numIconVertices;if(Y||K?K?Y||(A=A&&w):w=A&&w:A=w=A&&w,w&&f&&f.box&&i.collisionIndex.insertCollisionBox(f.box,s.get("text-ignore-placement"),a.bucketInstanceId,k&&k.box&&O?O:P,v.ID),A&&L&&i.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,v.ID),I&&(w&&i.collisionIndex.insertCollisionCircles(I.circles,s.get("text-ignore-placement"),a.bucketInstanceId,P,v.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new mt);for(var $=0;$<I.circles.length;$+=4)J.circles.push(I.circles[$+0]),J.circles.push(I.circles[$+1]),J.circles.push(I.circles[$+2]),J.circles.push(I.collisionDetected?1:0)}i.placements[t.crossTileID]=new vt(w||S,A||T,C||a.justReloaded),n[t.crossTileID]=!0}};if(w)for(var C=a.getSortedSymbolIndexes(this.transform.angle),R=C.length-1;R>=0;--R){var M=C[R];A(a.symbolInstances.get(M),a.collisionArrays[M])}else for(var k=t.symbolInstanceStart;k<t.symbolInstanceEnd;k++)A(a.symbolInstances.get(k),a.collisionArrays[k]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var I=this.collisionCircleArrays[a.bucketInstanceId];e.invert(I.invProjMatrix,u),I.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},bt.prototype.markUsedJustification=function(t,n,r,i){var o;o=i===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},bt.prototype.markUsedOrientation=function(t,n,r){for(var i=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,o=n===e.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)t.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},bt.prototype.commit=function(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;var t=this.prevPlacement,n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;var r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new dt(l,r,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new dt(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var p=new dt(h,r,!1,!1);p.isHidden()||(this.opacities[c]=p,n=n||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},bt.prototype.updateLayerOpacities=function(e,t){for(var n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.getBucket(e);a&&o.latestFeatureIndex&&e.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},bt.prototype.updateBucketOpacities=function(t,n,r){var i=this;t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();var o=t.layers[0].layout,a=new dt(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),l=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new dt(null,0,s&&(u||!t.hasIconData()||o.get("icon-optional")),u&&(s||!t.hasTextData()||o.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);for(var d=function(e,t,n){for(var r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n)},v=function(r){var o=t.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,v=o.crossTileID,m=i.opacities[v];n[v]?m=a:m||(i.opacities[v]=m=f),n[v]=!0;var g=o.numIconVertices>0,y=i.placedOrientations[o.crossTileID],_=y===e.WritingMode.vertical,x=y===e.WritingMode.horizontal||y===e.WritingMode.horizontalOnly;if(s>0||u>0){var b=kt(m.text);d(t.text,s,_?It:b),d(t.text,u,x?It:b);var E=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(e){e>=0&&(t.text.placedSymbolArray.get(e).hidden=E||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=E||x?1:0);var w=i.variableOffsets[o.crossTileID];w&&i.markUsedJustification(t,w.anchor,o,y);var S=i.placedOrientations[o.crossTileID];S&&(i.markUsedJustification(t,"left",o,S),i.markUsedOrientation(t,S,o))}if(g){var T=kt(m.icon),A=!(p&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(t.icon,o.numIconVertices,A?T:It),t.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(t.icon,o.numVerticalIconVertices,A?It:T),t.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){var C=t.collisionArrays[r];if(C){var R=new e.Point(0,0);if(C.textBox||C.verticalTextBox){var M=!0;if(l){var k=i.variableOffsets[v];k?(R=_t(k.anchor,k.width,k.height,k.textOffset,k.textBoxScale),c&&R._rotate(h?i.transform.angle:-i.transform.angle)):M=!1}C.textBox&&Et(t.textCollisionBox.collisionVertexArray,m.text.placed,!M||_,R.x,R.y),C.verticalTextBox&&Et(t.textCollisionBox.collisionVertexArray,m.text.placed,!M||x,R.x,R.y)}var I=Boolean(!x&&C.verticalIconBox);C.iconBox&&Et(t.iconCollisionBox.collisionVertexArray,m.icon.placed,I,p?R.x:0,p?R.y:0),C.verticalIconBox&&Et(t.iconCollisionBox.collisionVertexArray,m.icon.placed,!I,p?R.x:0,p?R.y:0)}}},m=0;m<t.symbolInstances.length;m++)v(m);if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){var g=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=g.invProjMatrix,t.placementViewportMatrix=g.viewportMatrix,t.collisionCircleArray=g.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}},bt.prototype.symbolFadeChange=function(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},bt.prototype.zoomAdjustment=function(e){return Math.max(0,(this.transform.zoom-e)/1.5)},bt.prototype.hasTransitions=function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration},bt.prototype.stillRecent=function(e,t){var n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e},bt.prototype.setStale=function(){this.stale=!0};var wt=Math.pow(2,25),St=Math.pow(2,24),Tt=Math.pow(2,17),At=Math.pow(2,16),Ct=Math.pow(2,9),Rt=Math.pow(2,8),Mt=Math.pow(2,1);function kt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*wt+t*St+n*Tt+t*At+n*Ct+t*Rt+n*Mt+t}var It=0,Lt=function(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Lt.prototype.continuePlacement=function(e,t,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(e,t){return e.sortKey-t.sortKey})));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Pt=function(e,t,n,r,i,o,a){this.placement=new bt(e,i,o,a),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Pt.prototype.isDone=function(){return this._done},Pt.prototype.continuePlacement=function(t,n,r){for(var i=this,o=e.browser.now(),a=function(){var t=e.browser.now()-o;return!i._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=n[t[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Lt(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pt.prototype.commit=function(e){return this.placement.commit(e),this.placement};var Ot=512/e.EXTENT/2,Dt=function(e,t,n){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<t.length;r++){var i=t.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)})}};Dt.prototype.getScaledCoordinates=function(t,n){var r=Ot/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*e.EXTENT+t.anchorX)*r),y:Math.floor((n.canonical.y*e.EXTENT+t.anchorY)*r)}},Dt.prototype.findMatches=function(e,t,n){for(var r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),i=0;i<e.length;i++){var o=e.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,t),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Nt=function(){this.maxCrossTileID=0};Nt.prototype.generate=function(){return++this.maxCrossTileID};var Ft=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ft.prototype.handleWrapJump=function(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+t),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=e},Ft.prototype.addBucket=function(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var i=this.usedCrossTileIDs[e.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>e.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(e)&&u.findMatches(t.symbolInstances,e,i)}else{var l=a[e.scaledTo(Number(o)).key];l&&l.findMatches(t.symbolInstances,e,i)}}for(var c=0;c<t.symbolInstances.length;c++){var h=t.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dt(e,t.symbolInstances,t.bucketInstanceId),!0},Ft.prototype.removeBucketCrossTileIDs=function(e,t){for(var n in t.indexedSymbolInstances)for(var r=0,i=t.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[e][i[r].crossTileID]},Ft.prototype.removeStaleBuckets=function(e){var t=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t};var Bt=function(){this.layerIndexes={},this.crossTileIDs=new Nt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Bt.prototype.addLayer=function(e,t,n){var r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Ft);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.getBucket(e);l&&e.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},Bt.prototype.pruneUnusedLayers=function(e){var t={};for(var n in e.forEach((function(e){t[e]=!0})),this.layerIndexes)t[n]||delete this.layerIndexes[n]};var zt=function(t,n){return e.emitValidationErrors(t,n&&n.filter((function(e){return"source.canvas"!==e.identifier})))},Ut=e.pick(je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),jt=e.pick(je,["setCenter","setZoom","setBearing","setPitch"]),Gt=function(){var t={},n=e.styleSpec.$version;for(var r in e.styleSpec.$root){var i,o=e.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(t[r]=i)}return t}(),Vt=function(t){function n(r,i){var o=this;void 0===i&&(i={}),t.call(this),this.map=r,this.dispatcher=new S(Be(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Bt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(t){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(function(t,n){if(e.triggerPluginCompletionEvent(t),n&&n.every((function(e){return e})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=o.sourceCaches[e.sourceId];if(t){var n=t.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.loadURL=function(t,n){var r=this;void 0===n&&(n={}),this.fire(new e.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken);var o=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(o,(function(t,n){r._request=null,t?r.fire(new e.ErrorEvent(t)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(t,n){var r=this;void 0===n&&(n={}),this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.browser.frame((function(){r._request=null,r._load(t,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Gt,!1)},n.prototype._load=function(t,n){if(!n||!zt(this,e.validateStyle(t))){for(var r in this._loaded=!0,this.stylesheet=t,t.sources)this.addSource(r,t.sources[r],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var i=Ue(this.stylesheet.layers);this._order=i.map((function(e){return e.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=e.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new E(this.stylesheet.light),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}},n.prototype._loadSprite=function(t){var n=this;this._spriteRequest=function(t,n,r){var i,o,a,s=e.browser.devicePixelRatio>1?"@2x":"",u=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),(function(e,t){u=null,a||(a=e,i=t,c())})),l=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),(function(e,t){l=null,a||(a=e,o=t,c())}));function c(){if(a)r(a);else if(i&&o){var t=e.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,v=u.stretchX,m=u.stretchY,g=u.content,y=new e.RGBAImage({width:l,height:c});e.RGBAImage.copy(t,y,{x:h,y:p},{x:0,y:0},{width:l,height:c}),n[s]={data:y,pixelRatio:d,sdf:f,stretchX:v,stretchY:m,content:g}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(t,this.map._requestManager,(function(t,r){if(n._spriteRequest=null,t)n.fire(new e.ErrorEvent(t));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new e.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(t){var n=this.sourceCaches[t.source];if(n){var r=t.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+t.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(e){for(var t=[],n=0,r=e;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&t.push(i.serialize())}return t},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(t){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var f=this._layers[p[h]];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(var d in u){var v=this.sourceCaches[d];u[d]!==v.used&&v.fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new e.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var e=Object.keys(this._changedImages);if(e.length){for(var t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}},n.prototype._updateWorkerLayers=function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(t){var n=this;if(this._checkLoaded(),zt(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=Ue(t.layers);var r=function(t,n){if(!t)return[{command:je.setStyle,args:[n]}];var r=[];try{if(!e.deepEqual(t.version,n.version))return[{command:je.setStyle,args:[n]}];e.deepEqual(t.center,n.center)||r.push({command:je.setCenter,args:[n.center]}),e.deepEqual(t.zoom,n.zoom)||r.push({command:je.setZoom,args:[n.zoom]}),e.deepEqual(t.bearing,n.bearing)||r.push({command:je.setBearing,args:[n.bearing]}),e.deepEqual(t.pitch,n.pitch)||r.push({command:je.setPitch,args:[n.pitch]}),e.deepEqual(t.sprite,n.sprite)||r.push({command:je.setSprite,args:[n.sprite]}),e.deepEqual(t.glyphs,n.glyphs)||r.push({command:je.setGlyphs,args:[n.glyphs]}),e.deepEqual(t.transition,n.transition)||r.push({command:je.setTransition,args:[n.transition]}),e.deepEqual(t.light,n.light)||r.push({command:je.setLight,args:[n.light]});var i={},o=[];!function(t,n,r,i){var o;for(o in n=n||{},t=t||{})t.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Ve(o,r,i));for(o in n)n.hasOwnProperty(o)&&(t.hasOwnProperty(o)?e.deepEqual(t[o],n[o])||("geojson"===t[o].type&&"geojson"===n[o].type&&We(t,n,o)?r.push({command:je.setGeoJSONSourceData,args:[o,n[o].data]}):He(o,n,r,i)):Ge(o,n,r))}(t.sources,n.sources,o,i);var a=[];t.layers&&t.layers.forEach((function(e){i[e.source]?r.push({command:je.removeLayer,args:[e.id]}):a.push(e)})),r=r.concat(o),function(t,n,r){n=n||[];var i,o,a,s,u,l,c,h=(t=t||[]).map(Ze),p=n.map(Ze),f=t.reduce(qe,{}),d=n.reduce(qe,{}),v=h.slice(),m=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(r.push({command:je.removeLayer,args:[a]}),v.splice(v.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)v[v.length-1-i]!==(a=p[p.length-1-i])&&(f.hasOwnProperty(a)?(r.push({command:je.removeLayer,args:[a]}),v.splice(v.lastIndexOf(a,v.length-o),1)):o++,r.push({command:je.addLayer,args:[d[a],l=v[v.length-i]]}),v.splice(v.length-i,0,a),m[a]=!0);for(i=0;i<p.length;i++)if(s=f[a=p[i]],u=d[a],!m[a]&&!e.deepEqual(s,u))if(e.deepEqual(s.source,u.source)&&e.deepEqual(s["source-layer"],u["source-layer"])&&e.deepEqual(s.type,u.type)){for(c in Xe(s.layout,u.layout,r,a,null,je.setLayoutProperty),Xe(s.paint,u.paint,r,a,null,je.setPaintProperty),e.deepEqual(s.filter,u.filter)||r.push({command:je.setFilter,args:[a,u.filter]}),e.deepEqual(s.minzoom,u.minzoom)&&e.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:je.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Xe(s[c],u[c],r,a,c.slice(6),je.setPaintProperty):e.deepEqual(s[c],u[c])||r.push({command:je.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Xe(s[c],u[c],r,a,c.slice(6),je.setPaintProperty):e.deepEqual(s[c],u[c])||r.push({command:je.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:je.removeLayer,args:[a]}),l=v[v.lastIndexOf(a)+1],r.push({command:je.addLayer,args:[u,l]})}(a,n.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:je.setStyle,args:[n]}]}return r}(this.serialize(),t).filter((function(e){return!(e.command in jt)}));if(0===r.length)return!1;var i=r.filter((function(e){return!(e.command in Ut)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(e){return e.command})).join(", ")+".");return r.forEach((function(e){"setTransition"!==e.command&&n[e.command].apply(n,e.args)})),this.stylesheet=t,!0},n.prototype.addImage=function(t,n){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,n),this._afterImageUpdated(t)},n.prototype.updateImage=function(e,t){this.imageManager.updateImage(e,t)},n.prototype.getImage=function(e){return this.imageManager.getImage(e)},n.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)},n.prototype._afterImageUpdated=function(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(t,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.validateStyle.source,"sources."+t,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[t]=new ke(t,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:t}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===t)return this.fire(new e.ErrorEvent(new Error('Source "'+t+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0},n.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},n.prototype.addLayer=function(t,n,r){void 0===r&&(r={}),this._checkLoaded();var i=t.id;if(this.getLayer(i))this.fire(new e.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===t.type){if(zt(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=e.clone$1(t),t=e.extend(t,{source:i})),this._validate(e.validateStyle.layer,"layers."+i,t,{arrayIndex:-1},r))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new e.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(t,n){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==n){var r=this._order.indexOf(t);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new e.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,t),this._layerOrderChanged=!0)}}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(t){this._checkLoaded();var n=this._layers[t];if(n){n.setEventedParent(null);var r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(e){return this._layers[e]},n.prototype.hasLayer=function(e){return e in this._layers},n.prototype.setLayerZoomRange=function(t,n,r){this._checkLoaded();var i=this.getLayer(t);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(t,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(t);if(i){if(!e.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(e.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=e.clone$1(n),this._updateLayer(i)))}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(t){return e.clone$1(this.getLayer(t).filter)},n.prototype.setLayoutProperty=function(t,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(t);o?e.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(t,n){var r=this.getLayer(t);if(r)return r.getLayoutProperty(n);this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(t,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(t);o?e.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(e,t){return this.getLayer(e).getPaintProperty(t)},n.prototype.setFeatureState=function(t,n){this._checkLoaded();var r=t.source,i=t.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,t.id,n)):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(t,n){this._checkLoaded();var r=t.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?t.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,t.id,n):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(t){this._checkLoaded();var n=t.source,r=t.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.sourceCaches,(function(e){return e.serialize()})),layers:this._serializeLayers(this._order)},(function(e){return void 0!==e}))},n.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(e){for(var t=this,n=function(e){return"fill-extrusion"===t._layers[e].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=e;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(e,t){return t.intersectionZ-e.intersectionZ}));for(var p=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(n(d))for(var v=i.length-1;v>=0;v--){var m=i[v].feature;if(r[m.layer.id]<f)break;p.push(m),i.pop()}else for(var g=0,y=e;g<y.length;g+=1){var _=y[g][d];if(_)for(var x=0,b=_;x<b.length;x+=1)p.push(b[x].feature)}}return p},n.prototype.queryRenderedFeatures=function(t,n,r){n&&n.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new e.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[c]||l.push(F(this.sourceCaches[c],this._layers,this._serializedLayers,t,n,r));return this.placement&&l.push(function(e,t,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(a[h[c]]);l.sort(B);for(var p=function(){var n=d[f],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(var o in r){var a=s[o]=s[o]||[],l=r[o];l.sort((function(e,t){var r=n.featureSortOrder;if(r){var i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)a.push(h[c])}},f=0,d=l;f<d.length;f+=1)p();var v=function(t){s[t].forEach((function(r){var i=r.feature,o=n[e[t].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var m in s)v(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(t,n){n&&n.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[t];return r?function(e,t){for(var n=e.getRenderableIds().map((function(t){return e.getTileByID(t)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,t))}return r}(r,n):[]},n.prototype.addSourceType=function(e,t,r){return n.getSourceType(e)?r(new Error('A source type called "'+e+'" already exists.')):(n.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(t,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in t)if(!e.deepEqual(t[o],r[o])){i=!0;break}if(i){var a={now:e.browser.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(a)}},n.prototype._validate=function(t,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&zt(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:r,styleSpec:e.styleSpec},i)))},n.prototype._remove=function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},n.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()},n.prototype._updateSources=function(e){for(var t in this.sourceCaches)this.sourceCaches[t].update(e)},n.prototype._generateCollisionBoxes=function(){for(var e in this.sourceCaches)this._reloadSource(e)},n.prototype._updatePlacement=function(t,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var p=this.sourceCaches[h.source];u[h.source]=p.getRenderableIds(!0).map((function(e){return p.getTileByID(e)})).sort((function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,u[h.source],t.center.lng);a=a||f}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.browser.now(),t.zoom))&&(this.pauseablePlacement=new Pt(t,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,v=this._order;d<v.length;d+=1){var m=this._layers[v[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,u[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()},n.prototype.getImages=function(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,t.icons)},n.prototype.getGlyphs=function(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)},n.prototype.getResource=function(t,n,r){return e.makeRequest(n,r)},n}(e.Evented);Vt.getSourceType=function(e){return D[e]},Vt.setSourceType=function(e,t){D[e]=t},Vt.registerForPluginStateChange=e.registerForPluginStateChange;var Ht=e.createLayout([{name:"a_pos",type:"Int16",components:2}]),Wt=yn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Xt=yn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Zt=yn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qt=yn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Yt=yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Kt=yn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Qt=yn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Jt=yn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$t=yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),en=yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),tn=yn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),nn=yn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rn=yn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),an=yn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sn=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),un=yn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=yn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cn=yn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),pn=yn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),fn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dn=yn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),vn=yn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mn=yn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gn=yn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function yn(e,t){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/attribute ([\w]+) ([\w]+)/g),i=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:e=e.replace(n,(function(e,t,n,r,i){return s[i]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:t=t.replace(n,(function(e,t,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===t?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===t?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var _n=Object.freeze({__proto__:null,prelude:Wt,background:Xt,backgroundPattern:Zt,circle:qt,clippingMask:Yt,heatmap:Kt,heatmapTexture:Qt,collisionBox:Jt,collisionCircle:$t,debug:en,fill:tn,fillOutline:nn,fillOutlinePattern:rn,fillPattern:on,fillExtrusion:an,fillExtrusionPattern:sn,hillshadePrepare:un,hillshade:ln,line:cn,lineGradient:hn,linePattern:pn,lineSDF:fn,raster:dn,symbolIcon:vn,symbolSDF:mn,symbolTextAndIcon:gn}),xn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function bn(e){for(var t=[],n=0;n<e.length;n++)if(null!==e[n]){var r=e[n].split(" ");t.push(r.pop())}return t}xn.prototype.bind=function(e,t,n,r,i,o,a,s){this.context=e;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(t,n,r,i,o,a,s)},xn.prototype.freshBind=function(e,t,n,r,i,o,a){var s,u=e.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}t.enableAttributes(c,e);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(c,e);o&&o.enableAttributes(c,e),a&&a.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i);for(var d=0,v=n;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(c,e,i)}o&&(o.bind(),o.setVertexAttribPointers(c,e,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,e,i)),l.currentNumAttributes=u},xn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var En=function(e,t,n,r,i,o){var a=e.gl;this.program=a.createProgram();for(var s=bn(n.staticAttributes),u=r?r.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?bn(n.staticUniforms):[],h=r?r.getBinderUniforms():[],p=[],f=0,d=c.concat(h);f<d.length;f+=1){var v=d[f];p.indexOf(v)<0&&p.push(v)}var m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;");var g=m.concat(Wt.fragmentSource,n.fragmentSource).join("\n"),y=m.concat(Wt.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,y),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=l.length;for(var E=0;E<this.numAttributes;E++)l[E]&&(a.bindAttribLocation(this.program,E,l[E]),this.attributes[l[E]]=E);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(_);for(var w=0;w<p.length;w++){var S=p[w];if(S&&!b[S]){var T=a.getUniformLocation(this.program,S);T&&(b[S]=T)}}this.fixedUniforms=i(e,b),this.binderUniforms=r?r.getUniforms(e,b):[]}}};function wn(e,t,n){var r=1/pt(n,1,t.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,t.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}En.prototype.draw=function(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m,g=e.gl;if(!this.failedToCreate){for(var y in e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(i),e.setCullFace(o),this.fixedUniforms)this.fixedUniforms[y].set(a[y]);f&&f.setUniforms(e,this.binderUniforms,h,{zoom:p});for(var _=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[t],x=0,b=c.get();x<b.length;x+=1){var E=b[x],w=E.vaos||(E.vaos={});(w[s]||(w[s]=new xn)).bind(e,this,u,f?f.getPaintVertexBuffers():[],l,E.vertexOffset,d,v),g.drawElements(t,E.primitiveLength*_,g.UNSIGNED_SHORT,E.primitiveOffset*_*2)}}};var Sn=function(t,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=e.create$1();"viewport"===o.properties.get("anchor")&&e.fromRotation(u,-n.transform.angle),e.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},Tn=function(t,n,r,i,o,a,s){return e.extend(Sn(t,n,r,i),wn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},An=function(e){return{u_matrix:e}},Cn=function(t,n,r,i){return e.extend(An(t),wn(r,n,i))},Rn=function(e,t){return{u_matrix:e,u_world:t}},Mn=function(t,n,r,i,o){return e.extend(Cn(t,n,r,i),{u_world:o})},kn=function(t,n,r,i){var o,a,s=t.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=pt(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:e.browser.devicePixelRatio,u_extrude_scale:a}},In=function(e,t,n){var r=pt(n,1,t.zoom),i=Math.pow(2,t.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[t.pixelsToGLUnits[0]/(r*i),t.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},Ln=function(e,t,n){return{u_matrix:e,u_inv_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Pn=function(e,t,n){return void 0===n&&(n=1),{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}},On=function(e){return{u_matrix:e}},Dn=function(e,t,n,r){return{u_matrix:e,u_extrude_scale:pt(t,1,n),u_intensity:r}},Nn=function(t,n,r){var i=t.transform;return{u_matrix:jn(t,n,r),u_ratio:1/pt(n,1,i.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Fn=function(t,n,r,i){return e.extend(Nn(t,n,r),{u_image:0,u_image_height:i})},Bn=function(t,n,r,i){var o=t.transform,a=Un(n,o);return{u_matrix:jn(t,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/pt(n,1,o.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},zn=function(t,n,r,i,o){var a=t.lineAtlas,s=Un(n,t.transform),u="round"===r.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),h=l.width*o.fromScale,p=c.width*o.toScale;return e.extend(Nn(t,n,r),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*e.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function Un(e,t){return 1/pt(e,1,t.tileZoom)}function jn(e,t,n){return e.translatePosMatrix(t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Gn=function(e,t,n,r,i){return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Vn(i.paint.get("raster-hue-rotate"))};var o,a};function Vn(e){e*=Math.PI/180;var t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}var Hn,Wn=function(e,t,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},Xn=function(t,n,r,i,o,a,s,u,l,c,h){var p=o.transform;return e.extend(Wn(t,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:e.browser.devicePixelRatio,u_is_halo:+h})},Zn=function(t,n,r,i,o,a,s,u,l,c){return e.extend(Xn(t,n,r,i,o,a,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},qn=function(e,t,n){return{u_matrix:e,u_opacity:t,u_color:n}},Yn=function(t,n,r,i,o,a){return e.extend(function(e,t,n,r){var i=n.imageManager.getPattern(e.from.toString()),o=n.imageManager.getPattern(e.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),p=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:t.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/pt(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,r,o),{u_matrix:t,u_opacity:n})},Kn={fillExtrusion:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fillExtrusionPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,n.u_height_factor),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fill:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},fillPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},fillOutline:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world)}},fillOutlinePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},circle:function(t,n){return{u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_scale_with_map:new e.Uniform1i(t,n.u_scale_with_map),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},collisionBox:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pixels_to_tile_units:new e.Uniform1f(t,n.u_pixels_to_tile_units),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_overscale_factor:new e.Uniform1f(t,n.u_overscale_factor)}},collisionCircle:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,n.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,n.u_viewport_size)}},debug:function(t,n){return{u_color:new e.UniformColor(t,n.u_color),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_overlay:new e.Uniform1i(t,n.u_overlay),u_overlay_scale:new e.Uniform1f(t,n.u_overlay_scale)}},clippingMask:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmap:function(t,n){return{u_extrude_scale:new e.Uniform1f(t,n.u_extrude_scale),u_intensity:new e.Uniform1f(t,n.u_intensity),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmapTexture:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_opacity:new e.Uniform1f(t,n.u_opacity)}},hillshade:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_latrange:new e.Uniform2f(t,n.u_latrange),u_light:new e.Uniform2f(t,n.u_light),u_shadow:new e.UniformColor(t,n.u_shadow),u_highlight:new e.UniformColor(t,n.u_highlight),u_accent:new e.UniformColor(t,n.u_accent)}},hillshadePrepare:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_dimension:new e.Uniform2f(t,n.u_dimension),u_zoom:new e.Uniform1f(t,n.u_zoom),u_unpack:new e.Uniform4f(t,n.u_unpack)}},line:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels)}},lineGradient:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_image:new e.Uniform1i(t,n.u_image),u_image_height:new e.Uniform1f(t,n.u_image_height)}},linePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_image:new e.Uniform1i(t,n.u_image),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},lineSDF:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_patternscale_a:new e.Uniform2f(t,n.u_patternscale_a),u_patternscale_b:new e.Uniform2f(t,n.u_patternscale_b),u_sdfgamma:new e.Uniform1f(t,n.u_sdfgamma),u_image:new e.Uniform1i(t,n.u_image),u_tex_y_a:new e.Uniform1f(t,n.u_tex_y_a),u_tex_y_b:new e.Uniform1f(t,n.u_tex_y_b),u_mix:new e.Uniform1f(t,n.u_mix)}},raster:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_tl_parent:new e.Uniform2f(t,n.u_tl_parent),u_scale_parent:new e.Uniform1f(t,n.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,n.u_buffer_scale),u_fade_t:new e.Uniform1f(t,n.u_fade_t),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image0:new e.Uniform1i(t,n.u_image0),u_image1:new e.Uniform1i(t,n.u_image1),u_brightness_low:new e.Uniform1f(t,n.u_brightness_low),u_brightness_high:new e.Uniform1f(t,n.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,n.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,n.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,n.u_spin_weights)}},symbolIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture)}},symbolSDF:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},symbolTextAndIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texsize_icon:new e.Uniform2f(t,n.u_texsize_icon),u_texture:new e.Uniform1i(t,n.u_texture),u_texture_icon:new e.Uniform1i(t,n.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},background:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_color:new e.UniformColor(t,n.u_color)}},backgroundPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image:new e.Uniform1i(t,n.u_image),u_pattern_tl_a:new e.Uniform2f(t,n.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,n.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,n.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,n.u_pattern_br_b),u_texsize:new e.Uniform2f(t,n.u_texsize),u_mix:new e.Uniform1f(t,n.u_mix),u_pattern_size_a:new e.Uniform2f(t,n.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,n.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,n.u_scale_a),u_scale_b:new e.Uniform1f(t,n.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,n.u_tile_units_to_pixels)}}};function Qn(t,n,r,i,o,a,s){for(var u=t.context,l=u.gl,c=t.useProgram("collisionBox"),h=[],p=0,f=0,d=0;d<i.length;d++){var v=i[d],m=n.getTile(v),g=m.getBucket(r);if(g){var y=v.posMatrix;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(v.posMatrix,m,o,a));var _=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){var b=e.create(),E=y;e.mul(b,g.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul(b,b,g.placementViewportMatrix),h.push({circleArray:x,circleOffset:f,transform:E,invTransform:b}),f=p+=x.length/4}_&&c.draw(u,l.LINES,Te.disabled,Ae.disabled,t.colorModeForRenderPass(),Re.disabled,In(y,t.transform,m),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,t.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var w=t.useProgram("collisionCircle"),S=new e.StructArrayLayout2f1f2i16;S.resize(4*p),S._trim();for(var T=0,A=0,C=h;A<C.length;A+=1)for(var R=C[A],M=0;M<R.circleArray.length/4;M++){var k=4*M,I=R.circleArray[k+0],L=R.circleArray[k+1],P=R.circleArray[k+2],O=R.circleArray[k+3];S.emplace(T++,I,L,P,O,0),S.emplace(T++,I,L,P,O,1),S.emplace(T++,I,L,P,O,2),S.emplace(T++,I,L,P,O,3)}(!Hn||Hn.length<2*p)&&(Hn=function(t){var n=2*t,r=new e.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(p));for(var D=u.createIndexBuffer(Hn,!0),N=u.createVertexBuffer(S,e.collisionCircleLayout.members,!0),F=0,B=h;F<B.length;F+=1){var z=B[F],U=Ln(z.transform,z.invTransform,t.transform);w.draw(u,l.TRIANGLES,Te.disabled,Ae.disabled,t.colorModeForRenderPass(),Re.disabled,U,r.id,N,D,e.SegmentVector.simpleSegment(0,2*z.circleOffset,z.circleArray.length,z.circleArray.length/2),null,t.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var Jn=e.identity(new Float32Array(16));function $n(t,n,r,i,o,a){var s=e.getAnchorAlignment(t),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=e.evaluateVariableOffset(t,i);return new e.Point((u/o+c[0])*a,(l/o+c[1])*a)}function er(t,n,r,i,o,a,s,u,l,c,h){var p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,d=t.icon.dynamicLayoutVertexArray,v={};f.clear();for(var m=0;m<p.length;m++){var g=p.get(m),y=g.hidden||!g.crossTileID||t.allowVerticalPlacement&&!g.placedOrientation?null:i[g.crossTileID];if(y){var _=new e.Point(g.anchorX,g.anchorY),x=$e(_,r?u:s),b=et(a.cameraToCenterDistance,x.signedDistanceFromCamera),E=o.evaluateSizeForFeature(t.textSizeData,c,g)*b/e.ONE_EM;r&&(E*=t.tilePixelRatio/l);for(var w=$n(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,E),S=r?$e(_.add(w),s).point:x.point.add(n?w.rotate(-a.angle):w),T=t.allowVerticalPlacement&&g.placedOrientation===e.WritingMode.vertical?Math.PI/2:0,A=0;A<g.numGlyphs;A++)e.addDynamicAttributes(f,S,T);h&&g.associatedIconIndex>=0&&(v[g.associatedIconIndex]={shiftedAnchor:S,angle:T})}else lt(g.numGlyphs,f)}if(h){d.clear();for(var C=t.icon.placedSymbolArray,R=0;R<C.length;R++){var M=C.get(R);if(M.hidden)lt(M.numGlyphs,d);else{var k=v[R];if(k)for(var I=0;I<M.numGlyphs;I++)e.addDynamicAttributes(d,k.shiftedAnchor,k.angle);else lt(M.numGlyphs,d)}}t.icon.dynamicLayoutVertexBuffer.updateData(d)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function tr(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function nr(t,n,r,i,o,a,s,u,l,c,h,p){for(var f=t.context,d=f.gl,v=t.transform,m="map"===u,g="map"===l,y=m&&"point"!==r.layout.get("symbol-placement"),_=m&&!g&&!y,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,E=t.depthModeForSublayer(0,Te.ReadOnly),w=r.layout.get("text-variable-anchor"),S=[],T=0,A=i;T<A.length;T+=1){var C=A[T],R=n.getTile(C),M=R.getBucket(r);if(M){var k=o?M.text:M.icon;if(k&&k.segments.get().length){var I=k.programConfigurations.get(r.id),L=o||M.sdfIcons,P=o?M.textSizeData:M.iconSizeData,O=g||0!==v.pitch,D=t.useProgram(tr(L,o,M),I),N=e.evaluateSizeForZoom(P,v.zoom),F=void 0,B=[0,0],z=void 0,U=void 0,j=null,G=void 0;if(o)z=R.glyphAtlasTexture,U=d.LINEAR,F=R.glyphAtlasTexture.size,M.iconsInText&&(B=R.imageAtlasTexture.size,j=R.imageAtlasTexture,G=O||t.options.rotating||t.options.zooming||"composite"===P.kind||"camera"===P.kind?d.LINEAR:d.NEAREST);else{var V=1!==r.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear;z=R.imageAtlasTexture,U=L||t.options.rotating||t.options.zooming||V||O?d.LINEAR:d.NEAREST,F=R.imageAtlasTexture.size}var H=pt(R,1,t.transform.zoom),W=Qe(C.posMatrix,g,m,t.transform,H),X=Je(C.posMatrix,g,m,t.transform,H),Z=w&&M.hasTextData(),q="none"!==r.layout.get("icon-text-fit")&&Z&&M.hasIconData();y&&nt(M,C.posMatrix,t,o,W,X,g,c);var Y=t.translatePosMatrix(C.posMatrix,R,a,s),K=y||o&&w||q?Jn:W,Q=t.translatePosMatrix(X,R,a,s,!0),J=L&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:k,uniformValues:L?M.iconsInText?Zn(P.kind,N,_,g,t,Y,K,Q,F,B):Xn(P.kind,N,_,g,t,Y,K,Q,o,F,!0):Wn(P.kind,N,_,g,t,Y,K,Q,o,F),atlasTexture:z,atlasTextureIcon:j,atlasInterpolation:U,atlasInterpolationIcon:G,isSDF:L,hasHalo:J};if(x&&M.canOverlap){b=!0;for(var ee=0,te=k.segments.get();ee<te.length;ee+=1){var ne=te[ee];S.push({segments:new e.SegmentVector([ne]),sortKey:ne.sortKey,state:$})}}else S.push({segments:k.segments,sortKey:0,state:$})}}}b&&S.sort((function(e,t){return e.sortKey-t.sortKey}));for(var re=0,ie=S;re<ie.length;re+=1){var oe=ie[re],ae=oe.state;if(f.activeTexture.set(d.TEXTURE0),ae.atlasTexture.bind(ae.atlasInterpolation,d.CLAMP_TO_EDGE),ae.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),ae.atlasTextureIcon&&ae.atlasTextureIcon.bind(ae.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),ae.isSDF){var se=ae.uniformValues;ae.hasHalo&&(se.u_is_halo=1,rr(ae.buffers,oe.segments,r,t,ae.program,E,h,p,se)),se.u_is_halo=0}rr(ae.buffers,oe.segments,r,t,ae.program,E,h,p,ae.uniformValues)}}function rr(e,t,n,r,i,o,a,s,u){var l=r.context;i.draw(l,l.gl.TRIANGLES,o,a,s,Re.disabled,u,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function ir(e,t,n,r,i,o,a){var s,u,l,c,h,p=e.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var m=0,g=r;m<g.length;m+=1){var y=g[m],_=t.getTile(y);if(!d||_.patternsLoaded()){var x=_.getBucket(n);if(x){var b=x.programConfigurations.get(n.id),E=e.useProgram(u,b);d&&(e.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(v));var w=f.constantOr(null);if(w&&_.imageAtlas){var S=_.imageAtlas,T=S.patternPositions[w.to.toString()],A=S.patternPositions[w.from.toString()];T&&A&&b.setConstantPatternPositions(T,A)}var C=e.translatePosMatrix(y.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,h=x.segments2;var R=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?Mn(C,e,v,_,R):Rn(C,R)}else c=x.indexBuffer,h=x.segments,l=d?Cn(C,e,v,_):An(C);E.draw(e.context,s,i,e.stencilModeForClipping(y),o,Re.disabled,l,n.id,x.layoutVertexBuffer,c,h,n.paint,e.transform.zoom,b)}}}}function or(e,t,n,r,i,o,a){for(var s=e.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=r;f<d.length;f+=1){var v=d[f],m=t.getTile(v),g=m.getBucket(n);if(g){var y=g.programConfigurations.get(n.id),_=e.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(e.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var x=l.constantOr(null);if(x&&m.imageAtlas){var b=m.imageAtlas,E=b.patternPositions[x.to.toString()],w=b.patternPositions[x.from.toString()];E&&w&&y.setConstantPatternPositions(E,w)}var S=e.translatePosMatrix(v.posMatrix,m,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),T=n.paint.get("fill-extrusion-vertical-gradient"),A=c?Tn(S,e,T,p,v,h,m):Sn(S,e,T,p);_.draw(s,s.gl.TRIANGLES,i,o,a,Re.backCCW,A,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,y)}}}function ar(t,n,r,i,o,a){var s=t.context,u=s.gl,l=n.fbo;if(l){var c=t.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(t,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=t.transform.angle);var u,l,c,h=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new e.MercatorCoordinate(0,c/l).toLngLat().lat,new e.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(t,n,r);c.draw(s,u.TRIANGLES,i,o,a,Re.disabled,h,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function sr(t,n,r,i,o,a){var s=t.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,h=l.stride,p=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(h),n.demTexture){var f=n.demTexture;f.update(p,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new e.Texture(s,p,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var v=new e.Texture(s,{width:c,height:c,data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),t.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,Re.disabled,function(t,n){var r=n.stride,i=e.create();return e.ortho(i,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(i,i,[0,-e.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ur(t,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=e.browser.now(),u=(s-t.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),f=p&&t.refreshedUponExpiration?1:e.clamp(p?u:1-l,0,1);return t.refreshedUponExpiration&&u>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var lr=new e.Color(1,0,0,1),cr=new e.Color(0,1,0,1),hr=new e.Color(0,0,1,1),pr=new e.Color(1,0,1,1),fr=new e.Color(0,1,1,1);function dr(e,t,n,r){mr(e,0,t+n/2,e.transform.width,n,r)}function vr(e,t,n,r){mr(e,t-n/2,0,n,e.transform.height,r)}function mr(t,n,r,i,o,a){var s=t.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*e.browser.devicePixelRatio,r*e.browser.devicePixelRatio,i*e.browser.devicePixelRatio,o*e.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function gr(t,n,r){var i=t.context,o=i.gl,a=r.posMatrix,s=t.useProgram("debug"),u=Te.disabled,l=Ae.disabled,c=t.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,l,c,Re.disabled,Pn(a,e.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);var h=n.getTileByID(r.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),f=n.getTile(r).tileSize,d=512/Math.min(f,512)*(r.overscaledZ/t.transform.zoom)*.5,v=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(v+=" => "+r.overscaledZ),function(e,t){e.initDebugOverlayCanvas();var n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,v+" "+p+"kb"),s.draw(i,o.TRIANGLES,u,l,Ce.alphaBlended,Re.disabled,Pn(a,e.Color.transparent,d),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}var yr={symbol:function(t,n,r,i,o){if("translucent"===t.renderPass){var a=Ae.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,n,r,i,o,a,s){for(var u=n.transform,l="map"===o,c="map"===a,h=0,p=t;h<p.length;h+=1){var f=p[h],d=i.getTile(f),v=d.getBucket(r);if(v&&v.text&&v.text.segments.get().length){var m=e.evaluateSizeForZoom(v.textSizeData,u.zoom),g=pt(d,1,n.transform.zoom),y=Qe(f.posMatrix,c,l,n.transform,g),_="none"!==r.layout.get("icon-text-fit")&&v.hasIconData();if(m){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);er(v,l,c,s,e.symbolSize,u,y,f.posMatrix,x,m,_)}}}}(i,t,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&nr(t,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&nr(t,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Qn(t,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Qn(t,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(t,n,r,i){if("translucent"===t.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=t.context,c=l.gl,h=t.depthModeForSublayer(0,Te.ReadOnly),p=Ae.disabled,f=t.colorModeForRenderPass(),d=[],v=0;v<i.length;v++){var m=i[v],g=n.getTile(m),y=g.getBucket(r);if(y){var _=y.programConfigurations.get(r.id),x={programConfiguration:_,program:t.useProgram("circle",_),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:kn(t,m,g,r)};if(u)for(var b=0,E=y.segments.get();b<E.length;b+=1){var w=E[b];d.push({segments:new e.SegmentVector([w]),sortKey:w.sortKey,state:x})}else d.push({segments:y.segments,sortKey:0,state:x})}}u&&d.sort((function(e,t){return e.sortKey-t.sortKey}));for(var S=0,T=d;S<T.length;S+=1){var A=T[S],C=A.state;C.program.draw(l,c.TRIANGLES,h,p,f,Re.disabled,C.uniformValues,r.id,C.layoutVertexBuffer,C.indexBuffer,A.segments,r.paint,t.transform.zoom,C.programConfiguration)}}}},heatmap:function(t,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var o=t.context,a=o.gl,s=Ae.disabled,u=new Ce([a.ONE,a.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,n){var r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),e.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,n,r){var i=e.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width/4,t.height/4,0,i.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(e,t,o,i)}}(o,t,r),o.clear({color:e.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!n.hasRenderableParent(c)){var h=n.getTile(c),p=h.getBucket(r);if(p){var f=p.programConfigurations.get(r.id);t.useProgram("heatmap",f).draw(o,a.TRIANGLES,Te.disabled,s,u,Re.disabled,Dn(c.posMatrix,h,t.transform.zoom,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,t.transform.zoom,f)}}}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){var r=t.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new e.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Te.disabled,Ae.disabled,t.colorModeForRenderPass(),Re.disabled,function(t,n,r,i){var o=e.create();e.ortho(o,0,t.width,t.height,0,0,1);var a=t.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(t,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}}(t,r))},line:function(t,n,r,i){if("translucent"===t.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=t.depthModeForSublayer(0,Te.ReadOnly),u=t.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),p=r.paint.get("line-gradient"),f=r.getCrossfadeParameters(),d=h?"linePattern":l?"lineSDF":p?"lineGradient":"line",v=t.context,m=v.gl,g=!0,y=0,_=i;y<_.length;y+=1){var x=_[y],b=n.getTile(x);if(!h||b.patternsLoaded()){var E=b.getBucket(r);if(E){var w=E.programConfigurations.get(r.id),S=t.context.program.get(),T=t.useProgram(d,w),A=g||T.program!==S,C=c.constantOr(null);if(C&&b.imageAtlas){var R=b.imageAtlas,M=R.patternPositions[C.to.toString()],k=R.patternPositions[C.from.toString()];M&&k&&w.setConstantPatternPositions(M,k)}var I=h?Bn(t,b,r,f):l?zn(t,b,r,l,f):p?Fn(t,b,r,E.lineClipsArray.length):Nn(t,b,r);if(h)v.activeTexture.set(m.TEXTURE0),b.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),w.updatePaintBuffers(f);else if(l&&(A||t.lineAtlas.dirty))v.activeTexture.set(m.TEXTURE0),t.lineAtlas.bind(v);else if(p){var L=E.gradients[r.id],P=L.texture;if(r.gradientVersion!==L.version){var O=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=x.canonical.z===D?Math.ceil(1<<t.transform.maxZoom-x.canonical.z):1;O=e.clamp(e.nextPowerOfTwo(E.maxLineLength/e.EXTENT*1024*N),256,v.maxTextureSize)}L.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:L.gradient||void 0,clips:E.lineClipsArray}),L.texture?L.texture.update(L.gradient):L.texture=new e.Texture(v,L.gradient,m.RGBA),L.version=r.gradientVersion,P=L.texture}v.activeTexture.set(m.TEXTURE0),P.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}T.draw(v,m.TRIANGLES,s,t.stencilModeForClipping(x),u,Re.disabled,I,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,t.transform.zoom,w,E.layoutVertexBuffer2),g=!1}}}}},fill:function(t,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=t.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=t.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===l){var c=t.depthModeForSublayer(1,"opaque"===t.renderPass?Te.ReadWrite:Te.ReadOnly);ir(t,n,r,i,c,s,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){var h=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Te.ReadOnly);ir(t,n,r,i,h,s,!0)}}},"fill-extrusion":function(e,t,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===e.renderPass){var o=new Te(e.context.gl.LEQUAL,Te.ReadWrite,e.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))or(e,t,n,r,o,Ae.disabled,Ce.disabled),or(e,t,n,r,o,e.stencilModeFor3D(),e.colorModeForRenderPass());else{var a=e.colorModeForRenderPass();or(e,t,n,r,o,Ae.disabled,a)}}},hillshade:function(e,t,n,r){if("offscreen"===e.renderPass||"translucent"===e.renderPass){for(var i=e.context,o=e.depthModeForSublayer(0,Te.ReadOnly),a=e.colorModeForRenderPass(),s="translucent"===e.renderPass?e.stencilConfigForOverlap(r):[{},r],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],p=t.getTile(h);p.needsHillshadePrepare&&"offscreen"===e.renderPass?sr(e,p,n,o,Ae.disabled,a):"translucent"===e.renderPass&&ar(e,p,n,o,u[h.overscaledZ],a)}i.viewport.set([0,0,e.width,e.height])}},raster:function(e,t,n,r){if("translucent"===e.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=e.context,o=i.gl,a=t.getSource(),s=e.useProgram("raster"),u=e.colorModeForRenderPass(),l=a instanceof L?[{},r]:e.stencilConfigForOverlap(r),c=l[0],h=l[1],p=h[h.length-1].overscaledZ,f=!e.options.moving,d=0,v=h;d<v.length;d+=1){var m=v[d],g=e.depthModeForSublayer(m.overscaledZ-p,1===n.paint.get("raster-opacity")?Te.ReadWrite:Te.ReadOnly,o.LESS),y=t.getTile(m),_=e.transform.calculatePosMatrix(m.toUnwrapped(),f);y.registerFadeDuration(n.paint.get("raster-fade-duration"));var x=t.findLoadedParent(m,0),b=ur(y,x,t,n,e.transform),E=void 0,w=void 0,S="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),E=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),w=[y.tileID.canonical.x*E%1,y.tileID.canonical.y*E%1]):y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var T=Gn(_,w||[0,0],E||1,b,n);a instanceof L?s.draw(i,o.TRIANGLES,g,Ae.disabled,u,Re.disabled,T,n.id,a.boundsBuffer,e.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,g,c[m.overscaledZ],u,Re.disabled,T,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,t,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=e.context,a=o.gl,s=e.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!e.isPatternMissing(l)){var c=!l&&1===r.a&&1===i&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass===c){var h=Ae.disabled,p=e.depthModeForSublayer(0,"opaque"===c?Te.ReadWrite:Te.ReadOnly),f=e.colorModeForRenderPass(),d=e.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),e.imageManager.bind(e.context));for(var m=n.getCrossfadeParameters(),g=0,y=v;g<y.length;g+=1){var _=y[g],x=e.transform.calculatePosMatrix(_.toUnwrapped()),b=l?Yn(x,i,e,l,{tileID:_,tileSize:u},m):qn(x,i,r);d.draw(o,a.TRIANGLES,p,h,f,Re.disabled,b,n.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}}}}},debug:function(e,t,n){for(var r=0;r<n.length;r++)gr(e,t,n[r])},custom:function(e,t,n){var r=e.context,i=n.implementation;if("offscreen"===e.renderPass){var o=i.prerender;o&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),o.call(i,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Ae.disabled);var a="3d"===i.renderingMode?new Te(e.context.gl.LEQUAL,Te.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Te.ReadOnly);r.setDepthMode(a),i.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}},_r=function(e,t){this.context=new Me(e),this.transform=t,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bt,this.gpuTimers={}};_r.prototype.resize=function(t,n){if(this.width=t*e.browser.devicePixelRatio,this.height=n*e.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},_r.prototype.setup=function(){var t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,Ht.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);var r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,Ht.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);var i=new e.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(e.EXTENT,0,e.EXTENT,0),i.emplaceBack(0,e.EXTENT,0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(i,I.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);var o=new e.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,Ht.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);var a=new e.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(a);var s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Ae({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},_r.prototype.clearStencil=function(){var t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=e.create();e.ortho(r,0,this.width,this.height,0,0,1),e.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Te.disabled,this.stencilClearMode,Ce.disabled,Re.disabled,On(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(e,t){if(this.currentStencilSource!==e.source&&e.isTileClipped()&&t&&t.length){this.currentStencilSource=e.source;var n=this.context,r=n.gl;this.nextStencilID+t.length>256&&this.clearStencil(),n.setColorMode(Ce.disabled),n.setDepthMode(Te.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=t;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Te.disabled,new Ae({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Ce.disabled,Re.disabled,On(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new Ae({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)},_r.prototype.stencilModeForClipping=function(e){var t=this.context.gl;return new Ae({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)},_r.prototype.stencilConfigForOverlap=function(e){var t,n=this.context.gl,r=e.sort((function(e,t){return t.overscaledZ-e.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new Ae({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(t={},t[i]=Ae.disabled,t),r]},_r.prototype.colorModeForRenderPass=function(){var t=this.context.gl;return this._showOverdrawInspector?new Ce([t.CONSTANT_COLOR,t.ONE],new e.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ce.unblended:Ce.alphaBlended},_r.prototype.depthModeForSublayer=function(e,t,n){if(!this.opaquePassEnabledForLayer())return Te.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Te(n||this.context.gl.LEQUAL,t,[r,r])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(t,n){var r=this;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,l,c={},h={},p={};for(var f in o){var d=o[f];c[f]=d.getVisibleCoordinates(),h[f]=c[f].slice().reverse(),p[f]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var v=0;v<i.length;v++)if(this.style._layers[i[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(var m=0,g=i;m<g.length;m+=1){var y=this.style._layers[g[m]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var _=h[y.source];("custom"===y.type||_.length)&&this.renderLayer(this,o[y.source],y,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],E=c[x.source];this._renderTileClippingMasks(x,E),this.renderLayer(this,b,x,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var w=this.style._layers[i[this.currentLayer]],S=o[w.source],T=("symbol"===w.type?p:h)[w.source];this._renderTileClippingMasks(w,c[w.source]),this.renderLayer(this,S,w,T)}this.options.showTileBoundaries&&(e.values(this.style._layers).forEach((function(e){e.source&&!e.isHidden(r.transform.zoom)&&(e.source!==(l&&l.id)&&(l=r.style.sourceCaches[e.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&yr.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(e){var t=e.transform.padding;dr(e,e.transform.height-(t.top||0),3,lr),dr(e,t.bottom||0,3,cr),vr(e,t.left||0,3,hr),vr(e,e.transform.width-(t.right||0),3,pr);var n=e.transform.centerPoint;!function(e,t,n,r){mr(e,t-1,n-10,2,20,r),mr(e,t-10,n-1,20,2,r)}(e,n.x,e.transform.height-n.y,fr)}(this),this.context.setDefault()},_r.prototype.renderLayer=function(e,t,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),yr[n.type](e,t,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(e){if(this.options.gpuTiming){var t=this.context.extTimerQuery,n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var e=this.gpuTimers;return this.gpuTimers={},e},_r.prototype.queryGpuTimers=function(e){var t={};for(var n in e){var r=e[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),t[n]=o}return t},_r.prototype.translatePosMatrix=function(t,n,r,i,o){if(!r[0]&&!r[1])return t;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:pt(n,r[0],this.transform.zoom),o?r[1]:pt(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return e.translate(c,t,l),c},_r.prototype.saveTileTexture=function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]},_r.prototype.getTileTexture=function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null},_r.prototype.isPatternMissing=function(e){if(!e)return!1;if(!e.from||!e.to)return!0;var t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n},_r.prototype.useProgram=function(e,t){this.cache=this.cache||{};var n=""+e+(t?t.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new En(this.context,e,_n[e],t,Kn[e],this._showOverdrawInspector)),this.cache[n]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xr=function(e,t){this.points=e,this.planes=t};xr.fromInvProjectionMatrix=function(t,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return e.transformMat4([],n,t)})).map((function(t){return e.scale$1([],t,1/t[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(t){var n=e.sub([],o[t[0]],o[t[1]]),r=e.sub([],o[t[2]],o[t[1]]),i=e.normalize([],e.cross([],n,r)),a=-e.dot(i,o[t[1]]);return i.concat(a)}));return new xr(o,a)};var br=function(t,n){this.min=t,this.max=n,this.center=e.scale$2([],e.add([],this.min,this.max),.5)};br.prototype.quadrant=function(t){for(var n=[t%2==0,t<2],r=e.clone$2(this.min),i=e.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new br(r,i)},br.prototype.distanceX=function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]},br.prototype.distanceY=function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]},br.prototype.intersects=function(t){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<t.planes.length;i++){for(var o=t.planes[i],a=0,s=0;s<n.length;s++)a+=e.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<t.points.length;h++){var p=t.points[h][u]-this.min[u];l=Math.min(l,p),c=Math.max(c,p)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var Er=function(e,t,n,r){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=r};Er.prototype.interpolate=function(t,n,r){return null!=n.top&&null!=t.top&&(this.top=e.number(t.top,n.top,r)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,n.bottom,r)),null!=n.left&&null!=t.left&&(this.left=e.number(t.left,n.left,r)),null!=n.right&&null!=t.right&&(this.right=e.number(t.right,n.right,r)),this},Er.prototype.getCenter=function(t,n){var r=e.clamp((this.left+t-this.right)/2,0,t),i=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.Point(r,i)},Er.prototype.equals=function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right},Er.prototype.clone=function(){return new Er(this.top,this.bottom,this.left,this.right)},Er.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var wr=function(t,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Er,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};wr.prototype.clone=function(){var e=new wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e},Sr.minZoom.get=function(){return this._minZoom},Sr.minZoom.set=function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))},Sr.maxZoom.get=function(){return this._maxZoom},Sr.maxZoom.set=function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))},Sr.minPitch.get=function(){return this._minPitch},Sr.minPitch.set=function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))},Sr.maxPitch.get=function(){return this._maxPitch},Sr.maxPitch.set=function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))},Sr.renderWorldCopies.get=function(){return this._renderWorldCopies},Sr.renderWorldCopies.set=function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e},Sr.worldSize.get=function(){return this.tileSize*this.scale},Sr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sr.size.get=function(){return new e.Point(this.width,this.height)},Sr.bearing.get=function(){return-this.angle/Math.PI*180},Sr.bearing.set=function(t){var n=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.create$2(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sr.pitch.get=function(){return this._pitch/Math.PI*180},Sr.pitch.set=function(t){var n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Sr.fov.get=function(){return this._fov/Math.PI*180},Sr.fov.set=function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())},Sr.zoom.get=function(){return this._zoom},Sr.zoom.set=function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain(),this._calcMatrices())},Sr.center.get=function(){return this._center},Sr.center.set=function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())},Sr.padding.get=function(){return this._edgeInsets.toJSON()},Sr.padding.set=function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())},Sr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},wr.prototype.isPaddingEqual=function(e){return this._edgeInsets.equals(e)},wr.prototype.interpolatePadding=function(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()},wr.prototype.coveringZoomLevel=function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)},wr.prototype.getVisibleUnwrappedCoordinates=function(t){var n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new e.Point(0,0)),i=this.pointCoordinate(new e.Point(this.width,0)),o=this.pointCoordinate(new e.Point(this.width,this.height)),a=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new e.UnwrappedTileID(l,t));return n},wr.prototype.coveringTiles=function(t){var n=this.coveringZoomLevel(t),r=n;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);var i=e.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=xr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(e){return{aabb:new br([e*o,0,0],[(e+1)*o,o,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}},c=[],h=[],p=n,f=t.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var v=c.pop(),m=v.x,g=v.y,y=v.fullyVisible;if(!y){var _=v.aabb.intersects(s);if(0===_)continue;y=2===_}var x=v.aabb.distanceX(a),b=v.aabb.distanceY(a),E=Math.max(Math.abs(x),Math.abs(b));if(v.zoom===p||E>3+(1<<p-v.zoom)-2&&v.zoom>=u)h.push({tileID:new e.OverscaledTileID(v.zoom===p?f:v.zoom,v.wrap,v.zoom,m,g),distanceSq:e.sqrLen([a[0]-.5-m,a[1]-.5-g])});else for(var w=0;w<4;w++){var S=(m<<1)+w%2,T=(g<<1)+(w>>1);c.push({aabb:v.aabb.quadrant(w),zoom:v.zoom+1,x:S,y:T,wrap:v.wrap,fullyVisible:y})}}return h.sort((function(e,t){return e.distanceSq-t.distanceSq})).map((function(e){return e.tileID}))},wr.prototype.resize=function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()},Sr.unmodified.get=function(){return this._unmodified},wr.prototype.zoomScale=function(e){return Math.pow(2,e)},wr.prototype.scaleZoom=function(e){return Math.log(e)/Math.LN2},wr.prototype.project=function(t){var n=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.Point(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(n)*this.worldSize)},wr.prototype.unproject=function(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()},Sr.point.get=function(){return this.project(this.center)},wr.prototype.setLocationAtPoint=function(t,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),a=new e.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},wr.prototype.locationPoint=function(e){return this.coordinatePoint(this.locationCoordinate(e))},wr.prototype.pointLocation=function(e){return this.coordinateLocation(this.pointCoordinate(e))},wr.prototype.locationCoordinate=function(t){return e.MercatorCoordinate.fromLngLat(t)},wr.prototype.coordinateLocation=function(e){return e.toLngLat()},wr.prototype.pointCoordinate=function(t){var n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,l=r[2]/o,c=u===l?0:(0-u)/(l-u);return new e.MercatorCoordinate(e.number(n[0]/i,r[0]/o,c)/this.worldSize,e.number(a,s,c)/this.worldSize)},wr.prototype.coordinatePoint=function(t){var n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(n,n,this.pixelMatrix),new e.Point(n[0]/n[3],n[1]/n[3])},wr.prototype.getBounds=function(){return(new e.LngLatBounds).extend(this.pointLocation(new e.Point(0,0))).extend(this.pointLocation(new e.Point(this.width,0))).extend(this.pointLocation(new e.Point(this.width,this.height))).extend(this.pointLocation(new e.Point(0,this.height)))},wr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},wr.prototype.setMaxBounds=function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},wr.prototype.calculatePosMatrix=function(t,n){void 0===n&&(n=!1);var r=t.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=t.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*t.wrap,u=e.identity(new Float64Array(16));return e.translate(u,u,[s*a,o.y*a,0]),e.scale(u,u,[a/e.EXTENT,a/e.EXTENT,1]),e.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},wr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},wr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=e.mercatorYfromLat(h[1])*this.worldSize,t=(a=e.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=e.mercatorXfromLng(p[0])*this.worldSize,n=(u=e.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,t||0);if(d)return this.center=this.unproject(new e.Point(n?(u+s)/2:f.x,t?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,m=l.y/2;v-m<o&&(i=o+m),v+m>a&&(i=a-m)}if(this.lngRange){var g=f.x,y=l.x/2;g-y<s&&(r=s+y),g+y>u&&(r=u-y)}void 0===r&&void 0===i||(this.center=this.unproject(new e.Point(void 0!==r?r:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},wr.prototype._calcMatrices=function(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(e.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);e.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,e.scale(c,c,[1,-1,1]),e.translate(c,c,[0,0,-this.cameraToCenterDistance]),e.rotateX(c,c,this._pitch),e.rotateZ(c,c,this.angle),e.translate(c,c,[-a,-s,0]),this.mercatorMatrix=e.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),e.scale(c,c,[1,1,e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=e.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*h+d*p,m=s-Math.round(s)+f*p+d*h,g=new Float64Array(c);if(e.translate(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,c=e.create(),e.scale(c,c,[this.width/2,-this.height/2,1]),e.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=e.create(),e.scale(c,c,[1,-1,1]),e.translate(c,c,[-1,-1,0]),e.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=e.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},wr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new e.Point(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},wr.prototype.getCameraPoint=function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))},wr.prototype.getCameraQueryGeometry=function(t){var n=this.getCameraPoint();if(1===t.length)return[t[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=t;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new e.Point(r,i),new e.Point(o,i),new e.Point(o,a),new e.Point(r,a),new e.Point(r,i)]},Object.defineProperties(wr.prototype,Sr);var Tr=function(t){var n,r,i,o;this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Tr.prototype.addTo=function(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Tr.prototype.remove=function(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Tr.prototype.getHashString=function(t){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=t?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,p=!1,f=e.window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===h?(p=!0,t+"="+c):e})).filter((function(e){return e}));return p||f.push(h+"="+c),"#"+f.join("&")}return"#"+c},Tr.prototype._getCurrentHash=function(){var t,n=this,r=e.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(e){return e.split("=")})).forEach((function(e){e[0]===n._hashName&&(t=e)})),(t&&t[1]||"").split("/")):r.split("/")},Tr.prototype._onHashChange=function(){var e=this._getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(e)}))){var t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},Tr.prototype._updateHashUnthrottled=function(){var t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());try{e.window.history.replaceState(e.window.history.state,null,t)}catch(e){}};var Ar={linearity:.3,easing:e.bezier(0,0,.3,1)},Cr=e.extend({deceleration:2500,maxSpeed:1400},Ar),Rr=e.extend({deceleration:20,maxSpeed:1400},Ar),Mr=e.extend({deceleration:1e3,maxSpeed:360},Ar),kr=e.extend({deceleration:1e3,maxSpeed:90},Ar),Ir=function(e){this._map=e,this.clear()};function Lr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Pr(t,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=e.clamp(t*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Ir.prototype.clear=function(){this._inertiaBuffer=[]},Ir.prototype.record=function(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.browser.now(),settings:t})},Ir.prototype._drainInertiaBuffer=function(){for(var t=this._inertiaBuffer,n=e.browser.now();t.length>0&&n-t[0].time>160;)t.shift()},Ir.prototype._onMoveEnd=function(t){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Pr(n.pan.mag(),a,e.extend({},Cr,t||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Lr(s,u)}if(n.zoom){var l=Pr(n.zoom,a,Rr);s.zoom=this._map.transform.zoom+l.amount,Lr(s,l)}if(n.bearing){var c=Pr(n.bearing,a,Mr);s.bearing=this._map.transform.bearing+e.clamp(c.amount,-179,179),Lr(s,c)}if(n.pitch){var h=Pr(n.pitch,a,kr);s.pitch=this._map.transform.pitch+h.amount,Lr(s,h)}if(s.zoom||s.bearing){var p=void 0===n.pinchAround?n.around:n.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),e.extend(s,{noMoveStart:!0})}};var Or=function(t){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);t.call(this,r,e.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(e.Event),Dr=function(t){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(e){return i.unproject(e)})),l=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new e.Point(0,0)),c=i.unproject(l);t.call(this,r,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(e.Event),Nr=function(e){function t(t,n,r){e.call(this,t,{originalEvent:r}),this._defaultPrevented=!1}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={defaultPrevented:{configurable:!0}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,n),t}(e.Event),Fr=function(e,t){this._map=e,this._clickTolerance=t.clickTolerance};Fr.prototype.reset=function(){delete this._mousedownPos},Fr.prototype.wheel=function(e){return this._firePreventable(new Nr(e.type,this._map,e))},Fr.prototype.mousedown=function(e,t){return this._mousedownPos=t,this._firePreventable(new Or(e.type,this._map,e))},Fr.prototype.mouseup=function(e){this._map.fire(new Or(e.type,this._map,e))},Fr.prototype.click=function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Or(e.type,this._map,e))},Fr.prototype.dblclick=function(e){return this._firePreventable(new Or(e.type,this._map,e))},Fr.prototype.mouseover=function(e){this._map.fire(new Or(e.type,this._map,e))},Fr.prototype.mouseout=function(e){this._map.fire(new Or(e.type,this._map,e))},Fr.prototype.touchstart=function(e){return this._firePreventable(new Dr(e.type,this._map,e))},Fr.prototype.touchmove=function(e){this._map.fire(new Dr(e.type,this._map,e))},Fr.prototype.touchend=function(e){this._map.fire(new Dr(e.type,this._map,e))},Fr.prototype.touchcancel=function(e){this._map.fire(new Dr(e.type,this._map,e))},Fr.prototype._firePreventable=function(e){if(this._map.fire(e),e.defaultPrevented)return{}},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Br=function(e){this._map=e};Br.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Br.prototype.mousemove=function(e){this._map.fire(new Or(e.type,this._map,e))},Br.prototype.mousedown=function(){this._delayContextMenu=!0},Br.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Br.prototype.contextmenu=function(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Or(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()},Br.prototype.isEnabled=function(){return!0},Br.prototype.isActive=function(){return!1},Br.prototype.enable=function(){},Br.prototype.disable=function(){};var zr=function(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1};function Ur(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}zr.prototype.isEnabled=function(){return!!this._enabled},zr.prototype.isActive=function(){return!!this._active},zr.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},zr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},zr.prototype.mousedown=function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(n.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)},zr.prototype.mousemoveWindow=function(e,t){if(this._active){var r=t;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},zr.prototype.mouseupWindow=function(t,r){var i=this;if(this._active&&0===t.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:function(e){return e.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",t)}},zr.prototype.keydown=function(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))},zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},zr.prototype._fireEvent=function(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))};var jr=function(e){this.reset(),this.numTouches=e.numTouches};jr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},jr.prototype.touchstart=function(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){for(var n=new e.Point(0,0),r=0,i=t;r<i.length;r+=1)n._add(i[r]);return n.div(t.length)}(n),this.touches=Ur(r,n)))},jr.prototype.touchmove=function(e,t,n){if(!this.aborted&&this.centroid){var r=Ur(n,t);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},jr.prototype.touchend=function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Gr=function(e){this.singleTap=new jr(e),this.numTaps=e.numTaps,this.reset()};Gr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Gr.prototype.touchstart=function(e,t,n){this.singleTap.touchstart(e,t,n)},Gr.prototype.touchmove=function(e,t,n){this.singleTap.touchmove(e,t,n)},Gr.prototype.touchend=function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Vr=function(){this._zoomIn=new Gr({numTouches:1,numTaps:2}),this._zoomOut=new Gr({numTouches:2,numTaps:1}),this.reset()};Vr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vr.prototype.touchstart=function(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)},Vr.prototype.touchmove=function(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)},Vr.prototype.touchend=function(e,t,n){var r=this,i=this._zoomIn.touchend(e,t,n),o=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0},Vr.prototype.touchcancel=function(){this.reset()},Vr.prototype.enable=function(){this._enabled=!0},Vr.prototype.disable=function(){this._enabled=!1,this.reset()},Vr.prototype.isEnabled=function(){return this._enabled},Vr.prototype.isActive=function(){return this._active};var Hr={0:1,2:2},Wr=function(e){this.reset(),this._clickTolerance=e.clickTolerance||1};Wr.prototype.blur=function(){this.reset()},Wr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wr.prototype._correctButton=function(e,t){return!1},Wr.prototype._move=function(e,t){return{}},Wr.prototype.mousedown=function(e,t){if(!this._lastPoint){var r=n.mouseButton(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}},Wr.prototype.mousemoveWindow=function(e,t){var n=this._lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=Hr[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)},Wr.prototype.mouseupWindow=function(e){this._lastPoint&&n.mouseButton(e)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var Xr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.mousedown=function(t,n){e.prototype.mousedown.call(this,t,n),this._lastPoint&&(this._active=!0)},t.prototype._correctButton=function(e,t){return 0===t&&!e.ctrlKey},t.prototype._move=function(e,t){return{around:t,panDelta:t.sub(e)}},t}(Wr),Zr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return 0===t&&e.ctrlKey||2===t},t.prototype._move=function(e,t){var n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}},t.prototype.contextmenu=function(e){e.preventDefault()},t}(Wr),qr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return 0===t&&e.ctrlKey||2===t},t.prototype._move=function(e,t){var n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}},t.prototype.contextmenu=function(e){e.preventDefault()},t}(Wr),Yr=function(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()};Yr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)},Yr.prototype.touchstart=function(e,t,n){return this._calculateTransform(e,t,n)},Yr.prototype.touchmove=function(e,t,n){if(this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)},Yr.prototype.touchend=function(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()},Yr.prototype.touchcancel=function(){this.reset()},Yr.prototype._calculateTransform=function(t,n,r){r.length>0&&(this._active=!0);var i=Ur(r,n),o=new e.Point(0,0),a=new e.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(o._add(l),a._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var Kr=function(){this.reset()};function Qr(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Jr(e,t){return Math.log(e/t)/Math.LN2}Kr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Kr.prototype._start=function(e){},Kr.prototype._move=function(e,t,n){return{}},Kr.prototype.touchstart=function(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))},Kr.prototype.touchmove=function(e,t,n){if(this._firstTwoTouches){e.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Qr(n,t,r[0]),a=Qr(n,t,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,e)}}},Kr.prototype.touchend=function(e,t,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Qr(r,t,i[0]),s=Qr(r,t,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype.enable=function(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var $r=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._distance,delete this._startDistance},t.prototype._start=function(e){this._startDistance=this._distance=e[0].dist(e[1])},t.prototype._move=function(e,t){var n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Jr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jr(this._distance,n),pinchAround:t}},t}(Kr);function ei(e,t){return 180*e.angleWith(t)/Math.PI}var ti=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},t.prototype._start=function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])},t.prototype._move=function(e,t){var n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ei(this._vector,n),pinchAround:t}},t.prototype._isBelowThreshold=function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,n=ei(e,this._startVector);return Math.abs(n)<t},t}(Kr);function ni(e){return Math.abs(e.y)>Math.abs(e.x)}var ri=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},t.prototype._start=function(e){this._lastPoints=e,ni(e[0].sub(e[1]))&&(this._valid=!1)},t.prototype._move=function(e,t,n){var r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},t.prototype.gestureBeginsVertically=function(e,t,n){if(void 0!==this._valid)return this._valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=e.y>0==t.y>0;return ni(e)&&ni(t)&&o}},t}(Kr),ii={panStep:100,bearingStep:15,pitchStep:10},oi=function(){var e=ii;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1};function ai(e){return e*(2-e)}oi.prototype.blur=function(){this.reset()},oi.prototype.reset=function(){this._active=!1},oi.prototype.keydown=function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ai,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t._bearingStep,pitch:s.getPitch()+i*t._pitchStep,offset:[-o*t._panStep,-a*t._panStep],center:s.getCenter()},{originalEvent:e})}}}},oi.prototype.enable=function(){this._enabled=!0},oi.prototype.disable=function(){this._enabled=!1,this.reset()},oi.prototype.isEnabled=function(){return this._enabled},oi.prototype.isActive=function(){return this._active},oi.prototype.disableRotation=function(){this._rotationDisabled=!0},oi.prototype.enableRotation=function(){this._rotationDisabled=!1};var si=function(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll(["_onTimeout"],this)};si.prototype.setZoomRate=function(e){this._defaultZoomRate=e},si.prototype.setWheelZoomRate=function(e){this._wheelZoomRate=e},si.prototype.isEnabled=function(){return!!this._enabled},si.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},si.prototype.isZooming=function(){return!!this._zooming},si.prototype.enable=function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)},si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},si.prototype.wheel=function(t){if(this.isEnabled()){var n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=e.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}},si.prototype._onTimeout=function(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},si.prototype._start=function(t){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,t);this._around=e.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},si.prototype.renderFrame=function(){var t=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((e.browser.now()-this._lastWheelEventTime)/200,1),p=l(h);a=e.number(u,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){t._zooming=!1,t._handler._triggerRenderFrame(),delete t._targetZoom,delete t._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},si.prototype._smoothOutEasing=function(t){var n=e.ease;if(this._prevEase){var r=this._prevEase,i=(e.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=e.bezier(a,s,.25,1)}return this._prevEase={start:e.browser.now(),duration:t,easing:n},n},si.prototype.blur=function(){this.reset()},si.prototype.reset=function(){this._active=!1};var ui=function(e,t){this._clickZoom=e,this._tapZoom=t};ui.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ui.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ui.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ui.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var li=function(){this.reset()};li.prototype.reset=function(){this._active=!1},li.prototype.blur=function(){this.reset()},li.prototype.dblclick=function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}},li.prototype.enable=function(){this._enabled=!0},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var ci=function(){this._tap=new Gr({numTouches:1,numTaps:1}),this.reset()};ci.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ci.prototype.touchstart=function(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))},ci.prototype.touchmove=function(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)},ci.prototype.touchend=function(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)},ci.prototype.touchcancel=function(){this.reset()},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var hi=function(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n};hi.prototype.enable=function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pi=function(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n};pi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fi=function(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};fi.prototype.enable=function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var di=function(e){return e.zoom||e.drag||e.pitch||e.rotate},vi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(e.Event);function mi(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var gi=function(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ir(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),e.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[e.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===e.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};gi.prototype.destroy=function(){for(var t=0,r=this._listeners;t<r.length;t+=1){var i=r[t],o=i[0];n.removeEventListener(o,i[1],o===e.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},gi.prototype._addDefaultHandlers=function(e){var t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Fr(t,e));var r=t.boxZoom=new zr(t,e);this._add("boxZoom",r);var i=new Vr,o=new li;t.doubleClickZoom=new ui(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new ci;this._add("tapDragZoom",a);var s=t.touchPitch=new ri;this._add("touchPitch",s);var u=new Zr(e),l=new qr(e);t.dragRotate=new pi(e,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new Xr(e),h=new Yr(e);t.dragPan=new hi(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new ti,f=new $r;t.touchZoomRotate=new fi(n,f,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]);var d=t.scrollZoom=new si(t,this);this._add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new oi;this._add("keyboard",v),this._add("blockableMapEvent",new Br(t));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m+=1){var y=g[m];e.interactive&&e[y]&&t[y].enable(e[y])}},gi.prototype._add=function(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t},gi.prototype.stop=function(e){if(!this._updatingCamera){for(var t=0,n=this._handlers;t<n.length;t+=1)n[t].handler.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}},gi.prototype.isActive=function(){for(var e=0,t=this._handlers;e<t.length;e+=1)if(t[e].handler.isActive())return!0;return!1},gi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gi.prototype.isMoving=function(){return Boolean(di(this._eventsInProgress))||this.isZooming()},gi.prototype._blockedByActive=function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1},gi.prototype.handleWindowEvent=function(e){this.handleEvent(e,e.type+"Window")},gi.prototype._getMapTouches=function(e){for(var t=[],n=0,r=e;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&t.push(i)}return t},gi.prototype.handleEvent=function(e,t){this._updatingCamera=!0;for(var r="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},o={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,e),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var v=void 0;this._blockedByActive(a,d,p)?f.reset():f[t||e.type]&&(v=f[t||e.type](e,u,s),this.mergeHandlerResult(i,o,v,p,r),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||f.isActive())&&(a[p]=f)}}var m={};for(var g in this._previousActiveHandlers)a[g]||(m[g]=r);this._previousActiveHandlers=a,(Object.keys(m).length||mi(i))&&(this._changes.push([i,o,m]),this._triggerRenderFrame()),(Object.keys(a).length||mi(i))&&this._map._stop(!0),this._updatingCamera=!1;var y=i.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},gi.prototype.mergeHandlerResult=function(t,n,r,i,o){if(r){e.extend(t,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},gi.prototype._applyChanges=function(){for(var t={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=a[2];s.panDelta&&(t.panDelta=(t.panDelta||new e.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(t.around=s.around),void 0!==s.pinchAround&&(t.pinchAround=s.pinchAround),s.noInertia&&(t.noInertia=s.noInertia),e.extend(n,u),e.extend(r,l)}this._updateMapTransform(t,n,r),this._changes=[]},gi.prototype._updateMapTransform=function(e,t,n){var r=this._map,i=r.transform;if(!mi(e))return this._fireEvents(t,n,!0);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.around,c=e.pinchAround;void 0!==c&&(l=c),r._stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)},gi.prototype._fireEvents=function(t,n,r){var i=this,o=di(this._eventsInProgress),a=di(t),s={};for(var u in t)this._eventsInProgress[u]||(s[u+"start"]=t[u].originalEvent),this._eventsInProgress[u]=t[u];for(var l in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(l,s[l]);for(var c in a&&this._fireEvent("move",a.originalEvent),t)this._fireEvent(c,t[c].originalEvent);var h,p={};for(var f in this._eventsInProgress){var d=this._eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this._handlersById[v].isActive()||(delete this._eventsInProgress[f],p[f+"end"]=h=n[v]||m)}for(var g in p)this._fireEvent(g,p[g]);var y=di(this._eventsInProgress);if(r&&(o||a)&&!y){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(e){return 0!==e&&-i._bearingSnap<e&&e<i._bearingSnap};_?(x(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new e.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gi.prototype._fireEvent=function(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))},gi.prototype._requestFrame=function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){delete e._frameId,e.handleEvent(new vi("renderFrame",{timeStamp:t})),e._applyChanges()}))},gi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yi=function(t){function n(n,r){t.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getCenter=function(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(e,t){return this.jumpTo({center:e},t)},n.prototype.panBy=function(t,n,r){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),r)},n.prototype.panTo=function(t,n,r){return this.easeTo(e.extend({center:t},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(e,t){return this.jumpTo({zoom:e},t),this},n.prototype.zoomTo=function(t,n,r){return this.easeTo(e.extend({zoom:t},n),r)},n.prototype.zoomIn=function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this},n.prototype.zoomOut=function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(e,t){return this.jumpTo({bearing:e},t),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(e,t){return this.jumpTo({padding:e},t),this},n.prototype.rotateTo=function(t,n,r){return this.easeTo(e.extend({bearing:t},n),r)},n.prototype.resetNorth=function(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this},n.prototype.resetNorthPitch=function(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this},n.prototype.snapToNorth=function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(e,t){return this.jumpTo({pitch:e},t),this},n.prototype.cameraForBounds=function(t,n){t=e.LngLatBounds.convert(t);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(t,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=e.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=e.extend(o,i.padding);var s=this.transform,u=s.padding,l=s.project(e.LngLat.convert(t)),c=s.project(e.LngLat.convert(n)),h=l.rotate(-r*Math.PI/180),p=c.rotate(-r*Math.PI/180),f=new e.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),d=new e.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),v=f.sub(d),m=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/v.x,g=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/v.y;if(!(g<0||m<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),i.maxZoom),_="number"==typeof i.offset.x?new e.Point(i.offset.x,i.offset.y):e.Point.convert(i.offset),x=new e.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=_.add(x).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(c).div(2).sub(b)),zoom:y,bearing:r}}e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)},n.prototype.fitScreenCoordinates=function(t,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.Point.convert(t)),this.transform.pointLocation(e.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(t,n,r){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(t,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(a=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),i&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),o&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),a&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n))},n.prototype.easeTo=function(t,n){var r=this;this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.browser.prefersReducedMotion)&&(t.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in t?+t.zoom:o,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:s,p="padding"in t?t.padding:i.padding,f=e.Point.convert(t.offset),d=i.centerPoint.add(f),v=i.pointLocation(d),m=e.LngLat.convert(t.center||v);this._normalizeCenter(m);var g,y,_=i.project(v),x=i.project(m).sub(_),b=i.zoomScale(l-o);t.around&&(g=e.LngLat.convert(t.around),y=i.locationPoint(g));var E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(p),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,E),this._ease((function(t){if(r._zooming&&(i.zoom=e.number(o,l,t)),r._rotating&&(i.bearing=e.number(a,c,t)),r._pitching&&(i.pitch=e.number(s,h,t)),r._padding&&(i.interpolatePadding(u,p,t),d=i.centerPoint.add(f)),g)i.setLocationAtPoint(g,y);else{var v=i.zoomScale(i.zoom-o),m=l>o?Math.min(2,b):Math.max(.5,b),E=Math.pow(m,1-t),w=i.unproject(_.add(x.mult(t*E)).mult(v));i.setLocationAtPoint(i.renderWorldCopies?w.wrap():w,d)}r._fireMoveEvents(n)}),(function(e){r._afterEase(n,e)}),t),this},n.prototype._prepareEase=function(t,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))},n.prototype._fireMoveEvents=function(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))},n.prototype._afterEase=function(t,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),i&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}},n.prototype.flyTo=function(t,n){var r=this;if(!t.essential&&e.browser.prefersReducedMotion){var i=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in t?e.clamp(+t.zoom,o.minZoom,o.maxZoom):a,h="bearing"in t?this._normalizeBearing(t.bearing,s):s,p="pitch"in t?+t.pitch:u,f="padding"in t?t.padding:o.padding,d=o.zoomScale(c-a),v=e.Point.convert(t.offset),m=o.centerPoint.add(v),g=o.pointLocation(m),y=e.LngLat.convert(t.center||g);this._normalizeCenter(y);var _=o.project(g),x=o.project(y).sub(_),b=t.curve,E=Math.max(o.width,o.height),w=E/d,S=x.mag();if("minZoom"in t){var T=e.clamp(Math.min(t.minZoom,a,c),o.minZoom,o.maxZoom),A=E/o.zoomScale(T-a);b=Math.sqrt(A/S*2)}var C=b*b;function R(e){var t=(w*w-E*E+(e?-1:1)*C*C*S*S)/(2*(e?w:E)*C*S);return Math.log(Math.sqrt(t*t+1)-t)}function M(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}var I=R(0),L=function(e){return k(I)/k(I+b*e)},P=function(e){return E*((k(I)*(M(t=I+b*e)/k(t))-M(I))/C)/S;var t},O=(R(1)-I)/b;if(Math.abs(S)<1e-6||!isFinite(O)){if(Math.abs(E-w)<1e-6)return this.easeTo(t,n);var D=w<E?-1:1;O=Math.abs(Math.log(w/E))/b,P=function(){return 0},L=function(e){return Math.exp(D*b*e)}}return t.duration="duration"in t?+t.duration:1e3*O/("screenSpeed"in t?+t.screenSpeed/b:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==u,this._padding=!o.isPaddingEqual(f),this._prepareEase(n,!1),this._ease((function(t){var i=t*O,d=1/L(i);o.zoom=1===t?c:a+o.scaleZoom(d),r._rotating&&(o.bearing=e.number(s,h,t)),r._pitching&&(o.pitch=e.number(u,p,t)),r._padding&&(o.interpolatePadding(l,f,t),m=o.centerPoint.add(v));var g=1===t?y:o.unproject(_.add(x.mult(P(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?g.wrap():g,m),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),t),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,t)}if(!e){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(t,n,r){!1===r.animate||0===r.duration?(t(1),n()):(this._easeStart=e.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var t=Math.min((e.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(t,n){t=e.wrap(t,-180,180);var r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t},n.prototype._normalizeCenter=function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}},n}(e.Evented),_i=function(t){void 0===t&&(t={}),this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_i.prototype.getDefaultPosition=function(){return"bottom-right"},_i.prototype.onAdd=function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_i.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_i.prototype._setElementTitle=function(e,t){var n=this._map._getUIString("AttributionControl."+t);e.title=n,e.setAttribute("aria-label",n)},_i.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_i.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){var r=n.reduce((function(e,t,r){return t.value&&(e+=t.key+"="+t.value+(r<n.length-1?"&":"")),e}),"?");t.href=e.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}},_i.prototype._updateData=function(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())},_i.prototype._updateAttributions=function(){if(this._map.style){var e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((function(e){return"string"!=typeof e?"":e}))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&e.indexOf(o.attribution)<0&&e.push(o.attribution)}}e.sort((function(e,t){return e.length-t.length}));var a=(e=e.filter((function(t,n){for(var r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},_i.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xi=function(){e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)};xi.prototype.onAdd=function(e){this._map=e,this._container=n.create("div","mapboxgl-ctrl");var t=n.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xi.prototype.getDefaultPosition=function(){return"bottom-left"},xi.prototype._updateLogo=function(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xi.prototype._logoRequired=function(){if(this._map.style){var e=this._map.style.sourceCaches;for(var t in e)if(e[t].getSource().mapbox_logo)return!0;return!1}},xi.prototype._updateCompact=function(){var e=this._container.children;if(e.length){var t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}};var bi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bi.prototype.add=function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t},bi.prototype.remove=function(e){for(var t=this._currentlyRunning,n=0,r=t?this._queue.concat(t):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===e)return void(i.cancelled=!0)}},bi.prototype.run=function(e){void 0===e&&(e=0);var t=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=t;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(e),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ei={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},wi=e.window.HTMLImageElement,Si=e.window.HTMLElement,Ti=e.window.ImageBitmap,Ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ci=function(r){function i(t){var n=this;if(null!=(t=e.extend({},Ai,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new wr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies);if(r.call(this,i,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new bi,this._controls=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Ei,t.locale),this._clickTolerance=t.clickTolerance,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken),"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error("Container '"+t.container+"' not found.")}else{if(!(t.container instanceof Si))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gi(this,t),this._hash=t.hash&&new Tr("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new _i({customAttribution:t.customAttribution})),this.addControl(new xi,t.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(t){n._update("style"===t.dataType),n.fire(new e.Event(t.dataType+"data",t))})),this.on("dataloading",(function(t){n.fire(new e.Event(t.dataType+"dataloading",t))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=t.onAdd(this);this._controls.push(t);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this},i.prototype.hasControl=function(e){return this._controls.indexOf(e)>-1},i.prototype.resize=function(t){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),o&&this.fire(new e.Event("moveend",t)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()},i.prototype.setMinZoom=function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to 60");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(e){return this.transform.renderWorldCopies=e,this._update()},i.prototype.project=function(t){return this.transform.locationPoint(e.LngLat.convert(t))},i.prototype.unproject=function(t){return this.transform.pointLocation(e.Point.convert(t))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(e,t,n){var r,i=this;if("mouseenter"===e||"mouseover"===e){var o=!1;return{layer:t,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[];a.length?o||(o=!0,n.call(i,new Or(e,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===e||"mouseout"===e){var a=!1;return{layer:t,listener:n,delegates:{mousemove:function(r){(i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Or(e,i,r.originalEvent)))},mouseout:function(t){a&&(a=!1,n.call(i,new Or(e,i,t.originalEvent)))}}}}return{layer:t,listener:n,delegates:(r={},r[e]=function(e){var r=i.getLayer(t)?i.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,n.call(i,e),delete e.features)},r)}},i.prototype.on=function(e,t,n){if(void 0===n)return r.prototype.on.call(this,e,t);var i=this._createDelegatedListener(e,t,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(e,t,n){if(void 0===n)return r.prototype.once.call(this,e,t);var i=this._createDelegatedListener(e,t,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(e,t,n){var i=this;return void 0===n?r.prototype.off.call(this,e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&function(r){for(var o=r[e],a=0;a<o.length;a++){var s=o[a];if(s.layer===t&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(t,n){if(!this.style)return[];var r;if(void 0!==n||void 0===t||t instanceof e.Point||Array.isArray(t)||(n=t,t=void 0),n=n||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.Point||"number"==typeof t[0])r=[e.Point.convert(t)];else{var i=e.Point.convert(t[0]),o=e.Point.convert(t[1]);r=[i,new e.Point(o.x,i.y),o,new e.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(e,t){return this.style.querySourceFeatures(e,t)},i.prototype.setStyle=function(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))},i.prototype._getUIString=function(e){var t=this._locale[e];if(null==t)throw new Error("Missing UI string '"+e+"'");return t},i.prototype._updateStyle=function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new Vt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Vt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(t,n){var r=this;if("string"==typeof t){var i=this._requestManager.normalizeStyleURL(t),o=this._requestManager.transformRequest(i,e.ResourceType.Style);e.getJSON(o,(function(t,i){t?r.fire(new e.ErrorEvent(t)):i&&r._updateDiff(i,n)}))}else"object"==typeof t&&this._updateDiff(t,n)},i.prototype._updateDiff=function(t,n){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(t,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)},i.prototype.isSourceLoaded=function(t){var n=this.style&&this.style.sourceCaches[t];if(void 0!==n)return n.loaded();this.fire(new e.ErrorEvent(new Error("There is no source with ID '"+t+"'")))},i.prototype.areTilesLoaded=function(){var e=this.style&&this.style.sourceCaches;for(var t in e){var n=e[t]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)},i.prototype.removeSource=function(e){return this.style.removeSource(e),this._update(!0)},i.prototype.getSource=function(e){return this.style.getSource(e)},i.prototype.addImage=function(t,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof wi||Ti&&n instanceof Ti){var l=e.browser.getImageData(n);this.style.addImage(t,{data:new e.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(t,{data:new e.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,t)}},i.prototype.updateImage=function(t,n){var r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof wi||Ti&&n instanceof Ti?e.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof wi||Ti&&n instanceof Ti)),void this.style.updateImage(t,r))},i.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(e){this.style.removeImage(e)},i.prototype.loadImage=function(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)},i.prototype.moveLayer=function(e,t){return this.style.moveLayer(e,t),this._update(!0)},i.prototype.removeLayer=function(e){return this.style.removeLayer(e),this._update(!0)},i.prototype.getLayer=function(e){return this.style.getLayer(e)},i.prototype.setLayerZoomRange=function(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)},i.prototype.setFilter=function(e,t,n){return void 0===n&&(n={}),this.style.setFilter(e,t,n),this._update(!0)},i.prototype.getFilter=function(e){return this.style.getFilter(e)},i.prototype.setPaintProperty=function(e,t,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(e,t,n,r),this._update(!0)},i.prototype.getPaintProperty=function(e,t){return this.style.getPaintProperty(e,t)},i.prototype.setLayoutProperty=function(e,t,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(e,t,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(e,t){return this.style.getLayoutProperty(e,t)},i.prototype.setLight=function(e,t){return void 0===t&&(t={}),this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(e,t){return this.style.setFeatureState(e,t),this._update()},i.prototype.removeFeatureState=function(e,t){return this.style.removeFeatureState(e,t),this._update()},i.prototype.getFeatureState=function(e){return this.style.getFeatureState(e)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();var t=this._canvasContainer=n.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(e){o[e]=n.create("div","mapboxgl-ctrl-"+e,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(t,n){var r=e.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*n,this._canvas.style.width=t+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new _r(r,this.transform),e.webpSupported.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))},i.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))},i.prototype._onMapScroll=function(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(e){return this._update(),this._renderTaskQueue.add(e)},i.prototype._cancelRenderFrame=function(e){this._renderTaskQueue.remove(e)},i.prototype._render=function(t){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=e.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=e.browser.now();this.style.zoomHistory.update(s,u);var l=new e.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=e.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var t=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new e.Event("gpu-timing-frame",{cpuTime:h,gpuTime:t}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var t=r.painter.queryGpuTimers(p);r.fire(new e.Event("gpu-timing-layer",{layerTimes:t}))}),50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var t=0,n=this._controls;t<n.length;t+=1)n[t].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),Ri(this._canvasContainer),Ri(this._controlContainer),Ri(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new e.Event("remove"))},i.prototype.triggerRepaint=function(){var t=this;this.style&&!this._frame&&(this._frame=e.browser.frame((function(e){t._frame=null,t._render(e)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(e){this._trackResize&&this.resize({originalEvent:e})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(e){this._showPadding!==e&&(this._showPadding=e,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(e){this._vertices=e,this._update()},i.prototype._setCacheLimits=function(t,n){e.setCacheLimits(t,n)},o.version.get=function(){return e.version},Object.defineProperties(i.prototype,o),i}(yi);function Ri(e){e.parentNode&&e.parentNode.removeChild(e)}var Mi={showCompass:!0,showZoom:!0,visualizePitch:!1},ki=function(t){var r=this;this.options=e.extend({},Mi,t),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(e){return r._map.zoomIn({},{originalEvent:e})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(e){return r._map.zoomOut({},{originalEvent:e})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(e){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:e}):r._map.resetNorth({},{originalEvent:e})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ki.prototype._updateZoomButtons=function(){var e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},ki.prototype._rotateCompassArrow=function(){var e=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=e},ki.prototype.onAdd=function(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ii(this._map,this._compass,this.options.visualizePitch)),this._container},ki.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ki.prototype._createButton=function(e,t){var r=n.create("button",e,this._container);return r.type="button",r.addEventListener("click",t),r},ki.prototype._setButtonTitle=function(e,t){var n=this._map._getUIString("NavigationControl."+t);e.title=n,e.setAttribute("aria-label",n)};var Ii=function(t,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Zr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new qr({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function Li(t,n,r){if(t=new e.LngLat(t.lng,t.lat),n){var i=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),a=r.locationPoint(t).distSqr(n);r.locationPoint(i).distSqr(n)<a?t=i:r.locationPoint(o).distSqr(n)<a&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){var s=r.locationPoint(t);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}Ii.prototype.down=function(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),n.disableDrag()},Ii.prototype.move=function(e,t){var n=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Ii.prototype.off=function(){var e=this.element;n.removeEventListener(e,"mousedown",this.mousedown),n.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(e,"touchmove",this.touchmove),n.removeEventListener(e,"touchend",this.touchend),n.removeEventListener(e,"touchcancel",this.reset),this.offTemp()},Ii.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(e.window,"mousemove",this.mousemove),n.removeEventListener(e.window,"mouseup",this.mouseup)},Ii.prototype.mousedown=function(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:function(){return t.preventDefault()}}),n.mousePos(this.element,t)),n.addEventListener(e.window,"mousemove",this.mousemove),n.addEventListener(e.window,"mouseup",this.mouseup)},Ii.prototype.mousemove=function(e){this.move(e,n.mousePos(this.element,e))},Ii.prototype.mouseup=function(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()},Ii.prototype.touchstart=function(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return e.preventDefault()}},this._startPos))},Ii.prototype.touchmove=function(e){1!==e.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:function(){return e.preventDefault()}},this._lastPos))},Ii.prototype.touchend=function(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ii.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oi(e,t,n){var r=e.classList;for(var i in Pi)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+t)}var Di,Ni=function(t){function r(r,i){if(t.call(this),(r instanceof e.window.HTMLElement||i)&&(r=e.extend({element:r},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=e.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=n.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var x=n.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(x),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(g),s.appendChild(y),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=e.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(e){e.preventDefault()})),this._element.addEventListener("mousedown",(function(e){e.preventDefault()})),Oi(this._element,this._anchor,"marker"),this._popup=null}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){var t=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(e){var t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(e){var t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this},r.prototype._update=function(e){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(t="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),e&&"moveend"!==e.type||(this._pos=this._pos.round()),n.setTransform(this._element,Pi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+t)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(t){return this._offset=e.Point.convert(t),this._update(),this},r.prototype._onMove=function(t){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(e){return this._rotation=e||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(e){return this._rotationAlignment=e||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(e.Evented),Fi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Bi=0,zi=!1,Ui=function(t){function r(n){t.call(this),this.options=e.extend({},Fi,n),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.onAdd=function(t){var r;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Di?r(Di):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((function(e){r(Di="denied"!==e.state)})):r(Di=!!e.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bi=0,zi=!1},r.prototype._isOutOfMapMaxBounds=function(e){var t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}},r.prototype._updateCamera=function(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=this._map.getBearing(),o=e.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(t){if(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),n=this._map.unproject([1,e]),r=t.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&zi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(t){var r=this;if(this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ni(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(t){t.geolocateSource||"ACTIVE_LOCK"!==r._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new e.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bi--,zi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Bi>1?(t={maximumAge:6e5,timeout:0},zi=!0):(t=this.options.positionOptions,zi=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(e.Evented),ji={maxWidth:100,unit:"metric"},Gi=function(t){this.options=e.extend({},ji,t),e.bindAll(["_onMove","setUnit"],this)};function Vi(e,t,n){var r=n&&n.maxWidth||100,i=e._container.clientHeight/2,o=e.unproject([0,i]),a=e.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Hi(t,r,u/5280,e._getUIString("ScaleControl.Miles")):Hi(t,r,u,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Hi(t,r,s/1852,e._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hi(t,r,s/1e3,e._getUIString("ScaleControl.Kilometers")):Hi(t,r,s,e._getUIString("ScaleControl.Meters"))}function Hi(e,t,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(e){var t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(a)));e.style.width=t*(s/n)+"px",e.innerHTML=s+"&nbsp;"+r}Gi.prototype.getDefaultPosition=function(){return"bottom-left"},Gi.prototype._onMove=function(){Vi(this._map,this._container,this.options)},Gi.prototype.onAdd=function(e){return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Gi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Gi.prototype.setUnit=function(e){this.options.unit=e,Vi(this._map,this._container,this.options)};var Wi=function(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var t=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Xi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qi=function(t){function r(n){t.call(this),this.options=e.extend(Object.create(Xi),n),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(t){return this.setDOMContent(e.window.document.createTextNode(t))},r.prototype.setHTML=function(t){var n,r=e.window.document.createDocumentFragment(),i=e.window.document.createElement("body");for(i.innerHTML=t;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(e){return this.options.maxWidth=e,this._update(),this},r.prototype.setDOMContent=function(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(e){this._container&&this._container.classList.add(e)},r.prototype.removeClassName=function(e){this._container&&this._container.classList.remove(e)},r.prototype.setOffset=function(e){return this.options.offset=e,this._update(),this},r.prototype.toggleClassName=function(e){if(this._container)return this._container.classList.toggle(e)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(e){this._update(e.point)},r.prototype._onMouseMove=function(e){this._update(e.point)},r.prototype._onDrag=function(e){this._update(e.point)},r.prototype._update=function(t){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(e){return r._container.classList.add(e)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var i=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),o=this.options.anchor,a=function t(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new e.Point(0,0),top:new e.Point(0,n),"top-left":new e.Point(r,r),"top-right":new e.Point(-r,r),bottom:new e.Point(0,-n),"bottom-left":new e.Point(r,-r),"bottom-right":new e.Point(-r,-r),left:new e.Point(n,0),right:new e.Point(-n,0)}}if(n instanceof e.Point||Array.isArray(n)){var i=e.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.Point.convert(n.center||[0,0]),top:e.Point.convert(n.top||[0,0]),"top-left":e.Point.convert(n["top-left"]||[0,0]),"top-right":e.Point.convert(n["top-right"]||[0,0]),bottom:e.Point.convert(n.bottom||[0,0]),"bottom-left":e.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":e.Point.convert(n["bottom-right"]||[0,0]),left:e.Point.convert(n.left||[0,0]),right:e.Point.convert(n.right||[0,0])}}return t(new e.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();n.setTransform(this._container,Pi[o]+" translate("+c.x+"px,"+c.y+"px)"),Oi(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var e=this._container.querySelector(Zi);e&&e.focus()}},r.prototype._onClose=function(){this.remove()},r}(e.Evented),Yi={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:Ci,NavigationControl:ki,GeolocateControl:Ui,AttributionControl:_i,ScaleControl:Gi,FullscreenControl:Wi,Popup:qi,Marker:Ni,Style:Vt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,Evented:e.Evented,config:e.config,prewarm:function(){Be().acquire(Oe)},clearPrewarmedResources:function(){var e=Ne;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Oe),Ne=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return De.workerCount},set workerCount(e){De.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){e.clearTileCache(t)},workerUrl:""};return Yi})),n}()},9471:(e,t,n)=>{"use strict";e.exports=i;var r=n(1687);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function h(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function p(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function f(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function d(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function v(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function m(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function g(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function x(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function b(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function E(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=x(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=E(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=x(this.buf,this.pos)+x(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=x(this.buf,this.pos)+E(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return l(e,r,t);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return l(e,r,t);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return l(e,r,t);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return l(e,r,t);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return l(e,r,t);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return l(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&s?function(e,t,n){return s.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r="",i=t;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==i.Bytes)return e.push(this.readVarint(t));var n=u(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&c(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&c(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,i.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,v,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,_,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},858:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=o(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,p=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,f=new(c||"function"!=typeof WeakMap?function(){var e=16,n=u.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+s()}while(u.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t,n=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t));n[6]=79&n[6]|64,n[8]=191&n[8]|128;for(var r="",i=0;i<e;++i){var o=n[i];4!==i&&6!==i&&8!==i||(r+="-"),o<16&&(r+="0"),r+=o.toString(16).toLowerCase()}return r}}():WeakMap);function d(e,t,n){var r=f.get(e);if(w(r)){if(!n)return;r=new h,f.set(e,r)}var i=r.get(t);if(w(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){if(m(e,t,n))return!0;var r=O(t);return!S(r)&&v(e,r,n)}function m(e,t,n){var r=d(t,n,!1);return!w(r)&&!!r.has(e)}function g(e,t,n){if(m(e,t,n))return y(e,t,n);var r=O(t);return S(r)?void 0:g(e,r,n)}function y(e,t,n){var r=d(t,n,!1);if(!w(r))return r.get(e)}function _(e,t,n,r){d(n,r,!0).set(e,t)}function x(e,t){var n=b(e,t),r=O(e);if(null===r)return n;var i=x(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new p,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,h=i;c<h.length;c++)l=h[c],o.has(l)||(o.add(l),a.push(l));return a}function b(e,t){var n=[],r=d(e,t,!1);if(w(r))return n;for(var o=function(e){var t=I(e,i);if(!M(t))throw new TypeError;var n=t.call(e);if(!T(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=L(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{P(o)}finally{throw e}}a++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function w(e){return void 0===e}function S(e){return null===e}function T(e){return"object"==typeof e?null!==e:"function"==typeof e}function A(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=I(e,r);if(void 0!==i){var o=i.call(e,n);if(T(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(M(n)&&!T(i=n.call(e)))return i;if(M(r=e.valueOf)&&!T(i=r.call(e)))return i}else{var r;if(M(r=e.valueOf)&&!T(i=r.call(e)))return i;var i,o=e.toString;if(M(o)&&!T(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function C(e){var t=A(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function R(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function M(e){return"function"==typeof e}function k(e){return"function"==typeof e}function I(e,t){var n=e[t];if(null!=n){if(!M(n))throw new TypeError;return n}}function L(e){var t=e.next();return!t.done&&t}function P(e){var t=e.return;t&&t.call(e)}function O(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function D(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(w(n)){if(!R(e))throw new TypeError;if(!k(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!w(r)&&!S(r)){if(!k(r))throw new TypeError;t=r}}return t}(e,t)}if(!R(e))throw new TypeError;if(!T(t))throw new TypeError;if(!T(r)&&!w(r)&&!S(r))throw new TypeError;return S(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!w(o)&&!S(o)){if(!T(o))throw new TypeError;r=o}}return r}(e,t,n=C(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!T(n))throw new TypeError;if(!w(r)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!T(n))throw new TypeError;return w(r)||(r=C(r)),_(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!T(t))throw new TypeError;return w(n)||(n=C(n)),v(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!T(t))throw new TypeError;return w(n)||(n=C(n)),m(e,t,n)})),e("getMetadata",(function(e,t,n){if(!T(t))throw new TypeError;return w(n)||(n=C(n)),g(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!T(t))throw new TypeError;return w(n)||(n=C(n)),y(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!T(e))throw new TypeError;return w(t)||(t=C(t)),x(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!T(e))throw new TypeError;return w(t)||(t=C(t)),b(e,t)})),e("deleteMetadata",(function(e,t,n){if(!T(t))throw new TypeError;w(n)||(n=C(n));var r=d(t,n,!1);if(w(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=f.get(t);return i.delete(n),i.size>0||f.delete(t),!0}))}(i)}()}(r||(r={}))},8281:function(e){e.exports=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function s(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function l(e,t){for(e+="";e.length<t;)e=" "+e;return e}function c(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function f(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function d(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function v(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new c,0:new c};a.unknown.name=a[0].name=t||f(),a.unknown.lines.push(new h(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var p=/(\d+)(\s+\d+)?/.exec(l[2]);p&&(i=0|p[1],p[2]&&((o=0|p[2])in a||(a[o]=new c)));break;case"define":var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);d&&(a[o].name=d[1]?(n=d[2],"undefined"!=typeof atob?atob(n):"base64:"+n):d[2])}a[o].lines.push(new h(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function m(e){e._commandRef=f()}function g(e,t){var n=d();r(e+" in command "+(t||f())+("unknown"===n?"":" called from "+n))}function y(e,t,n,r){a(e,t)||g("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||f())}var _=33071,x=32819,b=32820,E=33635,w=34042,S={};function T(e,t){return e===b||e===x||e===E?2:e===w?4:S[e]*t}function A(e){return!(e&e-1||!e)}S[5120]=S[5121]=1,S[5122]=S[5123]=S[36193]=S[E]=S[x]=S[b]=2,S[5124]=S[5125]=S[5126]=S[w]=4;var C=t(i,{optional:function(e){e()},raise:r,commandRaise:g,command:function(e,t,n){e||g(t,n||f())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||g("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||f())},constructor:function(e){Object.keys(e).forEach((function(e){u.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+u)}))},type:function(e,t,n){a(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:y,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:s,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";y(r,"string",u+" shader source must be a string",a);var c=v(r,a),h=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(s);(function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))})(c,h),Object.keys(c).forEach((function(e){var t=c[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(l(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(l("| ",6)),o(l("^^^",t+3)+n,"font-weight:bold"),o(l("| ",6)),o(i+n,"font-weight:bold")})),o(l("| ",6)+n)}else o(l(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+c[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=v(r,a),l='Error linking program with vertex shader, "'+v(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),i.raise(l)}},callSite:d,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?s(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):s(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:f,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===_&&e.wrapT===_||i(A(o)&&A(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(A(o)&&A(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=o>>r,c=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(i(h.width===l&&h.height===c,"invalid shape for mip images"),i(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var p=Math.ceil(T(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;i(h.data.byteLength===p*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===_&&t.wrapT===_,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];i(l.width===o&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!l.compressed,"can not generate mipmap for compressed textures"),i(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var p=c[h];if(p){var f=o>>h,d=a>>h;i(l.mipmask&1<<h,"missing mipmap data"),i(p.width===f&&p.height===d,"invalid shape for mip images"),i(p.format===e.format&&p.internalformat===e.internalformat&&p.type===e.type,"incompatible type for mip image"),p.compressed||(p.data?i(p.data.byteLength===f*d*Math.max(T(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}}),R=0;function M(e,t){this.id=R++,this.type=e,this.data=t}function k(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+k(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return I(e.substr(0,r.index)).concat(I(r[1])).concat(I(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+k(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(I(i[a]));return o}function L(e){return"["+I(e).join("][")+"]"}var P={DynamicVariable:M,define:function(e,t){return new M(e,L(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof M},unbox:function(e,t){return"function"==typeof e?new M(0,e):e},accessor:L},O={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},D="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function N(e){return"string"==typeof e?e.split():(C(Array.isArray(e),"invalid extension array"),e)}function F(e){return"string"==typeof e?(C("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function B(e){var n,r,i,o,a,s=e||{},u={},l=[],c=[],h="undefined"==typeof window?1:window.devicePixelRatio,p=!1,f=function(e){e&&C.raise(e)},d=function(){};if("string"==typeof s?(C("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),C(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(o=s).canvas:(C.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=F(s.canvas):"container"in s&&(r=F(s.container)),"attributes"in s&&(u=s.attributes,C.type(u,"object","invalid context attributes")),"extensions"in s&&(l=N(s.extensions)),"optionalExtensions"in s&&(c=N(s.optionalExtensions)),"onDone"in s&&(C.type(s.onDone,"function","invalid or missing onDone callback"),f=s.onDone),"profile"in s&&(p=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,C(h>0,"invalid pixel ratio"))):C.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){C("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var v=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,h);if(!v)return null;i=v.canvas,d=v.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:l,optionalExtensions:c,pixelRatio:h,profile:p,onDone:f,onDestroy:d}:(d(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function z(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function U(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function j(){var e=z(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[U(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[U(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var G=j();G.zero=j();var V=3553,H=6408,W=5126,X=36160;function Z(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var q=function(e){return Object.keys(e).map((function(t){return e[t]}))},Y={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||G.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:K(e,t[0],t[1],t[2],a,0);break;default:Q(e,t,0,a,0)}return a}};function K(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function Q(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],l=t[n+2],c=t[n+3];for(a=0;a<s;++a)K(e[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Q(e[a],t,n+1,r,i),i+=o}var J={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},$={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},ee={dynamic:35048,stream:35040,static:35044},te=Y.flatten,ne=Y.shape,re=35044,ie=35040,oe=5121,ae=5126,se=[];function ue(e){return 0|J[Object.prototype.toString.call(e)]}function le(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function ce(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}se[5120]=1,se[5122]=2,se[5124]=4,se[5121]=1,se[5123]=2,se[5125]=4,se[5126]=4;var he={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pe=0,fe=1,de=4,ve=5120,me=5121,ge=5122,ye=5123,_e=5124,xe=5125,be=34963,Ee=35040,we=35044;var Se=new Float32Array(1),Te=new Uint32Array(Se.buffer),Ae=5123;function Ce(e){for(var t=G.allocType(Ae,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{Se[0]=e[n];var r=Te[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function Re(t){return Array.isArray(t)||e(t)}var Me=function(e){return!(e&e-1||!e)},ke=34467,Ie=3553,Le=34067,Pe=34069,Oe=6408,De=6406,Ne=6407,Fe=6409,Be=6410,ze=32854,Ue=32855,je=36194,Ge=32819,Ve=32820,He=33635,We=34042,Xe=6402,Ze=34041,qe=35904,Ye=35906,Ke=36193,Qe=33776,Je=33777,$e=33778,et=33779,tt=35986,nt=35987,rt=34798,it=35840,ot=35841,at=35842,st=35843,ut=36196,lt=5121,ct=5123,ht=5125,pt=5126,ft=10242,dt=10243,vt=10497,mt=33071,gt=33648,yt=10240,_t=10241,xt=9728,bt=9729,Et=9984,wt=9985,St=9986,Tt=9987,At=33170,Ct=4352,Rt=4353,Mt=4354,kt=34046,It=3317,Lt=37440,Pt=37441,Ot=37443,Dt=37444,Nt=33984,Ft=[Et,St,wt,Tt],Bt=[0,Fe,Be,Ne,Oe],zt={};function Ut(e){return"[object "+e+"]"}zt[Fe]=zt[De]=zt[Xe]=1,zt[Ze]=zt[Be]=2,zt[Ne]=zt[qe]=3,zt[Oe]=zt[Ye]=4;var jt=Ut("HTMLCanvasElement"),Gt=Ut("OffscreenCanvas"),Vt=Ut("CanvasRenderingContext2D"),Ht=Ut("ImageBitmap"),Wt=Ut("HTMLImageElement"),Xt=Ut("HTMLVideoElement"),Zt=Object.keys(J).concat([jt,Gt,Vt,Ht,Wt,Xt]),qt=[];qt[lt]=1,qt[pt]=4,qt[Ke]=2,qt[ct]=2,qt[ht]=4;var Yt=[];function Kt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Qt(e){return!!Array.isArray(e)&&!(0===e.length||!Re(e[0]))}function Jt(e){return Object.prototype.toString.call(e)}function $t(e){return Jt(e)===jt}function en(e){return Jt(e)===Gt}function tn(e){if(!e)return!1;var t=Jt(e);return Zt.indexOf(t)>=0||Kt(e)||Qt(e)||Z(e)}function nn(e){return 0|J[Object.prototype.toString.call(e)]}function rn(e,t){return G.allocType(e.type===Ke?pt:e.type,t)}function on(e,t){e.type===Ke?(e.data=Ce(t),G.freeType(t)):e.data=t}function an(e,t,n,r,i,o){var a;if(a=void 0!==Yt[e]?Yt[e]:zt[e]*qt[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function sn(n,r,i,o,a,s,u){var l={"don't care":Ct,"dont care":Ct,nice:Mt,fast:Rt},c={repeat:vt,clamp:mt,mirror:gt},h={nearest:xt,linear:bt},p=t({mipmap:Tt,"nearest mipmap nearest":Et,"linear mipmap nearest":wt,"nearest mipmap linear":St,"linear mipmap linear":Tt},h),f={none:0,browser:Dt},d={uint8:lt,rgba4:Ge,rgb565:He,"rgb5 a1":Ve},v={alpha:De,luminance:Fe,"luminance alpha":Be,rgb:Ne,rgba:Oe,rgba4:ze,"rgb5 a1":Ue,rgb565:je},m={};r.ext_srgb&&(v.srgb=qe,v.srgba=Ye),r.oes_texture_float&&(d.float32=d.float=pt),r.oes_texture_half_float&&(d.float16=d["half float"]=Ke),r.webgl_depth_texture&&(t(v,{depth:Xe,"depth stencil":Ze}),t(d,{uint16:ct,uint32:ht,"depth stencil":We})),r.webgl_compressed_texture_s3tc&&t(m,{"rgb s3tc dxt1":Qe,"rgba s3tc dxt1":Je,"rgba s3tc dxt3":$e,"rgba s3tc dxt5":et}),r.webgl_compressed_texture_atc&&t(m,{"rgb atc":tt,"rgba atc explicit alpha":nt,"rgba atc interpolated alpha":rt}),r.webgl_compressed_texture_pvrtc&&t(m,{"rgb pvrtc 4bppv1":it,"rgb pvrtc 2bppv1":ot,"rgba pvrtc 4bppv1":at,"rgba pvrtc 2bppv1":st}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=ut);var g=Array.prototype.slice.call(n.getParameter(ke));Object.keys(m).forEach((function(e){var t=m[e];g.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var x=[];Object.keys(d).forEach((function(e){var t=d[e];x[t]=e}));var b=[];Object.keys(h).forEach((function(e){var t=h[e];b[t]=e}));var E=[];Object.keys(p).forEach((function(e){var t=p[e];E[t]=e}));var w=[];Object.keys(c).forEach((function(e){var t=c[e];w[t]=e}));var S=y.reduce((function(e,t){var n=v[t];return n===Fe||n===De||n===Fe||n===Be||n===Xe||n===Ze||r.ext_srgb&&(n===qe||n===Ye)?e[n]=n:n===Ue||t.indexOf("rgba")>=0?e[n]=Oe:e[n]=Ne,e}),{});function T(){this.internalformat=Oe,this.format=Oe,this.type=lt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Dt,this.width=0,this.height=0,this.channels=0}function A(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function R(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(C.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(C.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(C.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(C.parameter(t.colorSpace,f,"invalid colorSpace"),e.colorSpace=f[t.colorSpace]),"type"in t){var n=t.type;C(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),C(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),C(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(n,d,"invalid texture type"),e.type=d[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(C(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],C(s>0&&s<=4,"invalid number of channels"),u=!0),C(o>=0&&o<=i.maxTextureSize,"invalid width"),C(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,C(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,C(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,C(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,C(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var l=!1;if("format"in t){var c=t.format;C(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(c,v,"invalid texture format");var h=e.internalformat=v[c];e.format=S[h],c in d&&("type"in t||(e.type=d[c])),c in m&&(e.compressed=!0),l=!0}!u&&l?e.channels=zt[e.format]:u&&!l?e.channels!==Bt[e.format]&&(e.format=e.internalformat=Bt[e.channels]):l&&u&&C(e.channels===zt[e.format],"number of channels inconsistent with specified format")}}function M(e){n.pixelStorei(Lt,e.flipY),n.pixelStorei(Pt,e.premultiplyAlpha),n.pixelStorei(Ot,e.colorSpace),n.pixelStorei(It,e.unpackAlignment)}function k(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(tn(n)?r=n:n&&(C.type(n,"object","invalid pixel data type"),R(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),tn(n.data)&&(r=n.data)),C(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){C(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,C(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==lt||(t.type=nn(r));else if(Kt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case lt:case ct:case ht:case pt:var r=G.allocType(e.type,n);r.set(t),e.data=r;break;case Ke:e.data=Ce(t);break;default:C.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(Z(r)){var u=r.data;Array.isArray(u)||t.type!==lt||(t.type=nn(u));var l,c,h,p,f,d,v=r.shape,m=r.stride;3===v.length?(h=v[2],d=m[2]):(C(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=v[0],c=v[1],p=m[0],f=m[1],t.alignment=1,t.width=l,t.height=c,t.channels=h,t.format=t.internalformat=Bt[h],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=rn(e,a*s*u),c=0,h=0;h<s;++h)for(var p=0;p<a;++p)for(var f=0;f<u;++f)l[c++]=t[n*p+r*h+i*f+o];on(e,l)}(t,u,p,f,d,r.offset)}else if($t(r)||en(r)||Jt(r)===Vt)$t(r)||en(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return Jt(e)===Ht}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return Jt(e)===Wt}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return Jt(e)===Xt}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Qt(r)){var g=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=Re(r[0][0])?_||r[0][0].length:_||1;for(var x=Y.shape(r),b=1,E=0;E<x.length;++E)b*=x[E];var w=rn(t,b);Y.flatten(r,x,"",w),on(t,w),t.alignment=1,t.width=g,t.height=y,t.channels=_,t.format=t.internalformat=Bt[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===pt?C(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Ke&&C(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function L(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,h=e.height;M(e),i?n.texImage2D(t,r,u,u,l,i):e.compressed?n.compressedTexImage2D(t,r,s,c,h,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,c,h,0)):n.texImage2D(t,r,u,c,h,0,u,l,a||null)}function P(e,t,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,h=e.type,p=e.width,f=e.height;M(e),s?n.texSubImage2D(t,a,r,i,c,h,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,l,p,f,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,p,f)):n.texSubImage2D(t,a,r,i,p,f,c,h,u)}var O=[];function D(){return O.pop()||new k}function N(e){e.needsFree&&G.freeType(e.data),k.call(e),O.push(e)}function F(){T.call(this),this.genMipmaps=!1,this.mipmapHint=Ct,this.mipmask=0,this.images=Array(16)}function B(e,t,n){var r=e.images[0]=D();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function z(e,t){var n=null;if(tn(t))A(n=e.images[0]=D(),e),I(n,t),e.mipmask=1;else if(R(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)A(n=e.images[i]=D(),e),n.width>>=i,n.height>>=i,I(n,r[i]),e.mipmask|=1<<i;else A(n=e.images[0]=D(),e),I(n,t),e.mipmask=1;A(e,e.images[0]),!e.compressed||e.internalformat!==Qe&&e.internalformat!==Je&&e.internalformat!==$e&&e.internalformat!==et||C(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function U(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;L(n[r],t,r)}}var j=[];function V(){var e=j.pop()||new F;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function H(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&N(t[n]),t[n]=null;j.push(e)}function W(){this.minFilter=xt,this.magFilter=xt,this.wrapS=mt,this.wrapT=mt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ct}function X(e,t){if("min"in t){var n=t.min;C.parameter(n,p),e.minFilter=p[n],Ft.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;C.parameter(r,h),e.magFilter=h[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(C.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(C.parameter(s[0],c),C.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in t){var u=t.wrapS;C.parameter(u,c),o=c[u]}if("wrapT"in t){var f=t.wrapT;C.parameter(f,c),a=c[f]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;C("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":C.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":C(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:C.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=Et)}}function K(e,t){n.texParameteri(t,_t,e.minFilter),n.texParameteri(t,yt,e.magFilter),n.texParameteri(t,ft,e.wrapS),n.texParameteri(t,dt,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,kt,e.anisotropic),e.genMipmaps&&(n.hint(At,e.mipmapHint),n.generateMipmap(t))}var Q=0,J={},$=i.maxTextureUnits,ee=Array($).map((function(){return null}));function te(e){T.call(this),this.mipmask=0,this.internalformat=Oe,this.id=Q++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new W,u.profile&&(this.stats={size:0})}function ne(e){n.activeTexture(Nt),n.bindTexture(e.target,e.texture)}function re(){var e=ee[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(Ie,null)}function ie(e){var t=e.texture;C(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Nt+r),n.bindTexture(i,null),ee[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return t(te.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<$;++r){var i=ee[r];if(i){if(i.bindCount>0)continue;i.unit=-1}ee[r]=e,t=r;break}t>=$&&C.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,n.activeTexture(Nt+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ie(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new te(Ie);function o(e,t){var n=r.texInfo;W.call(n);var a=V();return"number"==typeof e?B(a,0|e,"number"==typeof t?0|t:0|e):e?(C.type(e,"object","invalid arguments to regl.texture"),X(n,e),z(a,e)):B(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,A(r,a),C.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,ne(r),U(a,Ie),K(n,Ie),re(),H(a),u.profile&&(r.stats.size=an(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=x[r.type],o.mag=b[n.magFilter],o.min=E[n.minFilter],o.wrapS=w[n.wrapS],o.wrapT=w[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){C(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=D();return A(l,r),l.width=0,l.height=0,I(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,C(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),C(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),C(r.mipmask&1<<u,"missing mipmap data"),C(l.data||l.element||l.needsCopy,"missing image data"),ne(r),P(l,Ie,a,s,u),re(),N(l),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,ne(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;n.texImage2D(Ie,s,r.format,l,c,0,r.format,r.type,null)}return re(),u.profile&&(r.stats.size=an(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,l){var c=new te(Le);J[c.id]=c,s.cubeCount++;var h=new Array(6);function p(e,t,n,r,o,a){var s,l=c.texInfo;for(W.call(l),s=0;s<6;++s)h[s]=V();if("number"!=typeof e&&e)if("object"==typeof e)if(t)z(h[0],e),z(h[1],t),z(h[2],n),z(h[3],r),z(h[4],o),z(h[5],a);else if(X(l,e),R(c,e),"faces"in e){var f=e.faces;for(C(Array.isArray(f)&&6===f.length,"cube faces must be a length 6 array"),s=0;s<6;++s)C("object"==typeof f[s]&&!!f[s],"invalid input for cube map face"),A(h[s],c),z(h[s],f[s])}else for(s=0;s<6;++s)z(h[s],e);else C.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)B(h[s],d,d)}for(A(c,h[0]),i.npotTextureCube||C(Me(c.width)&&Me(c.height),"your browser does not support non power or two texture dimensions"),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,C.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,ne(c),s=0;s<6;++s)U(h[s],Pe+s);for(K(l,Le),re(),u.profile&&(c.stats.size=an(c.internalformat,c.type,p.width,p.height,l.genMipmaps,!0)),p.format=_[c.internalformat],p.type=x[c.type],p.mag=b[l.magFilter],p.min=E[l.minFilter],p.wrapS=w[l.wrapS],p.wrapT=w[l.wrapT],s=0;s<6;++s)H(h[s]);return p}return p(e,t,r,o,a,l),p.subimage=function(e,t,n,r,i){C(!!t,"must specify image data"),C("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return A(u,c),u.width=0,u.height=0,I(u,t),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,C(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),C(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),C(c.mipmask&1<<s,"missing mipmap data"),C(u.data||u.element||u.needsCopy,"missing image data"),ne(c),P(u,Pe+e,o,a,s),re(),N(u),p},p.resize=function(e){var t=0|e;if(t!==c.width){p.width=c.width=t,p.height=c.height=t,ne(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)n.texImage2D(Pe+r,i,c.format,t>>i,t>>i,0,c.format,c.type,null);return re(),u.profile&&(c.stats.size=an(c.internalformat,c.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=c,u.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p},clear:function(){for(var e=0;e<$;++e)n.activeTexture(Nt+e),n.bindTexture(Ie,null),ee[e]=null;q(J).forEach(ie),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<$;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null)}q(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Ie)n.texImage2D(Ie,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(Pe+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);K(e.texInfo,e.target)}))}}}Yt[ze]=2,Yt[Ue]=2,Yt[je]=2,Yt[Ze]=4,Yt[Qe]=.5,Yt[Je]=.5,Yt[$e]=1,Yt[et]=1,Yt[tt]=.5,Yt[nt]=1,Yt[rt]=1,Yt[it]=.5,Yt[ot]=.25,Yt[at]=.5,Yt[st]=.25,Yt[ut]=.5;var un=36161,ln=32854,cn=[];function hn(e,t,n){return cn[e]*t*n}cn[32854]=2,cn[32855]=2,cn[36194]=2,cn[33189]=2,cn[36168]=1,cn[34041]=4,cn[35907]=4,cn[34836]=16,cn[34842]=8,cn[34843]=6;var pn=36160,fn=36161,dn=3553,vn=34069,mn=36064,gn=36096,yn=36128,_n=33306,xn=36053,bn=6402,En=[6407,6408],wn=[];wn[6408]=4,wn[6407]=3;var Sn=[];Sn[5121]=1,Sn[5126]=4,Sn[36193]=2;var Tn=33189,An=36168,Cn=34041,Rn=[32854,32855,36194,35907,34842,34843,34836],Mn={};Mn[xn]="complete",Mn[36054]="incomplete attachment",Mn[36057]="incomplete dimensions",Mn[36055]="incomplete, missing attachment",Mn[36061]="unsupported";var kn=5126,In=34962;function Ln(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=kn,this.offset=0,this.stride=0,this.divisor=0}var Pn=35632,On=35633,Dn=35718,Nn=35721;var Fn=6408,Bn=5121,zn=3333,Un=5126;function jn(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(C(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Bn):(C(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(C(l===Bn||l===Un,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Un&&C(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):C(l===Bn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,h=0,p=i.framebufferWidth,f=i.framebufferHeight,d=null;e(u)?d=u:u&&(C.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,C(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),C(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(u.width||i.framebufferWidth-c),f=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===Bn?C(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Un&&C(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),C(p>0&&p+c<=i.framebufferWidth,"invalid width for read pixels"),C(f>0&&f+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=p*f*4;return d||(l===Bn?d=new Uint8Array(v):l===Un&&(d=d||new Float32Array(v))),C.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),C(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(zn,4),t.readPixels(c,h,p,f,Fn,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function Gn(e){return Array.prototype.slice.call(e)}function Vn(e){return Gn(e).join("")}var Hn="xyzw".split(""),Wn=5121,Xn=1,Zn=2,qn=0,Yn=1,Kn=2,Qn=3,Jn=4,$n="dither",er="blend.enable",tr="blend.color",nr="blend.equation",rr="blend.func",ir="depth.enable",or="depth.func",ar="depth.range",sr="depth.mask",ur="colorMask",lr="cull.enable",cr="cull.face",hr="frontFace",pr="lineWidth",fr="polygonOffset.enable",dr="polygonOffset.offset",vr="sample.alpha",mr="sample.enable",gr="sample.coverage",yr="stencil.enable",_r="stencil.mask",xr="stencil.func",br="stencil.opFront",Er="stencil.opBack",wr="scissor.enable",Sr="scissor.box",Tr="viewport",Ar="profile",Cr="framebuffer",Rr="vert",Mr="frag",kr="elements",Ir="primitive",Lr="count",Pr="offset",Or="instances",Dr="vao",Nr="Width",Fr="Height",Br=Cr+Nr,zr=Cr+Fr,Ur=Tr+Nr,jr=Tr+Fr,Gr="drawingBuffer",Vr=Gr+Nr,Hr=Gr+Fr,Wr=[rr,nr,xr,br,Er,gr,Tr,Sr,dr],Xr=34962,Zr=34963,qr=3553,Yr=34067,Kr=2884,Qr=3042,Jr=3024,$r=2960,ei=2929,ti=3089,ni=32823,ri=32926,ii=32928,oi=5126,ai=35664,si=35665,ui=35666,li=5124,ci=35667,hi=35668,pi=35669,fi=35670,di=35671,vi=35672,mi=35673,gi=35674,yi=35675,_i=35676,xi=35678,bi=35680,Ei=4,wi=1028,Si=1029,Ti=2304,Ai=2305,Ci=32775,Ri=32776,Mi=519,ki=7680,Ii=0,Li=1,Pi=32774,Oi=513,Di=36160,Ni=36064,Fi={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Bi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],zi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ui={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ji={frag:35632,vert:35633},Gi={cw:Ti,ccw:Ai};function Vi(t){return Array.isArray(t)||e(t)||Z(t)}function Hi(e){return e.sort((function(e,t){return e===Tr?-1:t===Tr?1:e<t?-1:1}))}function Wi(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function Xi(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Zi(e){return new Wi(!1,!1,!1,e)}function qi(e,t){var n=e.type;if(n===qn){var r=e.data.length;return new Wi(!0,r>=1,r>=2,t)}if(n===Jn){var i=e.data;return new Wi(i.thisDep,i.contextDep,i.propDep,t)}return new Wi(n===Qn,n===Kn,n===Yn,t)}var Yi=new Wi(!1,!1,!1,(function(){}));function Ki(e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m=c.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=Ci,g.max=Ri);var y=r.angle_instanced_arrays,_=r.webgl_draw_buffers,x={dirty:!0,profile:v.profile},b={},E=[],w={},S={};function T(e){return e.replace(".","_")}function A(e,t,n){var r=T(e);E.push(e),b[r]=x[r]=!!n,w[r]=t}function R(e,t,n){var r=T(e);E.push(e),Array.isArray(n)?(x[r]=n.slice(),b[r]=n.slice()):x[r]=b[r]=n,S[r]=t}A($n,Jr),A(er,Qr),R(tr,"blendColor",[0,0,0,0]),R(nr,"blendEquationSeparate",[Pi,Pi]),R(rr,"blendFuncSeparate",[Li,Ii,Li,Ii]),A(ir,ei,!0),R(or,"depthFunc",Oi),R(ar,"depthRange",[0,1]),R(sr,"depthMask",!0),R(ur,ur,[!0,!0,!0,!0]),A(lr,Kr),R(cr,"cullFace",Si),R(hr,hr,Ai),R(pr,pr,1),A(fr,ni),R(dr,"polygonOffset",[0,0]),A(vr,ri),A(mr,ii),R(gr,"sampleCoverage",[1,!1]),A(yr,$r),R(_r,"stencilMask",-1),R(xr,"stencilFunc",[Mi,0,-1]),R(br,"stencilOpSeparate",[wi,ki,ki,ki]),R(Er,"stencilOpSeparate",[Si,ki,ki,ki]),A(wr,ti),R(Sr,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),R(Tr,Tr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var M={gl:e,context:f,strings:n,next:b,current:x,draw:p,elements:a,buffer:o,shader:h,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:Vi},k={primTypes:he,compareFuncs:zi,blendFuncs:Fi,blendEquations:g,stencilOps:Ui,glTypes:$,orientationType:Gi};C.optional((function(){M.isArrayLike=Re})),_&&(k.backBuffer=[Si],k.drawBuffer=z(i.maxDrawbuffers,(function(e){return 0===e?[0]:z(e,(function(e){return Ni+e}))})));var I=0;function L(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,Gn(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Gn(arguments)),n.push(";")),t},toString:function(){return Vn([r.length>0?"var "+r.join(",")+";":"",Vn(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Gn(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),l=u.toString;return s[e]=t(u,{arg:i,toString:function(){return Vn(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var e=Vn(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,Gn(arguments)),this},else:function(){return r.apply(r,Gn(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Vn(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Vn(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=I++,e.batchId="0";var o=r(M),a=e.shared={props:"a0"};Object.keys(M).forEach((function(e){a[e]=i.def(o,".",e)})),C.optional((function(){e.CHECK=r(C),e.commandStr=C.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},k.invalidBlendCombinations=Bi}));var s=e.next={},u=e.current={};Object.keys(S).forEach((function(e){Array.isArray(x[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var l=e.constants={};Object.keys(k).forEach((function(e){l[e]=i.def(JSON.stringify(k[e]))})),e.invoke=function(t,n){switch(n.type){case qn:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case Yn:return t.def(a.props,n.data);case Kn:return t.def(a.context,n.data);case Qn:return t.def("this",n.data);case Jn:return n.data.append(e,t),n.data.ref}},e.attribCache={};var h={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in h)return h[t];var i=c.scope[t];return i||(i=c.scope[t]=new m),h[t]=r(i)},e}function O(e,t,s,l,p){var f=e.static,d=e.dynamic;C.optional((function(){var e=[Cr,Rr,Mr,kr,Ir,Pr,Lr,Or,Ar,Dr].concat(E);function t(t){Object.keys(t).forEach((function(t){C.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',p.commandStr)}))}t(f),t(d)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Mr]&&"string"==typeof n[Rr]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)C("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),_=function(e,t){var n=e.static,r=e.dynamic;if(Cr in n){var i=n[Cr];return i?(i=u.getFramebuffer(i),C.command(i,"invalid framebuffer object"),Zi((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Br,n+".width"),t.set(o,"."+zr,n+".height"),n}))):Zi((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Br,r+"."+Vr),t.set(r,"."+zr,r+"."+Hr),"null"}))}if(Cr in r){var o=r[Cr];return qi(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");C.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Br,a+"?"+a+".width:"+s+"."+Vr),t.set(s,"."+zr,a+"?"+a+".height:"+s+"."+Hr),a}))}return null}(e),x=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];C.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,C.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,C.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new Wi(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Br,"-",l));var i=s;return"height"in o||(i=t.def(n,".",zr,"-",c)),[l,c,r,i]}))}if(e in i){var h=i[e],p=qi(h,(function(t,n){var r=t.invoke(n,h);C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Br,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",zr,"-",a,")");return C.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(p.thisDep=p.thisDep||t.thisDep,p.contextDep=p.contextDep||t.contextDep,p.propDep=p.propDep||t.propDep),p}return t?new Wi(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Br),t.def(n,".",zr)]})):null}var a=o(Tr);if(a){var s=a;a=new Wi(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+Ur,n[2]),t.set(r,"."+jr,n[3]),n}))}return{viewport:a,scissor_box:o(Sr)}}(e,_,p),b=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(kr in n){var e=n[kr];Vi(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),C.command(e,"invalid elements",t.commandStr));var i=Zi((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(kr in r){var o=r[kr];return qi(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),l=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return C.optional((function(){e.assert(l.else,"!"+a+"||"+s,"invalid elements")})),t.entry(l),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return C.command(!o||a>=0,"invalid "+e,t.commandStr),Zi((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return qi(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,C.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?Zi((function(e,t){return e.OFFSET="0",0})):null}var s=o(Pr,!0);return{elements:i,primitive:function(){if(Ir in n){var e=n[Ir];return C.commandParameter(e,he,"invalid primitve",t.commandStr),Zi((function(t,n){return he[e]}))}if(Ir in r){var o=r[Ir];return qi(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return C.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(he))})),t.def(n,"[",r,"]")}))}return i?Xi(i)?i.value?Zi((function(e,t){return t.def(e.ELEMENTS,".primType")})):Zi((function(){return Ei})):new Wi(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Ei)})):null}(),count:function(){if(Lr in n){var e=0|n[Lr];return C.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Zi((function(){return e}))}if(Lr in r){var o=r[Lr];return qi(o,(function(e,t){var n=e.invoke(t,o);return C.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(Xi(i)){if(i)return s?new Wi(s.thisDep,s.contextDep,s.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return C.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):Zi((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var a=Zi((function(){return-1}));return C.optional((function(){a.MISSING=!0})),a}var u=new Wi(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return C.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(Or,!1),offset:s}}(e,p),w=function(e,t){var n=e.static,r=e.dynamic,o={};return E.forEach((function(e){var a=T(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=Zi((function(){return s}))}else if(e in r){var u=r[e];o[a]=qi(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case lr:case er:case $n:case yr:case ir:case wr:case fr:case vr:case mr:case sr:return s((function(n){return C.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return C.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case or:return s((function(n){return C.commandParameter(n,zi,"invalid "+e,t.commandStr),zi[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return C.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(zi))})),n.def(i,"[",r,"]")}));case ar:return s((function(e){return C.command(Re(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case rr:return s((function(e){C.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return C.commandParameter(n,Fi,a+".srcRGB",t.commandStr),C.commandParameter(r,Fi,a+".srcAlpha",t.commandStr),C.commandParameter(i,Fi,a+".dstRGB",t.commandStr),C.commandParameter(o,Fi,a+".dstAlpha",t.commandStr),C.command(-1===Bi.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Fi[n],Fi[i],Fi[r],Fi[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return C.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Fi))})),s}C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");C.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case nr:return s((function(n){return"string"==typeof n?(C.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"==typeof n?(C.commandParameter(n.rgb,g,e+".rgb",t.commandStr),C.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void C.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return C.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case tr:return s((function(e){return C.command(Re(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),z(4,(function(t){return+e[t]}))}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),z(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case _r:return s((function(e){return C.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return C.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case xr:return s((function(n){C.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return C.commandParameter(r,zi,e+".cmp",t.commandStr),C.commandType(i,"number",e+".ref",t.commandStr),C.commandType(o,"number",e+".mask",t.commandStr),[zi[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return C.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",ki),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case br:case Er:return s((function(n){C.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return C.commandParameter(r,Ui,e+".fail",t.commandStr),C.commandParameter(i,Ui,e+".zfail",t.commandStr),C.commandParameter(o,Ui,e+".zpass",t.commandStr),[e===Er?Si:wi,Ui[r],Ui[i],Ui[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return C.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Ui))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",ki)}return C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===Er?Si:wi,o("fail"),o("zfail"),o("zpass")]}));case dr:return s((function(e){C.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return C.commandType(n,"number",a+".factor",t.commandStr),C.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case cr:return s((function(e){var n=0;return"front"===e?n=wi:"back"===e&&(n=Si),C.command(!!n,a,t.commandStr),n}),(function(e,t,n){return C.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',wi,":",Si)}));case pr:return s((function(e){return C.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return C.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case hr:return s((function(e){return C.commandParameter(e,Gi,a,t.commandStr),Gi[e]}),(function(e,t,n){return C.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+Ti+":"+Ai)}));case ur:return s((function(e){return C.command(Re(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),z(4,(function(e){return"!!"+n+"["+e+"]"}))}));case gr:return s((function(e){C.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return C.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return C.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,p),S=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);C.optional((function(){h.shader(ji[e],t,C.guessCommand())}));var r=Zi((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return qi(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return C.optional((function(){n(t.shared.shader,".shader(",ji[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Mr),l=a(Rr),c=null;return Xi(u)&&Xi(l)?(c=h.program(l.id,u.id,null,r),s=Zi((function(e,t){return e.link(c)}))):s=new Wi(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Mr);var i=r+".program("+(l?l.append(e,t):t.def(r,".",Rr))+","+n;return C.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,v);function A(e){var t=x[e];t&&(w[e]=t)}A(Tr),A(T(Sr));var R=Object.keys(w).length>0,M={framebuffer:_,draw:b,shader:S,state:w,dirty:R,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(e){var t,n=e.static,r=e.dynamic;if(Ar in n){var i=!!n[Ar];(t=Zi((function(e,t){return i}))).enable=i}else if(Ar in r){var o=r[Ar];t=qi(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),M.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=Zi((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=Zi((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(C.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=Zi((function(e){return e.link(o.color[0])}))):C.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Re(o)?r=Zi((function(t){return t.global.def("[",z(o.length,(function(n){return C.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):C.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=qi(t,(function(e,n){return e.invoke(n,t)}))})),i}(s,p),M.drawVAO=M.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(Dr in n){var i=n[Dr];return null!==i&&null===c.getVAO(i)&&(i=c.createVAO(i)),Zi((function(e){return e.link(c.getVAO(i))}))}if(Dr in r){var o=r[Dr];return qi(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!M.drawVAO&&S.program&&!v&&r.angle_instanced_arrays){var k=!0,I=S.program.attributes.map((function(e){var n=t.static[e];return k=k&&!!n,n}));if(k&&I.length>0){var L=c.getVAO(c.createVAO(I));M.drawVAO=new Wi(null,null,null,(function(e,t){return e.link(L)})),M.useVAO=!0}}return v?M.useVAO=!0:M.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),u=new m;if(Vi(i))u.state=Xn,u.buffer=o.getBuffer(o.create(i,Xr,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=Xn,u.buffer=l,u.type=0;else if(C.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=Zn,"number"==typeof c?u.x=c:(C.command(Re(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),Hn.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{l=Vi(i.buffer)?o.getBuffer(o.create(i.buffer,Xr,!1,!0)):o.getBuffer(i.buffer),C.command(!!l,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;C.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var p=0|i.stride;C.command(p>=0&&p<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var f=0|i.size;C.command(!("size"in i)||f>0&&f<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,v=0;"type"in i&&(C.commandParameter(i.type,$,"invalid type for attribute "+e,t.commandStr),v=$[i.type]);var g=0|i.divisor;"divisor"in i&&(C.command(0===g||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),C.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),C.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){C.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=Xn,u.size=f,u.normalized=d,u.type=v||l.dtype,u.offset=h,u.stride=p,u.divisor=g}}a[e]=Zi((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=qi(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;C.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=Xn,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var h=l.buffer,p=l.type;function f(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",Xr,",",i,");",p,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",p,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",Zn,";","if(typeof "+i+'.constant === "number"){',l[Hn[0]],"=",i,".constant;",Hn.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Hn.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",Xr,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),f("size"),f("offset"),f("stride"),f("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),a}(t,p),M.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=Zi((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=qi(t,(function(e,n){return e.invoke(n,t)}))})),r}(l),M}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(e,t),";")})),t(i)}function N(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;_&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",Di,",",u,".framebuffer);"),_&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Di,",null);"),_&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function F(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");E.forEach((function(t){var r,c,h=T(t);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var p=z(x[h].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(p.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",S[h],"(",p,");",p.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",h);var f=e.cond(r,"!==",s,".",h);l(f),h in w?f(e.cond(r).then(i,".enable(",w[h],");").else(i,".disable(",w[h],");"),s,".",h,"=",r,";"):f(i,".",S[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function B(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;Hi(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(w[i]){var c=w[i];Xi(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(Re(l)){var h=o[i];t(s,".",S[i],"(",l,");",l.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",S[i],"(",l,");",a,".",i,"=",l,";")}}))}function U(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function j(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,h=u.timer,p=n.profile;function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(e){e(o=t.def(),"=",f(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),d&&(r?e(a=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",l,");"))}function m(e){e(l,".cpuTime+=",f(),"-",o,";"),d&&(r?e(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):e(h,".endQuery();"))}function g(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(p){if(Xi(p))return void(p.enable?(v(t),m(t.exit),g("true")):g("false"));g(s=p.append(e,t))}else s=t.def(c,".profile");var y=e.block();v(y),t("if(",s,"){",y,"}");var _=e.block();m(_),t.exit("if(",s,"){",_,"}")}function G(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(Yi))return;var l=e.scopeAttrib(s);C.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(e){a[e]=t.def(l,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function f(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",p.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",Xr,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",p.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),y){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Hn.map((function(e,t){return u+"."+e+"!=="+h[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Hn.map((function(e,t){return u+"."+e+"="+h[t]+";"})).join(""),"}")}l===Xn?f():l===Zn?d():(t("if(",l,"===",Xn,"){"),f(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case ai:case ci:case di:return 2;case si:case hi:case vi:return 3;case ui:case pi:case mi:return 4;default:return 1}}(r.info.type),a)}))}function V(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,l=0;l<i.length;++l){var c,h=i[l],p=h.name,f=h.info.type,d=r.uniforms[p],v=e.link(h)+".location";if(d){if(!o(d))continue;if(Xi(d)){var m=d.value;if(C.command(null!=m,'missing uniform "'+p+'"',e.commandStr),f===xi||f===bi){C.command("function"==typeof m&&(f===xi&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||f===bi&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,e.commandStr);var g=e.link(m._texture||m.color[0]._texture);t(u,".uniform1i(",v,",",g+".bind());"),t.exit(g,".unbind();")}else if(f===gi||f===yi||f===_i){C.optional((function(){C.command(Re(m),"invalid matrix for uniform "+p,e.commandStr),C.command(f===gi&&4===m.length||f===yi&&9===m.length||f===_i&&16===m.length,"invalid length for matrix uniform "+p,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),_=2;f===yi?_=3:f===_i&&(_=4),t(u,".uniformMatrix",_,"fv(",v,",false,",y,");")}else{switch(f){case oi:C.commandType(m,"number","uniform "+p,e.commandStr),a="1f";break;case ai:C.command(Re(m)&&2===m.length,"uniform "+p,e.commandStr),a="2f";break;case si:C.command(Re(m)&&3===m.length,"uniform "+p,e.commandStr),a="3f";break;case ui:C.command(Re(m)&&4===m.length,"uniform "+p,e.commandStr),a="4f";break;case fi:C.commandType(m,"boolean","uniform "+p,e.commandStr),a="1i";break;case li:C.commandType(m,"number","uniform "+p,e.commandStr),a="1i";break;case di:case ci:C.command(Re(m)&&2===m.length,"uniform "+p,e.commandStr),a="2i";break;case vi:case hi:C.command(Re(m)&&3===m.length,"uniform "+p,e.commandStr),a="3i";break;case mi:case pi:C.command(Re(m)&&4===m.length,"uniform "+p,e.commandStr),a="4i"}t(u,".uniform",a,"(",v,",",Re(m)?Array.prototype.slice.call(m):m,");")}continue}c=d.append(e,t)}else{if(!o(Yi))continue;c=t.def(s.uniforms,"[",n.id(p),"]")}f===xi?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):f===bi&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),C.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){n("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(s.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(t===qr?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(f){case li:r("number");break;case ci:i(2);break;case hi:i(3);break;case pi:i(4);break;case oi:r("number");break;case ai:i(2);break;case si:i(3);break;case ui:i(4);break;case fi:r("boolean");break;case di:i(2);break;case vi:i(3);break;case mi:case gi:i(4);break;case yi:i(9);break;case _i:i(16);break;case xi:o(qr);break;case bi:o(Yr)}}));var x=1;switch(f){case xi:case bi:var b=t.def(c,"._texture");t(u,".uniform1i(",v,",",b,".bind());"),t.exit(b,".unbind();");continue;case li:case fi:a="1i";break;case ci:case di:a="2i",x=2;break;case hi:case vi:a="3i",x=3;break;case pi:case mi:a="4i",x=4;break;case oi:a="1f";break;case ai:a="2f",x=2;break;case si:a="3f",x=3;break;case ui:a="4f",x=4;break;case gi:a="Matrix2fv";break;case yi:a="Matrix3fv";break;case _i:a="Matrix4fv"}if(t(u,".uniform",a,"(",v,","),"M"===a.charAt(0)){var E=Math.pow(f-gi+2,2),w=e.global.def("new Float32Array(",E,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",z(E,(function(e){return w+"["+e+"]="+c+"["+e+"]"})),",",w,")")}else t(x>1?z(x,(function(e){return c+"["+e+"]"})):c);t(");")}}function H(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw;var u=function(){var i,u=s.elements,l=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(l=n),i=u.append(e,l)):i=l.def(a,".",kr),i&&l("if("+i+")"+o+".bindBuffer("+Zr+","+i+".buffer.buffer);"),i}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var c,h,p=l(Ir),f=l(Pr),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),C.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Lr),C.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");y&&(c=l(Or),h=e.instancing);var v=u+".type",m=s.elements&&Xi(s.elements);function g(){function e(){n(h,".drawElementsInstancedANGLE(",[p,d,v,f+"<<(("+v+"-"+Wn+")>>1)",c],");")}function t(){n(h,".drawArraysInstancedANGLE(",[p,f,d,c],");")}u?m?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function _(){function e(){n(o+".drawElements("+[p,d,v,f+"<<(("+v+"-"+Wn+")>>1)"]+");")}function t(){n(o+".drawArrays("+[p,f,d]+");")}u?m?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),g(),n("}else if(",c,"<0){"),_(),n("}")):g():_()}function W(e,t,n,r,i){var o=L(),a=o.proc("body",i);return C.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function X(e,t,n,r){U(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),G(e,t,n,r.attributes,(function(){return!0}))),V(e,t,n,r.uniforms,(function(){return!0})),H(e,t,t,n)}function Z(e,t,n,r){function i(){return!0}e.batchId="a1",U(e,t),G(e,t,n,r.attributes,i),V(e,t,n,r.uniforms,i),H(e,t,t,n)}function q(e,t,n,r){U(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&D(e,u,n.context),n.needsFramebuffer&&N(e,u,n.framebuffer),B(e,u,n.state,l),n.profile&&l(n.profile)&&j(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),G(e,s,n,r.attributes,c),G(e,u,n,r.attributes,l)),V(e,s,n,r.uniforms,c),V(e,u,n,r.uniforms,l),H(e,s,u,n);else{var h=e.global.def("{}"),p=n.shader.progVar.append(e,u),f=u.def(p,".id"),d=u.def(h,"[",f,"]");u(e.shared.gl,".useProgram(",p,".program);","if(!",d,"){",d,"=",h,"[",f,"]=",e.link((function(t){return W(Z,e,n,t,2)})),"(",p,");}",d,".call(this,a0[",o,"],",o,");")}}function Y(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!Re(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(P.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=e.global.def("{}");o.forEach((function(t){var n=r[t];if(P.isDynamic(n)){"function"==typeof n&&(n=r[t]=P.unbox(n));var o=qi(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new P.DynamicVariable(Jn,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(e,t){o.forEach((function(n){var i=r[n];if(P.isDynamic(i)){var o=e.invoke(t,i);t(l,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:b,current:x,procs:function(){var e=L(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),N(e,t),N(e,n,null,!0),y&&(a=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var p=n.def(s.attributes,"[",h,"]"),f=e.cond(p,".buffer");f.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",Xr,",",p,".buffer.buffer);",u,".vertexAttribPointer(",h,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),n(f),y&&n(a,".vertexAttribDivisorANGLE(",h,",",p,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(w).forEach((function(r){var i=w[r],a=o.def(l,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(S).forEach((function(r){var i,a,s=S[r],h=x[r],p=e.block();if(p(u,".",s,"("),Re(h)){var f=h.length;i=e.global.def(l,".",r),a=e.global.def(c,".",r),p(z(f,(function(e){return i+"["+e+"]"})),");",z(f,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",z(f,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",p,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),p(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",p,"}");n(p)})),e.compile()}(),compile:function(e,t,r,i,o){var a=L();a.stats=a.link(o),Object.keys(t.static).forEach((function(e){Y(a,t,e)})),Wr.forEach((function(t){Y(a,e,t)}));var s=O(e,t,r,i,a);return function(e,t){var n=e.proc("draw",1);U(e,n),D(e,n,t.context),N(e,n,t.framebuffer),F(e,n,t),B(e,n,t.state),j(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)X(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return W(X,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),Hi(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);Re(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),j(e,r,t,!0,!0),[kr,Pr,Lr,Or,Ir].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new m).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Rr),a(Mr),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(a,s),function(e,t){var n=e.proc("batch",2);e.batchId="0",U(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||N(e,n,o)):N(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),F(e,n,t),B(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||j(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),h=n.def(l,".id"),p=n.def(c,"[",h,"]");n(e.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",h,"]=",e.link((function(n){return W(q,e,t,n,2)})),"(",l,");",p,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),a.compile()}}}var Qi=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function l(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=a,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var p=u[n],f=p.startQueryIndex,d=p.endQueryIndex;p.sum+=c[d]-c[f];var v=h[f],m=h[d];m===v?(p.stats.gpuTime+=p.sum/1e6,s(p)):(p.startQueryIndex=v,p.endQueryIndex=m,u[e++]=p)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},Ji="webglcontextlost",$i="webglcontextrestored";function eo(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=B(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){C.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(e){var t=u[e];return t||(t=u[e]=l.length,l.push(e),t)},str:function(e){return l[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=s.extensions,f=Qi(0,p),d=D(),v=i.drawingBufferWidth,m=i.drawingBufferHeight,g={tick:0,time:0,viewportWidth:v,viewportHeight:m,framebufferWidth:v,framebufferHeight:m,drawingBufferWidth:v,drawingBufferHeight:m,pixelRatio:r.pixelRatio},y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(V,a),e.texImage2D(V,0,H,1,1,0,H,W,null);var s=e.createFramebuffer();if(e.bindFramebuffer(X,s),e.framebufferTexture2D(X,36064,V,a,0),e.bindTexture(V,null),36053!==e.checkFramebufferStatus(X))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=G.allocType(W,4);e.readPixels(0,0,1,1,H,W,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),G.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),h=G.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,H,3,3,0,H,5121,h),G.freeType(h),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,p),_=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=re,this.byteLength=0,this.dimension=1,this.dtype=oe,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||ae,n.length>0)if(Array.isArray(n[0])){s=ne(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];t.dimension=c,l(t,u=te(n,s,t.dtype),r),a?t.persistentData=u:G.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var p=G.allocType(t.dtype,n.length);le(p,n),l(t,p,r),a?t.persistentData=p:G.freeType(p)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||ue(n[0])||ae,l(t,u=te(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:G.freeType(u)):C.raise("invalid buffer data")}else if(e(n))t.dtype=i||ue(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Z(n)){s=n.shape;var f=n.stride,d=n.offset,v=0,m=0,g=0,y=0;1===s.length?(v=s[0],m=1,g=f[0],y=0):2===s.length?(v=s[0],m=s[1],g=f[0],y=f[1]):C.raise("invalid shape"),t.dtype=i||ue(n.data)||ae,t.dimension=m;var _=G.allocType(t.dtype,v*m);ce(_,n.data,v,m,g,y,d),l(t,_,r),a?t.persistentData=_:G.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=oe,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):C.raise("invalid buffer data")}function h(e){n.bufferCount--,i(e);var r=e.buffer;C(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,l){n.bufferCount++;var p=new s(o);function f(n){var i=re,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||Z(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(C.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(C(null===o||Array.isArray(o)||e(o)||Z(o),"invalid data for buffer"),o=n.data),"usage"in n&&(C.parameter(n.usage,ee,"invalid buffer usage"),i=ee[n.usage]),"type"in n&&(C.parameter(n.type,$,"invalid buffer type"),s=$[n.type]),"dimension"in n&&(C.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(C.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),p.bind(),o?c(p,o,i,s,u,l):(a&&t.bufferData(p.type,a,i),p.dtype=s||oe,p.usage=i,p.dimension=u,p.byteLength=a),r.profile&&(p.stats.size=p.byteLength*se[p.dtype]),f}function d(e,n){C(n+e.byteLength<=p.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+p.byteLength),t.bufferSubData(p.type,n,e)}return a[p.id]=p,u||f(i),f._reglType="buffer",f._buffer=p,f.subdata=function(t,n){var r,i=0|(n||0);if(p.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=G.allocType(p.dtype,t.length);le(o,t),d(o,i),G.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=ne(t);var a=te(t,r,p.dtype);d(a,i),G.freeType(a)}else C.raise("invalid buffer data")}else if(Z(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):C.raise("invalid shape");var v=Array.isArray(t.data)?p.dtype:ue(t.data),m=G.allocType(v,u*l);ce(m,t.data,u,l,c,h,t.offset),d(m,i),G.freeType(m)}else C.raise("invalid data for buffer subdata");return f},r.profile&&(f.stats=p.stats),f.destroy=function(){h(p)},f},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,ie,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){q(a).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){q(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,h,r,(function(e){return x.destroyBuffer(e)})),x=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Ln;var l=0,c={},h={Record:Ln,scope:{},state:s,currentVAO:null,targetVAO:null,restore:p()?function(){p()&&q(c).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new d;function s(t){C(Array.isArray(t),"arguments to vertex array constructor must be an array"),C(t.length<a,"too many attributes"),C(t.length>0,"must specify at least one attribute");for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var u=r.attributes;u.length=t.length;for(var l=0;l<t.length;++l){var c=t[l],h=u[l]=new Ln;if(Array.isArray(c)||e(c)||Z(c)){var p=o.create(c,In,!1,!0);h.buffer=o.getBuffer(p),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,r.buffers.push(p)}else o.getBuffer(c)?(h.buffer=o.getBuffer(c),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(c.buffer)?(h.buffer=o.getBuffer(c.buffer),h.size=0|(+c.size||h.buffer.dimension),h.normalized=!!c.normalized||!1,"type"in c?(C.parameter(c.type,$,"invalid buffer type"),h.type=$[c.type]):h.type=h.buffer.dtype,h.offset=0|(c.offset||0),h.stride=0|(c.stride||0),h.divisor=0|(c.divisor||0),h.state=1,C(h.size>=1&&h.size<=4,"size must be between 1 and 4"),C(h.offset>=0,"invalid offset"),C(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),C(h.divisor>=0,"divisor must be positive"),C(!h.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in c?(C(l>0,"first attribute must not be a constant"),h.x=+c.x||0,h.y=+c.y||0,h.z=+c.z||0,h.w=+c.w||0,h.state=2):C(!1,"invalid attribute spec for location "+l)}return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:p()?function(e){if(e!==h.currentVAO){var t=p();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),h.currentVAO=e}}:function(e){if(e!==h.currentVAO){if(e)e.bindAttrs();else for(var n=f(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}h.currentVAO=e}},clear:p()?function(){q(c).forEach((function(e){e.destroy()}))}:function(){}};function p(){return n.oes_vertex_array_object}function f(){return n.angle_instanced_arrays}function d(){this.id=++l,this.attributes=[];var e=p();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=f(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(In,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},d.prototype.refresh=function(){var e=p();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=p();this===h.currentVAO&&(h.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},h}(i,p,y,h,_),b=function(t,n,r,i){var o={},a=0,s={uint8:me,uint16:ye};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=de,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=xe),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var p=c;c||e(o)&&(!Z(o)||e(o.data))||(p=n.oes_element_index_uint?xe:ye),r._initBuffer(i.buffer,o,a,p,3)}else t.bufferData(be,l,a),i.buffer.dtype=h||me,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case me:case ve:h=me;break;case ye:case ge:h=ye;break;case xe:case _e:h=xe;break;default:C.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,C(h!==xe||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=u;f<0&&(f=i.buffer.byteLength,h===ye?f>>=1:h===xe&&(f>>=2)),i.vertCount=f;var d=s;if(s<0){d=de;var v=i.buffer.dimension;1===v&&(d=pe),2===v&&(d=fe),3===v&&(d=de)}i.primType=d}function h(e){i.elementsCount--,C(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,be,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=de,a.vertCount=0|t,a.type=me;else{var n=null,r=we,i=-1,u=-1,h=0,p=0;Array.isArray(t)||e(t)||Z(t)?n=t:(C.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,C(Array.isArray(n)||e(n)||Z(n),"invalid data for element buffer")),"usage"in t&&(C.parameter(t.usage,ee,"invalid element buffer usage"),r=ee[t.usage]),"primitive"in t&&(C.parameter(t.primitive,he,"invalid element buffer primitive"),i=he[t.primitive]),"count"in t&&(C("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(C.parameter(t.type,s,"invalid buffer type"),p=s[t.type]),"length"in t?h=0|t.length:(h=u,p===ye||p===ge?h*=2:p!==xe&&p!==_e||(h*=4))),c(a,n,r,i,u,h,p)}else o(),a.primType=de,a.vertCount=0,a.type=me;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){h(a)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,be,!0,!1)._buffer)),c(t,e,Ee,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){q(o).forEach(h)}}}(i,p,_,h),E=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(n,r,a){var s=n===Pn?i:o,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),C.shaderError(e,u,l,n,a),s[r]=u}return u}var l={},c=[],h=0;function p(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function f(n,i,o){var l,c,h=u(Pn,n.fragId),p=u(On,n.vertId),f=n.program=e.createProgram();if(e.attachShader(f,h),e.attachShader(f,p),o)for(l=0;l<o.length;++l){var d=o[l];e.bindAttribLocation(f,d[0],d[1])}e.linkProgram(f),C.linkError(e,f,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(f,Dn);r.profile&&(n.stats.uniformsCount=v);var m=n.uniforms;for(l=0;l<v;++l)if(c=e.getActiveUniform(f,l))if(c.size>1)for(var g=0;g<c.size;++g){var y=c.name.replace("[0]","["+g+"]");s(m,new a(y,t.id(y),e.getUniformLocation(f,y),c))}else s(m,new a(c.name,t.id(c.name),e.getUniformLocation(f,c.name),c));var _=e.getProgramParameter(f,Nn);r.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(l=0;l<_;++l)(c=e.getActiveAttrib(f,l))&&s(x,new a(c.name,t.id(c.name),e.getAttribLocation(f,c.name),c))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return c.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return c.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);q(i).forEach(t),i={},q(o).forEach(t),o={},c.forEach((function(t){e.deleteProgram(t.program)})),c.length=0,l={},n.shaderCount=0},program:function(e,t,r,i){C.command(e>=0,"missing vertex shader",r),C.command(t>=0,"missing fragment shader",r);var o=l[t];o||(o=l[t]={});var a=o[e];if(a&&!i)return a;var s=new p(t,e);return n.shaderCount++,f(s,r,i),a||(o[e]=s),c.push(s),s},restore:function(){i={},o={};for(var e=0;e<c.length;++e)f(c[e],null,c[e].attributes.map((function(e){return[e.location,e.name]})))},shader:u,frag:-1,vert:-1}}(i,c,h,r),w=sn(i,p,y,(function(){A.procs.poll()}),g,h,r),S=function(e,t,n,r,i){var o={rgba4:ln,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=ln,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;C(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(un,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var c=new l(e.createRenderbuffer());function h(t,r){var s=0,u=0,l=ln;if("object"==typeof t&&t){var p=t;if("shape"in p){var f=p.shape;C(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape"),s=0|f[0],u=0|f[1]}else"radius"in p&&(s=u=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(u=0|p.height);"format"in p&&(C.parameter(p.format,o,"invalid renderbuffer format"),l=o[p.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?C.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(C(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,e.bindRenderbuffer(un,c.renderbuffer),e.renderbufferStorage(un,l,s,u),C(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=hn(c.format,c.width,c.height)),h.format=a[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===c.width&&a===c.height||(C(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,e.bindRenderbuffer(un,c.renderbuffer),e.renderbufferStorage(un,c.format,o,a),C(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=hn(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){q(u).forEach(c)},restore:function(){q(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(un,t.renderbuffer),e.renderbufferStorage(un,t.format,t.width,t.height)})),e.bindRenderbuffer(un,null)}}}(i,p,y,h,r),T=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&l.push("srgba"),n.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function f(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);C(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;C(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(pn,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(pn,t,fn,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=dn,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),C.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,C(t===dn)):"textureCube"===o?(n=i,C(t>=vn&&t<vn+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=fn):C.raise("invalid regl object for attachment"),new h(t,n,r)}function m(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new h(dn,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(fn,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var _=0,x={};function b(){this.id=_++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function E(e){e.colorAttachments.forEach(p),p(e.depthAttachment),p(e.stencilAttachment),p(e.depthStencilAttachment)}function w(t){var n=t.framebuffer;C(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete x[t.id]}function S(t){var n;e.bindFramebuffer(pn,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(mn+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(pn,mn+n,dn,null,0);e.framebufferTexture2D(pn,_n,dn,null,0),e.framebufferTexture2D(pn,gn,dn,null,0),e.framebufferTexture2D(pn,yn,dn,null,0),d(gn,t.depthAttachment),d(yn,t.stencilAttachment),d(_n,t.depthStencilAttachment);var o=e.checkFramebufferStatus(pn);e.isContextLost()||o===xn||C.raise("framebuffer configuration not supported, status = "+Mn[o]),e.bindFramebuffer(pn,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function T(e,i){var o=new b;function h(e,t){var i;C(s.next!==o,"can not update framebuffer which is currently in use");var a=0,p=0,d=!0,y=!0,_=null,x=!0,b="rgba",w="uint8",T=1,A=null,R=null,M=null,k=!1;if("number"==typeof e)a=0|e,p=0|t||a;else if(e){C.type(e,"object","invalid arguments for framebuffer");var I=e;if("shape"in I){var L=I.shape;C(Array.isArray(L)&&L.length>=2,"invalid shape for framebuffer"),a=L[0],p=L[1]}else"radius"in I&&(a=p=I.radius),"width"in I&&(a=I.width),"height"in I&&(p=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&C(1===_.length||n.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(T=0|I.colorCount,C(T>0,"invalid color buffer count")),"colorTexture"in I&&(x=!!I.colorTexture,b="rgba4"),"colorType"in I&&(w=I.colorType,x?(C(n.oes_texture_float||!("float"===w||"float32"===w),"you must enable OES_texture_float in order to use floating point framebuffer objects"),C(n.oes_texture_half_float||!("half float"===w||"float16"===w),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===w||"float16"===w?(C(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==w&&"float32"!==w||(C(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),C.oneOf(w,c,"invalid color type")),"colorFormat"in I&&(b=I.colorFormat,u.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:x?C.oneOf(I.colorFormat,u,"invalid color format for texture"):C.oneOf(I.colorFormat,l,"invalid color format for renderbuffer"))),("depthTexture"in I||"depthStencilTexture"in I)&&(k=!(!I.depthTexture&&!I.depthStencilTexture),C(!k||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(A=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(R=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=y=I.depthStencil:(M=I.depthStencil,d=!1,y=!1))}else a=p=1;var P=null,O=null,D=null,N=null;if(Array.isArray(_))P=_.map(v);else if(_)P=[v(_)];else for(P=new Array(T),i=0;i<T;++i)P[i]=m(a,p,x,b,w);C(n.webgl_draw_buffers||P.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),C(P.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||P[0].width,p=p||P[0].height,A?O=v(A):d&&!y&&(O=m(a,p,k,"depth","uint32")),R?D=v(R):y&&!d&&(D=m(a,p,!1,"stencil","uint8")),M?N=v(M):!A&&!R&&y&&d&&(N=m(a,p,k,"depth stencil","depth stencil")),C(!!A+!!R+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<P.length;++i)if(f(P[i],a,p),C(!P[i]||P[i].texture&&En.indexOf(P[i].texture._texture.format)>=0||P[i].renderbuffer&&Rn.indexOf(P[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),P[i]&&P[i].texture){var B=wn[P[i].texture._texture.format]*Sn[P[i].texture._texture.type];null===F?F=B:C(F===B,"all color attachments much have the same number of bits per pixel.")}return f(O,a,p),C(!O||O.texture&&O.texture._texture.format===bn||O.renderbuffer&&O.renderbuffer._renderbuffer.format===Tn,"invalid depth attachment for framebuffer object"),f(D,a,p),C(!D||D.renderbuffer&&D.renderbuffer._renderbuffer.format===An,"invalid stencil attachment for framebuffer object"),f(N,a,p),C(!N||N.texture&&N.texture._texture.format===Cn||N.renderbuffer&&N.renderbuffer._renderbuffer.format===Cn,"invalid depth-stencil attachment for framebuffer object"),E(o),o.width=a,o.height=p,o.colorAttachments=P,o.depthAttachment=O,o.stencilAttachment=D,o.depthStencilAttachment=N,h.color=P.map(g),h.depth=g(O),h.stencil=g(D),h.depthStencil=g(N),h.width=o.width,h.height=o.height,S(o),h}return a.framebufferCount++,h(e,i),t(h,{resize:function(e,t){C(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,S(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){w(o),E(o)},use:function(e){s.setFBO({framebuffer:h},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof b)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;C(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},p=0,f=null,d="rgba",v="uint8",m=1;if("number"==typeof e)p=0|e;else if(e){C.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;C(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),C(y[0]===y[1],"cube framebuffer must be square"),p=y[0]}else"radius"in g&&(p=0|g.radius),"width"in g?(p=0|g.width,"height"in g&&C(g.height===p,"must be square")):"height"in g&&(p=0|g.height);("color"in g||"colors"in g)&&(f=g.color||g.colors,Array.isArray(f)&&C(1===f.length||n.webgl_draw_buffers,"multiple render targets not supported")),f||("colorCount"in g&&(m=0|g.colorCount,C(m>0,"invalid color buffer count")),"colorType"in g&&(C.oneOf(g.colorType,c,"invalid color type"),v=g.colorType),"colorFormat"in g&&(d=g.colorFormat,C.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(h.depth=g.depth),"stencil"in g&&(h.stencil=g.stencil),"depthStencil"in g&&(h.depthStencil=g.depthStencil)}else p=1;if(f)if(Array.isArray(f))for(l=[],r=0;r<f.length;++r)l[r]=f[r];else l=[f];else{l=Array(m);var _={radius:p,format:d,type:v};for(r=0;r<m;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var x=l[r];C("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),p=p||x.width,C(x.width===p&&x.height===p,"invalid cube map shape"),h.color[r]={target:vn,data:l[r]}}for(r=0;r<6;++r){for(var b=0;b<l.length;++b)h.color[b].target=vn+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=T(h)}return t(a,{width:p,height:p,color:l})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(C(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){q(x).forEach(w)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,q(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),S(t)}))}})}(i,p,y,w,S,h),A=Ki(i,c,p,y,_,b,0,T,{},x,E,{elements:null,primitive:4,count:-1,offset:0,instances:-1},g,f,r),R=jn(i,T,A.procs.poll,g,o,p,y),M=A.next,k=i.canvas,I=[],L=[],N=[],F=[r.onDestroy],z=null;function U(){if(0===I.length)return f&&f.update(),void(z=null);z=O.next(U),Re();for(var e=I.length-1;e>=0;--e){var t=I[e];t&&t(g,null,0)}i.flush(),f&&f.update()}function j(){!z&&I.length>0&&(z=O.next(U))}function Y(){z&&(O.cancel(U),z=null)}function K(e){e.preventDefault(),a=!0,Y(),L.forEach((function(e){e()}))}function Q(e){i.getError(),a=!1,s.restore(),E.restore(),_.restore(),w.restore(),S.restore(),T.restore(),x.restore(),f&&f.restore(),A.procs.refresh(),j(),N.forEach((function(e){e()}))}function J(e){function n(e){var t={},n={};return Object.keys(e).forEach((function(r){var i=e[r];P.isDynamic(i)?n[r]=P.unbox(i,r):t[r]=i})),{dynamic:n,static:t}}C(!!e,"invalid args to regl({...})"),C.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e)),u={gpuTime:0,cpuTime:0,count:0},l=A.compile(s,o,i,r,u),c=l.draw,h=l.batch,p=l.scope,f=[];return t((function(e,t){var n;if(a&&C.raise("context lost"),"function"==typeof e)return p.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)p.call(this,null,t,n);else{if(!Array.isArray(e))return p.call(this,e,t,0);for(n=0;n<e.length;++n)p.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;f.length<e;)f.push(null);return f}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u})}k&&(k.addEventListener(Ji,K,!1),k.addEventListener($i,Q,!1));var Se=T.setFBO=J({framebuffer:P.define.call(null,1,"framebuffer")});function Te(e,t){var n=0;A.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),C(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function Ae(e){return C.type(e,"function","regl.frame() callback must be a function"),I.push(e),j(),{cancel:function(){var t=eo(I,e);C(t>=0,"cannot cancel a frame twice"),I[t]=function e(){var t=eo(I,e);I[t]=I[I.length-1],I.length-=1,I.length<=0&&Y()}}}}function Ce(){var e=M.viewport,t=M.scissor_box;e[0]=e[1]=t[0]=t[1]=0,g.viewportWidth=g.framebufferWidth=g.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,g.viewportHeight=g.framebufferHeight=g.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function Re(){g.tick+=1,g.time=ke(),Ce(),A.procs.poll()}function Me(){Ce(),A.procs.refresh(),f&&f.update()}function ke(){return(D()-d)/1e3}Me();var Ie=t(J,{clear:function(e){if(C("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)Se(t({framebuffer:e.framebuffer.faces[n]},e),Te);else Se(e,Te);else Te(0,e)},prop:P.define.bind(null,1),context:P.define.bind(null,2),this:P.define.bind(null,3),draw:J({}),buffer:function(e){return _.create(e,34962,!1,!1)},elements:function(e){return b.create(e,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:S.create,framebuffer:T.create,framebufferCube:T.createCube,vao:x.createVAO,attributes:o,frame:Ae,on:function(e,t){var n;switch(C.type(t,"function","listener callback must be a function"),e){case"frame":return Ae(t);case"lost":n=L;break;case"restore":n=N;break;case"destroy":n=F;break;default:C.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(e){return y.extensions.indexOf(e.toLowerCase())>=0},read:R,destroy:function(){I.length=0,Y(),k&&(k.removeEventListener(Ji,K),k.removeEventListener($i,Q)),E.clear(),T.clear(),S.clear(),w.clear(),b.clear(),_.clear(),x.clear(),f&&f.clear(),F.forEach((function(e){e()}))},_gl:i,_refresh:Me,poll:function(){Re(),f&&f.update()},now:ke,stats:h});return r.onDone(null,Ie),Ie}}()},9059:function(e){e.exports=function(){"use strict";function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;t(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1);t(e,r,i,Math.max(o,Math.floor(i-l*h/u+p)),Math.min(a,Math.floor(i+(u-l)*h/u+p)),s)}var f=r[2*i+s],d=o,v=a;for(n(e,r,o,i),r[2*a+s]>f&&n(e,r,o,a);d<v;){for(n(e,r,d,v),d++,v--;r[2*d+s]<f;)d++;for(;r[2*v+s]>f;)v--}r[2*o+s]===f?n(e,r,o,v):n(e,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var o=function(e){return e[0]},a=function(e){return e[1]},s=function(t,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),h=0;h<t.length;h++)l[h]=h,c[2*h]=n(t[h]),c[2*h+1]=r(t[h]);e(l,c,i,0,l.length-1,0)};s.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((f+p)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},s.prototype.within=function(e,t,n){return function(e,t,n,r,o,a){for(var s=[0,e.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),h=s.pop(),p=s.pop();if(h-p<=a)for(var f=p;f<=h;f++)i(t[2*f],t[2*f+1],n,r)<=l&&u.push(e[f]);else{var d=Math.floor((p+h)/2),v=t[2*d],m=t[2*d+1];i(v,m,n,r)<=l&&u.push(e[d]);var g=(c+1)%2;(0===c?n-o<=v:r-o<=m)&&(s.push(p),s.push(d-1),s.push(g)),(0===c?n+o>=v:r+o>=m)&&(s.push(d+1),s.push(h),s.push(g))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},c=Math.fround||(u=new Float32Array(1),function(e){return u[0]=+e,u[0]}),h=function(e){this.options=y(Object.create(l),e),this.trees=new Array(this.options.maxZoom+1)};function p(e,t,n,r,i){return{x:c(e),y:c(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function f(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:c(m(r)),y:c(g(i)),zoom:1/0,index:t,parentId:-1}}function d(e){return{type:"Feature",id:e.id,properties:v(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function v(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return y(y({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function m(e){return e/360+.5}function g(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function y(e,t){for(var n in t)e[n]=t[n];return e}function _(e){return e.x}function x(e){return e.y}return h.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var a="prepare "+e.length+" points";n&&console.time(a),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(f(e[l],l));this.trees[i+1]=new s(u,_,x,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var h=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,x,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},h.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,h=u.range(m(n),g(o),m(i),g(r));c<h.length;c+=1){var p=h[c],f=u.points[p];l.push(f.numPoints?d(f):this.points[f.index])}return l},h.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===e&&s.push(h.numPoints?d(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},h.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},h.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},h.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},h.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},h.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c=void 0,h=void 0,p=void 0;if(l)c=v(u),h=u.x,p=u.y;else{var f=this.points[u.index];c=f.properties,h=m(f.geometry.coordinates[0]),p=g(f.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(p*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(d.id=y),o.features.push(d)}},h.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},h.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),l=0;l<e.length;l++){var c=e[l];if(!(c.zoom<=t)){c.zoom=t;for(var h=this.trees[t+1],f=h.within(c.x,c.y,u),d=c.numPoints||1,v=d,m=0,g=f;m<g.length;m+=1){var y=g[m],_=h.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var x=c.x*d,b=c.y*d,E=a&&d>1?this._map(c,!0):null,w=(l<<5)+(t+1)+this.points.length,S=0,T=f;S<T.length;S+=1){var A=T[S],C=h.points[A];if(!(C.zoom<=t)){C.zoom=t;var R=C.numPoints||1;x+=C.x*R,b+=C.y*R,C.parentId=w,a&&(E||(E=this._map(c,!0)),a(E,this._map(C)))}}c.parentId=w,n.push(p(x/v,b/v,w,v,E))}else if(n.push(c),v>1)for(var M=0,k=f;M<k.length;M+=1){var I=k[M],L=h.points[I];L.zoom<=t||(L.zoom=t,n.push(L))}}}return n},h.prototype._getOriginId=function(e){return e-this.points.length>>5},h.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},h.prototype._map=function(e,t){if(e.numPoints)return t?y({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?y({},r):r},h}()},9787:t=>{"use strict";t.exports=e},6853:(e,t,n)=>{var r=n(9264).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},l=u.iterator||"@@iterator",c=u.asyncIterator||"@@asyncIterator",h=u.toStringTag||"@@toStringTag";function p(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var i=t&&t.prototype instanceof x?t:x,o=Object.create(i.prototype),a=new P(r||[]);return s(o,"_invoke",{value:M(e,n,a)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var v="suspendedStart",m="suspendedYield",g="executing",y="completed",_={};function x(){}function b(){}function E(){}var w={};p(w,l,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(O([])));T&&T!==o&&a.call(T,l)&&(w=T);var A=E.prototype=x.prototype=Object.create(w);function C(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(i,o,s,u){var l=d(e[i],e,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function M(e,n,r){var i=v;return function(o,a){if(i===g)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=k(s,r);if(u){if(u===_)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var l=d(e,n,r);if("normal"===l.type){if(i=r.done?y:m,l.arg===_)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=y,r.method="throw",r.arg=l.arg)}}}function k(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,k(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),_;var o=d(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,_;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,_):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function O(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=E,s(A,"constructor",{value:E,configurable:!0}),s(E,"constructor",{value:b,configurable:!0}),b.displayName=p(E,h,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,p(e,h,"GeneratorFunction")),e.prototype=Object.create(A),e},n.awrap=function(e){return{__await:e}},C(R.prototype),p(R.prototype,c,(function(){return this})),n.AsyncIterator=R,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new R(f(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(A),p(A,h,"Generator"),p(A,l,(function(){return this})),p(A,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=O,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,_):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;L(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),_}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},9264:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4823:(e,t,n)=>{var r=n(6853)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var i={};return(()=>{"use strict";r.r(i),r.d(i,{AreaMap:()=>VD,ChoroplethMap:()=>iN,DotMap:()=>OO,FlowMap:()=>kD,GeographicHeatmap:()=>HO,GridMap:()=>eD,HexbinMap:()=>cD,PathMap:()=>ED,registerFontFace:()=>l,registerIconFont:()=>p,registerIconFonts:()=>f,registerImage:()=>o,registerImages:()=>a,unregisterFontFace:()=>c,unregisterIconFont:()=>d,unregisterImage:()=>s});var e={};r.r(e),r.d(e,{add:()=>Ba,adjoint:()=>ra,clone:()=>Ko,copy:()=>Qo,create:()=>Yo,determinant:()=>ia,equals:()=>Va,exactEquals:()=>Ga,frob:()=>Fa,fromQuat:()=>Ta,fromQuat2:()=>_a,fromRotation:()=>da,fromRotationTranslation:()=>ya,fromRotationTranslationScale:()=>wa,fromRotationTranslationScaleOrigin:()=>Sa,fromScaling:()=>fa,fromTranslation:()=>pa,fromValues:()=>Jo,fromXRotation:()=>va,fromYRotation:()=>ma,fromZRotation:()=>ga,frustum:()=>Aa,getRotation:()=>Ea,getScaling:()=>ba,getTranslation:()=>xa,identity:()=>ea,invert:()=>na,lookAt:()=>Oa,mul:()=>Xa,multiply:()=>oa,multiplyScalar:()=>Ua,multiplyScalarAndAdd:()=>ja,ortho:()=>La,orthoNO:()=>Ia,orthoZO:()=>Pa,perspective:()=>Ra,perspectiveFromFieldOfView:()=>ka,perspectiveNO:()=>Ca,perspectiveZO:()=>Ma,rotate:()=>ua,rotateX:()=>la,rotateY:()=>ca,rotateZ:()=>ha,scale:()=>sa,set:()=>$o,str:()=>Na,sub:()=>Za,subtract:()=>za,targetTo:()=>Da,translate:()=>aa,transpose:()=>ta});var t={};r.r(t),r.d(t,{add:()=>Df,angle:()=>cd,bezier:()=>nd,ceil:()=>zf,clone:()=>kf,copy:()=>Pf,create:()=>Mf,cross:()=>$f,dist:()=>_d,distance:()=>Xf,div:()=>yd,divide:()=>Bf,dot:()=>Jf,equals:()=>dd,exactEquals:()=>fd,floor:()=>Uf,forEach:()=>wd,fromValues:()=>Lf,hermite:()=>td,inverse:()=>Kf,len:()=>bd,length:()=>If,lerp:()=>ed,max:()=>Gf,min:()=>jf,mul:()=>gd,multiply:()=>Ff,negate:()=>Yf,normalize:()=>Qf,random:()=>rd,rotateX:()=>sd,rotateY:()=>ud,rotateZ:()=>ld,round:()=>Vf,scale:()=>Hf,scaleAndAdd:()=>Wf,set:()=>Of,sqrDist:()=>xd,sqrLen:()=>Ed,squaredDistance:()=>Zf,squaredLength:()=>qf,str:()=>pd,sub:()=>md,subtract:()=>Nf,transformMat3:()=>od,transformMat4:()=>id,transformQuat:()=>ad,zero:()=>hd});var n=new Map;function o(e,t){n.set(e,t)}function a(e){e.forEach((function(e){n.set(e.id,e.image)}))}function s(e){return n.delete(e)}var u=new Map;function l(e,t){u.set(e,t)}function c(e){return u.delete(e)}var h=new Map;function p(e,t){h.set(e,t)}function f(e){e.forEach((function(e){h.set(e.name,e.fontUnicode)}))}function d(e){return h.delete(e)}function v(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var m=r(9787),g=r.n(m),y=function(e,t){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},y(e,t)};function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var x=function(){return x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},x.apply(this,arguments)};function b(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function E(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function w(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function S(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function T(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function A(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var C={}.toString;const R=function(e,t){return C.call(e)==="[object "+t+"]"},M=function(e){return R(e,"Function")},k=function(e){return Array.isArray?Array.isArray(e):R(e,"Array")},I=function(e){var t=typeof e;return null!==e&&"object"===t||"function"===t},L=function(e,t){if(e)if(k(e))for(var n=0,r=e.length;n<r&&!1!==t(e[n],n);n++);else if(I(e))for(var i in e)if(e.hasOwnProperty(i)&&!1===t(e[i],i))break};Object.keys;const P=function(e){return"object"==typeof e&&null!==e},O=function(e){if(!P(e)||!R(e,"Object"))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t};var D=Array.prototype;D.splice,D.indexOf,Array.prototype.splice;const N=function(e){return R(e,"String")};Object.prototype.hasOwnProperty;Number.isInteger&&Number.isInteger,Math.PI,Math.PI;Object.values;const F=function(e,t){return e&&t?e.replace(/\\?\{([^{}]+)\}/g,(function(e,n){return"\\"===e.charAt(0)?e.slice(1):void 0===t[n]?"":t[n]})):e},B=function(e){return R(e,"Boolean")};Object.prototype;const z=function(e){return void 0===e},U=function e(t){if("object"!=typeof t||null===t)return t;var n;if(k(t)){n=[];for(var r=0,i=t.length;r<i;r++)"object"==typeof t[r]&&null!=t[r]?n[r]=e(t[r]):n[r]=t[r]}else for(var o in n={},t)"object"==typeof t[o]&&null!=t[o]?n[o]=e(t[o]):n[o]=t[o];return n};function j(e,t,n,r){for(var i in n=n||0,r=r||5,t)if(t.hasOwnProperty(i)){var o=t[i];null!==o&&O(o)?(O(e[i])||(e[i]={}),n<r?j(e[i],o,n+1,r):e[i]=t[i]):k(o)?(e[i]=[],e[i]=e[i].concat(o)):void 0!==o&&(e[i]=o)}}const G=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r+=1)j(e,t[r]);return e};Object.prototype.hasOwnProperty;const V=function(e){return null!==e&&"function"!=typeof e&&isFinite(e.length)},H=function e(t,n){if(t===n)return!0;if(!t||!n)return!1;if(N(t)||N(n))return!1;if(V(t)||V(n)){if(t.length!==n.length)return!1;for(var r=!0,i=0;i<t.length&&(r=e(t[i],n[i]));i++);return r}if(P(t)||P(n)){var o=Object.keys(t),a=Object.keys(n);if(o.length!==a.length)return!1;for(r=!0,i=0;i<o.length&&(r=e(t[o[i]],n[o[i]]));i++);return r}return!1};var W=Object.prototype.hasOwnProperty;const X=function(e,t){if(null===e||!O(e))return{};var n={};return L(t,(function(t){W.call(e,t)&&(n[t]=e[t])})),n};var Z={};const q=function(e){return Z[e=e||"g"]?Z[e]+=1:Z[e]=1,e+Z[e]};var Y;!function(e,t){if(!M(e))throw new TypeError("Expected a function");new Map}((function(e,t){void 0===t&&(t={});var n=t.fontSize,r=t.fontFamily,i=t.fontWeight,o=t.fontStyle,a=t.fontVariant;return Y||(Y=document.createElement("canvas").getContext("2d")),Y.font=[o,a,i,n+"px",r].join(" "),Y.measureText(N(e)?e:"").width})),function(){function e(){this.map={}}e.prototype.has=function(e){return void 0!==this.map[e]},e.prototype.get=function(e,t){var n=this.map[e];return void 0===n?t:n},e.prototype.set=function(e,t){this.map[e]=t},e.prototype.clear=function(){this.map={}},e.prototype.delete=function(e){delete this.map[e]},e.prototype.size=function(){return Object.keys(this.map).length}}();var K={},Q={},J=function(e){return Q[e]},$=function(e,t){Q[e]=t},ee=function(e,t){K[e]=t},te={},ne={};function re(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function ie(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function oe(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}var ae=function(e){var t=new RegExp('[",\n\r]'),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,u=o<=0,l=!1;function c(){if(u)return ne;if(l)return l=!1,te;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?u=!0:10===(r=e.charCodeAt(a++))?l=!0:13===r&&(l=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))l=!0;else if(13===r)l=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=c())!==ne;){for(var h=[];r!==te&&r!==ne;)h.push(r),r=c();t&&null==(h=t(h,s++))||i.push(h)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?function(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+oe(-e,6):e>9999?"+"+oe(e,6):oe(e,4)}(e.getUTCFullYear())+"-"+oe(e.getUTCMonth()+1,2)+"-"+oe(e.getUTCDate(),2)+(i?"T"+oe(t,2)+":"+oe(n,2)+":"+oe(r,2)+"."+oe(i,3)+"Z":r?"T"+oe(t,2)+":"+oe(n,2)+":"+oe(r,2)+"Z":n||t?"T"+oe(t,2)+":"+oe(n,2)+"Z":"")}(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=re(e);return function(r,i){return t(n(r),i,e)}}(e,t):re(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=ie(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=ie(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(","),se=ae.parse;function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function le(e){var t=function(e,t){if("object"!==ue(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ue(t)?t:String(t)}function ce(e,t,n){return(t=le(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){ce(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ae.parseRows,ae.format,ae.formatBody,ae.formatRows,ae.formatRow,ae.formatValue;var fe=6371008.8,de={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*fe,kilometers:6371.0088,kilometres:6371.0088,meters:fe,metres:fe,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:fe/1852,radians:1,yards:6967335.223679999};function ve(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function me(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return ve({type:"Polygon",coordinates:e},t,n)}function ge(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return ve({type:"LineString",coordinates:e},t,n)}function ye(e){return e%360*Math.PI/180}function _e(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function xe(e){return"Feature"===e.type?e.geometry:e}function be(e,t,n){if(null!==e)for(var r,i,o,a,s,u,l,c,h=0,p=0,f=e.type,d="FeatureCollection"===f,v="Feature"===f,m=d?e.features.length:1,g=0;g<m;g++){s=(c=!!(l=d?e.features[g].geometry:v?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var y=0;y<s;y++){var _=0,x=0;if(null!==(a=c?l.geometries[y]:l)){u=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===t(u,p,g,_,x))return!1;p++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===t(u[r],p,g,_,x))return!1;p++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===t(u[r][i],p,g,_,x))return!1;p++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(x=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===t(u[r][i][o],p,g,_,x))return!1;p++}x++}_++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===be(a.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ee(e,t){!function(e,t){var n,r,i,o,a,s,u,l,c,h,p=0,f="FeatureCollection"===e.type,d="Feature"===e.type,v=f?e.features.length:1;for(n=0;n<v;n++){for(s=f?e.features[n].geometry:d?e.geometry:e,l=f?e.features[n].properties:d?e.properties:{},c=f?e.features[n].bbox:d?e.bbox:void 0,h=f?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,l,c,h))return!1;p++}}(e,(function(e,n,r,i,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(ve(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l=e.coordinates[u];if(!1===t(ve({type:a,coordinates:l},r),n,u))return!1}}))}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,le(r.key),r)}}function Se(e,t,n){return t&&we(e.prototype,t),n&&we(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ae(e,t)}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ae(e,t)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t){if(t&&("object"===ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Re(e)}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}function Ie(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Le(e,t,n){return Le=Ie()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Ae(i,n.prototype),i},Le.apply(null,arguments)}function Pe(e){var t="function"==typeof Map?new Map:void 0;return Pe=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Le(e,arguments,ke(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ae(n,e)},Pe(e)}var Oe={REGISTERED_PROTOCOLS:{}};var De=function(e){return Oe.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]},Ne=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e,t,n,o){var a;return Te(this,i),(a=r.call(this,"AJAXError: ".concat(t," (").concat(e,"): ").concat(n))).status=e,a.statusText=t,a.url=n,a.body=o,a}return Se(i)}(Pe(Error));function Fe(e,t){var n=new XMLHttpRequest,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new Ne(n.status,n.statusText,r.toString(),o))}},n.cancel=n.abort,n.send(e.body),n}function Be(e){return new Promise((function(t,n){Fe(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function ze(e,t){return Fe(e,t)}var Ue=function(e,t){return(De(e.url)||ze)(pe(pe({},e),{},{type:"arrayBuffer"}),t)},je=function(e,t){return ze(pe(pe({},e),{},{method:"GET"}),t)},Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ve(e,t){var n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=Ge}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):Ge}function He(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var We=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?He(o,t):Ve(o,t)}};return"json"===e.type?function(e,t){return(De(e.url)||ze)(pe(pe({},e),{},{type:"json"}),t)}(e,r):Ue(e,r)},Xe=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Ze={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qe(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ye(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ke(){}var Qe=.7,Je=1/Qe,$e="\\s*([+-]?\\d+)\\s*",et="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",tt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nt=/^#([0-9a-f]{3,8})$/,rt=new RegExp("^rgb\\("+[$e,$e,$e]+"\\)$"),it=new RegExp("^rgb\\("+[tt,tt,tt]+"\\)$"),ot=new RegExp("^rgba\\("+[$e,$e,$e,et]+"\\)$"),at=new RegExp("^rgba\\("+[tt,tt,tt,et]+"\\)$"),st=new RegExp("^hsl\\("+[et,tt,tt]+"\\)$"),ut=new RegExp("^hsla\\("+[et,tt,tt,et]+"\\)$"),lt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ct(){return this.rgb().formatHex()}function ht(){return this.rgb().formatRgb()}function pt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=nt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ft(t):3===n?new mt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?dt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?dt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=rt.exec(e))?new mt(t[1],t[2],t[3],1):(t=it.exec(e))?new mt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ot.exec(e))?dt(t[1],t[2],t[3],t[4]):(t=at.exec(e))?dt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=st.exec(e))?xt(t[1],t[2]/100,t[3]/100,1):(t=ut.exec(e))?xt(t[1],t[2]/100,t[3]/100,t[4]):lt.hasOwnProperty(e)?ft(lt[e]):"transparent"===e?new mt(NaN,NaN,NaN,0):null}function ft(e){return new mt(e>>16&255,e>>8&255,255&e,1)}function dt(e,t,n,r){return r<=0&&(e=t=n=NaN),new mt(e,t,n,r)}function vt(e,t,n,r){return 1===arguments.length?((i=e)instanceof Ke||(i=pt(i)),i?new mt((i=i.rgb()).r,i.g,i.b,i.opacity):new mt):new mt(e,t,n,null==r?1:r);var i}function mt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function gt(){return"#"+_t(this.r)+_t(this.g)+_t(this.b)}function yt(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function _t(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function xt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Et(e,t,n,r)}function bt(e){if(e instanceof Et)return new Et(e.h,e.s,e.l,e.opacity);if(e instanceof Ke||(e=pt(e)),!e)return new Et;if(e instanceof Et)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Et(a,s,u,e.opacity)}function Et(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function wt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function St(e){var t=pt(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function Tt(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function At(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ct(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1}}function Rt(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function Mt(e){return"cat"===e.type?[0,255]:[0,1]}qe(Ke,pt,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:ct,formatHex:ct,formatHsl:function(){return bt(this).formatHsl()},formatRgb:ht,toString:ht}),qe(mt,vt,Ye(Ke,{brighter:function(e){return e=null==e?Je:Math.pow(Je,e),new mt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Qe:Math.pow(Qe,e),new mt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gt,formatHex:gt,formatRgb:yt,toString:yt})),qe(Et,(function(e,t,n,r){return 1===arguments.length?bt(e):new Et(e,t,n,null==r?1:r)}),Ye(Ke,{brighter:function(e){return e=null==e?Je:Math.pow(Je,e),new Et(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Qe:Math.pow(Qe,e),new Et(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new mt(wt(e>=240?e-240:e+120,i,r),wt(e,i,r),wt(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));function kt(e){switch(e){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return 1029;default:return 1028}}function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lt(e,t){if(e){if("string"==typeof e)return It(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?It(e,t):void 0}}function Pt(e){return function(e){if(Array.isArray(e))return It(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Lt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||Lt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Dt=r(4552),Nt=r.n(Dt),Ft=r(2803),Bt=r.n(Ft),zt=r(2837),Ut=r.n(zt),jt=r(5399),Gt=r.n(jt),Vt=r(676),Ht=r.n(Vt),Wt=r(4409),Xt=r.n(Wt),Zt=r(9673),qt=r.n(Zt),Yt=r(7307),Kt=r.n(Yt),Qt=r(6416),Jt=r.n(Qt),$t=r(7405),en=r.n($t),tn=r(4778),nn=r.n(tn),rn=r(3013),on=r.n(rn),an=r(1685),sn=r.n(an),un=r(4573),ln=r.n(un),cn=r(9871),hn=r.n(cn),pn=r(8174),fn=r.n(pn),dn=r(9411),vn=r.n(dn),mn=r(6001),gn=r.n(mn),yn=r(7276),_n=r.n(yn),xn=r(9484),bn=r.n(xn),En=r(1676),wn=r.n(En),Sn={isNil:qt(),merge:on(),throttle:hn(),isString:en(),debounce:Ut(),pull:ln(),isTypedArray:nn(),isPlainObject:Jt(),isNumber:Kt(),isBoolean:Ht(),isEqual:Xt(),cloneDeep:Bt(),uniq:fn(),clamp:Nt(),upperFirst:vn(),get:Gt(),mergeWith:sn(),isFunction:gn(),isObject:_n(),isUndefined:bn(),camelCase:wn()};function Tn(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function An(e){return Tn(e).split(/\s+/)}function Cn(e,t,n){var r=window.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function Rn(e){var t=e.parentNode;t&&t.removeChild(e)}function Mn(e,t){if(void 0!==e.classList)for(var n=An(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!function(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Ln(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}(e,t)){var o=Ln(e);In(e,(o?o+" ":"")+t)}}function kn(e,t){void 0!==e.classList?An(t).forEach((function(t){e.classList.remove(t)})):In(e,Tn((" "+Ln(e)+" ").replace(" "+t+" "," ")))}function In(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Ln(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}Sn.pull;var Pn,On=function(e){var t,n=null===(t=document)||void 0===t||null===(t=t.documentElement)||void 0===t?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}(["transform","WebkitTransform"]),Dn=function(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){return"initial-scale"===Ot(e.split("="),1)[0]}));return n?1*n.split("=")[1]:1}()<1?1:window.devicePixelRatio;function Nn(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function Fn(e){e.innerHTML=""}var Bn=null===(Pn=navigator)||void 0===Pn?void 0:Pn.userAgent;function zn(e){var t=[1/0,1/0,-1/0,-1/0];return be(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}Bn.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Bn.indexOf("Android")>-1||Bn.indexOf("Adr"),zn.default=zn;const Un=zn;function jn(e){return"number"==typeof e}var Gn=2*Math.PI*6378137/2;function Vn(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;Hn(t,n)})),t}function Hn(e,t){return Array.isArray(t[0])?t.forEach((function(t){Hn(e,t)})):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function Wn(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1};e=function(e,t){if(!1===t)return e;var n=function(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}(e[0]),r=function(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}(e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]);var n=e[0],r=e[1],i=n*Gn/180,o=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return o=o*Gn/180,t.enable&&(i=Number(i.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),3===e.length?[i,o,e[2]]:[i,o]}function Xn(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function Zn(e,t){var n=85.0511287798,r=Math.PI/180,i=6378137;return t=Math.max(Math.min(n,t),-n),t*=r,[(e*=r)*i,(t=Math.log(Math.tan(Math.PI/4+t/2)))*i]}function qn(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function Yn(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Kn(e){return[[e[0],e[1]],[e[2],e[3]]]}function Qn(e){if(jn(e[0]))return e;if(jn(e[0][0]))throw new Error("当前数据不支持标注");if(jn(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}var Jn=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),$n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;Te(this,e),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return Se(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function er(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}var tr={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return er(e)/e.length},sum:er,mode:function(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}};function nr(e,t){return e.map((function(e){return e[t]}))}function rr(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ir(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){rr(o,r,i,a,s,"next",e)}function s(e){rr(o,r,i,a,s,"throw",e)}a(void 0)}))}}var or,ar=r(4823),sr=r.n(ar),ur=r(3024),lr=r.n(ur),cr=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),hr=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({});function pr(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function fr(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:fr(e)}))}var dr=[-1/0,-1/0,1/0,1/0],vr=(ce(or={},cr.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),ce(or,cr.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!pr(e)&&fr(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),ce(or,cr.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&pr(e)}));var t=e.slice().sort((function(e,t){return e.z-t.z}));t.forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&fr(e)}))})),or),mr=function(){};function gr(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function yr(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var _r=function(e,t,n){var r=Ot(yr(e,t,n),2),i=r[0],o=r[1],a=Ot(yr(e+1,t+1,n),2),s=a[0];return[i,a[1],s,o]},xr=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=e;return r&&(o<0?o+=i:o>i-1&&(o%=i)),{warpX:o,warpY:t}};var br=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(e){var t;Te(this,o),ce(Re(t=i.call(this)),"tileSize",256),ce(Re(t),"isVisible",!1),ce(Re(t),"isCurrent",!1),ce(Re(t),"isVisibleChange",!1),ce(Re(t),"loadedLayers",0),ce(Re(t),"isLayerLoaded",!1),ce(Re(t),"isLoad",!1),ce(Re(t),"isChildLoad",!1),ce(Re(t),"parent",null),ce(Re(t),"children",[]),ce(Re(t),"data",null),ce(Re(t),"properties",{}),ce(Re(t),"loadDataId",0);var n=e.x,r=e.y,a=e.z,s=e.tileSize,u=e.warp,l=void 0===u||u;return t.x=n,t.y=r,t.z=a,t.warp=l||!0,t.tileSize=s,t}return Se(o,[{key:"isLoading",get:function(){return this.loadStatus===hr.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===hr.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===hr.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===hr.Cancelled}},{key:"isDone",get:function(){return[hr.Loaded,hr.Cancelled,hr.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return _r(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=Ot(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2],i=function(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return me([[a,[i,r],[i,o],[n,o],a]],t.properties,{bbox:e,id:t.id})}(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}});return i}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(t=ir(sr().mark((function e(t){var n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,g,y;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=hr.Loading,a=null,e.prev=7,u=this.x,l=this.y,c=this.z,h=this.bounds,p=this.tileSize,f=this.warp,d=xr(u,l,c,f),v=d.warpX,m=d.warpY,g=this.abortController.signal,y={x:v,y:m,z:c,bounds:h,tileSize:p,signal:g,warp:f},e.next=14,n(y,this);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0;case 20:if(o===this.loadDataId){e.next=22;break}return e.abrupt("return");case 22:if(!this.isCancelled||a){e.next=24;break}return e.abrupt("return");case 24:if(!s&&a){e.next=28;break}return this.loadStatus=hr.Failure,i(s,this),e.abrupt("return");case 28:this.loadStatus=hr.Loaded,this.data=a,r(this);case 31:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(e){return t.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=hr.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),o}(ur.EventEmitter);function Er(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return wr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Sr=Sn.throttle,Tr=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Ar=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t;return Te(this,i),ce(Re(t=r.call(this)),"currentTiles",[]),ce(Re(t),"cacheTiles",new Map),ce(Re(t),"throttleUpdate",Sr((function(e,n){t.update(e,n)}),16)),ce(Re(t),"onTileLoad",(function(e){t.emit(Tr.TileLoaded,e),t.updateTileVisible(),t.loadFinished()})),ce(Re(t),"onTileError",(function(e,n){t.emit(Tr.TileError,{error:e,tile:n}),t.updateTileVisible(),t.loadFinished()})),ce(Re(t),"onTileUnload",(function(e){t.emit(Tr.TileUnload,e),t.loadFinished()})),t.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:dr,getTileData:mr,warp:!0,updateStrategy:cr.Replace},t.updateOptions(e),t}return Se(i,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){var e=Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}));return e}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=pe(pe(pe({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.max(0,Math.ceil(e));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return Yn(Kn(e),Kn(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=qn(Kn(e),.2),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(t);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(e){return n.options.warp||e.x>=0&&e.x<Math.pow(2,r)}));this.emit(Tr.TilesLoadStart),this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=Er(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=Ot(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=Er(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;)t.shift().abortLoad()}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=gr(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=Er(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=Er(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=Er(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):vr[t](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,l=!0):e.isVisibleChange=!1})),l&&this.emit(Tr.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset,a=function(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,l=e.extent,c=void 0===l?dr:l,h=Math.ceil(t)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var p=Ot(n,4),f=p[0],d=p[1],v=p[2],m=p[3],g=[Math.max(f,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(m,c[3])],y=[],_=Ot(gr(g[0],g[1],h),2),x=_[0],b=_[1],E=Ot(gr(g[2],g[3],h),2),w=E[0],S=E[1],T=x;T<=w;T++)for(var A=S;A<=b;A++)y.push({x:T,y:A,z:h});var C=(w+x)/2,R=(b+S)/2,M=function(e,t){return Math.abs(e-C)+Math.abs(t-R)};return y.sort((function(e,t){return M(e.x,e.y)-M(t.x,t.y)})),y}({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i});return a}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(Tr.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new br({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=Er(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=Ot(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=Er(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=Er(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),i}(lr());function Cr(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=function(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}(e),a=Math.abs(n+r)%o.length;return(De(o[a])?"".concat(o[a],"/{z}/{x}/{y}"):o[a]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,_r(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function Rr(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,l=void 0===u?"default":u,c=t.format,h=t.service,p=void 0===h?"WMTS":h,f=t.tileMatrixset;return"".concat(e,"&SERVICE=").concat(p,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(f,"&FORMAT=").concat(c,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function Mr(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document;var kr="undefined"!=typeof window&&void 0!==window.orientation,Ir=function(){function e(e,t){var n=this;this.name=e,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return e.prototype.postMessage=function(e,t){this.workerThread.postMessage({source:"Main thread",type:e,payload:t})},e.prototype.done=function(e){Mr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(e)},e.prototype.error=function(e){Mr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(e)},e}();const Lr=Ir;var Pr=new Map;function Or(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Dr(e,t,n){void 0===t&&(t=!0);var r=n||new Set;if(e)if(Nr(e))r.add(e);else if(Nr(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(var i in e)Dr(e[i],t,r);return void 0===n?Array.from(r):[]}function Nr(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}var Fr=function(){},Br=function(){function e(e){this.terminated=!1,this.loadableURL="";var t=e.name,n=e.source,r=e.url;Mr(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Fr,this.onError=function(e){return console.log(e)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return"undefined"!=typeof Worker},e.prototype.destroy=function(){this.onMessage=Fr,this.onError=Fr,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){t=t||Dr(e),this.worker.postMessage(e,t)},e.prototype.getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",e.message&&(t+=e.message+" in "),e.lineno&&(t+=":"+e.lineno+":"+e.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var e=this;this.loadableURL=function(e){Mr(e.source&&!e.url||!e.source&&e.url);var t,n=Pr.get(e.source||e.url);return n||(e.url&&(n=(t=e.url).startsWith("http")?Or("try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"):t,Pr.set(e.url,n)),e.source&&(n=Or(e.source),Pr.set(e.source,n))),Mr(n),n}({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e.getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(t){return console.error("worker "+e.name+", message error: "+t)},t},e}();const zr=Br;var Ur=function(){return Ur=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ur.apply(this,arguments)},jr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Gr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Vr=function(){function e(e){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}return e.prototype.destroy=function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0},e.prototype.setProps=function(e){this.props=Ur(Ur({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},e.prototype.startJob=function(e,t,n){return void 0===t&&(t=function(e,t,n){return e.done(n)}),void 0===n&&(n=function(e,t){return e.error(t)}),jr(this,void 0,void 0,(function(){var r,i=this;return Gr(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},e.prototype.startQueuedJob=function(){return jr(this,void 0,void 0,(function(){var e,t,n;return Gr(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(e=this.getAvailableWorker()))return[2];if(!(t=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:e}),n=new Lr(t.name,e),e.onMessage=function(e){return t.onMessage(n,e.type,e.payload)},e.onError=function(e){return t.onError(n,e)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(e),[7];case 4:return[2]}}))}))},e.prototype.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var e=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new zr({name:e,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return kr?this.maxMobileConcurrency:this.maxConcurrency},e}();const Hr=Vr;var Wr=function(){return Wr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Wr.apply(this,arguments)},Xr=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Zr={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0};!function(){function e(e){this.workerPools=new Map,this.props=Wr({},Zr),this.setProps(e),this.workerPools=new Map}e.isSupported=function(){return zr.isSupported()},e.getWorkerFarm=function(t){return void 0===t&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var e,t;try{for(var n=Xr(this.workerPools.values()),r=n.next();!r.done;r=n.next())r.value.destroy()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setProps=function(e){var t,n;this.props=Wr(Wr({},this.props),e);try{for(var r=Xr(this.workerPools.values()),i=r.next();!i.done;i=r.next())i.value.setProps(this.getWorkerPoolProps())}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new Hr({name:t,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(t,i)),i},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}();var qr=new Map;function Yr(e){var t=e.type,n=e.data;return"message"===t&&n&&"string"==typeof n.source&&"Main thread"===n.source}function Kr(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}function Qr(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function Jr(e){return e.filter?[1]:[0]}function $r(e,t){return[t]}!function(){function e(){}Object.defineProperty(e,"onmessage",{set:function(e){self.onmessage=function(t){if(Yr(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(e){var t=qr.get(e);t||(t=function(t){if(Yr(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}),self.addEventListener("message",t)},e.removeEventListener=function(e){var t=qr.get(e);qr.delete(e),self.removeEventListener("message",t)},e.postMessage=function(e,t){if(self){var n={source:"Worker thread",type:e,payload:t},r=Dr(t);self.postMessage(n,r)}}}(),function(){function e(){this._values=[],this._settlers=[],this._closed=!1}e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(e){return this.enqueue(e)},e.prototype.enqueue=function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)},e.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},e.prototype.next=function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,n){e._settlers.push({resolve:t,reject:n})}))}}();var ei=r(1034),ti=r.n(ei),ni=1e-6,ri="undefined"!=typeof Float32Array?Float32Array:Array,ii=Math.random;function oi(){var e=new ri(2);return ri!=Float32Array&&(e[0]=0,e[1]=0),e}function ai(e,t){var n=new ri(2);return n[0]=e,n[1]=t,n}function si(e,t){return e[0]=t[0],e[1]=t[1],e}function ui(e,t,n){return e[0]=t,e[1]=n,e}function li(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ci(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function hi(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function pi(e,t){return e[0]*t[0]+e[1]*t[1]}Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var fi=ci,di=(oi(),oi()),vi=(oi(),oi()),mi=oi(),gi=oi();function yi(e,t,n,r,i){return li(e,n,r),hi(e,e),[i/pi(t=ai(-e[1],e[0]),ai(-n[1],n[0])),t]}function _i(e,t){return ui(e,-t[1],t[0])}function xi(e,t,n){return fi(e,t,n),hi(e,e),e}function bi(e,t){return e[0]===t[0]&&e[1]===t[1]}var Ei=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Te(this,e),ce(this,"lastFlip",-1),ce(this,"miter",ai(0,0)),ce(this,"started",!1),ce(this,"dash",!1),ce(this,"totalDistance",0),ce(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Se(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var p=t[o],f=o<e.length-1?[].concat(Pt(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var p=t[o],f=o<e.length-1?[].concat(Pt(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,l=e.indices,c=e.positions,h=e.normals,p="square"===this.cap,f="bevel"===this.join,d=Xn([a[0],a[1]]),v=Xn([o[0],o[1]]);xi(vi,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=oi(),_i(this.normal,vi)),!this.started)if(this.started=!0,p){var g=oi(),y=oi();li(g,this.normal,vi),li(y,this.normal,vi),h.push(y[0],y[1],0),h.push(g[0],g[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(t+0,t+1,t+2),i){bi(r,i)&&li(i,r,hi(i,ci(i,r,n))),xi(mi,i,r);var _=Ot(yi(gi,oi(),vi,mi,this.thickness),2),x=_[0],b=_[1],E=pi(gi,this.normal)<0?-1:1,w=f;w||"miter"!==this.join||x>this.miterLimit&&(w=!0),w?(h.push(this.normal[0],this.normal[1],0),h.push(b[0],b[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,Pt(this.lastFlip!==-E?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),_i(di,mi),si(this.normal,di),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,b,x,this.totalDistance),l.push.apply(l,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),E=-1,si(this.normal,b),u+=2),this.lastFlip=E}else{if(_i(this.normal,vi),p){var S=oi(),T=oi();fi(T,vi,this.normal),li(S,vi,this.normal),h.push(T[0],T[1],0),h.push(S[0],S[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l=Xn([r[0],r[1]]),c=Xn([n[0],n[1]]);xi(vi,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=oi(),_i(this.normal,vi)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var p=Xn([i[0],i[1]]);bi(l,p)&&li(p,l,hi(p,ci(p,l,c))),xi(mi,p,l);var f=Ot(yi(gi,oi(),vi,mi,this.thickness),2),d=f[0],v=f[1];pi(gi,this.normal),this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),si(this.normal,v),o+=2,this.lastFlip=-1}else _i(this.normal,vi),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,h=Xn([r[0],r[1]]),p=Xn([n[0],n[1]]);xi(vi,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=oi(),_i(this.normal,vi)),!this.started)if(this.started=!0,l){var d=oi(),v=oi();li(d,this.normal,vi),li(v,this.normal,vi),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(t+0,t+1,t+2),i){var m=Xn([i[0],i[1]]);bi(h,m)&&li(m,h,hi(m,ci(m,h,p))),xi(mi,m,h);var g=Ot(yi(gi,oi(),vi,mi,this.thickness),2),y=g[0],_=g[1],x=pi(gi,this.normal)<0?-1:1,b=c;b||"miter"!==this.join||y>this.miterLimit&&(b=!0),b?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,Pt(this.lastFlip!==-x?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),_i(di,mi),si(this.normal,di),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),x=-1,si(this.normal,_),o+=2),this.lastFlip=x}else{if(_i(this.normal,vi),l){var E=oi(),w=oi();fi(w,vi,this.normal),li(E,vi,this.normal),u.push(w[0],w[1],0),u.push(E[0],E[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function wi(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new Ei({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function Si(e){var t=Qn(e.coordinates);return{vertices:[].concat(Pt(t),Pt(t),Pt(t),Pt(t)),indices:[0,1,2,2,3,0],size:t.length}}function Ti(e){var t=e.coordinates,n=ti().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ti()(r,o,i),vertices:r,size:i}}var Ai=function(){var e=ir(sr().mark((function e(t){var n,r,i,o,a,s,u,l,c;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.iconMap,a={a_Color:Kr,a_Position:Qr,filter:Jr,a_vertexId:$r,a_PickingColor:function(e){var t=e.id;return i?At(t):[0,0,0]},a_DistanceAndIndex:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(e,t,n){return[n[5]]},a_Size:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(e,t,n,r,i){return i},a_Miter:function(e,t,n){return[n[4]]},a_iconMapUV:function(e){var t=e.texture,n=o[t]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=wi(e),i=r.indices,o=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(e){l.push(e+u)})),c=p;var d=o.length/p;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*p,r*p+p),u=0;f&&void 0!==f[r]&&(u=f[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,Pt(a[n.name](e,t,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ci=function(){var e=ir(sr().mark((function e(t){var n,r,i,o,a,s,u,l,c;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.shape2d,a={a_Color:Kr,a_Position:Qr,filter:Jr,a_vertexId:$r,a_PickingColor:function(e){var t=e.id;return i?At(t):[0,0,0]},a_Shape:function(e){var t=e.shape,n=void 0===t?2:t;return[o.indexOf(n)]},a_Extrude:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=Si(e),i=r.indices,o=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(e){l.push(e+u)})),c=p;var d=o.length/p;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*p,r*p+p),u=0;f&&void 0!==f[r]&&(u=f[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,Pt(a[n.name](e,t,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ri=function(){var e=ir(sr().mark((function e(t){var n,r,i,o,a,s,u,l;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o={a_Color:Kr,a_Position:Qr,filter:Jr,a_vertexId:$r,a_PickingColor:function(e){var t=e.id;return i?At(t):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],l=3,r.forEach((function(e,t){var r=Ti(e),i=r.indices,c=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(e){u.push(e+s)})),l=p;var d=c.length/p;a.sizePerElement=l,a.elements.push({featureIdx:t,vertices:c,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],a=c.slice(r*p,r*p+p),s=0;f&&void 0!==f[r]&&(s=f[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,Pt(o[n.name](e,t,a,r,i,s)))}))},m=0;m<d;m++)v(m)})),e.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();pe({},{pointFill:Ci,line:Ai,polygonFill:Ri}),new Map;var Mi=r(1584),ki=r.n(Mi);function Ii(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Li(e){var t=Object.isFrozen(e)?Sn.cloneDeep(e):e;return ki()(t,!0),t}function Pi(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){Ee(Li(e[s]),(function(n){var r=_e(n),i=pe(pe({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],h=[];if(a){var p="Polygon";Array.isArray(a[0])||(p="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(p="LineString"),h=Li({type:p,coordinates:c[a]}).coordinates}else n&&r&&i&&o?h=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]:n&&r&&(h=[parseFloat(c[n]),parseFloat(c[r])]);var f=pe(pe({},c),{},{_id:l,coordinates:h});u.push(f)}return{dataArray:u}}function Oi(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],p=t+3;p<n;p+=3){var f=Di(e[p],e[p+1],u,l,c,h);if(f>o)i=p,o=f;else if(f===o){var d=Math.abs(p-a);d<s&&(i=p,s=d)}}o>r&&(i-t>3&&Oi(e,t,i,r),e[i+2]=o,n-i>3&&Oi(e,i,n,r))}function Di(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function Ni(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Fi(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)Fi(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)Fi(e,t[r][i])}(i),i}function Fi(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function Bi(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)zi(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)zi(i[l],s);else if("LineString"===o)Ui(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],Ui(i[l],s,a,!1),e.push(Ni(u,"LineString",s,t.properties));return}ji(i,s,a,!1)}else if("Polygon"===o)ji(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)Bi(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];ji(i[l],c,a,!0),s.push(c)}}e.push(Ni(u,o,s,t.properties))}}function zi(e,t){t.push(Gi(e[0])),t.push(Vi(e[1])),t.push(0)}function Ui(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=Gi(e[s][0]),l=Vi(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,Oi(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function ji(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];Ui(e[i],o,n,r),t.push(o)}}function Gi(e){return e/360+.5}function Vi(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function Hi(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===p||"MultiPoint"===p)Wi(h,v,n,r,i);else if("LineString"===p)Xi(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)qi(h,v,n,r,i,!1);else if("Polygon"===p)qi(h,v,n,r,i,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var g=[];qi(h[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push(Ni(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(Ni(c.id,p,v,c.tags))}}}return u.length?u:null}function Wi(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function Xi(e,t,n,r,i,o,a){for(var s,u,l=Zi(e),c=0===i?Ki:Qi,h=e.start,p=0;p<e.length-3;p+=3){var f=e[p],d=e[p+1],v=e[p+2],m=e[p+3],g=e[p+4],y=0===i?f:d,_=0===i?m:g,x=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=c(l,f,d,m,g,n),a&&(l.start=h+s*u)):y>r?_<r&&(u=c(l,f,d,m,g,r),a&&(l.start=h+s*u)):Yi(l,f,d,v),_<n&&y>=n&&(u=c(l,f,d,m,g,n),x=!0),_>r&&y<=r&&(u=c(l,f,d,m,g,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),t.push(l),l=Zi(e)),a&&(h+=s)}var b=e.length-3;f=e[b],d=e[b+1],v=e[b+2],(y=0===i?f:d)>=n&&y<=r&&Yi(l,f,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&Yi(l,l[0],l[1],l[2]),l.length&&t.push(l)}function Zi(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function qi(e,t,n,r,i,o){for(var a=0;a<e.length;a++)Xi(e[a],t,n,r,i,o,!1)}function Yi(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Ki(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Qi(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function Ji(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=$i(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push($i(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push($i(o.geometry[s][l],t));i.push(u)}n.push(Ni(o.id,a,i,o.tags))}return n}function $i(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function eo(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(to(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(to(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function to(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function no(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,ro(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function ro(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)io(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)io(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)io(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(p.id=t.id),e.features.push(p)}}function io(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function oo(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)Bi(n,e.features[r],t,r);else"Feature"===e.type?Bi(n,e,t):Bi(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=Hi(e,1,-1-n,n,0,-1,2,t),o=Hi(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=Hi(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=Ji(i,1).concat(r)),o&&(r=r.concat(Ji(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ao(e,t,n){return 32*((1<<e)*n+t)+e}oo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oo.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=ao(t,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=no(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==e.length){l>1&&console.time("clipping");var v,m,g,y,_,x,b=.5*u.buffer/u.extent,E=.5-b,w=.5+b,S=1+b;v=m=g=y=null,_=Hi(e,c,n-b,n+w,0,p.minX,p.maxX,u),x=Hi(e,c,n+E,n+S,0,p.minX,p.maxX,u),e=null,_&&(v=Hi(_,c,r-b,r+w,1,p.minY,p.maxY,u),m=Hi(_,c,r+E,r+S,1,p.minY,p.maxY,u),_=null),x&&(g=Hi(x,c,r-b,r+w,1,p.minY,p.maxY,u),y=Hi(x,c,r+E,r+S,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(m||[],t+1,2*n,2*r+1),s.push(g||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},oo.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=ao(e,t=(t%a+a)%a,n);if(this.tiles[s])return eo(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[ao(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?eo(this.tiles[s],i):null):null};var so=function(){function e(t,n,r,i){Te(this,e),ce(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return Se(e,[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),uo={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function lo(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var co=["Unknown","Point","LineString","Polygon"];function ho(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,h=e*Math.pow(2,r),p=e*t,f=e*n,d=co[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+f)/h,i=360*(n[0]+p)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var m=[];for(o=0;o<s.length;o++)m[o]=s[o][0];v(s=m);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=lo(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var po=function(){var e=ir(sr().mark((function e(t,n,r,i){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return ho(i,r.x,r.y,r.z,e)})):[];e(new so({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var fo=function(){var e=ir(sr().mark((function e(t,n,r,i){var o,a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={x:n.x,y:n.y,z:n.z},a=Cr(t,o),e.abrupt("return",new Promise((function(e){i?i(o,(function(t,r){if(t||!r){var i=new so({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o={layers:{defaultLayer:{features:r.features}}},a=new so(o,n.x,n.y,n.z);e(a)}})):je(pe(pe({},r),{},{url:a}),(function(t,r){if(t||!r){var i=new so({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o=JSON.parse(r),a=new so({layers:{defaultLayer:{features:o}}},n.x,n.y,n.z);e(a)}}))})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),vo=r(59),mo=r(9471),go=r.n(mo),yo=function(){function e(t,n,r,i){Te(this,e),ce(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new vo.VectorTile(new(go())(t))}return Se(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(pe(pe({},i),{},{properties:pe({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),_o={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},xo=function(){var e=ir(sr().mark((function e(t,n,r,i,o){var a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Cr(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new yo(n,r.x,r.y,r.z);e(i)}}));else{var t=Ue(pe(pe({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new yo(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.cancel()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function bo(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),l=0;l<a;l++){var c=JSON.parse(u),h=Eo(c,o,l);if("number"==typeof h)s.push(h);else{var p=wo(c);s.push(p)}}return s}function Eo(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}else Eo(r,t,n)}))}function wo(e){var t=function(e){var t=Ot(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=wo(e[1])),Array.isArray(i)&&(i=wo(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var So={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=Ot((null==t?void 0:t.countCut)||[2,98],2),s=a[0],u=a[1],l=(null==t?void 0:t.RMinMax)||To(n,s,u),c=(null==t?void 0:t.GMinMax)||To(r,s,u),h=(null==t?void 0:t.BMinMax)||To(i,s,u),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-l[0])),o.push(Math.max(0,r[p]-c[0])),o.push(Math.max(0,i[p]-h[0]));return{rasterData:o,rMinMax:l,gMinMax:c,bMinMax:h}}}};function To(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function Ao(e,t,n){return Co.apply(this,arguments)}function Co(){return Co=ir(sr().mark((function e(t,n,r){var i,o,a,s,u,l;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,Pt(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=ue(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return l=r(o),e.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:bo(r,o)}:Ro(r,o),e.abrupt("break",16);case 15:l={rasterData:o[0].rasterData};case 16:return e.abrupt("return",pe(pe({},l),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)}))),Co.apply(this,arguments)}function Ro(e,t){var n=So[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){return void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!"),[bo(e.r||["band",0],t),bo(e.g||["band",0],t),bo(e.b||["band",0],t)]}(n.expression,t):{rasterData:bo(n.expression,t)}:void 0}function Mo(e,t,n,r){return ko.apply(this,arguments)}function ko(){return ko=ir(sr().mark((function e(t,n,r,i){var o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ao(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)}))),ko.apply(this,arguments)}r(858);var Io,Lo=r(7758),Po=r(4746),Oo={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Do=r(4320),No=r.n(Do);function Fo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zo(e,t,n){var r,i=Fo(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=pe(pe({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function Uo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function jo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Go(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Go(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vo=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function Ho(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function Wo(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var Xo,Zo=(0,Lo.b2)()(Io=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"fontAtlas",void 0),ce(Re(e),"iconFontMap",void 0),ce(Re(e),"iconFontGlyphs",{}),ce(Re(e),"fontOptions",void 0),ce(Re(e),"key",void 0),ce(Re(e),"cache",new $n(3)),e}return Se(i,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:Vo,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=pe(pe({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,p=n&&n.data;p||((p=window.document.createElement("canvas")).width=1024);var f=p.getContext("2d",{willReadFrequently:!0});Ho(f,i,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,h=void 0===c?0:c,p=0,f=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);f+30>o&&(f=0,p++),s[e]={x:f,y:h+30*p,width:30,height:30,advance:r},f+=30}}));var d=r+2*i;return{mapping:s,xOffset:f,yOffset:h+p*d,canvasHeight:Uo(h+(p+1)*d)}}(pe({getFontWidth:function(e){return f.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),v=d.mapping,m=d.canvasHeight,g=d.xOffset,y=d.yOffset,_=f.getImageData(0,0,p.width,p.height);if(p.height=m,f.putImageData(_,0,0),Ho(f,i,a,o),u){var x,b=new(No())(a,s,l,c,i,o),E=f.getImageData(0,0,b.size,b.size),w=jo(t);try{for(w.s();!(x=w.n()).done;){var S=x.value;if(h){var T=String.fromCharCode(parseInt(S.replace("&#x","").replace(";",""),16));Wo(b.draw(T),E)}else Wo(b.draw(S),E);f.putImageData(E,v[S].x,v[S].y)}}catch(e){w.e(e)}finally{w.f()}}else{var A,C=jo(t);try{for(C.s();!(A=C.n()).done;){var R=A.value;f.fillText(R,v[R].x,v[R].y+1*a)}}catch(e){C.e(e)}finally{C.f()}}return{xOffset:g,yOffset:y,mapping:v,data:p,width:p.width,height:p.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),i}(ur.EventEmitter))||Io;var qo=(0,Lo.b2)()(Xo=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"canvasHeight",128),ce(Re(e),"texture",void 0),ce(Re(e),"canvas",void 0),ce(Re(e),"iconData",void 0),ce(Re(e),"iconMap",void 0),ce(Re(e),"ctx",void 0),ce(Re(e),"loadingImageCount",0),e}return Se(o,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(t=ir(sr().mark((function e(t,n){var r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,p=s/c;o&&e.ctx.drawImage(o,r+(64-p)/2,i+(64-h)/2,p,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},l=Fo(e);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+3>1024&&(zo(u,s,o),i=0,o=a+o+3,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+3,a=Math.max(a,h)}}}catch(e){l.e(e)}finally{l.f()}return s.length>0&&zo(u,s,o),{mapping:u,canvasHeight:Uo(a+o+3)}}(this.iconData),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),o}(ur.EventEmitter))||Xo;function Yo(){var e=new ri(16);return ri!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ko(e){var t=new ri(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Jo(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m=new ri(16);return m[0]=e,m[1]=t,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=l,m[10]=c,m[11]=h,m[12]=p,m[13]=f,m[14]=d,m[15]=v,m}function $o(e,t,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=p,e[12]=f,e[13]=d,e[14]=v,e[15]=m,e}function ea(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ta(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function na(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,E=r*l-o*s,w=i*l-o*u,S=c*v-h*d,T=c*m-p*d,A=c*g-f*d,C=h*m-p*v,R=h*g-f*v,M=p*g-f*m,k=y*M-_*R+x*C+b*A-E*T+w*S;return k?(k=1/k,e[0]=(s*M-u*R+l*C)*k,e[1]=(i*R-r*M-o*C)*k,e[2]=(v*w-m*E+g*b)*k,e[3]=(p*E-h*w-f*b)*k,e[4]=(u*A-a*M-l*T)*k,e[5]=(n*M-i*A+o*T)*k,e[6]=(m*x-d*w-g*_)*k,e[7]=(c*w-p*x+f*_)*k,e[8]=(a*R-s*A+l*S)*k,e[9]=(r*A-n*R-o*S)*k,e[10]=(d*E-v*x+g*y)*k,e[11]=(h*x-c*E-f*y)*k,e[12]=(s*T-a*C-u*S)*k,e[13]=(n*C-r*T+i*S)*k,e[14]=(v*_-d*b-m*y)*k,e[15]=(c*b-h*_+p*y)*k,e):null}function ra(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=s*(p*g-f*m)-h*(u*g-l*m)+v*(u*f-l*p),e[1]=-(r*(p*g-f*m)-h*(i*g-o*m)+v*(i*f-o*p)),e[2]=r*(u*g-l*m)-s*(i*g-o*m)+v*(i*l-o*u),e[3]=-(r*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),e[4]=-(a*(p*g-f*m)-c*(u*g-l*m)+d*(u*f-l*p)),e[5]=n*(p*g-f*m)-c*(i*g-o*m)+d*(i*f-o*p),e[6]=-(n*(u*g-l*m)-a*(i*g-o*m)+d*(i*l-o*u)),e[7]=n*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),e[8]=a*(h*g-f*v)-c*(s*g-l*v)+d*(s*f-l*h),e[9]=-(n*(h*g-f*v)-c*(r*g-o*v)+d*(r*f-o*h)),e[10]=n*(s*g-l*v)-a*(r*g-o*v)+d*(r*l-o*s),e[11]=-(n*(s*f-l*h)-a*(r*f-o*h)+c*(r*l-o*s)),e[12]=-(a*(h*m-p*v)-c*(s*m-u*v)+d*(s*p-u*h)),e[13]=n*(h*m-p*v)-c*(r*m-i*v)+d*(r*p-i*h),e[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),e[15]=n*(s*p-u*h)-a*(r*p-i*h)+c*(r*u-i*s),e}function ia(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11],f=e[12],d=e[13],v=e[14],m=e[15];return(t*a-n*o)*(h*m-p*v)-(t*s-r*o)*(c*m-p*d)+(t*u-i*o)*(c*v-h*d)+(n*s-r*a)*(l*m-p*f)-(n*u-i*a)*(l*v-h*f)+(r*u-i*s)*(l*d-c*f)}function oa(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],_=n[0],x=n[1],b=n[2],E=n[3];return e[0]=_*r+x*s+b*h+E*v,e[1]=_*i+x*u+b*p+E*m,e[2]=_*o+x*l+b*f+E*g,e[3]=_*a+x*c+b*d+E*y,_=n[4],x=n[5],b=n[6],E=n[7],e[4]=_*r+x*s+b*h+E*v,e[5]=_*i+x*u+b*p+E*m,e[6]=_*o+x*l+b*f+E*g,e[7]=_*a+x*c+b*d+E*y,_=n[8],x=n[9],b=n[10],E=n[11],e[8]=_*r+x*s+b*h+E*v,e[9]=_*i+x*u+b*p+E*m,e[10]=_*o+x*l+b*f+E*g,e[11]=_*a+x*c+b*d+E*y,_=n[12],x=n[13],b=n[14],E=n[15],e[12]=_*r+x*s+b*h+E*v,e[13]=_*i+x*u+b*p+E*m,e[14]=_*o+x*l+b*f+E*g,e[15]=_*a+x*c+b*d+E*y,e}function aa(e,t,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],m=n[1],g=n[2];return t===e?(e[12]=t[0]*v+t[4]*m+t[8]*g+t[12],e[13]=t[1]*v+t[5]*m+t[9]*g+t[13],e[14]=t[2]*v+t[6]*m+t[10]*g+t[14],e[15]=t[3]*v+t[7]*m+t[11]*g+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=p,e[10]=f,e[11]=d,e[12]=r*v+s*m+h*g+t[12],e[13]=i*v+u*m+p*g+t[13],e[14]=o*v+l*m+f*g+t[14],e[15]=a*v+c*m+d*g+t[15]),e}function sa(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ua(e,t,n,r){var i,o,a,s,u,l,c,h,p,f,d,v,m,g,y,_,x,b,E,w,S,T,A,C,R=r[0],M=r[1],k=r[2],I=Math.hypot(R,M,k);return I<ni?null:(R*=I=1/I,M*=I,k*=I,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],d=t[7],v=t[8],m=t[9],g=t[10],y=t[11],_=R*R*a+o,x=M*R*a+k*i,b=k*R*a-M*i,E=R*M*a-k*i,w=M*M*a+o,S=k*M*a+R*i,T=R*k*a+M*i,A=M*k*a-R*i,C=k*k*a+o,e[0]=s*_+h*x+v*b,e[1]=u*_+p*x+m*b,e[2]=l*_+f*x+g*b,e[3]=c*_+d*x+y*b,e[4]=s*E+h*w+v*S,e[5]=u*E+p*w+m*S,e[6]=l*E+f*w+g*S,e[7]=c*E+d*w+y*S,e[8]=s*T+h*A+v*C,e[9]=u*T+p*A+m*C,e[10]=l*T+f*A+g*C,e[11]=c*T+d*A+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function la(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+h*r,e[7]=u*i+p*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=h*i-s*r,e[11]=p*i-u*r,e}function ca(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-h*r,e[3]=u*i-p*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+h*i,e[11]=u*r+p*i,e}function ha(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+h*r,e[3]=u*i+p*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=h*i-s*r,e[7]=p*i-u*r,e}function pa(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fa(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function da(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],l=Math.hypot(a,s,u);return l<ni?null:(a*=l=1/l,s*=l,u*=l,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function va(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ma(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ga(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ya(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,p=r*l,f=i*u,d=i*l,v=o*l,m=a*s,g=a*u,y=a*l;return e[0]=1-(f+v),e[1]=h+y,e[2]=p-g,e[3]=0,e[4]=h-y,e[5]=1-(c+v),e[6]=d+m,e[7]=0,e[8]=p+g,e[9]=d-m,e[10]=1-(c+f),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _a(e,t){var n=new ri(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+c*r+u*o-l*i)/h,n[1]=2*(u*a+c*i+l*r-s*o)/h,n[2]=2*(l*a+c*o+s*i-u*r)/h):(n[0]=2*(s*a+c*r+u*o-l*i),n[1]=2*(u*a+c*i+l*r-s*o),n[2]=2*(l*a+c*o+s*i-u*r)),ya(e,t,n),e}function xa(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ba(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,l,c),e}function Ea(e,t){var n=new ri(3);ba(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,l=t[4]*r,c=t[5]*i,h=t[6]*o,p=t[8]*r,f=t[9]*i,d=t[10]*o,v=a+c+d,m=0;return v>0?(m=2*Math.sqrt(v+1),e[3]=.25*m,e[0]=(h-f)/m,e[1]=(p-u)/m,e[2]=(s-l)/m):a>c&&a>d?(m=2*Math.sqrt(1+a-c-d),e[3]=(h-f)/m,e[0]=.25*m,e[1]=(s+l)/m,e[2]=(p+u)/m):c>d?(m=2*Math.sqrt(1+c-a-d),e[3]=(p-u)/m,e[0]=(s+l)/m,e[1]=.25*m,e[2]=(h+f)/m):(m=2*Math.sqrt(1+d-a-c),e[3]=(s-l)/m,e[0]=(p+u)/m,e[1]=(h+f)/m,e[2]=.25*m),e}function wa(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,v=o*c,m=a*c,g=s*u,y=s*l,_=s*c,x=r[0],b=r[1],E=r[2];return e[0]=(1-(d+m))*x,e[1]=(p+_)*x,e[2]=(f-y)*x,e[3]=0,e[4]=(p-_)*b,e[5]=(1-(h+m))*b,e[6]=(v+g)*b,e[7]=0,e[8]=(f+y)*E,e[9]=(v-g)*E,e[10]=(1-(h+d))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Sa(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,h=s+s,p=o*l,f=o*c,d=o*h,v=a*c,m=a*h,g=s*h,y=u*l,_=u*c,x=u*h,b=r[0],E=r[1],w=r[2],S=i[0],T=i[1],A=i[2],C=(1-(v+g))*b,R=(f+x)*b,M=(d-_)*b,k=(f-x)*E,I=(1-(p+g))*E,L=(m+y)*E,P=(d+_)*w,O=(m-y)*w,D=(1-(p+v))*w;return e[0]=C,e[1]=R,e[2]=M,e[3]=0,e[4]=k,e[5]=I,e[6]=L,e[7]=0,e[8]=P,e[9]=O,e[10]=D,e[11]=0,e[12]=n[0]+S-(C*S+k*T+P*A),e[13]=n[1]+T-(R*S+I*T+O*A),e[14]=n[2]+A-(M*S+L*T+D*A),e[15]=1,e}function Ta(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,p=i*a,f=i*s,d=i*u,v=o*a,m=o*s,g=o*u;return e[0]=1-h-d,e[1]=c+g,e[2]=p-m,e[3]=0,e[4]=c-g,e[5]=1-l-d,e[6]=f+v,e[7]=0,e[8]=p+m,e[9]=f-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Aa(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function Ca(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}var Ra=Ca;function Ma(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e}function ka(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Ia(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}var La=Ia;function Pa(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*l,e[15]=1,e}function Oa(e,t,n,r){var i,o,a,s,u,l,c,h,p,f,d=t[0],v=t[1],m=t[2],g=r[0],y=r[1],_=r[2],x=n[0],b=n[1],E=n[2];return Math.abs(d-x)<ni&&Math.abs(v-b)<ni&&Math.abs(m-E)<ni?ea(e):(c=d-x,h=v-b,p=m-E,i=y*(p*=f=1/Math.hypot(c,h,p))-_*(h*=f),o=_*(c*=f)-g*p,a=g*h-y*c,(f=Math.hypot(i,o,a))?(i*=f=1/f,o*=f,a*=f):(i=0,o=0,a=0),s=h*a-p*o,u=p*i-c*a,l=c*o-h*i,(f=Math.hypot(s,u,l))?(s*=f=1/f,u*=f,l*=f):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=l,e[10]=p,e[11]=0,e[12]=-(i*d+o*v+a*m),e[13]=-(s*d+u*v+l*m),e[14]=-(c*d+h*v+p*m),e[15]=1,e)}function Da(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],p=a-n[2],f=c*c+h*h+p*p;f>0&&(c*=f=1/Math.sqrt(f),h*=f,p*=f);var d=u*p-l*h,v=l*c-s*p,m=s*h-u*c;return(f=d*d+v*v+m*m)>0&&(d*=f=1/Math.sqrt(f),v*=f,m*=f),e[0]=d,e[1]=v,e[2]=m,e[3]=0,e[4]=h*m-p*v,e[5]=p*d-c*m,e[6]=c*v-h*d,e[7]=0,e[8]=c,e[9]=h,e[10]=p,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function Na(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Fa(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ba(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function za(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Ua(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function ja(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Ga(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Va(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=t[0],_=t[1],x=t[2],b=t[3],E=t[4],w=t[5],S=t[6],T=t[7],A=t[8],C=t[9],R=t[10],M=t[11],k=t[12],I=t[13],L=t[14],P=t[15];return Math.abs(n-y)<=ni*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=ni*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=ni*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=ni*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-E)<=ni*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-w)<=ni*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-S)<=ni*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-T)<=ni*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-A)<=ni*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-C)<=ni*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-R)<=ni*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-M)<=ni*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(d-k)<=ni*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(v-I)<=ni*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(m-L)<=ni*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-P)<=ni*Math.max(1,Math.abs(g),Math.abs(P))}var Ha,Wa,Xa=oa,Za=za,qa=(0,Lo.b2)()(Ha=function(){function e(){Te(this,e),ce(this,"viewport",void 0),ce(this,"overridedViewProjectionMatrix",void 0),ce(this,"jitteredViewProjectionMatrix",void 0),ce(this,"jitteredProjectionMatrix",void 0),ce(this,"viewMatrixInverse",void 0),ce(this,"cameraPosition",void 0)}return Se(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=Yo(),na(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=Ot(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=pa(Yo(),[e,t,0]);this.jitteredProjectionMatrix=oa(Yo(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=oa(Yo(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Ha,Ya=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({});function Ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Qa,Ja,$a={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},es=(0,Lo.b2)()(Wa=function(){function e(){Te(this,e),ce(this,"container",void 0),ce(this,"controlCorners",void 0),ce(this,"controlContainer",void 0),ce(this,"scene",void 0),ce(this,"mapsService",void 0),ce(this,"controls",[]),ce(this,"unAddControls",[])}return Se(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(Oo.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(Oo.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ka(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ka(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.controls);try{for(t.s();!(e=t.n()).done;)e.value.remove()}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t=this.controlContainer=Cn("div","l7-control-container",this.container);Object.values(Ya).forEach((function(n){var r,i;!function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=n.map((function(e){return"l7-"+e})).join(" ");e[n.filter((function(e){return!["row","column"].includes(e)})).join("")]=Cn("div",r,t)}((r=n,i=r.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(Pt(i),[$a[r]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&Rn(this.controlCorners[e]);this.controlContainer&&Rn(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=Ot(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=Ot(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),e}())||Wa,ts=(0,Lo.b2)()(Qa=function(){function e(){Te(this,e),ce(this,"container",void 0),ce(this,"scene",void 0),ce(this,"mapsService",void 0),ce(this,"markers",[]),ce(this,"markerLayers",[]),ce(this,"unAddMarkers",[]),ce(this,"unAddMarkerLayers",[])}return Se(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Oo.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||Qa,ns=(0,Lo.b2)()(Ja=function(){function e(){Te(this,e),ce(this,"scene",void 0),ce(this,"mapsService",void 0),ce(this,"popups",[]),ce(this,"unAddPopups",[])}return Se(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(Pt(this.popups),Pt(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(Oo.IMapService)}}]),e}())||Ja,rs=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),is=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),os=function(e){return e.AND="and",e.OR="or",e}({}),as=function(e){return e.INIT="init",e.UPDATE="update",e}({});const ss={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"};var us,ls=Sn.merge,cs={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},hs={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:os.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ps=(0,Lo.b2)()(us=function(){function e(){Te(this,e),ce(this,"sceneConfigCache",{}),ce(this,"layerConfigCache",{}),ce(this,"layerAttributeConfigCache",{})}return Se(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return ss[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=pe(pe({},cs),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=pe({},ls({},this.sceneConfigCache[e],hs,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=pe(pe({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||us;function fs(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function ds(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function vs(){var e=new ri(4);return ri!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ms(e,t,n,r){var i=new ri(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function gs(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}vs();var ys=Math.PI/180,_s=4003e4;function xs(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),p=Math.cos(n*ys),f=h/360,d=f/p,v=h/_s/p;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[f,-d,v],c.degreesPerPixel=[1/f,-1/d,1/v],s){var m=ys*Math.tan(n*ys)/p,g=f*m/2,y=h/_s*m,_=y/d*v;c.pixelsPerDegree2=[0,-g,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var bs,Es,ws,Ss,Ts,As,Cs=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Rs=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Ms=(bs=(0,Lo.b2)(),Es=(0,Lo.f3)(Oo.ICameraService),bs((Ss=function(){function e(){Te(this,e),ce(this,"needRefresh",!0),fs(this,"cameraService",Ts,this),ce(this,"coordinateSystem",void 0),ce(this,"viewportCenter",void 0),ce(this,"viewportCenterProjection",void 0),ce(this,"pixelsPerDegree",void 0),ce(this,"pixelsPerDegree2",void 0),ce(this,"pixelsPerMeter",void 0)}return Se(e,[{key:"refresh",value:function(e){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=e||this.cameraService.getCenter(),i=xs({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Cs.LNGLAT||this.coordinateSystem===Cs.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Cs.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===Cs.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=xs({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=oa([],l,u),h=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=gs([],[h[0],h[1],0,1],c),c=oa([],l,u=this.cameraService.getViewMatrixUncentered()||u),c=oa([],c,Rs),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),e}(),Ts=ds(Ss.prototype,"cameraService",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws=Ss))||ws);var ks,Is,Ls,Ps,Os,Ds=(0,Lo.b2)()(As=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"renderMap",new Map),ce(Re(e),"enable",!1),ce(Re(e),"renderEnable",!1),ce(Re(e),"cacheLogs",{}),e}return Se(i,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),i=null;r.forEach((function(e,o){null!==i?(i[e]||(i[e]={}),o!==r.length-1&&(i=i[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),o!==r.length-1&&(i=n.cacheLogs[e])),o===r.length-1&&(i[e]=pe(pe({time:Date.now()},i[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(ue(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})):""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,pe(pe({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",pe(pe({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),i}(ur.EventEmitter))||As,Ns=r(7971),Fs=r.n(Ns),Bs=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({});var zs={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Us=(ks=(0,Lo.b2)(),Is=(0,Lo.f3)(Oo.IMapService),ks((Ps=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"indragging",!1),fs(Re(e),"mapService",Os,Re(e)),ce(Re(e),"hammertime",void 0),ce(Re(e),"lastClickTime",0),ce(Re(e),"lastClickXY",[-1,-1]),ce(Re(e),"clickTimer",void 0),ce(Re(e),"$containter",void 0),ce(Re(e),"onDrag",(function(t){var n=e.interactionEvent(t);n.type=zs[n.type],"dragging"===n.type?e.indragging=!0:e.indragging=!1,e.emit(Bs.Drag,n)})),ce(Re(e),"onHammer",(function(t){t.srcEvent.stopPropagation();var n=e.interactionEvent(t);e.emit(Bs.Hover,n)})),ce(Re(e),"onTouch",(function(t){var n=t.touches[0];e.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),ce(Re(e),"onHover",(function(t){var n=t.clientX,r=t.clientY,i=t.type,o=e.mapService.getMapContainer();if(o){var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=e.mapService.containerToLngLat([n,r]);"click"!==i&&"touch"!==i?"click"!==i&&"dblclick"!==i&&e.emit(Bs.Hover,{x:n,y:r,lngLat:u,type:i,target:t}):e.isDoubleTap(n,r,u)})),e}return Se(i,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Bs.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(Bs.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(Bs.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(Bs.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new(Fs().Manager)(e);t.add(new(Fs().Tap)({event:"dblclick",taps:2})),t.add(new(Fs().Tap)({event:"click"})),t.add(new(Fs().Pan)({threshold:0,pointers:0})),t.add(new(Fs().Press)({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(Bs.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(Bs.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}]),i}(lr()),Os=ds(Ps.prototype,"mapService",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ls=Ps))||Ls),js=0;function Gs(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(js++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var Vs,Hs,Ws,Xs,Zs,qs,Ys,Ks,Qs,Js,$s,eu,tu,nu,ru,iu,ou,au,su,uu,lu,cu,hu=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),pu=(Vs=(0,Lo.b2)(),Hs=(0,Lo.f3)(Oo.IMapService),Ws=(0,Lo.f3)(Oo.IRendererService),Xs=(0,Lo.f3)(Oo.IGlobalConfigService),Zs=(0,Lo.f3)(Oo.IInteractionService),qs=(0,Lo.f3)(Oo.ILayerService),Vs((Ks=function(){function e(){var t=this;Te(this,e),ce(this,"pickedColors",void 0),ce(this,"pickedTileLayers",[]),fs(this,"mapService",Qs,this),fs(this,"rendererService",Js,this),fs(this,"configService",$s,this),fs(this,"interactionService",eu,this),fs(this,"layerService",tu,this),ce(this,"pickingFBO",void 0),ce(this,"width",0),ce(this,"height",0),ce(this,"alreadyInPicking",!1),ce(this,"pickBufferScale",1),ce(this,"pickFromPickingFBO",(function(e,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,l=t.rendererService,c=l.readPixels,h=l.getContainer,p=t.getContainerSize(h()),f=p.width,d=p.height;f*=Dn,d*=Dn;var v=e.getLayerConfig(),m=v.enableHighlight,g=v.enableSelect,y=r*Dn,_=i*Dn;if(y>f-1*Dn||y<0||_>d-1*Dn||_<0)return!1;var x=c({x:Math.floor(y/t.pickBufferScale),y:Math.floor((d-(i+1)*Dn)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO});if(t.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var b=Tt(x),E=e.layerPickService.getFeatureById(b);b!==e.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var w={x:r,y:i,type:a,lngLat:o,featureId:b,feature:E,target:s};E&&(u=!0,e.setCurrentPickId(b),t.triggerHoverOnLayer(e,w))}else{var S={x:r,y:i,lngLat:o,type:null!==e.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};t.triggerHoverOnLayer(e,pe(pe({},S),{},{type:"unpick"})),t.triggerHoverOnLayer(e,S),e.setCurrentPickId(null)}if(m&&e.layerPickService.highlightPickedFeature(x),g&&"click"===a&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()){var T=Tt(x);null===e.getCurrentSelectedId()||T!==e.getCurrentSelectedId()?(e.layerPickService.selectFeature(x),e.setCurrentSelectedId(T)):(e.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null))}return u}))}var t,n,r;return Se(e,[{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=t.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=Dn,s*=Dn,this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.interactionService.on(Bs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=ir(sr().mark((function e(t,n,r){var i,o,a,s=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n=this,r=Ot(t.map((function(e){var t=e<0?0:e;return Math.floor(t*Dn/n.pickBufferScale)})),4),i=r[0],o=r[1],a=r[2],s=r[3],u=this.rendererService,l=u.readPixels,c=u.getContainer,h=this.getContainerSize(c()),p=h.width,f=h.height;if(f*=Dn,i>((p*=Dn)-1)*Dn/this.pickBufferScale||a<0||o>(f-1)*Dn/this.pickBufferScale||s<0)return[];for(var d=Math.min(p/this.pickBufferScale,a)-i,v=Math.min(f/this.pickBufferScale,s)-o,m=l({x:i,y:Math.floor(f/this.pickBufferScale-(s+1)),width:d,height:v,data:new Uint8Array(d*v*4),framebuffer:this.pickingFBO}),g=[],y={},_=0;_<m.length/4;_+=1){var x=Tt(m.slice(4*_,4*_+4));if(-1!==x&&!y[x]){var b=e.layerPickService.getFeatureById(x);g.push(pe(pe({},b),{},{pickedFeatureIdx:x})),y[x]=!0}}return g}},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/Dn,height:e.height/Dn}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=Dn,r*=Dn,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(t=ir(sr().mark((function e(t){var n,r,i,o=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.layerPickService.pickRender(t);var n=o.pickFromPickingFBO(e,t);return o.layerService.pickedLayerId=n?+e.id:-1,n&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]),e}(),Qs=ds(Ks.prototype,"mapService",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=ds(Ks.prototype,"rendererService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=ds(Ks.prototype,"configService",[Xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu=ds(Ks.prototype,"interactionService",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu=ds(Ks.prototype,"layerService",[qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=Ks))||Ys),fu=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Te(this,e),ce(this,"autoStart",void 0),ce(this,"startTime",0),ce(this,"oldTime",0),ce(this,"running",!1),ce(this,"elapsedTime",0),this.autoStart=t}return Se(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function du(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return vu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vu(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mu,gu,yu,_u,xu,bu,Eu=Sn.throttle,wu=(nu=(0,Lo.b2)(),ru=(0,Lo.f3)(Oo.IRendererService),iu=(0,Lo.f3)(Oo.IMapService),ou=(0,Lo.f3)(Oo.IDebugService),nu((su=function(e){Ce(c,e);var t,n,r,i,o,a,s,u,l=(s=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(s);if(u){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function c(){var e;Te(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=l.call.apply(l,[this].concat(n))),"pickedLayerId",-1),ce(Re(e),"clock",new fu),ce(Re(e),"alreadyInRendering",!1),ce(Re(e),"layers",[]),ce(Re(e),"layerList",[]),ce(Re(e),"layerRenderID",void 0),ce(Re(e),"sceneInited",!1),ce(Re(e),"animateInstanceCount",0),ce(Re(e),"shaderPicking",!0),ce(Re(e),"enableRender",!0),fs(Re(e),"renderService",uu,Re(e)),fs(Re(e),"mapService",lu,Re(e)),fs(Re(e),"debugService",cu,Re(e)),ce(Re(e),"reRender",Eu((function(){e.renderLayers()}),32)),ce(Re(e),"throttleRenderLayers",Eu((function(){e.renderLayers()}),16)),e}return Se(c,[{key:"needPick",value:function(e){return this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(a=ir(sr().mark((function e(){var t=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=ir(sr().mark((function e(n){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(o=ir(sr().mark((function e(t,n){var r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?(r=n.layerChildren.indexOf(t))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(t))>-1&&this.layers.splice(i,1),t.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.destroy(),this.reRender();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(r=ir(sr().mark((function e(){var t,n,r,i,o,a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=this.debugService.generateRenderUid(),this.debugService.renderStart(t),this.alreadyInRendering=!0,this.clear(),this.renderService.beginFrame(),n=du(this.layerList),e.prev=9,n.s();case 11:if((r=n.n()).done){e.next=24;break}if(i=r.value,o=i.getLayerConfig(),a=o.enableMask,i.masks.filter((function(e){return e.inited})).length>0&&a&&this.renderMask(i.masks),!i.getLayerConfig().enableMultiPassRenderer){e.next=20;break}return e.next=18,i.renderMultiPass();case 18:e.next=22;break;case 20:return e.next=22,i.render();case 22:e.next=11;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(9),n.e(e.t0);case 29:return e.prev=29,n.f(),e.finish(29);case 32:this.renderService.endFrame(),this.debugService.renderEnd(t),this.alreadyInRendering=!1;case 35:case"end":return e.stop()}}),e,this,[[9,26,29,32]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?is.MULTIPLE:is.SINGLE,i=du(e);try{for(i.s();!(n=i.n()).done;)n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(n=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayers();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),a=(i+=r?o.length:1)>1?is.MULTIPLE:is.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=du(o);try{for(u.s();!(s=u.n()).done;)s.value.render({isStencil:!0,stencilType:a,stencilIndex:t++})}catch(e){u.e(e)}finally{u.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:t++,stencilOperation:os.OR})}},{key:"renderTileLayer",value:(t=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=St(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),c}(ur.EventEmitter),uu=ds(su.prototype,"renderService",[ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lu=ds(su.prototype,"mapService",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cu=ds(su.prototype,"debugService",[ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au=su))||au),Su=Sn.isNil,Tu=function(){function e(t){var n=this;Te(this,e),ce(this,"name",void 0),ce(this,"type",void 0),ce(this,"scale",void 0),ce(this,"descriptor",void 0),ce(this,"featureBufferLayout",[]),ce(this,"needRescale",!1),ce(this,"needRemapping",!1),ce(this,"needRegenerateVertices",!1),ce(this,"featureRange",{startIndex:0,endIndex:1/0}),ce(this,"vertexAttribute",void 0),ce(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return Se(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,Pt(e));if(!Su(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Au=["buffer","update","name"],Cu=["buffer","update","name"],Ru=(ce(mu={},hu.FLOAT,4),ce(mu,hu.UNSIGNED_BYTE,1),ce(mu,hu.UNSIGNED_SHORT,2),mu),Mu=(gu=(0,Lo.b2)(),yu=(0,Lo.f3)(Oo.IRendererService),gu((xu=function(){function e(){Te(this,e),ce(this,"attributesAndIndices",void 0),fs(this,"rendererService",bu,this),ce(this,"attributes",[]),ce(this,"triangulation",void 0),ce(this,"featureLayout",{sizePerElement:0,elements:[]})}return Se(e,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new Tu(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(pe(pe({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,h=Ru[u.type||hu.FLOAT];if(s){var p=this.featureLayout,f=p.elements,d=p.sizePerElement,v=f.slice(n,r);if(!v.length)return;var m=v[0].offset*c*h,g=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,Pt(s(t[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).reduce((function(e,t){return e.push.apply(e,Pt(t)),e}),[]);o.vertexAttribute.updateBuffer({data:g,offset:m}),null==i||i.emit("legend:".concat(e),{type:e,attr:o})}}}},{key:"createAttributesAndIndices",value:function(e,t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=0,s=[],u=3;e.forEach((function(e,t){var l=r.triangulation(e,n),c=l.indices,h=l.vertices,p=l.normals,f=l.size,d=l.indexes,v=l.count;"number"==typeof v&&(a+=v),c.forEach((function(e){s.push(e+o)})),u=f;var m=h.length/f;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:t,vertices:h,normals:p,offset:o}),o+=m;for(var g=function(n){var r=(null==p?void 0:p.slice(3*n,3*n+3))||[],o=h.slice(n*f,n*f+f),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,Pt(i.update(e,t,o,n,r,a)))}))},y=0;y<m;y++)g(y)}));var l=this.rendererService,c=l.createAttribute,h=l.createBuffer,p=l.createElements,f={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,v(e,Au)),o=c(pe({buffer:h(n)},i));f[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var d=p({data:s,type:hu.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:f,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),i=0,o=[],a=3;e.forEach((function(e,t){var s=n.triangulation(e),u=s.indices,l=s.vertices,c=s.normals,h=s.size,p=s.indexes;u.forEach((function(e){o.push(e+i)})),a=h;var f=l.length/h;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:t,vertices:l,normals:c,offset:i}),i+=f;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*h,n*h+h),a=0;p&&void 0!==p[n]&&(a=p[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,Pt(r.update(e,t,o,n,i,a)))}))},v=0;v<f;v++)d(v)}));var s=this.rendererService,u=s.createAttribute,l=s.createBuffer,c={};return r.forEach((function(e,t){if(e){var r=e.buffer,i=(e.update,e.name,v(e,Cu)),o=u(pe({buffer:l(r)},i));c[e.name||""]=o,n.attributes[t].vertexAttribute=o}})),{attributes:c}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),e}(),bu=ds(xu.prototype,"rendererService",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_u=xu))||_u);function ku(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function Iu(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Lu(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Pu(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function Ou(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Du={exports:{}},Nu={exports:{}},Fu={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(Fu,Fu.exports);var Bu={},zu={exports:{}},Uu={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(Uu,Uu.exports);var ju={};Object.defineProperty(ju,"__esModule",{value:!0}),ju.fallback=Xu,ju.wrap=Zu;var Gu,Vu=ju.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,Hu=ju.hasSetImmediate="function"==typeof setImmediate&&setImmediate,Wu=ju.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function Xu(e){setTimeout(e,0)}function Zu(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}Gu=Vu?queueMicrotask:Hu?setImmediate:Wu?process.nextTick:Xu,ju.default=Zu(Gu),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.isAsync)(e)?function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return a(e.apply(this,t),r)}:(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(Uu.exports),r=o(ju),i=Bu;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(zu,zu.exports),Object.defineProperty(Bu,"__esModule",{value:!0}),Bu.isAsyncIterable=Bu.isAsyncGenerator=Bu.isAsync=void 0;var qu,Yu=(qu=zu.exports)&&qu.__esModule?qu:{default:qu};function Ku(e){return"AsyncFunction"===e[Symbol.toStringTag]}Bu.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return Ku(e)?(0,Yu.default)(e):e},Bu.isAsync=Ku,Bu.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},Bu.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var Qu={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===t&&(t=e.length),!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(Qu,Qu.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(Fu.exports),r=o(Bu),i=o(Qu.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(Nu,Nu.exports);var Ju={exports:{}},$u={exports:{}},el={exports:{}},tl={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(tl,tl.exports);var nl={exports:{}},rl={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(rl,rl.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(Fu.exports),r=i(rl.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(nl,nl.exports);var il={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(il,il.exports);var ol={exports:{}},al={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={},e.exports=t.default}(al,al.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,l,h),l++,c()}})).catch(p))}function h(e,t){if(u-=1,!a)return e?p(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void c()}function p(e){a||(s=!1,o=!0,i(e))}c()};var n=function(e){return e&&e.__esModule?e:{default:e}}(al.exports);e.exports=t.default}(ol,ol.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(tl.exports),r=u(nl.exports),i=u(il.exports),o=Bu,a=u(ol.exports),s=u(al.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,l){if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,l);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,l);var c=(0,r.default)(t),h=!1,p=!1,f=0,d=!1;function v(e,t){if(!p)if(f-=1,e)h=!0,l(e);else if(!1===e)h=!0,p=!0;else{if(t===s.default||h&&f<=0)return h=!0,l(null);d||m()}}function m(){for(d=!0;f<e&&!h;){var t=c();if(null===t)return h=!0,void(f<=0&&l(null));f+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}m()}},e.exports=t.default}(el,el.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(el.exports),r=o(Bu),i=o(Qu.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}($u,$u.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i($u.exports),r=i(Qu.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(Ju,Ju.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(Nu.exports),r=i(Ju.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(Du,Du.exports);var sl=Ou(Du.exports),ul=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sl(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,Pu([],Lu(n.args),!1)),r(null,e)}))},e}(),ll={exports:{}},cl={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(Fu.exports),r=l(al.exports),i=l($u.exports),o=l(tl.exports),a=l(il.exports),s=l(Bu),u=l(Qu.exports);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(c))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(cl,cl.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(cl.exports),r=i(Nu.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(ll,ll.exports);var hl=Ou(ll.exports),pl=(function(){function e(){this.tasks=[]}e.prototype.promise=function(){return hl(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return ku(n,void 0,void 0,(function(){return Iu(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))}}(),{exports:{}});!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(tl.exports),r=a(il.exports),i=a(Bu),o=a(Qu.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(pl,pl.exports);var fl,dl,vl,ml,gl,yl,_l,xl,bl,El,wl,Sl,Tl,Al,Cl,Rl,Ml,kl,Il,Ll,Pl,Ol,Dl,Nl,Fl,Bl,zl,Ul,jl,Gl,Vl,Hl,Wl,Xl,Zl,ql=Ou(pl.exports),Yl=(function(){function e(){this.tasks=[]}e.prototype.call=function(){return ql(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t.apply(void 0,Pu([],Lu(n),!1))&&null,e)}))}}(),function(){function e(){this.tasks=[]}return e.prototype.call=function(){return sl(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}()),Kl=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sl(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return ku(n,void 0,void 0,(function(){return Iu(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,Pu([],Lu(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),Ql=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sl(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return ku(n,void 0,void 0,(function(){var n;return Iu(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,Pu([],Lu(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),Jl=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ql(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}(),$l=r(8625),ec=r.n($l);var tc,nc=(fl=(0,Lo.b2)(),dl=(0,Lo.f3)(Oo.SceneID),vl=(0,Lo.f3)(Oo.IIconService),ml=(0,Lo.f3)(Oo.IFontService),gl=(0,Lo.f3)(Oo.IControlService),yl=(0,Lo.f3)(Oo.IGlobalConfigService),_l=(0,Lo.f3)(Oo.IMapService),xl=(0,Lo.f3)(Oo.ICoordinateSystemService),bl=(0,Lo.f3)(Oo.IRendererService),El=(0,Lo.f3)(Oo.ILayerService),wl=(0,Lo.f3)(Oo.IDebugService),Sl=(0,Lo.f3)(Oo.ICameraService),Tl=(0,Lo.f3)(Oo.IInteractionService),Al=(0,Lo.f3)(Oo.IPickingService),Cl=(0,Lo.f3)(Oo.IShaderModuleService),Rl=(0,Lo.f3)(Oo.IMarkerService),Ml=(0,Lo.f3)(Oo.IPopupService),fl((Il=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;return Te(this,a),ce(Re(e=o.call(this)),"destroyed",!1),ce(Re(e),"loaded",!1),fs(Re(e),"id",Ll,Re(e)),fs(Re(e),"iconService",Pl,Re(e)),fs(Re(e),"fontService",Ol,Re(e)),fs(Re(e),"controlService",Dl,Re(e)),fs(Re(e),"configService",Nl,Re(e)),fs(Re(e),"map",Fl,Re(e)),fs(Re(e),"coordinateSystemService",Bl,Re(e)),fs(Re(e),"rendererService",zl,Re(e)),fs(Re(e),"layerService",Ul,Re(e)),fs(Re(e),"debugService",jl,Re(e)),fs(Re(e),"cameraService",Gl,Re(e)),fs(Re(e),"interactionService",Vl,Re(e)),fs(Re(e),"pickingService",Hl,Re(e)),fs(Re(e),"shaderModuleService",Wl,Re(e)),fs(Re(e),"markerService",Xl,Re(e)),fs(Re(e),"popupService",Zl,Re(e)),ce(Re(e),"inited",!1),ce(Re(e),"initPromise",void 0),ce(Re(e),"rendering",!1),ce(Re(e),"$container",void 0),ce(Re(e),"canvas",void 0),ce(Re(e),"markerContainer",void 0),ce(Re(e),"hooks",void 0),ce(Re(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}(),e.coordinateSystemService.needRefresh=!0,e.render())})),ce(Re(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new Kl},e}return Se(a,[{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(Bs.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",ir(sr().mark((function n(){var r,i,o;return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(null===(r=t.map)||void 0===r?void 0:r.getOverlayContainer())||void 0,t.$container=i||Gs(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=13;break}return t.canvas=Cn("canvas","",t.$container),t.setCanvas(),n.next=7,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 7:t.registerContextLost(),t.initContainer(),ec()(t.$container,t.handleWindowResized),window.matchMedia&&(null===(o=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===o||o.addListener(t.handleWindowResized)),n.next=14;break;case 13:console.error("容器 id 不存在");case 14:t.pickingService.init(t.id);case 15:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),"GAODE2.x"!==t.map.version&&e()})),t.map.initMiniMap()}));case 2:t.map.onCameraChanged(t.handleMapCameraChanged),t.interactionService.init(),t.interactionService.on(Bs.Drag,t.addSceneEvent.bind(t));case 5:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",ir(sr().mark((function n(){var r;return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.canvas,t.$container=r||null,!t.$container){n.next=7;break}return n.next=5,t.rendererService.init(e.canvas,t.configService.getSceneConfig(t.id),void 0);case 5:n.next=8;break;case 7:console.error("容器 id 不存在");case 8:t.pickingService.init(t.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(t=ir(sr().mark((function e(t){var n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=Cn("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n=this;this.inited?((0,$l.unbind)(this.$container,this.handleWindowResized),window.matchMedia&&(null===(t=window.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===t||t.removeListener(this.handleWindowResized)),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=n.$container)||void 0===e||e.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$container),this.emit("destroy")):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=Dn,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=Dn,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),a}(ur.EventEmitter),Ll=ds(Il.prototype,"id",[dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pl=ds(Il.prototype,"iconService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ol=ds(Il.prototype,"fontService",[ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=ds(Il.prototype,"controlService",[gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl=ds(Il.prototype,"configService",[yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fl=ds(Il.prototype,"map",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl=ds(Il.prototype,"coordinateSystemService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zl=ds(Il.prototype,"rendererService",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ul=ds(Il.prototype,"layerService",[El],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=ds(Il.prototype,"debugService",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=ds(Il.prototype,"cameraService",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=ds(Il.prototype,"interactionService",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl=ds(Il.prototype,"pickingService",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=ds(Il.prototype,"shaderModuleService",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=ds(Il.prototype,"markerService",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=ds(Il.prototype,"popupService",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=Il))||kl),rc=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ic(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return{content:e=e.replace(rc,(function(e,r,i){var o=i.split(":"),a=o[0].trim(),s="";switch(o.length>1&&(s=o[1].trim()),r){case"bool":s="true"===s;break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s=s?s.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(r)).fill(0)}return n[a]=s,"".concat(t?"uniform ":"").concat(r," ").concat(a,";\n")})),uniforms:n}}function oc(e){var t=ic(e,!0),n=t.content,r=t.uniforms;return{content:n=n.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(function(e,t,n){var i=ic(n=n.trim().replace(/^.*$/gm,(function(e){return"uniform ".concat(e)}))),o=i.content,a=i.uniforms;return Object.assign(r,a),"".concat(t,"{\n").concat(o,"\n};")})),uniforms:r}}function ac(e){var t={};return e.replace(rc,(function(e,n,r){var i=r.trim();return t[i]?"":(t[i]=!0,"uniform ".concat(n," ").concat(i,";\n"))}))}var sc=Sn.uniq,uc="#define PI 3.14159265359",lc="layout(std140) uniform SceneUniforms {\n  mat4 u_ViewMatrix;\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewProjectionMatrix;\n  mat4 u_ModelMatrix;\n  mat4 u_Mvp;\n  vec4 u_ViewportCenterProjection;\n  vec3 u_PixelsPerDegree;\n  float u_Zoom;\n  vec3 u_PixelsPerDegree2;\n  float u_ZoomScale;\n  vec3 u_PixelsPerMeter;\n  float u_CoordinateSystem;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_ViewportCenter;\n  vec2 u_ViewportSize;\n  vec2 u_sceneCenterMercator;\n  float u_FocalDistance;\n};",cc="layout(std140) uniform PickingUniforms {\n  vec4 u_HighlightColor;\n  vec4 u_SelectColor;\n  vec3 u_PickingColor;\n  float u_PickingStage;\n  vec3 u_CurrentSelectedId;\n  float u_PickingThreshold;\n  float u_PickingBuffer;\n  float u_shaderPick;\n  float u_EnableSelect;\n  float u_activeMix;\n};",hc='#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define EARTH_CIRCUMFERENCE 40.03e6\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n#pragma include "scene_uniforms"\n\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return lnglat;\n  }\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n \n\n  //    return vec4(\n  //     position.xy,\n  //     project_scale(position.z),\n  //     position.w);\n  // }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\n\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n\n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\n// Project meter into the unit of pixel which used in the camera world space\nfloat project_float_meter(float meter) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Since the zoom level uniform is updated by mapservice and it\'s alread been subtracted by 1\n    // Not sure if we are supposed to do that again\n   return meter;\n  } else  {\n    return project_float_pixel(meter);\n  }\n\n  // TODO: change the following code to make adaptations for amap\n  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}\n\n// 支持 GaodeV2、Mapbox\nvec4 project_common_position_to_clipspace_v2(vec4 position) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    return u_Mvp * position;\n  } else {\n    return project_common_position_to_clipspace(position);\n  }\n}\n',pc=/precision\s+(high|low|medium)p\s+float/,fc="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",dc=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,vc=/void\s+main\s*\([^)]*\)\s*\{\n?/,mc=(0,Lo.b2)()(tc=function(){function e(){Te(this,e),ce(this,"moduleCache",{}),ce(this,"rawContentCache",{})}return Se(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:uc,fs:uc}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("scene_uniforms",{vs:lc,fs:lc}),this.registerModule("picking_uniforms",{vs:cc,fs:cc}),this.registerModule("projection",{vs:hc,fs:hc}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:'layout(location = 2) in vec3 a_PickingColor;\nout vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return distance(vertexColor,u_PickingColor.rgb) < 0.01;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n',fs:'\nin vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n'}),this.registerModule("rotation_2d",{vs:"vec2 rotate_matrix(vec2 v, float a) {\n    float b = a / 180.0 * 3.1415926535897932384626433832795;\n    float s = sin(b);\n    float c = cos(b);\n    mat2 m = mat2(c, s, -s, c);\n    return m * v;\n}",fs:""})}},{key:"registerModule",value:function(e,t){t.vs=t.vs.replace(/\r\n/g,"\n"),t.fs=t.fs.replace(/\r\n/g,"\n");var n=t.vs,r=t.fs,i=t.uniforms,o=t.inject,a=oc(n),s=a.content,u=a.uniforms,l=oc(r),c=l.content,h=l.uniforms;this.rawContentCache[e]={fs:c,inject:o,uniforms:pe(pe(pe({},u),h),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.rawContentCache[e].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=oc(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(vc,(function(e){return e+(null==i?void 0:i["vs:#main-start"])}))),null!=i&&i["fs:#decl"]&&(r=(null==i?void 0:i["fs:#decl"])+r);var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,l=this.processModule(r,[],"fs"),c=l.content,h=l.includeList,p="",f=sc(u.concat(h).concat(e)).reduce((function(e,n){return pe(pe({},e),t.rawContentCache[n].uniforms)}),pe({},o));pc.test(c)||(p+=fc),p+=c;var d="";return pc.test(s)||(d+=fc),d+=s,this.moduleCache[e]={fs:p.trim(),uniforms:f,vs:d.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(dc,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}},{key:"injectDefines",value:function(e){return Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],";\n")}),"\n")}}]),e}())||tc;function gc(){return gc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ke(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},gc.apply(this,arguments)}var yc,_c,xc=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),bc=(0,Lo.b2)()(yc=function(){function e(){Te(this,e),ce(this,"shaderModuleService",void 0),ce(this,"rendererService",void 0),ce(this,"cameraService",void 0),ce(this,"mapService",void 0),ce(this,"interactionService",void 0),ce(this,"layerService",void 0),ce(this,"config",void 0)}return Se(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return xc.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(Oo.IRendererService),this.cameraService=e.getContainer().get(Oo.ICameraService),this.mapService=e.getContainer().get(Oo.IMapService),this.interactionService=e.getContainer().get(Oo.IInteractionService),this.layerService=e.getContainer().get(Oo.ILayerService),this.shaderModuleService=e.getContainer().get(Oo.IShaderModuleService)}},{key:"render",value:function(e){}}]),e}())||yc;var Ec,wc,Sc,Tc,Ac,Cc=(0,Lo.b2)()(_c=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){gc(ke(i.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),i}(bc))||_c;function Rc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Mc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mc(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Mc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var kc,Ic=(Ec=(0,Lo.b2)(),wc=(0,Lo.f3)(Oo.IPostProcessor),Ec((Tc=function(){function e(){Te(this,e),ce(this,"passes",[]),fs(this,"postProcessor",Ac,this),ce(this,"layer",void 0),ce(this,"renderFlag",void 0),ce(this,"width",0),ce(this,"height",0)}var t;return Se(e,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=ir(sr().mark((function e(){var t,n,r;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Rc(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===xc.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Ac=ds(Tc.prototype,"postProcessor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc=Tc))||Sc);var Lc,Pc,Oc,Dc,Nc,Fc,Bc=(0,Lo.b2)()(kc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"pickingFBO",void 0),ce(Re(e),"layer",void 0),ce(Re(e),"width",0),ce(Re(e),"height",0),ce(Re(e),"alreadyInRendering",!1),ce(Re(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),p=h.width,f=h.height,d=e.layer.getLayerConfig(),v=d.enableHighlight,m=d.enableSelect,g=n*Dn,y=r*Dn;g>p||g<0||y>f||y<0||c(e.pickingFBO,(function(){var t;if(0!==(a=l({x:Math.round(g),y:Math.round(f-(r+1)*Dn),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=Tt(a),u=e.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(pe(pe({},h),{},{type:"unpick"})),e.triggerHoverOnLayer(h),e.layer.setCurrentPickId(null)}v&&e.highlightPickedFeature(a),m&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return Se(i,[{key:"getType",value:function(){return xc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,t){gc(ke(i.prototype),"init",this).call(this,e,t),this.layer=e;var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,a=(0,n.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:r({width:s,height:u,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.interactionService.on(Bs.Hover,this.pickFromPickingFBO),this.interactionService.on(Bs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Bs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=Ot(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=Ot(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=At(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=At(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),i}(bc))||kc,zc=Sn.camelCase,Uc=Sn.isNil,jc=Sn.upperFirst,Gc=(Lc=(0,Lo.b2)(),Pc=(0,Lo.f3)(Oo.IShaderModuleService),Lc((Dc=function(){function e(){Te(this,e),fs(this,"shaderModuleService",Nc,this),ce(this,"rendererService",void 0),ce(this,"config",void 0),ce(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),ce(this,"enabled",!0),ce(this,"renderToScreen",!1),ce(this,"model",void 0),ce(this,"name",void 0),ce(this,"optionsToUpdate",{})}return Se(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return xc.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(Oo.IRendererService),this.shaderModuleService=e.getContainer().get(Oo.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,l=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:hu.FLOAT}),size:2})},uniforms:pe(pe({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),l=u.width,c=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=pe({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=pe(pe({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){Uc(e[n])||(t["u_".concat(jc(zc(n)))]=e[n])})),t}}]),e}(),Nc=ds(Dc.prototype,"shaderModuleService",[Pc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=Dc))||Oc);var Vc,Hc=Sn.isNil,Wc=(0,Lo.b2)()(Fc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Hc(e.bloomRadius)||(t.u_radius=e.bloomRadius),Hc(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),Hc(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),i}(Gc))||Fc;var Xc,Zc=Sn.isNil,qc=(0,Lo.b2)()(Vc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Zc(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),i}(Gc))||Vc;var Yc,Kc=Sn.isNil,Qc=(0,Lo.b2)()(Xc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Kc(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),i}(Gc))||Xc;var Jc,$c=(0,Lo.b2)()(Yc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Gc))||Yc;var eh,th=(0,Lo.b2)()(Jc=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),i}(Gc))||Jc;var nh,rh=(0,Lo.b2)()(eh=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Gc))||eh;var ih,oh=(0,Lo.b2)()(nh=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:pe(pe({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(Gc))||nh;var ah,sh=(0,Lo.b2)()(ih=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),i}(Gc))||ih;var uh,lh,ch,hh,ph,fh,dh,vh=(0,Lo.b2)()(ah=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),i}(Gc))||ah,mh=(uh=(0,Lo.b2)(),lh=(0,Lo.f3)(Oo.IRendererService),ch=(0,Lo.zY)(),uh((ph=function(){function e(){Te(this,e),fs(this,"rendererService",fh,this),ce(this,"passes",[]),ce(this,"readFBO",void 0),ce(this,"writeFBO",void 0)}var t,n;return Se(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,ir(sr().mark((function t(){return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(n=ir(sr().mark((function e(t,n){var r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"render",value:(t=ir(sr().mark((function e(t){var n,r;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}(),fh=ds(ph.prototype,"rendererService",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds(ph.prototype,"init",[ch],Object.getOwnPropertyDescriptor(ph.prototype,"init"),ph.prototype),hh=ph))||hh);var gh,yh,_h,xh,bh,Eh=(0,Lo.b2)()(dh=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getType",value:function(){return xc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){gc(ke(i.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),i}(bc))||dh;var wh="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function Sh(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var Th=1,Ah=(gh=(0,Lo.b2)(),yh=(0,Lo.f3)(Oo.IShaderModuleService),gh((xh=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return fs(Re(e=r.call.apply(r,[this].concat(n))),"shaderModuleService",bh,Re(e)),ce(Re(e),"haltonSequence",[]),ce(Re(e),"accumulatingId",0),ce(Re(e),"frame",0),ce(Re(e),"timer",void 0),ce(Re(e),"sampleRenderTarget",void 0),ce(Re(e),"prevRenderTarget",void 0),ce(Re(e),"outputRenderTarget",void 0),ce(Re(e),"copyRenderTarget",void 0),ce(Re(e),"blendModel",void 0),ce(Re(e),"outputModel",void 0),ce(Re(e),"copyModel",void 0),e}return Se(i,[{key:"getType",value:function(){return xc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,t){gc(ke(i.prototype),"init",this).call(this,e,t);var n=this.rendererService,r=n.createFramebuffer,o=n.createTexture2D;this.sampleRenderTarget=r({color:o({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.prevRenderTarget=r({color:o({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.outputRenderTarget=r({color:o({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})}),this.copyRenderTarget=r({color:o({width:1,height:1,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([Sh(a,2),Sh(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",wh,{blend:{enable:!0,func:{srcRGB:hu.ONE,dstRGB:hu.ONE_MINUS_SRC_ALPHA,srcAlpha:hu.ONE,dstAlpha:hu.ONE_MINUS_SRC_ALPHA},equation:{rgb:hu.FUNC_ADD,alpha:hu.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",wh)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=e.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),window.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=Th++,this.timer=window.setTimeout((function(){c(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=e.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var p=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:p.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var f=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=f,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,t,n){this.shaderModuleService.registerModule(e,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:t});var r=this.shaderModuleService.getModule(e),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(pe({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:[-4,-4,4,-4,0,4],type:hu.FLOAT}),size:2})},uniforms:pe({},a),depth:{enable:!1},count:3},n))}}]),i}(bc),bh=ds(xh.prototype,"shaderModuleService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=xh))||_h),Ch=new Lo.W2;Ch.bind(Oo.IGlobalConfigService).to(ps).inSingletonScope(),(0,Lo.GW)((0,Lo.b2)(),ur.EventEmitter),Ch.bind(Oo.IEventEmitter).to(ur.EventEmitter);var Rh=(0,Po.Z)(Ch,!1),Mh=function(e){var t=Rh.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}};const kh=Ch;var Ih=0;function Lh(){var e=new Lo.W2;return e.parent=Ch,e.bind(Oo.SceneID).toConstantValue("".concat(Ih++)),e.bind(Oo.IShaderModuleService).to(mc).inSingletonScope(),e.bind(Oo.ILayerService).to(wu).inSingletonScope(),e.bind(Oo.IDebugService).to(Ds).inSingletonScope(),e.bind(Oo.ISceneService).to(nc).inSingletonScope(),e.bind(Oo.ICameraService).to(qa).inSingletonScope(),e.bind(Oo.ICoordinateSystemService).to(Ms).inSingletonScope(),e.bind(Oo.IInteractionService).to(Us).inSingletonScope(),e.bind(Oo.IPickingService).to(pu).inSingletonScope(),e.bind(Oo.IControlService).to(es).inSingletonScope(),e.bind(Oo.IMarkerService).to(ts).inSingletonScope(),e.bind(Oo.IIconService).to(qo).inSingletonScope(),e.bind(Oo.IFontService).to(Zo).inSingletonScope(),e.bind(Oo.IPopupService).to(ns).inSingletonScope(),e.bind(Oo.INormalPass).to(Cc).whenTargetNamed("clear"),e.bind(Oo.INormalPass).to(Bc).whenTargetNamed("pixelPicking"),e.bind(Oo.INormalPass).to(Eh).whenTargetNamed("render"),e.bind(Oo.INormalPass).to(Ah).whenTargetNamed("taa"),e.bind(Oo.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(Oo.INormalPass,t)}})),e.bind(Oo.IPostProcessingPass).to(th).whenTargetNamed("copy"),e.bind(Oo.IPostProcessingPass).to(Wc).whenTargetNamed("bloom"),e.bind(Oo.IPostProcessingPass).to(qc).whenTargetNamed("blurH"),e.bind(Oo.IPostProcessingPass).to(Qc).whenTargetNamed("blurV"),e.bind(Oo.IPostProcessingPass).to(sh).whenTargetNamed("noise"),e.bind(Oo.IPostProcessingPass).to(vh).whenTargetNamed("sepia"),e.bind(Oo.IPostProcessingPass).to($c).whenTargetNamed("colorHalftone"),e.bind(Oo.IPostProcessingPass).to(rh).whenTargetNamed("hexagonalPixelate"),e.bind(Oo.IPostProcessingPass).to(oh).whenTargetNamed("ink"),e.bind(Oo.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(Oo.IPostProcessingPass,t);return n.setName(t),n}})),e}function Ph(e){var t=new Lo.W2;return t.parent=e,t.bind(Oo.IStyleAttributeService).to(Mu).inSingletonScope(),t.bind(Oo.IMultiPassRenderer).to(Ic).inSingletonScope(),t.bind(Oo.IPostProcessor).to(mh).inSingletonScope(),t}Sn.clamp;var Oh="sourceInitStart",Dh="sourceInitEnd",Nh="scaleInitStart",Fh="scaleInitEnd",Bh="mappingStart",zh="mappingEnd",Uh="buildModelStart",jh="buildModelEnd",Gh=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),Vh=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Hh=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),Wh=["mapload","mapchange","mapAfterFrameChange"],Xh=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Zh=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),qh=function(){var e=ir(sr().mark((function e(t,n,r,i){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&Mo([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Yh=function(){var e=ir(sr().mark((function e(t,n){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){var i,o;!t&&n?n instanceof ArrayBuffer?(i=n,o=function(t,n){t&&r(t),e(n)},"function"==typeof createImageBitmap?He(i,o):Ve(i,o)):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function Kh(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return Cr(e,t)})):e.map((function(e){return{url:Cr(e.url,t),bands:e.bands||[0]}})):Cr(e,t)}function Qh(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var Jh=function(){var e=ir(sr().mark((function e(t,n,r,i,o){var a,s,u,l,c,h;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=n.url,!((a="string"==typeof p?[{url:p,bands:[0]}]:"string"==typeof p[0]?p.map((function(e){return{url:e,bands:[0]}})):p).length>1)){e.next=15;break}return e.next=4,$h(a,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,Qh(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:Mo(u,i,o,r),e.next=17;break;case 15:h=Ue(n,(function(e,t){e?r(e):t&&Mo([{data:t,bands:a[0].bands}],i,o,r)})),Qh(t,[h]);case 17:case"end":return e.stop()}var p}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function $h(e,t){return ep.apply(this,arguments)}function ep(){return(ep=ir(sr().mark((function e(t,n){var r,i,o,a,s,u,l,c,h,p,f;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=pe(pe({},n),{},{url:s.url}),l=s.bands,e.next=10,Be(pe(pe({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,h=c.err,p=c.data,f=c.xhr,h&&o.push(h),i.push(f),r.push({data:p,bands:l});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tp=function(){var e=ir(sr().mark((function e(t,n,r,i,o){var a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:Kh(t,n)},e.abrupt("return",new Promise((function(e,t){Jh(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),np=function(){var e=ir(sr().mark((function e(t,n,r,i){var o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||Rr,o=s(a,pe(pe({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||Cr,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=We({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.cancel()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),rp=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},ip={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Zh.ARRAYBUFFER,Zh.RGB;var op=["extent","min","max","width","height","format","operation"],ap={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},sp=function(){var e=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=Ot(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),up=r(9059),lp=r.n(up);function cp(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return pe({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new(lp())({radius:r,minZoom:s,maxZoom:o}),p={type:"FeatureCollection",features:[]};return p.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:pe({},e)}})),h.load(p.features),h}function hp(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var pp={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return hp(e)/e.length},sum:hp};var fp=Sn.cloneDeep,dp=Sn.isFunction,vp=Sn.isString,mp=Sn.mergeWith;function gp(e,t){if(Array.isArray(t))return t}var yp=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(e,t){var n;return Te(this,a),ce(Re(n=o.call(this)),"type","source"),ce(Re(n),"isTile",!1),ce(Re(n),"inited",!1),ce(Re(n),"hooks",{init:new ul}),ce(Re(n),"parser",{type:"geojson"}),ce(Re(n),"transforms",[]),ce(Re(n),"cluster",!1),ce(Re(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),ce(Re(n),"invalidExtent",!1),ce(Re(n),"dataArrayChanged",!1),ce(Re(n),"cfg",{autoRender:!0}),n.originData=e,n.initCfg(t),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return Se(a,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,a.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||dp(i))&&(a=a.map((function(e){var n=e.id;if(n){var r,a=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(vp(i)&&o){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(a,o);r=pp[i](s)}dp(i)&&(r=i(a)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=J("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=fp(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?pe(pe({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(n=ir(sr().mark((function e(){var t=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=mp(this.cfg,e,gp);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=pe(pe({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=J(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=Vn(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new Ar(pe({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n,r=(n=t.type,K[n])(e.data,t);Object.assign(e.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=cp(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=qn(Kn(this.extent),e)),t[0].concat(t[1])}}]),a}(ur.EventEmitter);function _p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xp(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function xp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bp=6378e3,Ep=Math.PI/3,wp=[0,Ep,2*Ep,3*Ep,4*Ep,5*Ep];function Sp(e){return e[0]}function Tp(e){return e[1]}$("rasterTile",(function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t=e,Array.isArray(t)&&0===t.length||!Array.isArray(t)&&"string"!=typeof t)throw new Error("tile server url is error");var r=(null==n?void 0:n.dataType)||Zh.IMAGE;r===Zh.RGB&&(r=Zh.ARRAYBUFFER);var i=pe(pe(pe({},ip),n),{},{getTileData:function(t,i){switch(r){case Zh.IMAGE:return np(e,t,i,n);case Zh.CUSTOMIMAGE:case Zh.CUSTOMTERRAINRGB:return Yh(i,null==n?void 0:n.getCustomData);case Zh.ARRAYBUFFER:return tp(e,t,i,(null==n?void 0:n.format)||rp,null==n?void 0:n.operation);case Zh.CUSTOMARRAYBUFFER:case Zh.CUSTOMRGB:return qh(i,null==n?void 0:n.getCustomData,(null==n?void 0:n.format)||rp,null==n?void 0:n.operation);default:return np(e,t,i,n)}}});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),$("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=pe(pe(pe({},_o),t),{},{getTileData:function(e,r){return xo(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),$("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:pe(pe({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new oo(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:pe(pe(pe({},uo),t),{},{getTileData:function(e,t){return po(t,i,e,r)}}),isTile:!0}})),$("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:pe(pe(pe({},ap),t),{},{getTileData:function(e){return sp(e)}}),isTile:!0}})),$("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),0===(e=Li(e)).features.length?{dataArray:[],featureKeys:r}:(Ee(e,(function(e,r){var i=function(e,t){return void 0===t?null:1*ue(e.properties[t])==="number"?1*e.properties[t]:e.properties&&e.properties[t]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(e.properties[t]+"")%1000019:null}(e,null==t?void 0:t.featureId);null===i&&(i=r);var o=i,a=_e(e),s=pe(pe({},e.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),$("jsonTile",(function(e,t){return{dataArray:[],tilesetOptions:pe(pe({},t),{},{getTileData:function(n,r){return fo(e,r,null==t?void 0:t.requestParameters,t.getCustomData)}}),isTile:!0}})),$("image",(function(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=t.requestParameters,o=void 0===i?{}:i,a=new Promise((function(t){e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?t([e]):function(e,t,n){var r=[];if("string"==typeof e)We(pe(pe({},t),{},{url:e}),(function(e,t){t&&(r.push(t),n(r))}));else{var i=e.length,o=0;e.forEach((function(e){We(pe(pe({},t),{},{url:e}),(function(e,t){o++,t&&r.push(t),o===i&&n(r)}))}))}}(e,o,(function(e){t(e)}))}));return{originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}})),$("csv",(function(e,t){return Pi(se(e),t)})),$("json",Pi),$("raster",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,l=t.max,c=t.format,h=t.operation;return void 0===c||Ii(e)?(n=Array.from(e),r=a,i=s):n=Ao(Array.isArray(e)?e:[e],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),$("rasterRgb",(function(e,t){var n=t.extent,r=t.min,i=t.max,o=t.width,a=t.height,s=t.format,u=t.operation,l=v(t,op);return{_id:1,dataArray:[pe(pe({_id:1,data:void 0===s||Ii(e)?Array.from(e):Ao(Array.isArray(e)?e:[e],s,u),width:o,height:a},l),{},{min:r,max:i,coordinates:[[n[0],n[1]],[n[2],n[3]]]})]}})),ee("cluster",cp),ee("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),ee("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return pe(pe({},e),o[t])})),e})),ee("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),ee("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*bp)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=_p(e);try{for(a.s();!(r=a.n()).done;)n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}catch(e){a.e(e)}finally{a.f()}var s,u,l,c,h=(u=(i+o)/2,l=(s=t)/bp*(180/Math.PI),c=function(e,t){return t/bp*(180/Math.PI)/Math.cos(e*Math.PI/180)}(u,s),{yOffset:l,xOffset:c});if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var p,f={},d=_p(e);try{for(d.s();!(p=d.n()).done;){var v=p.value,m=v.coordinates[1],g=v.coordinates[0];if(Number.isFinite(m)&&Number.isFinite(g)){var y=Math.floor((m+90)/h.yOffset),_=Math.floor((g+180)/h.xOffset),x="".concat(y,"-").concat(_);f[x]=f[x]||{count:0,points:[]},f[x].count+=1,f[x].points.push(v)}}}catch(e){d.e(e)}finally{d.f()}return{gridHash:f,gridOffset:h}}(n,i),s=function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=nr(e[i].points,n.field);l[n.method]=tr[n.method](c)}return Object.assign(l,{_id:o,coordinates:Xn([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,t);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),ee("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=Ot(Xn(e.coordinates),2),n=t[0],r=t[1];return pe(pe({},e),{},{coordinates:[n,r]})})),l=function(){var e,t,n,r=0,i=0,o=1,a=1,s=Sp,u=Tp;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(h=+u.call(null,l,r,e))){var l,c,h,p=Math.round(h/=n),f=Math.round(c=c/t-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var v=c-f,m=f+(c<f?-1:1)/2,g=p+(h<p?-1:1),y=c-m,_=h-g;v*v+d*d>y*y+_*_&&(f=m+(1&p?1:-1)/2,p=g)}var x=f+"-"+p,b=i[x];b?b.push(l):(o.push(b=i[x]=[l]),b.x=(f+(1&p)/2)*t,b.y=p*n)}return o}function c(e){var t=0,n=0;return wp.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var h=l*t+(1&u)*t/2;h<o+t/2;h+=t)s.push([h,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(Ep),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]})),c={dataArray:l(u).map((function(e,n){var r;if(t.field&&a){var i=nr(e,t.field);e[a]=tr[a](i)}return ce(r={},t.method,e[a]),ce(r,"count",e.length),ce(r,"rawData",e),ce(r,"coordinates",[e.x,e.y]),ce(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return c}));const Ap=yp;var Cp=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t,n,o;return Te(this,i),ce(Re(t=r.call(this)),"added",!1),ce(Re(t),"eventHandle",(function(e){t.polyfillEvent(e),t.emit(e.type,{target:e,data:t.markerOption.extData,lngLat:t.lngLat})})),t.markerOption=pe(pe({},t.getDefault()),e),n=["update","onMove","onMapClick"],o=Re(t),n.forEach((function(e){o[e]&&(o[e]=o[e].bind(o))})),t.init(),t}return Se(i,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Xe.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(Oo.IMapService),this.sceneSerive=e.get(Oo.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&Rn(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&Rn(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),function(e,t){e.style[On]=t}(t,"".concat(Ze[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var p=this.mapsService.lngLatToContainer([i+360,o]);a.x=p.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=Cn("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}Mn(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),function(e,t,n){var r=e.classList;for(var i in Ze)Ze.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&(function(){for(var e=Bn,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),i}(ur.EventEmitter);Sn.merge,r(507);var Rp=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t;return Te(this,i),t=r.call(this),i.controlCount++,t.controlOption=pe(pe({},t.getDefault(e)),e||{}),t}return Se(i,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=Ot(n,2),i=r[0];void 0===r[1]&&(e[i]=t[i])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=pe(pe({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(Oo.IMapService),this.renderService=e.get(Oo.IRendererService),this.layerService=e.get(Oo.ILayerService),this.controlService=e.get(Oo.IControlService),this.configService=e.get(Oo.IGlobalConfigService),this.scene=e.get(Oo.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),Mn(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Rn(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Cn("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){kn(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){Mn(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:Ya.TOPRIGHT,name:"".concat(i.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ya.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&kn(t,n),e&&Mn(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),i}(lr());ce(Rp,"controlCount",0);var Mp=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e,t){var n;return Te(this,i),ce(Re(n=r.call(this)),"isShow",!1),ce(Re(n),"timeout",null),ce(Re(n),"show",(function(){return n.isShow||!n.contentDOM.innerHTML||(n.resetPopperPosition(),kn(n.popperDOM,"l7-popper-hide"),n.isShow=!0,n.option.unique&&i.conflictPopperList.forEach((function(e){e!==Re(n)&&e.isShow&&e.hide()})),n.emit("show"),window.addEventListener("pointerdown",n.onPopperUnClick)),Re(n)})),ce(Re(n),"hide",(function(){return n.isShow?(Mn(n.popperDOM,"l7-popper-hide"),n.isShow=!1,n.emit("hide"),window.removeEventListener("pointerdown",n.onPopperUnClick),Re(n)):Re(n)})),ce(Re(n),"setHideTimeout",(function(){n.timeout||(n.timeout=window.setTimeout((function(){n.isShow&&(n.hide(),n.timeout=null)}),300))})),ce(Re(n),"clearHideTimeout",(function(){n.timeout&&(window.clearTimeout(n.timeout),n.timeout=null)})),ce(Re(n),"onBtnClick",(function(){n.isShow?n.hide():n.show()})),ce(Re(n),"onPopperUnClick",(function(e){(function(e,t){for(var n=Array.isArray(t)?t:[t],r=e;r instanceof Element&&r!==window.document.body;){var i,o;if(n.find((function(e){var t;return null===(t=r)||void 0===t?void 0:t.matches(e)})))return r;r=null!==(i=null===(o=r)||void 0===o?void 0:o.parentElement)&&void 0!==i?i:null}})(e.target,[".l7-button-control",".l7-popper-content"])||n.hide()})),ce(Re(n),"onBtnMouseLeave",(function(){n.setHideTimeout()})),ce(Re(n),"onBtnMouseMove",(function(){n.clearHideTimeout(),n.isShow||n.show()})),n.button=e,n.option=t,n.init(),t.unique&&i.conflictPopperList.push(Re(n)),n}return Se(i,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(Fn(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Rn(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e,t,n={},r=this.option,i=r.container,o=r.offset,a=void 0===o?[0,0]:o,s=r.placement,u=Ot(a,2),l=u[0],c=u[1],h=this.button.getBoundingClientRect(),p=(t=i.getBoundingClientRect(),{left:(e=h).left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}),f=p.left,d=p.right,v=p.top,m=p.bottom,g=!1,y=!1;/^(left|right)/.test(s)?(s.includes("left")?n.right="".concat(h.width+d,"px"):s.includes("right")&&(n.left="".concat(h.width+f,"px")),s.includes("start")?n.top="".concat(v,"px"):s.includes("end")?n.bottom="".concat(m,"px"):(n.top="".concat(v+h.height/2,"px"),y=!0,n.transform="translate(".concat(l,"px, calc(").concat(c,"px - 50%))"))):/^(top|bottom)/.test(s)&&(s.includes("top")?n.bottom="".concat(h.height+m,"px"):s.includes("bottom")&&(n.top="".concat(h.height+v,"px")),s.includes("start")?n.left="".concat(f,"px"):s.includes("end")?n.right="".concat(d,"px"):(n.left="".concat(f+h.width/2,"px"),g=!0,n.transform="translate(calc(".concat(l,"px - 50%), ").concat(c,"px)"))),n.transform="translate(calc(".concat(l,"px - ").concat(g?"50%":"0%","), calc(").concat(c,"px - ").concat(y?"50%":"0%",")");var _=s.split("-");_.length&&Mn(this.popperDOM,_.map((function(e){return"l7-popper-".concat(e)})).join(" ")),Nn(this.popperDOM,function(e){return Object.entries(e).map((function(e){var t=Ot(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}(n))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=Cn("div","l7-popper l7-popper-hide ".concat(r)),a=Cn("div","l7-popper-content"),s=Cn("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),i}(ur.EventEmitter);ce(Mp,"conflictPopperList",[]);var kp=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t};function Ip(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Lp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lp(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Lp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Pp=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Op=function(){if("undefined"==typeof document)return!1;for(var e=Pp[0],t={},n=0,r=Pp;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=Ip(i.entries());try{for(a.s();!(o=a.n()).done;){var s=Ot(o.value,2),u=s[0],l=s[1];t[e[u]]=l}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),Dp={change:Op.fullscreenchange,error:Op.fullscreenerror},Np={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){Np.off("change",e),n()};Np.on("change",i);var o=e[Op.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(Np.isFullscreen){var n=function t(){Np.off("change",t),e()};Np.on("change",n);var r=document[Op.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return Np.isFullscreen?Np.exit():Np.request(e,t)},onchange:function(e){Np.on("change",e)},onerror:function(e){Np.on("error",e)},on:function(e,t){var n=Dp[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=Dp[e];n&&document.removeEventListener(n,t,!1)},raw:Op};Object.defineProperties(Np,{isFullscreen:{get:function(){return Boolean(document[Op.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[Op.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Op.fullscreenEnabled])}}}),Op||(Np={isEnabled:!1});var Fp=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getDefault",value:function(){return{position:Ya.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=Cn("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){gc(ke(i.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(Fn(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=Cn("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),i.setAttribute("draggable","false"),n){var o=Cn("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),i}(Rp);var Bp=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"update",(function(){var t,n,r,i,o,a,s,u=e.mapsService,l=e.controlOption.maxWidth,c=u.getSize()[1]/2,h=u.containerToLngLat([0,c]),p=u.containerToLngLat([l,c]),f=(t=[h.lng,h.lat],r=ye((n=[p.lng,p.lat])[1]-t[1]),i=ye(n[0]-t[0]),o=ye(t[1]),a=ye(n[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a),function(e,t){void 0===t&&(t="kilometers");var n=de[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters"));e.updateScales(f)})),e}return Se(i,[{key:"getDefault",value:function(e){return pe(pe({},gc(ke(i.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:Ya.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=Cn("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){gc(ke(i.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){Fn(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&Nn(e,"width: ".concat(i,"px")),n&&(this.mScale=Cn("div","l7-control-scale-line",e)),r&&(this.iScale=Cn("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),i}(Rp);var zp,Up=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),ce(Re(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),ce(Re(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),e.controlOption.showZoom&&e.zoomNumDiv&&(e.zoomNumDiv.innerText=String(Math.floor(t.getZoom()))),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return Se(i,[{key:"getDefault",value:function(e){return pe(pe({},gc(ke(i.prototype),"getDefault",this).call(this,e)),{},{position:Ya.BOTTOMRIGHT,name:"zoom",zoomInText:kp("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:kp("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(e){gc(ke(i.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=Cn("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){Fn(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",e)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=Cn("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,i&&o.addEventListener("click",i),o}}]),i}(Rp);Sn.get,function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 24px;\n  padding: 0 16px;\n  font-size: 12px;\n  line-height: 24px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  max-width: 420px;\n  max-height: 400px;\n  margin: 12px 0 0 12px;\n  overflow: auto;\n}\n.l7-select-control--image .l7-select-control-item {\n  position: relative;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: 408px / 3 - 12px;\n  margin-right: 12px;\n  margin-bottom: 12px;\n  overflow: hidden;\n  font-size: 12px;\n  border: 1px solid #fff;\n  border-radius: 2px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 100%;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var jp=(ce(zp={},rs.additive,{enable:!0,func:{srcRGB:hu.ONE,dstRGB:hu.ONE,srcAlpha:1,dstAlpha:1}}),ce(zp,rs.none,{enable:!1}),ce(zp,rs.normal,{enable:!0,func:{srcRGB:hu.SRC_ALPHA,dstRGB:hu.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),ce(zp,rs.subtractive,{enable:!0,func:{srcRGB:hu.ONE,dstRGB:hu.ONE,srcAlpha:hu.ZERO,dstAlpha:hu.ONE_MINUS_SRC_COLOR},equation:{rgb:hu.FUNC_SUBTRACT,alpha:hu.FUNC_SUBTRACT}}),ce(zp,rs.max,{enable:!0,func:{srcRGB:hu.ONE,dstRGB:hu.ONE},equation:{rgb:hu.MAX_EXT}}),ce(zp,rs.min,{enable:!0,func:{srcRGB:hu.ONE,dstRGB:hu.ONE},equation:{rgb:hu.MIN_EXT}}),zp);function Gp(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function Vp(e,t,n,r){var i=e.multiPassRenderer;return e.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),Gp(t).forEach((function(e){var t=Ot(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var Hp,Wp,Xp,Zp=function(){function e(t){Te(this,e),this.layer=t}return Se(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer().get(Oo.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(e,t){var n=this.layer.getContainer().get(Oo.IPickingService);return"RasterLayer"===e.type?this.pickRasterLayer(e,t):(this.pickRender(t),n.pickFromPickingFBO(e,t))}},{key:"pickRasterLayer",value:function(e,t,n){var r,i,o,a,s,u,l=this.layer.getContainer(),c=l.get(Oo.IPickingService),h=l.get(Oo.IMapService),p=this.layer.getSource().extent,f=(r=t.lngLat,o=(i=Ot(p,4))[0],a=i[1],s=i[2],u=i[3],r.lng>o&&r.lng<=s&&r.lat>a&&r.lat<=u),d={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},v=n||e;if(f){var m=this.readRasterValue(e,p,h,t.x,t.y);return d.rasterValue=m,c.triggerHoverOnLayer(v,d),!0}return d.type="mousemove"===t.type?"mouseout":"un"+t.type,c.triggerHoverOnLayer(v,pe(pe({},d),{},{type:"unpick"})),c.triggerHoverOnLayer(v,d),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=Ot(t,4),s=a[0],u=void 0===s?0:s,l=a[1],c=void 0===l?0:l,h=a[2],p=void 0===h?10:h,f=a[3],d=void 0===f?-10:f,v=n.lngLatToContainer([u,c]),m=n.lngLatToContainer([p,d]),g=m.x-v.x,y=v.y-m.y,_=[(r-v.x)/g,(i-m.y)/y],x=o.width||1,b=o.height||1,E=Math.floor(_[0]*x),w=Math.floor(_[1]*b),S=Math.max(0,w-1)*x+E;return o.data[S]}},{key:"selectFeature",value:function(e){var t=this.layer,n=Ot(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=Ot(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),qp=function(){function e(t){Te(this,e),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.get(Oo.IRendererService)}return Se(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return function(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=St(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}(e);case"quantize":return function(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=Rt(n,o);return t=null,n=null,a}(e);case"custom":return function(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=Rt(r,a);return n=null,r=null,s}(e,t);case"linear":return function(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,l=Rt(r,u);return n=null,r=null,l}(e,t);default:return Ct(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}]),e}(),Yp=["passes"],Kp=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"];function Qp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Jp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jp(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $p=Sn.isEqual,ef=Sn.isFunction,tf=Sn.isNumber,nf=Sn.isObject,rf=Sn.isPlainObject,of=Sn.isUndefined,af=0,sf=(Hp=Mh(Oo.IGlobalConfigService),Wp=function(e){Ce(h,e);var t,n,r,i,o,a,s,u,l,c=(u=h,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(u);if(l){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Te(this,h),ce(Re(e=c.call(this)),"id","".concat(af++)),ce(Re(e),"name","".concat(af)),ce(Re(e),"visible",!0),ce(Re(e),"zIndex",0),ce(Re(e),"inited",!1),ce(Re(e),"layerModelNeedUpdate",!1),ce(Re(e),"pickedFeatureID",null),ce(Re(e),"selectedFeatureID",null),ce(Re(e),"styleNeedUpdate",!1),ce(Re(e),"forceRender",!1),ce(Re(e),"clusterZoom",0),ce(Re(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),ce(Re(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),ce(Re(e),"hooks",{init:new Ql,afterInit:new Yl,beforeRender:new Yl,beforeRenderData:new Jl,afterRender:new ul,beforePickingEncode:new ul,afterPickingEncode:new ul,beforeHighlight:new ul(["pickedColor"]),afterHighlight:new ul,beforeSelect:new ul(["pickedColor"]),afterSelect:new ul,beforeDestroy:new ul,afterDestroy:new ul}),ce(Re(e),"models",[]),ce(Re(e),"startInit",!1),ce(Re(e),"layerChildren",[]),ce(Re(e),"masks",[]),fs(Re(e),"configService",Xp,Re(e)),ce(Re(e),"animateOptions",{enable:!1}),ce(Re(e),"currentPickId",null),ce(Re(e),"encodeStyleAttribute",{}),ce(Re(e),"enableShaderEncodeStyles",[]),ce(Re(e),"enableDataEncodeStyles",[]),ce(Re(e),"enablg",[]),ce(Re(e),"pendingStyleAttributes",[]),ce(Re(e),"scaleOptions",{}),ce(Re(e),"animateStatus",!1),ce(Re(e),"isDestroyed",!1),ce(Re(e),"encodeDataLength",0),ce(Re(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return Se(h,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.get(Oo.SceneID);this.configService.setLayerConfig(n,this.id,pe(pe(pe({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=pe(pe({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(s=ir(sr().mark((function e(){var t,n,r,i,o,a,s=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.get(Oo.SceneID),this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Oo.IIconService),this.fontService=this.container.get(Oo.IFontService),this.rendererService=this.container.get(Oo.IRendererService),this.layerService=this.container.get(Oo.ILayerService),this.debugService=this.container.get(Oo.IDebugService),this.interactionService=this.container.get(Oo.IInteractionService),this.pickingService=this.container.get(Oo.IPickingService),this.mapService=this.container.get(Oo.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.cameraService=this.container.get(Oo.ICameraService),this.coordinateService=this.container.get(Oo.ICoordinateSystemService),this.shaderModuleService=this.container.get(Oo.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Oo.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Oo.IFactoryNormalPass),this.styleAttributeService=this.container.get(Oo.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(Oo.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:pe({field:n},s.splitValuesAndCallbackInAttribute(r,n?void 0:s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Oo.ILayerPlugin),o=Qp(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new Zp(this),this.textureService=new qp(this),this.log("layerInitStart"),e.next=31,this.hooks.init.promise();case 31:this.log("layerInitEnd"),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return nf(e)?(t.enable=!0,t=pe(pe({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.log(Oh,as.UPDATE),this.layerSource.setData(e,t),this.log(Dh,as.UPDATE)):this.on("inited",(function(){n.log(Oh,as.UPDATE),n.getSource()?n.layerSource.setData(e,t):n.source(new Ap(e,t)),n.layerSource.once("update",(function(){n.log(Dh,as.UPDATE)}))})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=v(e,Yp);n&&Gp(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),r.borderColor&&(r.stroke=r.borderColor),r.borderWidth&&(r.strokeWidth=r.borderWidth);var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||tf(t[0])||tf(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[].concat(Pt(t.enableShaderEncodeStyles),Pt(t.enableDataEncodeStyles)).includes(n)&&rf(e[n])&&(e[n].field||e[n].value)&&!$p(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=pe({},this.scaleOptions);if(nf(e)?this.scaleOptions=pe(pe({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!$p(n,this.scaleOptions)){var r=nf(e)?e:ce({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(a=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!nf(e)||e,nf(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(nf(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:nf(t)?t.color:this.getLayerConfig().highlightColor,activeMix:nf(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:nf(t)?t.color:this.getLayerConfig().highlightColor,activeMix:nf(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(At(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!nf(e)||e,nf(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(nf(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:nf(t)?t.color:this.getLayerConfig().selectColor,selectMix:nf(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:nf(t)?t.color:this.getLayerConfig().selectColor,selectMix:nf(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(At(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=Vp(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isDestroyed||(null===(e=this.layerModel)||void 0===e||e.uniformBuffers.forEach((function(e){e.destroy()})),this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[],this.getLayerConfig().maskfence&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(n=this.layerModel)||void 0===n||n.clearModels(o),null===(r=this.tileLayer)||void 0===r||r.destroy(),this.models=[],null===(i=this.debugService)||void 0===i||i.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return ce({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return ce({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!of(e)})).map((function(n){return ce({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(o=ir(sr().mark((function e(t){var n,r,i,o,a,s,u,l,c,h,p,f,d=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.inject,a=t.triangulation,s=t.styleOption,u=v(t,Kp),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),l=this.shaderModuleService.getModule(n),c=l.vs,h=l.fs,p=l.uniforms,f=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=d.styleAttributeService.createAttributesAndIndices(d.encodedData,a,s),n=t.attributes,r=t.elements,i=t.count,o=pe({attributes:n,uniforms:p,fs:h,vs:c,elements:r,blend:jp[rs.normal],uniformBuffers:[].concat(Pt(d.layerModel.uniformBuffers),Pt(d.rendererService.uniformBuffers)),textures:d.layerModel.textures},u);i&&(o.count=i),e(f(o))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(i=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"rebuildModels",value:(r=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!$p(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,ce({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:pe({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],e.next=4,this.layerModel.initModels();case 4:this.models=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e){return{values:ef(e)?void 0:e,callback:ef(e)?e:void 0}}}]),h}(ur.EventEmitter),Xp=ds(Wp.prototype,"configService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp);function uf(e){return e.maskOperation===os.OR?{enable:!0,mask:255,func:{cmp:hu.ALWAYS,ref:1,mask:255},opFront:{fail:hu.KEEP,zfail:hu.REPLACE,zpass:hu.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===is.SINGLE||0===e.stencilIndex?hu.ALWAYS:hu.LESS,ref:e.stencilType===is.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:hu.KEEP,zfail:hu.REPLACE,zpass:hu.REPLACE}}}var lf,cf,hf,pf={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},ff={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"},df=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e}({}),vf={opacity:df.OPACITY,stroke:df.STROKE,offsets:df.OFFSETS,rotation:df.ROTATION,extrusionBase:df.EXTRUSION_BASE},mf=(lf=Mh(Oo.IGlobalConfigService),cf=function(){function e(t){Te(this,e),ce(this,"uniformBuffers",[]),ce(this,"textures",[]),ce(this,"preStyleAttribute",{}),ce(this,"encodeStyleAttribute",{}),fs(this,"configService",hf,this),this.layer=t,this.rendererService=t.getContainer().get(Oo.IRendererService),this.pickingService=t.getContainer().get(Oo.IPickingService),this.shaderModuleService=t.getContainer().get(Oo.IShaderModuleService),this.styleAttributeService=t.getContainer().get(Oo.IStyleAttributeService),this.mapService=t.getContainer().get(Oo.IMapService),this.iconService=t.getContainer().get(Oo.IIconService),this.fontService=t.getContainer().get(Oo.IFontService),this.cameraService=t.getContainer().get(Oo.ICameraService),this.layerService=t.getContainer().get(Oo.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var t,n,r;return Se(e,[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend;return jp[rs[void 0===e?"normal":e]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?os.AND:s;return"MaskLayer"===this.layer.type?uf({isStencil:!0,stencilType:is.SINGLE}):e.isStencil?uf(pe(pe({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:hu.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n=[];this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]?t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n"):n.push("  ".concat(ff[r]," u_").concat(r,";")),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n          layout(location = ").concat(vf[r],") in ").concat(ff[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n        #endif\n\n        ")}));var r=n.length?"\nlayout(std140) uniform AttributeUniforms {\n".concat(n.join("\n"),"\n};\n    "):"";t+=r;var i="";return this.layer.enableShaderEncodeStyles.forEach((function(e){i+="\n\n    #ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n      ").concat(ff[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n    #else\n      ").concat(ff[e]," ").concat(e," = u_").concat(e,";\n    #endif\n\n    ")})),{"vs:#decl":t,"fs:#decl":r,"vs:#main-start":i}}},{key:"getStyleAttribute",value:function(){var e=this,t={};return this.layer.enableShaderEncodeStyles.forEach((function(n){if(!e.layer.encodeStyleAttribute[n]){var r=e.layer.getLayerConfig()[n],i=void 0===r?pf[n]:r;"stroke"===n&&(i=St(i)),t["u_"+n]=i}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=function(e){switch(e){case"rotation":return{name:"Rotation",type:Hh.Attribute,descriptor:{name:"a_Rotation",shaderLocation:df.ROTATION,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.rotation,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}};case"stroke":return{name:"stroke",type:Hh.Attribute,descriptor:{name:"a_Stroke",shaderLocation:df.STROKE,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:Hh.Attribute,descriptor:{name:"a_Opacity",shaderLocation:df.OPACITY,buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"extrusionBase":return{name:"extrusionBase",type:Hh.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:df.EXTRUSION_BASE,buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.extrusionBase;return[void 0===t?0:t]}}};case"offsets":return{name:"offsets",type:Hh.Attribute,descriptor:{name:"a_Offsets",shaderLocation:df.OFFSETS,buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){return e.offsets}}};case"thetaOffset":return{name:"thetaOffset",type:Hh.Attribute,descriptor:{name:"a_ThetaOffset",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.thetaOffset;return[void 0===t?1:t]}}};default:return}}(t);n&&(e.styleAttributeService.registerStyleAttribute(n),n.descriptor&&(n.descriptor.shaderLocation=vf[t]))}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}}]),e}(),hf=ds(cf.prototype,"configService",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cf),gf=100;function yf(e){return e/180*Math.acos(-1)}function _f(e){var t=yf(e[0])+Math.PI/2,n=yf(e[1]),r=gf+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}var xf=oi(),bf=(oi(),oi()),Ef=oi(),wf=oi();function Sf(e,t,n,r,i){return li(e,n,r),hi(e,e),[i/pi(t=ai(-e[1],e[0]),ai(-n[1],n[0])),t]}function Tf(e,t){return ui(e,-t[1],t[0])}function Af(e,t,n){return fi(e,t,n),hi(e,e),e}function Cf(e,t){return e[0]===t[0]&&e[1]===t[1]}var Rf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Te(this,e),ce(this,"lastFlip",-1),ce(this,"miter",ai(0,0)),ce(this,"started",!1),ce(this,"dash",!1),ce(this,"totalDistance",0),ce(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Se(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var p=t[o],f=o<e.length-1?[].concat(Pt(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var p=t[o],f=o<e.length-1?[].concat(Pt(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l=Xn([r[0],r[1]]),c=Xn([n[0],n[1]]);Af(bf,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=oi(),Tf(this.normal,bf)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var p=Xn([i[0],i[1]]);Cf(l,p)&&li(p,l,hi(p,ci(p,l,c))),Af(Ef,p,l);var f=Ot(Sf(wf,oi(),bf,Ef,this.thickness),2),d=f[0],v=f[1];pi(wf,this.normal),this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),si(this.normal,v),o+=2,this.lastFlip=-1}else Tf(this.normal,bf),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,l=e.indices,c=e.positions,h=e.normals,p="square"===this.cap,f="bevel"===this.join,d=Xn([a[0],a[1]]),v=Xn([o[0],o[1]]);Af(bf,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=oi(),Tf(this.normal,bf)),!this.started)if(this.started=!0,p){var g=oi(),y=oi();li(g,this.normal,bf),li(y,this.normal,bf),h.push(y[0],y[1],0),h.push(g[0],g[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(t+0,t+1,t+2),i){Cf(r,i)&&li(i,r,hi(i,ci(i,r,n))),Af(Ef,i,r);var _=Ot(Sf(wf,oi(),bf,Ef,this.thickness),2),x=_[0],b=_[1],E=pi(wf,this.normal)<0?-1:1,w=f;w||"miter"!==this.join||x>this.miterLimit&&(w=!0),w?(h.push(this.normal[0],this.normal[1],0),h.push(b[0],b[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,Pt(this.lastFlip!==-E?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),Tf(xf,Ef),si(this.normal,xf),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,b,x,this.totalDistance),l.push.apply(l,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),E=-1,si(this.normal,b),u+=2),this.lastFlip=E}else{if(Tf(this.normal,bf),p){var S=oi(),T=oi();fi(T,bf,this.normal),li(S,bf,this.normal),h.push(T[0],T[1],0),h.push(S[0],S[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,h=Xn([r[0],r[1]]),p=Xn([n[0],n[1]]);Af(bf,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=oi(),Tf(this.normal,bf)),!this.started)if(this.started=!0,l){var d=oi(),v=oi();li(d,this.normal,bf),li(v,this.normal,bf),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(t+0,t+1,t+2),i){var m=Xn([i[0],i[1]]);Cf(h,m)&&li(m,h,hi(m,ci(m,h,p))),Af(Ef,m,h);var g=Ot(Sf(wf,oi(),bf,Ef,this.thickness),2),y=g[0],_=g[1],x=pi(wf,this.normal)<0?-1:1,b=c;b||"miter"!==this.join||y>this.miterLimit&&(b=!0),b?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,Pt(this.lastFlip!==-x?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),Tf(xf,Ef),si(this.normal,xf),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),x=-1,si(this.normal,_),o+=2),this.lastFlip=x}else{if(Tf(this.normal,bf),l){var E=oi(),w=oi();fi(w,bf,this.normal),li(E,bf,this.normal),u.push(w[0],w[1],0),u.push(E[0],E[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,Pt(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function Mf(){var e=new ri(3);return ri!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function kf(e){var t=new ri(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function If(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Lf(e,t,n){var r=new ri(3);return r[0]=e,r[1]=t,r[2]=n,r}function Pf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Of(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Df(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Nf(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Ff(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Bf(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function zf(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Uf(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function jf(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Gf(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Vf(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Hf(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Wf(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Xf(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Zf(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function qf(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Yf(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Kf(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Qf(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Jf(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $f(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function ed(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function td(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function nd(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,p=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*p,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*p,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*p,e}function rd(e,t){t=t||1;var n=2*ii()*Math.PI,r=2*ii()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function id(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function od(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function ad(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,h=o*s-r*l,p=r*u-i*s,f=i*p-o*h,d=o*c-r*p,v=r*h-i*c,m=2*a;return c*=m,h*=m,p*=m,f*=2,d*=2,v*=2,e[0]=s+c+f,e[1]=u+h+d,e[2]=l+p+v,e}function sd(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function ud(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function ld(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function cd(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&Jf(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function hd(e){return e[0]=0,e[1]=0,e[2]=0,e}function pd(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function fd(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function dd(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=ni*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=ni*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=ni*Math.max(1,Math.abs(i),Math.abs(s))}var vd,md=Nf,gd=Ff,yd=Bf,_d=Xf,xd=Zf,bd=If,Ed=qf,wd=function(){var e=Mf();return function(t,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();function Sd(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,a=ti().flatten(e),s=a.vertices,u=a.dimensions,l=[],c=[],h=[],p=0;p<s.length/u;p++)l.push(s[p*u],s[p*u+1],1,-1,-1),h.push(0,0,1);var f=ti()(a.vertices,a.holes,a.dimensions);c.push.apply(c,Pt(f));for(var d=function(){var e=a.vertices.slice(v*u,(v+1)*u),r=a.vertices.slice((v+1)*u,(v+2)*u);0===r.length&&(r=a.vertices.slice(0,u));var i=l.length/5;l.push(e[0],e[1],1,0,0,r[0],r[1],1,.1,0,e[0],e[1],0,0,.8,r[0],r[1],0,.1,.8);var o=function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Mf(),a=Mf(),s=Mf();i&&(e=Wn(e),n=Wn(n),r=Wn(r));var u=Lf.apply(t,Pt(e)),l=Lf.apply(t,Pt(n)),c=Lf.apply(t,Pt(r));md(o,c,l),md(a,u,l),$f(s,o,a);var h=Mf();return Qf(h,s),h}([r[0],r[1],1],[e[0],e[1],0],[e[0],e[1],1],n);h.push.apply(h,Pt(o).concat(Pt(o),Pt(o),Pt(o))),c.push.apply(c,Pt([1,2,0,3,2,1].map((function(e){return e+i}))))},v=0;v<o;v++)d();return{positions:l,index:c,normals:h}}var Td=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),Ad=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Cd(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);return r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}))}function Rd(){return Cd(30)}function Md(){return Cd(4)}function kd(){return Cd(3)}function Id(){return Cd(6,1)}function Ld(){return Cd(5)}var Pd=(ce(vd={},Ad.CIRCLE,Rd),ce(vd,Ad.HEXAGON,Id),ce(vd,Ad.TRIANGLE,kd),ce(vd,Ad.SQUARE,Md),ce(vd,Ad.PENTAGON,Ld),ce(vd,Td.CYLINDER,Rd),ce(vd,Td.HEXAGONCOLUMN,Id),ce(vd,Td.TRIANGLECOLUMN,kd),ce(vd,Td.SQUARECOLUMN,Md),ce(vd,Td.PENTAGONCOLUMN,Ld),vd),Od={};function Dd(e){var t=Qn(e.coordinates);return{vertices:[].concat(Pt(t),Pt(t),Pt(t),Pt(t)),indices:[0,1,2,2,3,0],size:t.length}}function Nd(e){var t=_f(Qn(e.coordinates));return{vertices:[].concat(Pt(t),Pt(t),Pt(t),Pt(t)),indices:[0,1,2,2,3,0],size:t.length}}function Fd(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Od&&Od[e])return Od[e];var n=Sd([Pd[e]?Pd[e]():Pd.cylinder()],t);return Od[e]=n,n}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function Bd(e){var t=Qn(e.coordinates);return{vertices:Pt(t),indices:[0],size:t.length}}function zd(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new Rf({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function Ud(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=Gd(t[0],n);r.push(i);for(var o=1;o<t.length-1;o++){n+=jd(t[o-1],t[o]);var a=Gd(t[o],n);r.push(a),r.push(a)}return n+=jd(t[t.length-2],t[t.length-1]),r.push(Gd(t[t.length-1],n)),{results:r,totalDistance:n}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function jd(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function Gd(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function Vd(e){var t=e.coordinates,n=ti().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ti()(r,o,i),vertices:r,size:i}}function Hd(e){var t=e.coordinates,n=ti().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ti()(r,o,i),vertices:Wd(r),size:i+4}}function Wd(e){for(var t=[],n=function(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];t.push.apply(t,[a,s,0].concat(Pt(r),[i]))}return t}function Xd(e){var t=Sd(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function Zd(e){var t,n,r,i,o,a,s=(t=e.shape,o=Pd[t]?Pd[t]():Pd.circle(),a=-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(t)?(n=[o],r=ti().flatten(n),i=ti()(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=ti().flatten(e),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=ti()(i.vertices,i.holes,i.dimensions);u.push.apply(u,Pt(c));for(var h=function(){var e=i.vertices.slice(p*a,(p+1)*a),t=i.vertices.slice((p+1)*a,(p+2)*a);0===t.length&&(t=i.vertices.slice(0,a));var n=s.length/3;s.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),u.push.apply(u,Pt([0,2,1,2,3,1].map((function(e){return e+n}))))},p=0;p<r;p++)h();return{positions:s,index:u}}([o]),a);return{vertices:s.positions,indices:s.index,size:3}}function qd(e){var t=e.coordinates;return{vertices:[].concat(Pt(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],Pt(t[1]),[0,1,0],Pt(t[0]),[0,0,1],Pt(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function Yd(e,t){for(var n=t.segmentNumber,r=void 0===n?30:n,i=e.coordinates,o=[],a=[],s=function(e){o.push(e,1,e,i[0][0],i[0][1],i[1][0],i[1][1],e,-1,e,i[0][0],i[0][1],i[1][0],i[1][1]),e!==r-1&&a.push.apply(a,Pt([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},u=0;u<r;u++)s(u);return{vertices:o,indices:a,size:7}}function Kd(e){var t=e.coordinates;2===t.length&&t.push(0);var n=Qd(-1,1),r=Qd(1,1),i=Qd(-1,-1),o=Qd(1,-1);return{vertices:[].concat(Pt(t),Pt(n),Pt(t),Pt(i),Pt(t),Pt(o),Pt(t),Pt(r)),indices:[0,1,2,3,0,2],size:5}}function Qd(e,t){return[(e+1)/2,(t+1)/2]}var Jd=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\n\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Zd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Hh.Attribute,descriptor:{name:"a_Pos",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),a}(mf);var $d,ev=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\n\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Fd,primitive:hu.TRIANGLES,depth:{enable:!0}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Hh.Attribute,descriptor:{name:"a_Pos",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),a}(mf);var tv=Sn.isEqual,nv=(0,Lo.b2)()($d=function(e){Ce(s,e);var t,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(o){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function s(){return Te(this,s),a.apply(this,arguments)}return Se(s,[{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig().rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),tv(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=s,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),l=u.width,c=u.height,this.heatmapFramerBuffer=r({color:o({width:Math.floor(l/4),height:Math.floor(c/4),wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE,min:hu.LINEAR,mag:hu.LINEAR}),depth:!1}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Hh.Attribute,descriptor:{name:"a_Dir",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Kd,e.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\n\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:Kd,depth:{enable:!1},cull:{enable:!0,face:kt(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:t,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:hu.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:hu.FLOAT}),size:2})},uniforms:pe({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:hu.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,i=void 0===r?10:r,o=t.radius,a=void 0===o?5:o;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i},blend:{enable:!0,func:{srcRGB:hu.ONE,srcAlpha:1,dstRGB:hu.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(e){var t,n=this.layer.getLayerConfig().opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=Yo();na(r,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:Pt(r)},blend:{enable:!0,func:{srcRGB:hu.SRC_ALPHA,srcAlpha:1,dstRGB:hu.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var p=h-s;r.push(p/s,-c/u,0),i.push(h/e),i.push(1-l/t)}for(var f=0;f<t;f++)for(var d=0;d<e;d++){var v=d+o*f,m=d+o*(f+1),g=d+1+o*(f+1),y=d+1+o*f;n.push(v,m,y),n.push(m,g,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,l=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({buffer:l({data:t.vertices,type:hu.FLOAT}),size:3}),a_Uv:s({buffer:l({data:t.uvs,type:hu.FLOAT}),size:2})},primitive:hu.TRIANGLES,uniforms:pe({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:hu.SRC_ALPHA,srcAlpha:1,dstRGB:hu.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:t.indices,type:hu.UNSIGNED_INT,count:t.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=Ct(t);this.colorTexture=e({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE,min:hu.NEAREST,mag:hu.NEAREST,flipY:!1}),this.preRampColors=t}}]),s}(mf))||$d;var rv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\n\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Zd,depth:{enable:!1},primitive:hu.TRIANGLES});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Hh.Attribute,descriptor:{name:"a_Pos",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),a}(mf);const iv={heatmap:nv,heatmap3d:nv,grid:Jd,grid3d:ev,hexagon:rv};var ov=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","HeatMapLayer"),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new iv[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),o}(sf);var av={solid:0,dash:1},sv=(Sn.isNumber,function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=(e.opacity,e.sourceColor),n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.forward,c=void 0===l||l,h=e.lineTexture,p=void 0!==h&&h,f=e.iconStep,d=void 0===f?100:f,v=e.segmentNumber,m=void 0===v?30:v;2===u.length&&u.push(0,0);var g=0,y=[0,0,0,0],_=[0,0,0,0];return t&&n&&(y=St(t),_=St(n),g=1),this.rendererService.getDirty()&&this.texture.bind(),pe({u_textureBlend:"normal"===i?0:1,segmentNumber:m,u_line_type:av[a||"solid"],u_dash_array:u,u_blur:.9,u_lineDir:c?1:-1,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:g,u_sourceColor:y,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'varying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// 当前顶点在弧线中所处的分段位置\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= opacity;\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_color;\n  \n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:Yd,depth:{enable:!1},styleOption:{segmentNumber:r}});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Hh.Attribute,descriptor:{name:"a_Instance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf));var uv={solid:0,dash:1},lv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,h=e.iconStep,p=void 0===h?100:h,f=e.segmentNumber,d=void 0===f?30:f,v=e.globalArcHeight,m=void 0===v?10:v;2===u.length&&u.push(0,0);var g=0,y=[0,0,0,0],_=[0,0,0,0];return t&&n&&(y=St(t),_=St(n),g=1),this.rendererService.getDirty()&&this.texture.bind(),pe({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:gf,u_global_height:m,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:uv[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:g,u_sourceColor:y,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:Yd,styleOption:{segmentNumber:r}});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Hh.Attribute,descriptor:{name:"a_Instance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf);var cv={solid:0,dash:1},hv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,h=e.lineTexture,p=void 0!==h&&h,f=e.iconStep,d=void 0===f?100:f,v=e.segmentNumber,m=void 0===v?30:v,g=e.globalArcHeight,y=void 0===g?10:g;2===c.length&&c.push(0,0);var _=0,x=[0,0,0,0],b=[0,0,0,0];return r&&i&&(x=St(r),b=St(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:gf,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:m,u_line_type:cv[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:x,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:a,fragmentShader:o,triangulation:Yd,depth:{enable:!0},styleOption:{segmentNumber:r}});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Hh.Attribute,descriptor:{name:"a_Instance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf),pv={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},fv=.5;function dv(e,t){var n="object"===ue(e)?e.type:e,r="source"===t?1:-1,i="object"===ue(e)?e:{};switch(n){case"circle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i,a=Rd(),s=ti().flatten([a]),u=ti()(s.vertices,s.holes,s.dimensions),l=a.map((function(t){return[t[0]*r*e,t[1]*o]})).flat();return{vertices:[].concat(Pt(l),Pt(l)),dimensions:2,indices:u.map((function(e){return e+a.length})),outLineIndices:u,normals:[].concat(Pt(a.map((function(t){return[t[1]*o,t[0]*r*e,1]})).flat()),Pt(new Array(3*a.length).fill(0)))}}(r,i);case"triangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*e*r,1*o,1*e*r,-1*o,0,0,1*e*r,1*o,1*e*r,-1*o],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);case"diamond":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o,0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"rect":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i;return{vertices:[0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2,0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"classic":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o,0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"halfTriangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?1:i;return{vertices:[0,fv*e,1*e*r,-(o+fv)*e,1*e*r,(o-fv)*e,0,fv*e,1*e*r,-(o+fv)*e,1*e*r,(o-fv)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function vv(e,t){return t?function(e,t){var n=e.coordinates.flat(),r=t,i=r.target,o=void 0===i?"classic":i,a=r.source,s=mv(dv(void 0===a?"circle":a,"source"),n,0,0),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r="object"===ue(n.source)?n.source.type:n.source,i="object"===ue(n.target)?n.target.type:n.target,o="object"===ue(n.source)?n.source:{},a=o.width,s=void 0===a?r?pv[r]:0:a,u=(o.height,"object"===ue(n.target)?n.target:{}),l=u.width,c=void 0===l?i?pv[i]:0:l;return u.height,{vertices:[0,fv,1*s].concat(Pt(e),[1,fv,-1*c],Pt(e),[1,-fv,-1*c],Pt(e),[0,-fv,1*s],Pt(e),[0,fv,1*s],Pt(e),[1,fv,-1*c],Pt(e),[1,-fv,-1*c],Pt(e),[0,-fv,1*s],Pt(e)),outLineIndices:[0,1,2,0,2,3].map((function(e){return e+t})),indices:[4,5,6,4,6,7].map((function(e){return e+t})),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}(n,s.vertices.length/7,t),l=mv(dv(o,"target"),n,1,s.vertices.length/7+u.vertices.length/7);return{vertices:[].concat(Pt(s.vertices),Pt(u.vertices),Pt(l.vertices)),indices:[].concat(Pt(s.outLineIndices),Pt(u.outLineIndices),Pt(l.outLineIndices),Pt(s.indices),Pt(u.indices),Pt(l.indices)),normals:[].concat(Pt(s.normals),Pt(u.normals),Pt(l.normals)),size:7}}(e,t):function(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(Pt(t),[1,2,-3],Pt(t),[1,1,-3],Pt(t),[0,1,0],Pt(t),[0,0,0],Pt(t),[1,0,0],Pt(t),[1,2,-3],Pt(t),[1,1,-3],Pt(t),[0,1,0],Pt(t),[0,0,0],Pt(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}(e)}function mv(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[],o=e.vertices,a=e.indices,s=e.dimensions,u=e.outLineIndices,l=0;l<o.length;l+=s)i.push.apply(i,[n,o[l+1],o[l]].concat(Pt(t)));return pe(pe({},e),{},{vertices:i,indices:a.map((function(e){return e+r})),outLineIndices:u.map((function(e){return e+r}))})}var gv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.stroke,a=void 0===o?"#000":o,s=e.strokeOpacity,u=void 0===s?1:s;return pe({u_gap_width:n,u_stroke_width:i,u_stroke:St(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\nvec2 project_pixel_offset(vec2 offsets) {\n\n   vec2 data = project_pixel(offsets);\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return data;\n  }\n\n  return vec2(data.x, -data.y);;\n}\n\nvec2 line_dir(vec2 target, vec2 source) {\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return normalize(target - source);\n  }\n  return normalize(ProjectFlat(target) - ProjectFlat(source));\n}\n\nfloat flag_gap() {\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n     return 1.;\n  }\n  return -1.;\n\n}\n\n\nvoid main() {\n\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = line_dir(target,source);\n  vec2 perpendicularDir = vec2(flowlineDir.y, flowlineDir.x); // mapbox || 高德\n\n\n  vec2 position = mix(source, target, a_Position.x);\n  \n  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    \n  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)\n  );\n\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || 高德\n\n  float gapCommon = flag_gap() * project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',inject:this.getInject(),triangulation:vv,styleOption:this.layer.getLayerConfig().symbol,primitive:hu.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Hh.Attribute,descriptor:{name:"a_Instance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),a}(mf);var yv={solid:0,dash:1},_v=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,h=e.iconStep,p=void 0===h?100:h,f=e.segmentNumber,d=void 0===f?30:f;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var v=0,m=[0,0,0,0],g=[0,0,0,0];return t&&n&&(m=St(t),g=St(n),v=1),pe({u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:yv[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:m,u_targetColor:g},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\nv_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\nv_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n     gl_FragColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/v_color.a;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:Yd,inject:this.getInject(),depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Hh.Attribute,descriptor:{name:"a_Instance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf),xv=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),bv=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),Ev=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({});var wv='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\n\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_stroke;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n  v_stroke = stroke;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',Sv={solid:0,dash:1},Tv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"textureEventFlag",!1),ce(Re(e),"texture",e.createTexture2D({data:[0,0,0,0],mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1,height:1})),ce(Re(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5,0,0]:s,l=e.lineTexture,c=void 0!==l&&l,h=e.iconStep,p=void 0===h?100:h,f=e.vertexHeightScale,d=void 0===f?20:f,v=e.strokeWidth,m=void 0===v?0:v,g=e.raisingHeight,y=void 0===g?0:g,_=e.heightfixed,x=void 0!==_&&_,b=e.linearDir,E=void 0===b?xv.VERTICAL:b,w=e.blur,S=void 0===w?[1,1,1]:w;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var T=0,A=[0,0,0,0],C=[0,0,0,0];return t&&n&&(A=St(t),C=St(n),T=1),pe({u_textureBlend:i===bv.NORMAL?0:1,u_line_type:Sv[a],u_dash_array:u,u_blur:S,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_strokeWidth:m,u_linearDir:E===xv.VERTICAL?1:0,u_linearColor:T,u_sourceColor:A,u_targetColor:C,u_heightfixed:Number(x),u_vertexScale:d,u_raisingHeight:Number(y)},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=wi,e.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:a,fragmentShader:o,triangulation:wi,inject:this.getInject(),depth:{enable:r}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // 实线部分\n  } else {\n    // 虚线部分\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\nuniform mat4 u_ModelMatrix;\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n  \n float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n    gl_FragColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:wv,type:"Linear"}:{frag:'#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\n\nuniform float u_strokeWidth: 0.0;\n\nuniform vec3 u_blur;\nvarying vec4 v_color;\nvarying vec4 v_stroke;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float strokeWidth = min(0.5, u_strokeWidth);\n  // 绘制 border\n  if(strokeWidth > 0.01) {\n    float borderOuterWidth = strokeWidth / 2.0;\n\n\n    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {\n      if(v > strokeWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, v_stroke.rgb, linear);\n      } else if(v <= strokeWidth) {\n        float linear = smoothstep(0.0, 1.0, v/strokeWidth);\n        gl_FragColor.rgb = mix(v_stroke.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:wv,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Hh.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Hh.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Hh.Attribute,descriptor:{name:"a_Miter",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf);Sn.isNumber;var Av=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var n=Ct(e.layer.getLayerConfig().rampColors);e.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE,min:hu.NEAREST,mag:hu.NEAREST,flipY:!1})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=(e.opacity,e.vertexHeightScale),n=void 0===t?20:t,r=e.raisingHeight,i=void 0===r?0:r,o=e.heightfixed,a=void 0!==o&&o,s=e.linearDir,u=void 0===s?xv.VERTICAL:s;return this.rendererService.getDirty()&&this.colorTexture.bind(),pe({u_linearDir:u===xv.VERTICAL?1:0,u_texture:this.colorTexture,u_heightfixed:Number(a),u_vertexScale:n,u_raisingHeight:Number(i)},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,this.layer.triangulation=zd,e.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\n\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  float linearRadio =currentLinePointRatio; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= opacity; // 全局透明度\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:zd,inject:this.getInject(),depth:{enable:r}});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Hh.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Hh.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Hh.Attribute,descriptor:{name:"a_Miter",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),a}(mf);var Cv='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\n\n\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color.a = v_color.a * opacity;\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',Rv=(Sn.isNumber,function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=(e.opacity,e.sourceColor),n=e.targetColor,r=e.vertexHeightScale,i=void 0===r?20:r,o=0,a=[0,0,0,0],s=[0,0,0,0];return t&&n&&(a=St(t),s=St(n),o=1),pe({u_linearColor:o,u_sourceColor:a,u_targetColor:s,u_vertexScale:i},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying float v_distanceScale;\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= v_color.a; // 全局透明度\n}\n",vert:Cv,type:"lineSimpleLinear"}:{frag:"\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",vert:Cv,type:"lineSimpleNormal"}}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:Ud,inject:this.getInject(),primitive:hu.LINES,depth:{enable:!1},pick:!1});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Hh.Attribute,descriptor:{name:"a_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Hh.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),a}(mf));var Mv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:hu.NEAREST,min:hu.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.heightfixed,a=void 0!==o&&o,s=e.lineTexture,u=void 0!==s&&s,l=e.iconStep,c=void 0===l?100:l,h=e.iconStepCount,p=void 0===h?1:h;this.rendererService.getDirty()&&this.texture.bind();var f=0,d=[0,0,0,0],v=[0,0,0,0];return t&&n&&(d=St(t),v=St(n),f=1),pe({u_heightfixed:Number(a),u_textureBlend:"normal"===i?0:1,u_texture:this.texture,u_line_texture:u?1:0,u_iconStepCount:p,u_icon_step:c,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:f,u_sourceColor:d,u_targetColor:v},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\n\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {    \n     originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整\n  }\n\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= v_color.a; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:zd,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Hh.Attribute,descriptor:{name:"a_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Hh.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Hh.Attribute,descriptor:{name:"a_Miter",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),a}(mf);const kv={arc:sv,arc3d:lv,greatcircle:_v,wall:Mv,line:Tv,simple:Rv,linearline:Av,earthArc3d:hv,flowline:gv};var Iv=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","LineLayer"),ce(Re(e),"enableShaderEncodeStyles",["opacity","offsets","stroke","thetaOffset"]),ce(Re(e),"arrowInsertCount",0),ce(Re(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new kv[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=pe({},e);e.coordinates.map((function(e){t.push(pe(pe({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),o}(sf);function Lv(e){var t=e.coordinates;return{vertices:Pt(t),indices:[0],size:t.length}}var Pv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.blend,a=e.strokeOpacity,s=void 0===a?1:a,u=e.strokeWidth,l=void 0===u?0:u,c=e.stroke;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:l,u_stroke_color:St(void 0===c?"#fff":c)}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Lv,e.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\n\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n  \n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:Lv,depth:{enable:!1},primitive:hu.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),a}(mf);var Ov=Sn.isNumber,Dv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"raiseCount",0),ce(Re(e),"raiseRepeat",0),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,h=e.opacityLinear,p=void 0===h?{enable:!1,dir:"up"}:h,f=e.lightEnable,d=void 0===f||f,v=0,m=[0,0,0,0],g=[0,0,0,0];if(o&&a&&(m=St(o),g=St(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:Ov(i)?i:1,u_linearColor:v,u_sourceColor:m,u_targetColor:g,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\n\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:Fd,depth:{enable:!0},cull:{enable:!0,face:kt(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Hh.Attribute,descriptor:{name:"a_Pos",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t=Qn(e.coordinates);return _f([t[0],t[1]])}}})}}]),a}(mf);var Nv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,o=e.strokeWidth,a=void 0===o?0:o,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s,l=e.blend,c=e.blur;return{u_blur:void 0===c?0:c,u_additive:"additive"===l?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:St(u)}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Nd,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:Nd,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Hh.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r){var i=Ot(n,3),o=i[0],a=i[1],s=i[2],u=Lf(0,0,1),l=Lf(o,0,s),c=o>=0?cd(u,l):2*Math.PI-cd(u,l),h=2*Math.PI-Math.asin(a/100),p=Yo();ca(p,p,c),la(p,p,h);var f=Lf(1,1,0);id(f,f,p),Qf(f,f);var d=Lf(-1,1,0);id(d,d,p),Qf(d,d);var v=Lf(-1,-1,0);id(v,v,p),Qf(v,v);var m=Lf(1,-1,0);id(m,m,p),Qf(m,m);var g=[].concat(Pt(f),Pt(d),Pt(v),Pt(m)),y=r%4*3;return[g[y],g[y+1],g[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Hh.Attribute,descriptor:{name:"a_Shape",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),a}(mf);var Fv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"raiseCount",0),ce(Re(e),"raiseRepeat",0),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,h=e.opacityLinear,p=void 0===h?{enable:!1,dir:"up"}:h,f=e.lightEnable,d=void 0===f||f,v=0,m=[0,0,0,0],g=[0,0,0,0];if(o&&a&&(m=St(o),g=St(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:m,u_targetColor:g,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,e.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\n\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:Fd,cull:{enable:!0,face:kt(this.mapService.version)},depth:{enable:r}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Hh.Attribute,descriptor:{name:"a_Pos",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e){var t=Qn(e.coordinates);return[t[0],t[1],0]}}})}}]),a}(mf);var Bv='layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\nlayout(location = 11) in vec3 a_Extrude;\nlayout(location = 10) in float a_Shape;\n\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n};\n\nout vec4 v_color;\nout vec4 v_stroke;\nout vec4 v_data;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // 透明度计算\n   v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  offset = rotate_matrix(offset,rotation);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n  \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',zv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,l=void 0===u?0:u,c=e.heightfixed,h=void 0!==c&&c,p=e.unit,f=void 0===p?"pixel":p,d=pe({u_blur_height_fixed:[s,Number(l),Number(h)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:Ev[f]},this.getStyleAttribute()),v=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Pt(v.u_stroke),Pt(v.u_offsets),[v.u_opacity,v.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Pt(d.u_blur_height_fixed),[d.u_stroke_width,d.u_stroke_opacity,d.u_additive,d.u_size_unit])).buffer)}),d}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Si)}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=Si,u=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),l=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),this.uniformBuffers.push(u,l),e.next=8,this.layer.buildLayerModel({moduleName:s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:Si,depth:{enable:!1}});case 8:return c=e.sent,e.abrupt("return",[c]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(e){return e.enable?(e.type,{frag:"\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",vert:Bv,type:"pointWave"}):{frag:"\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\nin vec4 v_data;\nin float v_radius;\n\n#pragma include \"scene_uniforms\"\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    outputColor = v_color;\n  } else {\n    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor = filterColor(outputColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(outputColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:Bv,type:"pointFill"}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Hh.Attribute,descriptor:{name:"a_Extrude",shaderLocation:df.EXTRUDE,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",shaderLocation:df.SIZE,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Hh.Attribute,descriptor:{name:"a_Shape",shaderLocation:df.SHAPE,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]),a}(mf);var Uv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"meter2coord",1),ce(Re(e),"isMeter",!1),ce(Re(e),"radian",0),ce(Re(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:hu.LINEAR,min:hu.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.heightfixed,i=void 0!==r&&r,o=e.unit,a=void 0===o?"pixel":o;return this.rendererService.getDirty()&&this.texture.bind(),pe({u_raisingHeight:Number(n),u_heightfixed:Number(i),u_size_unit:Ev[a],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Dd)}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\n\nuniform mat4 u_ModelMatrix;\n\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nvarying float v_opacity;\n// uniform vec2 u_offsets; // shader 注入\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n  v_opacity = opacity;\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  \n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (extrude.xy * (newSize) + offsets);\n\n  offset = rotate_matrix(offset,rotation);\n\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\nvarying float v_opacity;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= v_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Dd,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:kt(this.mapService.version)}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Hh.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),a}(mf);var jv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:hu.LINEAR,min:hu.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=(e.opacity,e.offsets,e.raisingHeight),n=void 0===t?0:t,r=e.heightfixed,i=void 0!==r&&r;return this.rendererService.getDirty()&&this.texture.bind(),pe({u_raisingHeight:Number(n),u_heightfixed:Number(i),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_opacity;\nuniform mat4 u_ModelMatrix;\n\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_opacity = opacity;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_opacity;\nuniform vec2 u_textSize;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n      gl_FragColor.a *= v_opacity;\n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Bd,inject:this.getInject(),depth:{enable:!1},primitive:hu.POINTS});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),a}(mf);function Gv(e){var t=e.coordinates;return{vertices:Pt(t),indices:[0],size:t.length}}var Vv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Pt(e.u_stroke),Pt(e.u_offsets),[e.u_opacity,e.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([.5]).buffer)}),pe({u_size_scale:.5},e)}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Gv,t=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),n=this.rendererService.createBuffer({data:new Float32Array(4),isUBO:!0}),this.uniformBuffers.push(t,n),e.next=6,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'layout(location = 0) in vec3 a_Position;\nlayout(location = 1) in vec4 a_Color;\nlayout(location = 9) in float a_Size;\n\nlayout(std140) uniform u_Common {\n  float u_size_scale;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);\n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;\n}\n',fragmentShader:"in vec4 v_color;\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n}",triangulation:Gv,inject:this.getInject(),depth:{enable:!1},primitive:hu.POINTS,pick:!1});case 6:return r=e.sent,e.abrupt("return",[r]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",shaderLocation:df.SIZE,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),a}(mf);var Hv=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,o=void 0===i?1:i,a=e.unit;return{u_size_unit:Ev[void 0===a?"pixel":a],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Dd)}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\n\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // 不以米为实际单位\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',triangulation:Dd,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Hh.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),a}(mf);function Wv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Xv=function(){function e(t,n,r){Te(this,e),ce(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return Se(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,p=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Wv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wv(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(l);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(!u.box[f]){u.box[f]=!0;var d=4*f;if(e<=h[d+2]&&t<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(e){p.e(e)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.xCellCount*f+p;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}();const Zv=Xv;var qv=function(){function t(e,n){Te(this,t),ce(this,"viewportPadding",100),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new Zv(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return Se(t,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(t,n,r){var i=ms(n,r,0,1),o=vs();return gs(o,i,Jo.apply(e,Pt(t))),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),t}();function Yv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Kv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kv(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Kv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qv(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function Jv(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function $v(e,t,n,r,i,o,a){var s,u=(t-n)*i,l=(-r*a+.5)*o,c=Yv(e);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(e){c.e(e)}finally{c.f()}}function em(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var tm='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',nm='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',rm=Sn.isEqual;function im(e){var t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=t.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return t.glyphInfoMap[n].glyphQuads.forEach((function(e,t){r.push.apply(r,Pt(a).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],Pt(a),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],Pt(a),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],Pt(a),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),i.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:r,indices:i,size:7}}var om=function(e){Ce(u,e);var t,n,r,i,o,a,s=(o=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(o);if(a){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=s.call.apply(s,[this].concat(n))),"glyphInfoMap",{}),ce(Re(e),"currentZoom",-1),ce(Re(e),"textureHeight",0),ce(Re(e),"textCount",0),ce(Re(e),"preTextStyle",{}),ce(Re(e),"mapping",ir(sr().mark((function t(){return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return Se(u,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,l=e.raisingHeight,c=void 0===l?0:l,h=this.getFontServiceMapping(),p=this.getFontServiceCanvas();return h&&Object.keys(h).length!==this.textCount&&p&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle(),pe({u_raisingHeight:Number(c),u_stroke_width:i,u_stroke_color:St(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null==p?void 0:p.width)||1,(null==p?void 0:p.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:(i=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),e.abrupt("return",this.buildModels());case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"buildModels",value:(r=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:nm,fragmentShader:tm,inject:this.getInject(),triangulation:im.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,a=t.textOffset,s=t.padding,u=t.fontFamily,l=t.fontWeight,rm(s,this.preTextStyle.padding)&&rm(a,this.preTextStyle.textOffset)&&rm(o,this.preTextStyle.textAnchor)&&rm(u,this.preTextStyle.fontFamily)&&rm(l,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:case 13:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(c=this.mapService.getZoom(),h=this.mapService.getBounds(),p=Yn(this.extent,h),!(Math.abs(this.currentZoom-c)>.5)&&p&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Hh.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Hh.Attribute,descriptor:{name:"a_tex",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){return qn(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return em(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?em(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r=r.toString());try{for(o.s();!(t=o.n()).done;){var a=t.value;-1===i.indexOf(a)&&i.push(a)}}catch(e){o.e(e)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,l=e.textAnchor,c=void 0===l?"center":l,h=e.textOffset,p=void 0===h?[0,0]:h,f=e.opacity,d=void 0===f?1:f,v=e.strokeOpacity,m=void 0===v?1:v,g=e.strokeWidth,y=void 0===g?0:g,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:c,textOffset:p,opacity:d,strokeOpacity:m,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,l=this.rawEncodeData;this.glyphInfo=l.map((function(r){var i=r.shape,a=void 0===i?"":i,l=r.id,c=r.size,h=void 0===c?1:c,p=r.textOffset?r.textOffset:u||[0,0],f=r.textAnchor?r.textAnchor:s||"center",d=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?function(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==p){var i=s-a;l=Math.max(i,l),Jv(c,t,p,c.length-1,h)}s=0,u-=r+5}));var f=Qv(i),d=f.horizontalAlign,v=f.verticalAlign;$v(c,h,d,v,l,r,n.length);var m=u- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-d*l,e.right=e.left+l}(c,t,u,n,r,i,o):function(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==p){var n=s-a;l=Math.max(n,l),Jv(c,t,p,c.length-1,h)}s=0,u-=r+5}));var f=Qv(i),d=f.horizontalAlign,v=f.verticalAlign;$v(c,h,d,v,l,r,n.length);var m=u- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-d*l,e.right=e.left+l}(c,t,u,n,r,i,o),!!l.length&&c}(a.toString(),n,h,f,"left",o,p,e),v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=[],a=Yv(void 0===i?[]:i);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=s.metrics,l=u.advance*s.scale/2,c=r?[s.x+l,s.y]:[0,0],h=r?[0,0]:[s.x+l+n[0],s.y+n[1]],p=-4*s.scale-l+h[0],f=-4*s.scale+h[1],d=p+u.width*s.scale,v=f+u.height*s.scale,m={x:p,y:f},g={x:d,y:f},y={x:p,y:v},_={x:d,y:v};o.push({tl:m,tr:g,bl:y,br:_,tex:u,glyphOffset:c})}}catch(e){a.e(e)}finally{a.f()}return o}(d,p,!1);return r.shaping=d,r.glyphQuads=v,r.centroid=Qn(r.coordinates),r.originCentroid="GAODE2.x"===r.version?Qn(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[l]={shaping:d,glyphQuads:v,centroid:Qn(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(void 0===i||!i){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new qv(a,s),l=this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/16,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length||(u.insertCollisionBox(c,o),0))}));l.forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:hu.LINEAR,min:hu.LINEAR,width:t.width,height:t.height})}},{key:"reBuildModel",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:nm,fragmentShader:tm,triangulation:im.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),u}(mf);const am={fillImage:Uv,fill:zv,radar:Hv,image:jv,normal:Vv,simplePoint:Pv,extrude:Fv,text:om,earthFill:Nv,earthExtrude:Dv};function sm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var um=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"type","PointLayer"),ce(Re(e),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),ce(Re(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),ce(Re(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return Se(a,[{key:"buildModels",value:(n=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new am[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return sm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?sm(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(e){a.e(e)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=t.billboard,o=void 0===i||i,a=this.iconService.getIconMap(),s=e.find((function(e){return e.hasOwnProperty("shape")}));if(s){var u=s.shape;return"dot"===u?"normal":"simple"===u?"simplePoint":"radar"===u?"radar":"fillImage"===this.layerType||!1===o?"fillImage":-1!==(null==n?void 0:n.indexOf(u))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(u))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":a.hasOwnProperty(u)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),a}(sf);var lm=function(e){Ce(s,e);var t,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(o){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function s(){return Te(this,s),a.apply(this,arguments)}return Se(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.heightfixed,n=void 0!==t&&t,r=e.raisingHeight,i=void 0===r?0:r,o=e.topsurface,a=void 0===o||o,s=e.sidesurface,u=void 0===s||s,l=e.sourceColor,c=e.targetColor,h=0,p=[1,1,1,1],f=[1,1,1,1];return l&&c&&(p=St(l),f=St(c),h=1),pe({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:h,u_sourceColor:p,u_targetColor:f,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:(r=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=ir(sr().mark((function e(){var t,n,r,i,o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:Xd});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {// 是否是边缘\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\n\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\n\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],i=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var o=Ot(this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),2),a=o[0],s=o[1],u=Ot(this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),2),l=u[0],c=u[1];r=l-a,i=c-s,t=[a,s,l,c]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Hh.Attribute,descriptor:{name:"a_uvs",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,n,o){var a=o[0],s=o[1];return[(a-t[0])/r,(s-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(t=ir(sr().mark((function e(){var t,n,r,i=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e,t){var o=new Image;o.crossOrigin="anonymous",o.src=n,o.onload=function(){return i.texture=r({data:o,width:o.width,height:o.height,wrapS:hu.CLAMP_TO_EDGE,wrapT:hu.CLAMP_TO_EDGE,min:hu.LINEAR,mag:hu.LINEAR}),e(null)},o.onerror=function(){t(new Error("image load error"))}})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),s}(mf);var cm=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){return pe({},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:Xd});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'\nuniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n\n  gl_FragColor = v_Color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\n\n\n\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_Color = a_Color;\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Hh.Attribute,descriptor:{name:"a_Normal",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Hh.Attribute,descriptor:{name:"a_Size",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),a}(mf);var hm=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return pe({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,i=t.triangulation,o=t.type,this.layer.triangulation=i,e.next=4,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:hu.TRIANGLES,depth:{enable:!1}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Hh.Attribute,descriptor:{name:"a_linear",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:Hd}:{frag:'varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\n\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n \n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:Ti}}}]),a}(mf);var pm=Sn.isNumber,fm=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,o=e.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:St(i),u_watercolor2:St(a),u_opacity:pm(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\n\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:Vd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=Ot(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Hh.Attribute,descriptor:{name:"a_uv",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,r,i,s){var u=Ot("GAODE2.x"===e.version?e.originCoordinates[0][s]:i,2),l=u[0],c=u[1];return[(l-t)/o,(c-n)/a]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(e){return i({data:e,width:e.width,height:e.height,wrapS:hu.MIRRORED_REPEAT,wrapT:hu.MIRRORED_REPEAT,min:hu.LINEAR,mag:hu.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),e=function(e){r.texture1=a(e[0]),r.texture2=a(e[1]),r.texture3=a(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]),a}(mf);var dm=Sn.isNumber,vm=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:dm(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\n\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:Vd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=Ot(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Hh.Attribute,descriptor:{name:"a_uv",buffer:{usage:hu.STATIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,r,i,s){var u=Ot("GAODE2.x"===e.version?e.originCoordinates[0][s]:i,2),l=u[0],c=u[1];return[(l-t)/o,(c-n)/a]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:hu.MIRRORED_REPEAT,wrapT:hu.MIRRORED_REPEAT,min:hu.LINEAR,mag:hu.LINEAR}),e.layerService.reRender()}}}]),a}(mf);const mm={fill:hm,line:Tv,extrude:lm,text:om,point_fill:zv,point_image:jv,point_normal:Vv,point_extrude:Fv,water:vm,ocean:fm,extrusion:cm};var gm=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","PolygonLayer"),ce(Re(e),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new mm[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"extrusion"===n?"extrusion":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),o}(sf);var ym=Sn.isNumber;const _m={fill:function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:ym(n)?n:0,u_color:St(i)}}},{key:"initModels",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\n\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Vd,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),a}(mf)};var xm,bm,Em,wm,Sm,Tm,Am,Cm,Rm=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","MaskLayer"),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new _m[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),o}(sf),Mm=Sn.cloneDeep,km=(xm=(0,Lo.b2)(),bm=(0,Lo.f3)(Oo.IMapService),Em=(0,Lo.f3)(Oo.IFontService),xm((Sm=function(){function e(){Te(this,e),fs(this,"mapService",Tm,this),fs(this,"fontService",Am,this)}return Se(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("DataMappingPlugin",ir(sr().mark((function t(){return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(Bh,as.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(zh,as.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=ir(sr().mark((function t(i){var o;return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(Bh,as.UPDATE),o=n.generateMaping(e,{styleAttributeService:r}),e.log(zh,as.UPDATE),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var l=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),(0!==a.length||0!==e.encodeDataLength)&&(e.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(e,t,n,r){var i=this,o=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),a=n.map((function(e,t){var n=r?r[t]:{},a=pe({id:e._id,coordinates:e.coordinates},n);return o.forEach((function(t){var n=i.applyAttributeMapping(t,e);"color"!==t.name&&"stroke"!==t.name||(n=n.map((function(e){return St(e)}))),a[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(a.shape=i.fontService.getIconFontKey(a[t.name]))})),a}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2Amap2Coordinates(a,e),this.adjustData2SimpleCoordinates(a),a}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&"GAODE2.x"===this.mapService.version){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version="GAODE2.x",e.originCoordinates=Mm(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&"SIMPLE"===this.mapService.version&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n,r,i=(n=[t[0]-e[0],t[1]-e[1]],r=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}(n,[0,0]),[n[0]/r,n[1]/r]);return[e[0]+1e-4*i[0],e[1]+1e-4*i[1]]}}]),e}(),Tm=ds(Sm.prototype,"mapService",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=ds(Sm.prototype,"fontService",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=Sm))||wm),Im=(0,Lo.b2)()(Cm=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(Oo.IMapService),e.hooks.init.tapPromise("DataSourcePlugin",ir(sr().mark((function n(){var r,i,o,a;return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(Oh,as.INIT),(r=e.getSource())||(i=e.sourceOption||e.defaultSourceConfig,o=i.data,a=i.options,r=new Ap(o,a),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(Dh,as.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(Dh,as.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",ir(sr().mark((function n(){var r,i,o;return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}())||Cm;function Lm(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Pm(e){var t;return 1===e.length&&(t=e,e=function(e,n){return Lm(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var Om=Pm(Lm),Dm=Om.right;Om.left;const Nm=Dm;function Fm(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var Bm=Array.prototype,zm=(Bm.slice,Bm.map,Math.sqrt(50)),Um=Math.sqrt(10),jm=Math.sqrt(2);function Gm(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=Vm(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function Vm(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=zm?10:o>=Um?5:o>=jm?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=zm?10:o>=Um?5:o>=jm?2:1)}function Hm(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=zm?i*=10:o>=Um?i*=5:o>=jm&&(i*=2),t<e?-i:i}function Wm(e){return null===e?NaN:+e}function Xm(e,t,n){if(null==n&&(n=Wm),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function Zm(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function qm(e){return function(){return e}}function Ym(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):qm(isNaN(e)?t:e)}const Km=function e(t){var n=function(e){return 1==(e=+e)?Ym:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):qm(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=vt(e)).r,(t=vt(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=Ym(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function Qm(e){return function(t){var n,r,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=vt(t[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=e(o),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=o(e),r.g=a(e),r.b=s(e),r+""}}}var Jm=Qm((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return Zm((n-r/t)*t,a,i,o,s)}})),$m=(Qm((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return Zm((n-r/t)*t,i,o,a,s)}})),"$");function eg(){}function tg(e,t){var n=new eg;if(e instanceof eg)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}eg.prototype=tg.prototype={constructor:eg,has:function(e){return $m+e in this},get:function(e){return this[$m+e]},set:function(e,t){return this[$m+e]=t,this},remove:function(e){var t=$m+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===$m&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===$m&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===$m&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===$m&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===$m&&++e;return e},empty:function(){for(var e in this)if(e[0]===$m)return!1;return!0},each:function(e){for(var t in this)t[0]===$m&&e(this[t],t.slice(1),this)}};const ng=tg;function rg(){}var ig=ng.prototype;rg.prototype=function(e,t){var n=new rg;if(e instanceof rg)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:rg,has:ig.has,add:function(e){return this[$m+(e+="")]=e,this},remove:ig.remove,clear:ig.clear,values:ig.keys,size:ig.size,empty:ig.empty,each:ig.each};var og=Array.prototype,ag=og.map,sg=og.slice;function ug(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function lg(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}var cg={name:"implicit"};function hg(){var e=ng(),t=[],n=[],r=cg;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==cg)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=ng();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=sg.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return hg(t,n).unknown(r)},ug.apply(i,arguments),i}function pg(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=xg(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function fg(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function dg(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function vg(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=xg(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var mg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gg=new RegExp(mg.source,"g");function yg(e,t){var n,r,i,o=mg.lastIndex=gg.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=mg.exec(e))&&(r=gg.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:dg(n,r)})),o=gg.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function _g(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function xg(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?qm(t):("number"===i?dg:"string"===i?(n=pt(t))?(t=n,Km):yg:t instanceof pt?Km:t instanceof Date?fg:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?pg:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?vg:dg:_g))(e,t)}function bg(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Eg(e){return+e}var wg=[0,1];function Sg(e){return e}function Tg(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Ag(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function Cg(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=Tg(i,r),o=n(a,o)):(r=Tg(r,i),o=n(o,a)),function(e){return o(r(e))}}function Rg(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Tg(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=Nm(e,t,1,r)-1;return o[n](i[n](t))}}function Mg(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function kg(){var e,t,n,r,i,o,a=wg,s=wg,u=xg,l=Sg;function c(){return r=Math.min(a.length,s.length)>2?Rg:Cg,i=o=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((o||(o=r(s,a.map(e),dg)))(n)))},h.domain=function(e){return arguments.length?(a=ag.call(e,Eg),l===Sg||(l=Ag(a)),c()):a.slice()},h.range=function(e){return arguments.length?(s=sg.call(e),c()):s.slice()},h.rangeRound=function(e){return s=sg.call(e),u=bg,c()},h.clamp=function(e){return arguments.length?(l=e?Ag(a):Sg,h):l!==Sg},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function Ig(e,t){return kg()(e,t)}var Lg,Pg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Og(e){if(!(t=Pg.exec(e)))throw new Error("invalid format: "+e);var t;return new Dg({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Dg(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Ng(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Fg(e){return(e=Ng(Math.abs(e)))?e[1]:NaN}function Bg(e,t){var n=Ng(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Og.prototype=Dg.prototype,Dg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const zg={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Bg(100*e,t)},r:Bg,s:function(e,t){var n=Ng(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(Lg=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ng(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ug(e){return e}var jg,Gg,Vg,Hg=Array.prototype.map,Wg=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xg(e){var t=e.domain;return e.ticks=function(e){var n=t();return Gm(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return function(e,t,n,r){var i,o=Hm(e,t,n);switch((r=Og(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Fg(t)/3)))-Fg(Math.abs(e)))}(o,a))||(r.precision=i),Vg(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Fg(t)-Fg(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-Fg(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Gg(r)}(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=Vm(s,u,n))>0?r=Vm(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=Vm(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function Zg(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function qg(e){return Math.log(e)}function Yg(e){return Math.exp(e)}function Kg(e){return-Math.log(-e)}function Qg(e){return-Math.exp(-e)}function Jg(e){return isFinite(e)?+("1e"+e):e<0?0:e}function $g(e){return function(t){return-e(-t)}}function ey(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ty(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ny(e){return e<0?-e*e:e*e}jg=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Ug:(t=Hg.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Ug:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Hg.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=Og(e)).fill,n=e.align,h=e.sign,p=e.symbol,f=e.zero,d=e.width,v=e.comma,m=e.precision,g=e.trim,y=e.type;"n"===y?(v=!0,y="g"):zg[y]||(void 0===m&&(m=12),g=!0,y="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var _="$"===p?i:"#"===p&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===p?o:/[%p]/.test(y)?u:"",b=zg[y],E=/[defgprs%]/.test(y);function w(e){var i,o,u,p=_,w=x;if("c"===y)w=b(e)+w,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:b(Math.abs(e),m),g&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==h&&(S=!1),p=(S?"("===h?h:l:"-"===h||"("===h?"":h)+p,w=("s"===y?Wg[8+Lg/3]:"")+w+(S&&"("===h?")":""),E)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){w=(46===u?a+e.slice(i+1):e.slice(i))+w,e=e.slice(0,i);break}}v&&!f&&(e=r(e,1/0));var T=p.length+e.length+w.length,A=T<d?new Array(d-T+1).join(t):"";switch(v&&f&&(e=r(A+e,A.length?d-w.length:1/0),A=""),n){case"<":e=p+e+w+A;break;case"=":e=p+A+e+w;break;case"^":e=A.slice(0,T=A.length>>1)+p+e+w+A.slice(T);break;default:e=A+p+e+w}return s(e)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),w.toString=function(){return e+""},w}return{format:h,formatPrefix:function(e,t){var n=h(((e=Og(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Fg(t)/3))),i=Math.pow(10,-r),o=Wg[8+r/3];return function(e){return n(i*e)+o}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Gg=jg.format,Vg=jg.formatPrefix;var ry=new Date,iy=new Date;function oy(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return oy((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return ry.setTime(+t),iy.setTime(+r),e(ry),e(iy),Math.floor(n(ry,iy))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var ay=oy((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));ay.every=function(e){return isFinite(e=Math.floor(e))&&e>0?oy((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};const sy=ay;ay.range;var uy=oy((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));const ly=uy;uy.range;var cy=1e3,hy=6e4,py=36e5,fy=864e5,dy=6048e5;function vy(e){return oy((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*hy)/dy}))}var gy=vy(0),yy=vy(1),_y=vy(2),xy=vy(3),by=vy(4),Ey=vy(5),wy=vy(6),Sy=(gy.range,yy.range,_y.range,xy.range,by.range,Ey.range,wy.range,oy((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*hy)/fy}),(function(e){return e.getDate()-1})));const Ty=Sy;Sy.range;var Ay=oy((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*cy-e.getMinutes()*hy)}),(function(e,t){e.setTime(+e+t*py)}),(function(e,t){return(t-e)/py}),(function(e){return e.getHours()}));const Cy=Ay;Ay.range;var Ry=oy((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*cy)}),(function(e,t){e.setTime(+e+t*hy)}),(function(e,t){return(t-e)/hy}),(function(e){return e.getMinutes()}));const My=Ry;Ry.range;var ky=oy((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*cy)}),(function(e,t){return(t-e)/cy}),(function(e){return e.getUTCSeconds()}));const Iy=ky;ky.range;var Ly=oy((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));Ly.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?oy((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Ly:null};const Py=Ly;function Oy(e){return oy((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/dy}))}Ly.range;var Dy=Oy(0),Ny=Oy(1),Fy=Oy(2),By=Oy(3),zy=Oy(4),Uy=Oy(5),jy=Oy(6),Gy=(Dy.range,Ny.range,Fy.range,By.range,zy.range,Uy.range,jy.range,oy((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/fy}),(function(e){return e.getUTCDate()-1})));const Vy=Gy;Gy.range;var Hy=oy((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));Hy.every=function(e){return isFinite(e=Math.floor(e))&&e>0?oy((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const Wy=Hy;function Xy(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Zy(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function qy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}Hy.range;var Yy,Ky,Qy={"-":"",_:" ",0:"0"},Jy=/^\s*\d+/,$y=/^%/,e_=/[\\^$*+?|[\]().{}]/g;function t_(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function n_(e){return e.replace(e_,"\\$&")}function r_(e){return new RegExp("^(?:"+e.map(n_).join("|")+")","i")}function i_(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function o_(e,t,n){var r=Jy.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function a_(e,t,n){var r=Jy.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function s_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function u_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function l_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function c_(e,t,n){var r=Jy.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function h_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function p_(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function f_(e,t,n){var r=Jy.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function d_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function v_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function m_(e,t,n){var r=Jy.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function g_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function y_(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function __(e,t,n){var r=Jy.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function x_(e,t,n){var r=Jy.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function b_(e,t,n){var r=Jy.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function E_(e,t,n){var r=$y.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function w_(e,t,n){var r=Jy.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function S_(e,t,n){var r=Jy.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function T_(e,t){return t_(e.getDate(),t,2)}function A_(e,t){return t_(e.getHours(),t,2)}function C_(e,t){return t_(e.getHours()%12||12,t,2)}function R_(e,t){return t_(1+Ty.count(sy(e),e),t,3)}function M_(e,t){return t_(e.getMilliseconds(),t,3)}function k_(e,t){return M_(e,t)+"000"}function I_(e,t){return t_(e.getMonth()+1,t,2)}function L_(e,t){return t_(e.getMinutes(),t,2)}function P_(e,t){return t_(e.getSeconds(),t,2)}function O_(e){var t=e.getDay();return 0===t?7:t}function D_(e,t){return t_(gy.count(sy(e)-1,e),t,2)}function N_(e){var t=e.getDay();return t>=4||0===t?by(e):by.ceil(e)}function F_(e,t){return e=N_(e),t_(by.count(sy(e),e)+(4===sy(e).getDay()),t,2)}function B_(e){return e.getDay()}function z_(e,t){return t_(yy.count(sy(e)-1,e),t,2)}function U_(e,t){return t_(e.getFullYear()%100,t,2)}function j_(e,t){return t_((e=N_(e)).getFullYear()%100,t,2)}function G_(e,t){return t_(e.getFullYear()%1e4,t,4)}function V_(e,t){var n=e.getDay();return t_((e=n>=4||0===n?by(e):by.ceil(e)).getFullYear()%1e4,t,4)}function H_(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+t_(t/60|0,"0",2)+t_(t%60,"0",2)}function W_(e,t){return t_(e.getUTCDate(),t,2)}function X_(e,t){return t_(e.getUTCHours(),t,2)}function Z_(e,t){return t_(e.getUTCHours()%12||12,t,2)}function q_(e,t){return t_(1+Vy.count(Wy(e),e),t,3)}function Y_(e,t){return t_(e.getUTCMilliseconds(),t,3)}function K_(e,t){return Y_(e,t)+"000"}function Q_(e,t){return t_(e.getUTCMonth()+1,t,2)}function J_(e,t){return t_(e.getUTCMinutes(),t,2)}function $_(e,t){return t_(e.getUTCSeconds(),t,2)}function ex(e){var t=e.getUTCDay();return 0===t?7:t}function tx(e,t){return t_(Dy.count(Wy(e)-1,e),t,2)}function nx(e){var t=e.getUTCDay();return t>=4||0===t?zy(e):zy.ceil(e)}function rx(e,t){return e=nx(e),t_(zy.count(Wy(e),e)+(4===Wy(e).getUTCDay()),t,2)}function ix(e){return e.getUTCDay()}function ox(e,t){return t_(Ny.count(Wy(e)-1,e),t,2)}function ax(e,t){return t_(e.getUTCFullYear()%100,t,2)}function sx(e,t){return t_((e=nx(e)).getUTCFullYear()%100,t,2)}function ux(e,t){return t_(e.getUTCFullYear()%1e4,t,4)}function lx(e,t){var n=e.getUTCDay();return t_((e=n>=4||0===n?zy(e):zy.ceil(e)).getUTCFullYear()%1e4,t,4)}function cx(){return"+0000"}function hx(){return"%"}function px(e){return+e}function fx(e){return Math.floor(+e/1e3)}Yy=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=r_(i),c=i_(i),h=r_(o),p=i_(o),f=r_(a),d=i_(a),v=r_(s),m=i_(s),g=r_(u),y=i_(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:T_,e:T_,f:k_,g:j_,G:V_,H:A_,I:C_,j:R_,L:M_,m:I_,M:L_,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:px,s:fx,S:P_,u:O_,U:D_,V:F_,w:B_,W:z_,x:null,X:null,y:U_,Y:G_,Z:H_,"%":hx},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:W_,e:W_,f:K_,g:sx,G:lx,H:X_,I:Z_,j:q_,L:Y_,m:Q_,M:J_,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:px,s:fx,S:$_,u:ex,U:tx,V:rx,w:ix,W:ox,x:null,X:null,y:ax,Y:ux,Z:cx,"%":hx},b={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return S(e,t,n,r)},d:v_,e:v_,f:b_,g:h_,G:c_,H:g_,I:g_,j:m_,L:x_,m:d_,M:y_,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:f_,Q:w_,s:S_,S:__,u:a_,U:s_,V:u_,w:o_,W:l_,x:function(e,t,r){return S(e,n,t,r)},X:function(e,t,n){return S(e,r,t,n)},y:h_,Y:c_,Z:p_,"%":E_};function E(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=Qy[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function w(e,t){return function(n){var r,i,o=qy(1900,void 0,1);if(S(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Zy(qy(o.y,0,1))).getUTCDay(),r=i>4||0===i?Ny.ceil(r):Ny(r),r=Vy.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Xy(qy(o.y,0,1))).getDay(),r=i>4||0===i?yy.ceil(r):yy(r),r=Ty.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Zy(qy(o.y,0,1)).getUTCDay():Xy(qy(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Zy(o)):Xy(o)}}function S(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=b[i in Qy?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=E(n,_),_.X=E(r,_),_.c=E(t,_),x.x=E(n,x),x.X=E(r,x),x.c=E(t,x),{format:function(e){var t=E(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=w(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=w(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Ky=Yy.format,Yy.parse,Yy.utcFormat,Yy.utcParse;var dx,vx,mx=1e3,gx=6e4,yx=36e5,_x=864e5,xx=2592e6,bx=31536e6;function Ex(e){return new Date(e)}function Sx(e){return e instanceof Date?+e:+new Date(+e)}function Tx(e,t,n,r,i,o,a,s,u){var l=Ig(Sg,Sg),c=l.invert,h=l.domain,p=u(".%L"),f=u(":%S"),d=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),g=u("%b %d"),y=u("%B"),_=u("%Y"),x=[[a,1,mx],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,gx],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,yx],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,_x],[r,2,1728e5],[n,1,6048e5],[t,1,xx],[t,3,7776e6],[e,1,bx]];function b(s){return(a(s)<s?p:o(s)<s?f:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?m:g:e(s)<s?y:_)(s)}function E(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=Pm((function(e){return e[2]})).right(x,o);a===x.length?(i=Hm(n/bx,r/bx,t),t=e):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(Hm(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(ag.call(e,Sx)):h().map(Ex)},l.ticks=function(e,t){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=E(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(e,t){return null==t?b:u(t)},l.nice=function(e,t){var n=h();return(e=E(e,n[0],n[n.length-1],t))?h(Zg(n,e)):l},l.copy=function(){return Mg(l,Tx(e,t,n,r,i,o,a,s,u))},l}function Ax(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}var Cx,Rx,Mx=Sn.isNil,kx=Sn.isString,Ix=Sn.uniq,Lx=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Px=(ce(dx={},Gh.LINEAR,(function e(){var t=Ig(Sg,Sg);return t.copy=function(){return Mg(t,e())},ug.apply(t,arguments),Xg(t)})),ce(dx,Gh.POWER,(function e(){var t=function(e){var t=e(Sg,Sg),n=1;return t.exponent=function(t){return arguments.length?1==(n=+t)?e(Sg,Sg):.5===n?e(ty,ny):e(ey(n),ey(1/n)):n},Xg(t)}(kg());return t.copy=function(){return Mg(t,e()).exponent(t.exponent())},ug.apply(t,arguments),t})),ce(dx,Gh.LOG,(function e(){var t=function(e){var t,n,r=e(qg,Yg),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?Jg:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=$g(t),n=$g(n),e(Kg,Qg)):e(qg,Yg),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(p=s,s=u,u=p);var l,c,h,p=t(s),f=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&f-p<d){if(p=Math.round(p)-1,f=Math.round(f)+1,s>0){for(;p<f;++p)for(c=1,l=n(p);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;p<f;++p)for(c=o-1,l=n(p);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=Gm(p,f,Math.min(f-p,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Gg(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(Zg(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}(kg()).domain([1,10]);return t.copy=function(){return Mg(t,e()).base(t.base())},ug.apply(t,arguments),t})),ce(dx,Gh.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e(t).unknown(n)},i})),ce(dx,Gh.SEQUENTIAL,(function e(){var t=Xg(function(){var e,t,n,r,i,o=0,a=1,s=Sg,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),l):[o,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),l}}()(Sg));return t.copy=function(){return Ax(t,e())},lg.apply(t,arguments)})),ce(dx,Gh.TIME,(function(){return ug.apply(Tx(sy,ly,gy,Ty,Cy,My,Iy,Py,Ky).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),ce(dx,Gh.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=Xm(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[Nm(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(Lm),o()},a.range=function(e){return arguments.length?(r=sg.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},ug.apply(a,arguments)})),ce(dx,Gh.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[Nm(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=sg.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},ug.apply(Xg(s),arguments)})),ce(dx,Gh.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[Nm(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=sg.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=sg.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},ug.apply(o,arguments)})),ce(dx,Gh.CAT,hg),ce(dx,Gh.DIVERGING,(function e(){var t=Xg(function(){var e,t,n,r,i,o,a,s=0,u=.5,l=1,c=Sg,h=!1;function p(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),c(h?Math.max(0,Math.min(1,e)):e))}return p.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(l=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),p):[s,u,l]},p.clamp=function(e){return arguments.length?(h=!!e,p):h},p.interpolator=function(e){return arguments.length?(c=e,p):c},p.unknown=function(e){return arguments.length?(a=e,p):a},function(a){return o=a,e=a(s),t=a(u),n=a(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),p}}()(Sg));return t.copy=function(){return Ax(t,e())},lg.apply(t,arguments)})),dx),Ox=(0,Lo.b2)()(vx=function(){function e(){Te(this,e),ce(this,"scaleOptions",{})}return Se(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",ir(sr().mark((function t(){var i,o,a;return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(Nh,as.INIT),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:e.log(Fh,as.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=ir(sr().mark((function t(i){var o,a;return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(Nh,as.UPDATE),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=e.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),e.log(Fh,as.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale,i=e.scale.field;r.names=n.parseFields(Mx(i)?[]:i);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,e.name,null===(i=e.scale)||void 0===i?void 0:i.values,t))})),o.some((function(e){return e.type===Vh.VARIABLE}))?(r.type=Vh.VARIABLE,o.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case Gh.LOG:case Gh.LINEAR:case Gh.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case Gh.QUANTILE:case Gh.QUANTIZE:case Gh.THRESHOLD:e.scale.range(r.values);break;case Gh.IDENTITY:break;case Gh.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case Gh.DIVERGING:case Gh.SEQUENTIAL:e.scale.interpolator(Jm(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=Vh.CONSTANT,r.defaultValues=o.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:kx(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,o,a=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:Vh.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=hg([e]),s.type=Vh.CONSTANT),s;var u=null===(o=r.find((function(t){return!Mx(t[e])})))||void 0===o?void 0:o[e];if(this.isNumber(e)||Mx(u)&&!a)s.scale=hg([e]),s.type=Vh.CONSTANT;else{var l=a&&a.type||this.getDefaultType(u);"text"===n&&(l=Gh.CAT),void 0===n&&(l=Gh.IDENTITY);var c=this.createScaleConfig(l,e,a,r);s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(e){var t=Gh.LINEAR;return"string"==typeof e&&(t=Lx.test(e)?Gh.TIME:Gh.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i={type:e},o=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(e===Gh.CAT||e===Gh.IDENTITY)i.domain=Ix(o);else if(e===Gh.QUANTILE)i.domain=o;else if(e===Gh.DIVERGING){var a=Fm(o),s=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(a[0]+a[1])/2;i.domain=[a[0],s,a[1]]}else i.domain=Fm(o);return pe(pe({},i),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Px[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),e}())||vx,Dx=(0,Lo.b2)()(Cx=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(pe({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}())||Cx,Nx=(0,Lo.b2)()(Rx=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t,n=e.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!e.tileLayer&&r&&r.length>0&&((t=e.masks).push.apply(t,Pt(r)),e.updateLayerConfig({mask:i}))}))}}]),e}())||Rx,Fx=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;Te(this,e),ce(this,"tileResource",new Map),ce(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var t;return Se(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);if(e.isVisible)if(e.parent){var n=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(n)}else null==t||t.updateVisible(!0);else if(e.parent){var r=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(!r)}else null==t||t.updateVisible(!1)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.every((function(e){var n=t.getTile(null==e?void 0:e.key);return!n||!0===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(t=ir(sr().mark((function e(){var t,n,r=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,Pt(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,Pt(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}();var Bx=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function zx(e,t){return e>t?1:e<t?-1:0}function Ux(e,t,n){for(var r=new Bx(null,null),i=r,o=r;;){var a=n(e,t.key);if(a<0){if(null===t.left)break;if(n(e,t.left.key)<0){var s=t.left;if(t.left=s.right,s.right=t,null===(t=s).left)break}o.left=t,o=t,t=t.left}else{if(!(a>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(s=t.right,t.right=s.left,s.left=t,null===(t=s).right))break;i.right=t,i=t,t=t.right}}return i.right=t.left,o.left=t.right,t.left=r.right,t.right=r.left,t}function jx(e,t,n,r){var i=new Bx(e,t);if(null===n)return i.left=i.right=null,i;var o=r(e,(n=Ux(e,n,r)).key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function Gx(e,t,n){var r=null,i=null;if(t){var o=n((t=Ux(e,t,n)).key,e);0===o?(r=t.left,i=t.right):o<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}function Vx(e,t,n,r,i){if(e){r(t+(n?"└── ":"├── ")+i(e)+"\n");var o=t+(n?"    ":"│   ");e.left&&Vx(e.left,o,!1,r,i),e.right&&Vx(e.right,o,!0,r,i)}}var Hx=function(){function e(e){void 0===e&&(e=zx),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=jx(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new Bx(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,i=Ux(e,this._root,r),o=r(e,i.key);return 0===o?this._root=i:(o<0?(n.left=i.left,n.right=i,i.left=null):o>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=Ux(e,t,n)).key)?(null===t.left?r=t.right:(r=Ux(e,t.left,n)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ux(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=Ux(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){for(var t=e,n=[],r=!1,i=new Bx(null,null),o=i;!r;)t?(n.push(t),t=t.left):n.length>0?t=(t=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var r=e.length,i=this._comparator;if(n&&Zx(e,t,0,r-1,i),null===this._root)this._root=Wx(e,t,0,r),this._size=r;else{var o=function(e,t,n){for(var r=new Bx(null,null),i=r,o=e,a=t;null!==o&&null!==a;)n(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return null!==o?i.next=o:null!==a&&(i.next=a),r.next}(this.toList(),function(e,t){for(var n=new Bx(null,null),r=n,i=0;i<e.length;i++)r=r.next=new Bx(e[i],t[i]);return r.next=null,n.next}(e,t),i);r=this._size+r,this._root=Xx({head:o},0,r)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return Vx(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=Gx(e,this._root,r),o=i.left,a=i.right;r(e,t)<0?a=jx(t,n,a,r):o=jx(t,n,o,r),this._root=function(e,t,n){return null===t?e:(null===e||((t=Ux(e.key,t,n)).left=e),t)}(o,a,r)},e.prototype.split=function(e){return Gx(e,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var e,t,n;return function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(r){switch(r.label){case 0:e=this._root,t=[],n=!1,r.label=1;case 1:return n?[3,6]:null===e?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return 0===t.length?[3,4]:[4,e=t.pop()];case 3:return r.sent(),e=e.right,[3,5];case 4:n=!0,r.label=5;case 5:return[3,1];case 6:return[2]}}))},e}();function Wx(e,t,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=e[o],s=t[o],u=new Bx(a,s);return u.left=Wx(e,t,n,o),u.right=Wx(e,t,o+1,r),u}return null}function Xx(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),o=Xx(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=Xx(e,i+1,n),a}return null}function Zx(e,t,n,r,i){if(!(n>=r)){for(var o=e[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(e[a],o)<0);do{s--}while(i(e[s],o)>0);if(a>=s)break;var u=e[a];e[a]=e[s],e[s]=u,u=t[a],t[a]=t[s],t[s]=u}Zx(e,t,n,s,i),Zx(e,t,s+1,r,i)}}const qx=Hx;function Yx(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qx(e,t,n){return t&&Kx(e.prototype,t),n&&Kx(e,n),e}var Jx=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},$x=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},eb=Number.EPSILON;void 0===eb&&(eb=Math.pow(2,-52));var tb=eb*eb,nb=function(e,t){if(-eb<e&&e<eb&&-eb<t&&t<eb)return 0;var n=e-t;return n*n<tb*e*t?0:e<t?-1:1},rb=function(){function e(){Yx(this,e),this.reset()}return Qx(e,[{key:"reset",value:function(){this.xRounder=new ib,this.yRounder=new ib}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),e}(),ib=function(){function e(){Yx(this,e),this.tree=new qx,this.round(0)}return Qx(e,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===nb(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===nb(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),e}(),ob=new rb,ab=function(e,t){return e.x*t.y-e.y*t.x},sb=function(e,t){return e.x*t.x+e.y*t.y},ub=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},o=ab(r,i);return nb(o,0)},lb=function(e){return Math.sqrt(sb(e,e))},cb=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return sb(i,r)/lb(i)/lb(r)},hb=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},pb=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},fb=function(){function e(t,n){Yx(this,e),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return Qx(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vb.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),Qx(e,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},ab(u,s)/lb(u)/lb(s)),cosine:cb(t.point,e.point,l.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}]),e}(),db=0,vb=function(){function e(t,n,r,i){Yx(this,e),this.id=++db,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=i}return Qx(e,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var p=t.comparePoint(e.leftSE.point);if(0!==p)return p;var f=e.comparePoint(t.rightSE.point);return f<0?1:f>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var m=u-a,g=i-n,y=l-s,_=o-r;if(m>g&&y<_)return 1;if(m<g&&y>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}}]),Qx(e,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=$x(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=Jx(t,a)&&0===this.comparePoint(a),l=Jx(n,i)&&0===e.comparePoint(i),c=Jx(t,s)&&0===this.comparePoint(s),h=Jx(n,o)&&0===e.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;var p=function(e,t,n,r){if(0===t.x)return pb(n,r,e.x);if(0===r.x)return pb(e,t,n.x);if(0===t.y)return hb(n,r,e.y);if(0===r.y)return hb(e,t,n.y);var i=ab(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=ab(o,t)/i,s=ab(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===p?null:Jx(r,p)?ob.round(p.x,p.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new fb(t,!0),o=new fb(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return fb.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),fb.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],h=0,p=t.length;h<p;h++)if(0!==n[h]){var f=t[h],d=f.poly;if(-1===c.indexOf(d))if(f.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(f.poly);-1!==v&&l.splice(v,1)}}for(var m=0,g=l.length;m<g;m++){var y=l[m].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Tb.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===Tb.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(Tb.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var i,o,a,s=fb.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}return new e(new fb(i,!0),new fb(o,!1),[r],[a])}}]),e}(),mb=function(){function e(t,n,r){if(Yx(this,e),!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=ob.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,s=t.length;a<s;a++){if("number"!=typeof t[a][0]||"number"!=typeof t[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=ob.round(t[a][0],t[a][1]);u.x===o.x&&u.y===o.y||(this.segments.push(vb.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}i.x===o.x&&i.y===o.y||this.segments.push(vb.fromRing(o,i,this))}return Qx(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),e}(),gb=function(){function e(t,n){if(Yx(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new mb(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=t.length;r<i;r++){var o=new mb(t[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return Qx(e,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),yb=function(){function e(t,n){if(Yx(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=t.length;r<i;r++){var o=new gb(t[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return Qx(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),_b=function(){function e(t){Yx(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return Qx(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,h=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var p=s.getAvailableLinkedEvents();if(0===p.length){var f=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){u=p[0].otherSE;break}for(var v=null,m=0,g=h.length;m<g;m++)if(h[m].point===s.point){v=m;break}if(null===v){h.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(a);u=p.sort(y)[0].otherSE;break}var _=h.splice(v)[0],x=l.splice(_.index);x.unshift(x[0].otherSE),n.push(new e(x.reverse()))}n.push(new e(l))}}return n}}]),Qx(e,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==ub(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===ub(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,h=[],p=l;p!=c;p+=u)h.push([t[p].x,t[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];fb.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),xb=function(){function e(t){Yx(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Qx(e,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),e}(),bb=function(){function e(t){Yx(this,e),this.rings=t,this.polys=this._composePolys(t)}return Qx(e,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new xb(i));else{var o=i.enclosingRing();o.poly||t.push(new xb(o)),o.poly.addInterior(i)}}return t}}]),e}(),Eb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vb.compare;Yx(this,e),this.queue=t,this.tree=new qx(n),this.segments=[]}return Qx(e,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var l=a.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),h=0,p=c.length;h<p;h++)n.push(c[h])}var f=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(f=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),m=0,g=v.length;m<g;m++)n.push(v[m])}if(null!==u||null!==f){var y=null;y=null===u?f:null===f||fb.comparePoints(u,f)<=0?u:f,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var E=a.getIntersection(s);if(null!==E){if(!a.isAnEndpoint(E))for(var w=this._splitSafely(a,E),S=0,T=w.length;S<T;S++)n.push(w[S]);if(!s.isAnEndpoint(E))for(var A=this._splitSafely(s,E),C=0,R=A.length;C<R;C++)n.push(A[C])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),e}(),wb="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Sb="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Tb=new(function(){function e(){Yx(this,e)}return Qx(e,[{key:"run",value:function(e,t,n){Tb.type=e,ob.reset();for(var r=[new yb(t,!0)],i=0,o=n.length;i<o;i++)r.push(new yb(n[i],!1));if(Tb.numMultiPolys=r.length,"difference"===Tb.type)for(var a=r[0],s=1;s<r.length;)null!==$x(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===Tb.type)for(var u=0,l=r.length;u<l;u++)for(var c=r[u],h=u+1,p=r.length;h<p;h++)if(null===$x(c.bbox,r[h].bbox))return[];for(var f=new qx(fb.compare),d=0,v=r.length;d<v;d++)for(var m=r[d].getSweepEvents(),g=0,y=m.length;g<y;g++)if(f.insert(m[g]),f.size>wb)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var _=new Eb(f),x=f.size,b=f.pop();b;){var E=b.key;if(f.size===x){var w=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(w.id," ")+"[".concat(w.leftSE.point.x,", ").concat(w.leftSE.point.y,"] -> ")+"[".concat(w.rightSE.point.x,", ").concat(w.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(f.size>wb)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(_.segments.length>Sb)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var S=_.process(E),T=0,A=S.length;T<A;T++){var C=S[T];void 0===C.consumedBy&&f.insert(C)}x=f.size,b=f.pop()}ob.reset();var R=_b.factory(_.segments);return new bb(R).getGeom()}}]),e}());const Ab=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Tb.run("union",e,n)},Cb=function(e,t,n){void 0===n&&(n={});var r=xe(e),i=xe(t),o=Ab(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?me(o[0],n.properties):function(e,t,n){return void 0===n&&(n={}),ve({type:"MultiPolygon",coordinates:e},t,n)}(o,n.properties)};var Rb=function(){function e(){Te(this,e)}return Se(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=me(e.coordinates);t=null===t?n:Cb(t,n)})),n&&(t.properties=pe({},n)),t}}]),e}(),Mb="select",kb="active",Ib=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;Te(this,e),ce(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new Rb}return Se(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pick",value:function(e,t){var n=this.parent.getContainer().get(Oo.IPickingService);if("RasterLayer"===e.type){var r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r&&void 0!==r.getMainLayer()){var i=r.getMainLayer();return i.layerPickService.pickRasterLayer(i,t,this.parent)}return!1}return this.pickRender(t),n.pickFromPickingFBO(e,t)}},{key:"selectFeature",value:function(e){var t=Ot(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(Mb,o),this.updateHighLight(n,r,i,Mb)}},{key:"highlightPickedFeature",value:function(e){var t=Ot(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(kb,o),this.updateHighLight(n,r,i,kb)}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case Mb:null==o||o.hooks.beforeSelect.call([e,t,n]);break;case kb:null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get(Mb),t=this.tilePickID.get(kb);if(e){var n=Ot(this.pickId2Color(e),3),r=n[0],i=n[1],o=n[2];this.updateHighLight(r,i,o,Mb)}else if(t){var a=Ot(this.pickId2Color(t),3),s=a[0],u=a[1],l=a[2];this.updateHighLight(s,u,l,kb)}}},{key:"color2PickId",value:function(e,t,n){return Tt(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return At(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,Pt(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(e,t,n){return!1}}]),e}();var Lb=function(e){Ce(s,e);var t,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(o){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function s(e,t){var n;return Te(this,s),ce(Re(n=a.call(this)),"visible",!0),ce(Re(n),"layers",[]),ce(Re(n),"isLoaded",!1),ce(Re(n),"tileMaskLayers",[]),n.parent=t,n.sourceTile=e,n.x=e.x,n.y=e.y,n.z=e.z,n.key="".concat(n.x,"_").concat(n.y,"_").concat(n.z),n}return Se(s,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=Ot(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var e,t,n=this.parent.getLayerConfig();return pe(pe({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(t=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(t)),mask:n.mask||0!==(null===(e=n.maskLayers)||void 0===e?void 0:e.length)&&n.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=ir(sr().mark((function e(){var t,n,r;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new gm({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),n=Ph(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=ir(sr().mark((function e(t,n){var r;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ph(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addLayer",value:(t=ir(sr().mark((function e(t){var n;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=Ph(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(ce({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),s}(ur.EventEmitter);var Pb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new Iv).source(t.data,t.options).size(1).shape("line").color("red"),i=new um({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),o}(Lb);var Ob=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:(n=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),e.next=5,t.data.images;case 5:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,mag:hu.LINEAR,min:hu.LINEAR}),e.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n \n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",triangulation:qd,primitive:hu.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return i=e.sent,e.abrupt("return",[i]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),a}(mf);const Db={image:Ob};var Nb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","ImageLayer"),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Db[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),o}(sf);var Fb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Nb(pe({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),o}(Lb);var Bb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Rm(pe({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),o}(Lb);var zb=function(e){Ce(s,e);var t,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(o){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function s(){return Te(this,s),a.apply(this,arguments)}return Se(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=e.rampColors,h=l||Mt(c);return this.colorTexture=this.layer.textureService.getColorTexture(c,h),{u_opacity:n||1,u_texture:this.texture,u_domain:h,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(r=ir(sr().mark((function e(t){var n,r,i,o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:hu.LUMINANCE,type:hu.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",triangulation:qd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(mf),Ub=["data"],jb=["rasterData"];var Gb=function(e){Ce(s,e);var t,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(i);if(o){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=a.call.apply(a,[this].concat(n))),"dataOption",{}),e}return Se(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:(r=ir(sr().mark((function e(t){var n,r,i,o,a;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=v(t,Ub),this.dataOption=r,e.abrupt("return",pe({data:n},r));case 4:return e.next=6,t.data;case 6:if(i=e.sent,o=i.rasterData,a=v(i,jb),this.dataOption=a,!Array.isArray(o)){e.next=14;break}return e.abrupt("return",pe({data:o},a));case 14:return e.abrupt("return",pe({data:Array.from(o)},a));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:hu.RGB,type:hu.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",triangulation:qd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(mf);const Vb={raster:zb,rasterRgb:Gb,raster3d:zb,rasterTerrainRgb:function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){return Te(this,a),o.apply(this,arguments)}return Se(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,l=e.rampColors,c=e.colorTexture,h=e.rScaler,p=void 0===h?6553.6:h,f=e.gScaler,d=void 0===f?25.6:f,v=e.bScaler,m=void 0===v?.1:v,g=e.offset,y=void 0===g?1e4:g,_=u||Mt(l),x=c;return c?this.layer.textureService.setColorTexture(c,l,_):x=this.layer.textureService.getColorTexture(l,_),{u_opacity:t||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_unpack:[p,d,m,y],u_colorTexture:x}}},{key:"initModels",value:(n=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=4,t.data.images;case 4:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:hu.LINEAR,mag:hu.LINEAR}),e.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:qd,primitive:hu.TRIANGLES,depth:{enable:!1}});case 8:return i=e.sent,e.abrupt("return",[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Hh.Attribute,descriptor:{name:"a_Uv",buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),a}(mf)};var Hb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"type","RasterLayer"),e}return Se(o,[{key:"buildModels",value:(t=ir(sr().mark((function e(){var t;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Vb[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}}]),o}(sf),Wb=["rasterData"];var Xb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Hb(pe({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=v(t,Wb);return{data:n,options:{parser:pe({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),o}(Lb);var Zb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Hb(pe({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),o}(Lb),qb=["rasterData"];var Yb={positions:[0,1],colors:["#000","#fff"]},Kb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new Hb(pe(pe({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;s[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=v(t,qb);return{data:n,options:{parser:pe({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?Yb:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||Mt(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),o}(Lb);var Qb=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){return Te(this,o),i.apply(this,arguments)}return Se(o,[{key:"initTileLayer",value:(t=ir(sr().mark((function e(){var t,n,r,i,o;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),a=this.parent.type,r="PolygonLayer"===a?gm:"LineLayer"===a?Iv:um,i=this.getSourceOption()){e.next=8;break}return this.isLoaded=!0,this.emit("loaded"),e.abrupt("return");case 8:return o=new r(pe({},n)).source(i.data,i.options),Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=12,this.addLayer(o);case 12:if(!n.tileMask){e.next=15;break}return e.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(o),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return e.stop()}var a}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();return t?t.getSource().data.dataArray.filter((function(t){return t._id===e})):[]}}]),o}(Lb);function Jb(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return Qb;case"TileDebugLayer":return Pb;case"MaskLayer":return Bb;case"RasterLayer":switch(e.getSource().parser.dataType){case Zh.RGB:case Zh.CUSTOMRGB:return Xb;case Zh.ARRAYBUFFER:case Zh.CUSTOMARRAYBUFFER:return Kb;case Zh.TERRAINRGB:case Zh.CUSTOMTERRAINRGB:return Zb;default:return Fb}default:return Qb}}var $b,eE,tE,nE,rE,iE,oE,aE,sE,uE,lE,cE,hE,pE,fE,dE,vE,mE,gE,yE,_E,xE,bE,EE,wE=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],SE=Sn.debounce,TE=function(){function e(t){var n=this;Te(this,e),ce(this,"initedTileset",!1),ce(this,"mapchange",(function(){var e;if(!1!==n.parent.isVisible()){var t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))}})),ce(this,"viewchange",SE(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(Oo.IRendererService),this.layerService=r.get(Oo.ILayerService),this.mapService=r.get(Oo.IMapService),this.pickingService=r.get(Oo.IPickingService),this.tileLayerService=new Fx({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new Ib({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}var t;return Se(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();if(this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1!==this.parent.isVisible()){var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(t=ir(sr().mark((function e(){var t,n,r=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),e.next=6,Promise.all(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})).map(function(){var e=ir(sr().mark((function e(t){var n,i;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.tileLayerService.hasTile(t.key)){e.next=9;break}return n=Jb(r.parent),i=new n(t,r.parent),e.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(t),r.layerService.reRender()),e.next=12;break;case 9:r.tileLayerService.updateTileVisible(t),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;wE.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]),e}(),AE=(0,Lo.b2)()($b=function(){function e(){Te(this,e)}var t,n,r;return Se(e,[{key:"build",value:(r=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(t=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",ir(sr().mark((function n(){return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=4;break}return e.prepareBuildModel(),e.tileLayer=new TE(e),n.abrupt("return");case 4:return e.log(Uh,as.INIT),n.next=7,t.initLayerModel(e);case 7:e.log(jh,as.INIT);case 8:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=ir(sr().mark((function n(r){return sr().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=5;break}return e.tileLayer=new TE(e),n.abrupt("return",!1);case 5:return e.log(Uh,as.UPDATE),n.next=8,t.prepareLayerModel(e);case 8:return e.log(jh,as.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}())||$b,CE=(0,Lo.b2)()(eE=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}())||eE,RE=["type"],ME={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},kE={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},IE={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},LE={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},PE=(0,Lo.b2)()(tE=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(pe({},(n={u_DirectionalLights:new Array(3).fill(pe({},IE)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(pe({},LE)),u_NumOfSpotLights:0},t&&t.length||(t=[kE]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=v(e,RE),o=ME[r].lights,a=ME[r].num,s=n[a];n[o][s]=pe(pe({},n[o][s]),i),n[a]++})),n)));var t,n}))}))}}]),e}())||tE,OE=(0,Lo.b2)()(nE=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=Vp(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}())||nE,DE=(0,Lo.b2)()(rE=function(){function e(){Te(this,e),ce(this,"PickOption",{u_HighlightColor:[1,0,0,1],u_SelectColor:[1,0,0,1],u_PickingColor:[0,0,0],u_PickingStage:0,u_CurrentSelectedId:[0,0,0],u_PickingThreshold:10,u_PickingBuffer:0,u_shaderPick:0,u_EnableSelect:0,u_activeMix:0})}return Se(e,[{key:"pickOption2Array",value:function(){return Object.values(this.PickOption).flat()}},{key:"updatePickOption",value:function(e,t){var n=this;Object.keys(e).forEach((function(t){n.PickOption[t]=e[t]})),t.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array(this.pickOption2Array()))})}},{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.styleAttributeService;if(!r.uniformBuffers[1]){var o=r.createBuffer({data:new Float32Array(this.pickOption2Array().length),isUBO:!0});r.uniformBuffers[1]=o,this.updatePickOption({},r)}e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;i.registerStyleAttribute({name:"pickingColor",type:Hh.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:df.PICKING_COLOR,buffer:{data:[],type:hu.FLOAT},size:3,update:function(e){var n=e.id;return t?At(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:1},r),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:1})})))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:2},r),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:2})})))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var i=e.getLayerConfig(),o=i.highlightColor,a=i.activeMix,s=void 0===a?0:a,u="string"==typeof o?St(o):o||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Tt(new Uint8Array(t))});var l={u_PickingStage:2,u_PickingColor:t,u_HighlightColor:u.map((function(e){return 255*e})),u_activeMix:s};n.updatePickOption(l,r),e.models.forEach((function(e){return e.addUniforms(l)}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var i=e.getLayerConfig(),o=i.selectColor,a=i.selectMix,s=void 0===a?0:a,u="string"==typeof o?St(o):o||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Tt(new Uint8Array(t))});var l={u_PickingStage:2,u_PickingColor:t,u_HighlightColor:u.map((function(e){return 255*e})),u_activeMix:s,u_CurrentSelectedId:t,u_SelectColor:u.map((function(e){return 255*e})),u_EnableSelect:1};console.log(l),n.updatePickOption(l,r),e.models.forEach((function(e){return e.addUniforms(l)}))}))}}]),e}())||rE,NE=["mvt","geojsonvt","testTile"],FE=(0,Lo.b2)()(iE=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return NE.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:Hh.Attribute,descriptor:{name:"a_Position",shaderLocation:df.POSITION,buffer:{data:[],type:hu.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:Hh.Attribute,descriptor:{name:"a_Color",shaderLocation:df.COLOR,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:Hh.Attribute,descriptor:{name:"a_vertexId",shaderLocation:df.VERTEX_ID,buffer:{usage:hu.DYNAMIC_DRAW,data:[],type:hu.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),e}())||iE,BE=(oE=(0,Lo.b2)(),aE=(0,Lo.f3)(Oo.ICameraService),sE=(0,Lo.f3)(Oo.ICoordinateSystemService),uE=(0,Lo.f3)(Oo.IRendererService),lE=(0,Lo.f3)(Oo.IMapService),cE=(0,Lo.f3)(Oo.ILayerService),oE((pE=function(){function e(){Te(this,e),fs(this,"cameraService",fE,this),fs(this,"coordinateSystemService",dE,this),fs(this,"rendererService",vE,this),fs(this,"mapService",mE,this),fs(this,"layerService",gE,this)}return Se(e,[{key:"apply",value:function(e){var t,n=this,r=this.mapService.version,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];this.rendererService.uniformBuffers[0]||(t=this.rendererService.createBuffer({data:new Float32Array(108),isUBO:!0}),this.rendererService.uniformBuffers[0]=t),e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var a=e.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(a),"GAODE2.x"===r&&(n.setLayerCenter(e),i=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter());var s=n.rendererService.getViewportSize(),u=s.width,l=s.height,c=n.generateUBO(i,o,u,l),h=c.data,p=c.uniforms;n.layerService.alreadyInRendering&&t&&t.subData({offset:0,data:h}),e.models.forEach((function(t){t.addUniforms(pe(pe({},p),{},{u_PickingBuffer:e.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(e.getShaderPickStat())}))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}},{key:"generateUBO",value:function(e,t,n,r){var i,o=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),s=this.cameraService.getViewProjectionMatrix(),u=this.cameraService.getModelMatrix(),l=this.coordinateSystemService.getViewportCenterProjection(),c=this.coordinateSystemService.getPixelsPerDegree(),h=this.cameraService.getZoom(),p=this.coordinateSystemService.getPixelsPerDegree2(),f=this.cameraService.getZoomScale(),d=this.coordinateSystemService.getPixelsPerMeter(),v=this.coordinateSystemService.getCoordinateSystem(),m=this.cameraService.getCameraPosition(),g=window.devicePixelRatio,y=this.coordinateSystemService.getViewportCenter(),_=[n,r],x=this.cameraService.getFocalDistance();return{data:[].concat(Pt(a),Pt(o),Pt(s),Pt(u),Pt(e),Pt(l),Pt(c),[h],Pt(p),[f],Pt(d),[v],Pt(m),[g],Pt(y),_,Pt(t),[x,0]),uniforms:(i={},ce(i,"u_ProjectionMatrix",o),ce(i,"u_ViewMatrix",a),ce(i,"u_ViewProjectionMatrix",s),ce(i,"u_Zoom",h),ce(i,"u_ZoomScale",f),ce(i,"u_FocalDistance",x),ce(i,"u_CameraPosition",m),ce(i,"u_CoordinateSystem",v),ce(i,"u_ViewportCenter",y),ce(i,"u_ViewportCenterProjection",l),ce(i,"u_PixelsPerDegree",c),ce(i,"u_PixelsPerDegree2",p),ce(i,"u_PixelsPerMeter",d),ce(i,"u_Mvp",e),ce(i,"u_sceneCenterMercator",t),ce(i,"u_ViewportSize",_),ce(i,"u_ModelMatrix",u),ce(i,"u_DevicePixelRatio",g),i)}}}]),e}(),fE=ds(pE.prototype,"cameraService",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=ds(pE.prototype,"coordinateSystemService",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=ds(pE.prototype,"rendererService",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=ds(pE.prototype,"mapService",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=ds(pE.prototype,"layerService",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=pE))||hE),zE=(0,Lo.b2)()(yE=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}())||yE,UE=(0,Lo.b2)()(_E=function(){function e(){Te(this,e)}return Se(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||_E;kh.bind(Oo.ILayerPlugin).to(Im).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(FE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(Ox).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(km).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(CE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(Nx).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(UE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(zE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(OE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(BE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(Dx).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(PE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(DE).inRequestScope(),kh.bind(Oo.ILayerPlugin).to(AE).inRequestScope();var jE=(xE=Mh(Oo.IGlobalConfigService),bE=function(){function e(t){Te(this,e),fs(this,"configService",EE,this),this.config=t}return Se(e,[{key:"setContainer",value:function(e,t,n,r){e.bind(Oo.MapConfig).toConstantValue(pe(pe({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(Oo.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),EE=ds(bE.prototype,"configService",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE),GE=r(5396),VE=r.n(GE);function HE(e,t){var n,r,i,o=gs([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function WE(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var XE=Math.PI,ZE=XE/4,qE=XE/180,YE=180/XE,KE=4003e4;function QE(e){return Math.pow(2,e)}function JE(e,t){var n=Ot(e,2),r=n[0],i=n[1];WE(Number.isFinite(r)&&Number.isFinite(t)),WE(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*qE;return[(t*=512)*(r*qE+XE)/(2*XE),t*(XE-Math.log(Math.tan(ZE+.5*o)))/(2*XE)]}function $E(e,t){var n=Ot(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*XE)-XE,a=2*(Math.atan(Math.exp(XE-i/t*(2*XE)))-ZE);return[o*YE,a*YE]}function ew(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ot(e,3),i=r[0],o=r[1],a=r[2];if(WE(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a))return HE(t,[i,o,a,1]);var s,u,l,c,h,p,f=HE(t,[i,o,0,1]),d=HE(t,[i,o,1,1]),v=f[2],m=d[2];return s=[],l=d,c=v===m?0:((n||0)-v)/(m-v),h=(u=f)[0],p=u[1],s[0]=h+c*(l[0]-h),s[1]=p+c*(l[1]-p),s}var tw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function nw(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,l=void 0===u?0:u,c=e.offset,h=void 0===c?[0,0]:c,p=Ot(r,2),f=Ot(p[0],2),d=f[0],v=f[1],m=Ot(p[1],2),g=m[0],y=m[1];Number.isFinite(l)?l={top:l,bottom:l,left:l,right:l}:WE(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new rw({width:t,height:n,longitude:0,latitude:0,zoom:0}),x=_.project([d,y]),b=_.project([g,v]),E=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],w=[t-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];WE(w[0]>0&&w[1]>0);var S=w[0]/E[0],T=w[1]/E[1],A=(l.right-l.left)/2/S,C=(l.bottom-l.top)/2/T,R=[(b[0]+x[0])/2+A,(b[1]+x[1])/2+C],M=_.unproject(R),k=_.zoom+Math.log2(Math.abs(Math.min(S,T)));return{longitude:M[0],latitude:M[1],zoom:Math.min(k,s)}}var rw=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,p=void 0===h?0:h,f=n.bearing,d=void 0===f?0:f,v=n.altitude,m=void 0===v?1.5:v,g=n.nearZMultiplier,y=n.farZMultiplier;Te(this,t),r=r||1,i=i||1;var _=QE(c);m=Math.max(.75,m);var x=JE([u,a],_);x[2]=0;var b=function(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=e.nearZMultiplier,s=void 0===a?1:a,u=e.farZMultiplier,l=void 0===u?1:u,c=(void 0===o?0:o)*qE,h=Math.atan(.5/i),p=Math.sin(h)*i/Math.sin(Math.PI/2-c-h),f=Math.cos(Math.PI/2-c)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:s,far:f*l}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return Ra([],o,a,s,u)}({width:r,height:i,pitch:p,bearing:d,altitude:m,nearZMultiplier:g||1/i,farZMultiplier:y||1.01}),E=function(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.center,o=void 0===i?null:i,a=e.flipY,s=void 0!==a&&a,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return aa(u,u,[0,0,-e.altitude]),sa(u,u,[1,1,1/t]),la(u,u,-n*qE),ha(u,u,r*qE),s&&sa(u,u,[1,-1,1]),o&&aa(u,u,Yf([],o)),u}({height:i,center:x,pitch:p,bearing:d,altitude:m,flipY:!0});return(e=Me(this,ke(t).call(this,{width:r,height:i,viewMatrix:E,projectionMatrix:b}))).latitude=a,e.longitude=u,e.zoom=c,e.pitch=p,e.bearing=d,e.altitude=m,e.scale=_,e.center=x,e.pixelsPerMeter=function(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:QE(r),WE(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*qE),c=u/360,h=c/l,p=u/KE/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-h,p],s.degreesPerPixel=[1/c,-1/h,1/p],a){var f=qE*Math.tan(t*qE)/l,d=c*f/2,v=u/KE*f,m=v/h*p;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}(Re(Re(e))).pixelsPerMeter[2],Object.freeze(Re(Re(e))),e}return Ce(t,e),Se(t,[{key:"projectFlat",value:function(e){return JE(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(e){return $E(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=ew(e.pos,this.pixelUnprojectionMatrix),o=li([],JE(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return $E(li([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=nw(Object.assign({width:r,height:i,bounds:e},n));return new t({width:r,height:i,longitude:o.longitude,latitude:o.latitude,zoom:o.zoom})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?tw:i,a=t.projectionMatrix,s=void 0===a?tw:a;Te(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];oa(u,u,this.projectionMatrix),oa(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];sa(l,l,[this.width/2,-this.height/2,1]),aa(l,l,[1,-1,0]),oa(l,l,this.viewProjectionMatrix);var c=na([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Se(e,[{key:"equals",value:function(t){return t instanceof e&&t.width===this.width&&t.height===this.height&&Va(t.projectionMatrix,this.projectionMatrix)&&Va(t.viewMatrix,this.viewMatrix)}},{key:"project",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===t||t,r=function(e,t){var n=Ot(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return WE(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),HE(t,[r,i,a,1])}(this.projectPosition(e),this.pixelProjectionMatrix),i=Ot(r,2),o=i[0],a=i[1],s=n?a:this.height-a;return 2===e.length?[o,s]:[o,s,r[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=Ot(e,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=ew([a,l,u],this.pixelUnprojectionMatrix,c),p=Ot(this.unprojectPosition(h),3),f=p[0],d=p[1],v=p[2];return Number.isFinite(u)?[f,d,v]:Number.isFinite(i)?[f,d,i]:[f,d]}},{key:"projectPosition",value:function(e){var t=Ot(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=Ot(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){return arguments.length>1&&void 0!==arguments[1]||this.scale,e}},{key:"unprojectFlat",value:function(e){return arguments.length>1&&void 0!==arguments[1]||this.scale,e}}]),e}()),iw=function(){function e(){Te(this,e)}return Se(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new rw(pe(pe({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),ow=function(){function e(t){Te(this,e),ce(this,"size",1e4),this.size=t||1e4}return Se(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function aw(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return pe(pe({},{top:0,right:0,bottom:0,left:0}),e)}var sw,uw,lw,cw,hw,pw,fw,dw,vw,mw,gw,yw={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},_w=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var xw={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},bw=0;window.forceWebGL=!0;var Ew="15cd8a57710d40c9b7c0e3cc120f1200",ww=!1,Sw=[],Tw=(sw=(0,Lo.b2)(),uw=(0,Lo.f3)(Oo.IGlobalConfigService),lw=(0,Lo.f3)(Oo.MapConfig),cw=(0,Lo.f3)(Oo.ICoordinateSystemService),hw=(0,Lo.f3)(Oo.IEventEmitter),sw((fw=function(){function e(){var t=this;Te(this,e),ce(this,"version",Jn["GAODE1.x"]),ce(this,"simpleMapCoord",new ow),ce(this,"bgColor","rgba(0, 0, 0, 0)"),fs(this,"configService",dw,this),fs(this,"config",vw,this),fs(this,"coordinateSystemService",mw,this),fs(this,"eventEmitter",gw,this),ce(this,"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=t.getCenter(),p=h.lng,f=h.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var d=t.config.offsetZoom,v=void 0===d?12:d;t.viewport.getZoom()>v?t.coordinateSystemService.setCoordinateSystem(Cs.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(Cs.P20),t.cameraChangedCallback(t.viewport)}}))}var t;return Se(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=Cn("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==Wh.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(xw[this.version][e]||e,t)}},{key:"off",value:function(e,t){-1!==Wh.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(xw[this.version][e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=aw(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=aw(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"getMapStyleConfig",value:function(){return yw}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=Yo();return aa(o,o,Lf(i[0],i[1],t)),sa(o,o,Lf(r[0],r[1],r[2])),la(o,o,n[0]),ca(o,o,n[1]),ha(o,o,n[2]),o}},{key:"init",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,f,d,m=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Ew:l,h=t.mapInstance,p=t.plugin,f=void 0===p?[]:p,d=v(t,_w),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=pe({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};ww||h?ww&&window.AMap||h?t():Sw.push(t):(c===Ew&&console.warn("%c".concat(m.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),ww=!0,f.push("Map3D"),VE().load({key:c,version:"1.4.15",plugins:f}).then((function(){t(),Sw.length&&(Sw.forEach((function(e){return e()})),Sw=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new iw;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(Le(AMap.LngLat,Pt(e)),Le(AMap.LngLat,Pt(t))),r=Ot(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=Ot(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var t=document.getElementById("amap-script");t&&document.head.removeChild(t),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+bw++,t.appendChild(n),n}}]),e}(),dw=ds(fw.prototype,"configService",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vw=ds(fw.prototype,"config",[lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mw=ds(fw.prototype,"coordinateSystemService",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gw=ds(fw.prototype,"eventEmitter",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pw=fw))||pw);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var Aw=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Aw||{}),Cw={key:"",AMap:{version:"2.0",plugins:[]}},Rw={AMap:Aw.notload},Mw=[],kw=function(e){if("function"==typeof e){if(Rw.AMap===Aw.loaded)return void e(window.AMap);Mw.push(e)}};const Iw={load:function(){var e=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(Rw.AMap===Aw.failed)n("");else if(Rw.AMap===Aw.notload){var r=t.key,i=t.version,o=t.plugins;if(!r)return void n("请填写key");window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),Cw.key=r,Cw.AMap.version=i||Cw.AMap.version,Cw.AMap.plugins=o||Cw.AMap.plugins,Rw.AMap=Aw.loading;var a=document.body||document.head;window._onAPILoaded=function(t){t?(Rw.AMap=Aw.failed,n(t)):(Rw.AMap=Aw.loaded,e(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+Cw.AMap.version+"&key="+r+"&plugin="+Cw.AMap.plugins.join(","),s.onerror=function(e){Rw.AMap=Aw.failed,n(e)},a.appendChild(s)}else if(Rw.AMap===Aw.loaded){if(t.key&&t.key!==Cw.key)return void n("多个不一致的 key");if(t.version&&t.version!==Cw.AMap.version)return void n("不允许多个版本 JSAPI 混用");var u=[];t.plugins&&t.plugins.forEach((function(e){-1===Cw.AMap.plugins.indexOf(e)&&u.push(e)})),u.length&&window.AMap.plugin(u,(function(){e(window.AMap)}))}else{if(t.key&&t.key!==Cw.key)return void n("多个不一致的 key");if(t.version&&t.version!==Cw.AMap.version)return void n("不允许多个版本 JSAPI 混用");var l=[];t.plugins&&t.plugins.forEach((function(e){-1===Cw.AMap.plugins.indexOf(e)&&l.push(e)})),kw((function(){l.length&&window.AMap.plugin(l,(function(){e(window.AMap)}))}))}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reset:function(){delete window.AMap,Cw={key:"",AMap:{version:"1.4.15",plugins:[]}},Rw={AMap:Aw.notload}}};var Lw,Pw=Math.PI/180,Ow=function(){function e(){Te(this,e),ce(this,"projectionMatrix",Yo()),ce(this,"viewMatrix",Yo()),ce(this,"viewProjectionMatrix",Yo()),ce(this,"ViewProjectionMatrixUncentered",Yo()),ce(this,"viewUncenteredMatrix",Yo())}return Se(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,l=e.offsetOrigin,c=void 0===l?[0,0]:l,h=e.cameraHeight,p=void 0===h?1:h,f=e.aspect,d=void 0===f?1:f,v=e.near,m=void 0===v?.1:v,g=e.far,y=void 0===g?1e3:g,_=e.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*Pw,E=(360-a)*Pw;Ra(this.projectionMatrix,x,d,m,y);var w=Lf(p*Math.sin(b)*Math.sin(E),-p*Math.sin(b)*Math.cos(E),p*Math.cos(b)),S=Lf(-Math.cos(b)*Math.sin(E),Math.cos(b)*Math.cos(E),Math.sin(b));Oa(this.viewMatrix,w,Lf(0,0,0),S),this.viewUncenteredMatrix=Ko(this.viewMatrix),aa(this.viewMatrix,this.viewMatrix,Lf(-c[0],c[1],0)),oa(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),oa(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=Ot(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),Dw=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var Nw="15cd8a57710d40c9b7c0e3cc120f1200",Fw=!1,Bw=[],zw=(0,Lo.b2)()(Lw=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"version","GAODE1.x"),ce(Re(e),"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=e.getCenter(),p=h.lng,f=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var d=e.config.offsetZoom,v=void 0===d?12:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(Cs.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(Cs.P20),e.cameraChangedCallback(e.viewport)}})),e}return Se(o,[{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=Yo();return aa(o,o,Lf(i[0],i[1],t)),sa(o,o,Lf(r[0],r[1],r[2])),la(o,o,n[0]),ca(o,o,n[1]),ha(o,o,n[2]),o}},{key:"init",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,f,d,m=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Nw:l,h=t.mapInstance,p=t.plugin,f=void 0===p?[]:p,d=v(t,Dw),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=pe({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};Fw||h?Fw&&window.AMap||h?t():Bw.push(t):(c===Nw&&console.warn(m.configService.getSceneWarninfo("MapToken")),Fw=!0,f.push("Map3D"),Iw.load({key:c,version:"1.4.15",plugins:f}).then((function(e){t(),Bw.length&&(Bw.forEach((function(e){return e()})),Bw=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new Ow;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(Le(AMap.LngLat,Pt(e)),Le(AMap.LngLat,Pt(t))),r=Ot(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=Ot(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}}]),o}(Tw))||Lw;var Uw,jw=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getServiceConstructor",value:function(){return zw}}]),i}(jE),Gw=function(){function e(){Te(this,e),ce(this,"projectionMatrix",Yo()),ce(this,"viewMatrix",Yo()),ce(this,"viewProjectionMatrix",Yo()),ce(this,"ViewProjectionMatrixUncentered",Yo()),ce(this,"viewUncenteredMatrix",Yo())}return Se(e,[{key:"syncWithMapCamera",value:function(e){var n=e.zoom,r=void 0===n?1:n,i=e.center,o=void 0===i?[0,0]:i,a=e.offsetOrigin,s=void 0===a?[0,0]:a,u=e.cameraPosition,l=void 0===u?[0,0,0]:u,c=e.up,h=void 0===c?[0,1,0]:c,p=e.lookAt,f=void 0===p?[0,0,0]:p,d=e.aspect,v=void 0===d?1:d,m=e.near,g=void 0===m?.1:m,y=e.far,_=void 0===y?1e3:y,x=e.fov,b=void 0===x?45:x;this.zoom=r,this.center=o,Ra(this.projectionMatrix,b/180*Math.PI,v,g,_);var E=Lf.apply(t,Pt(l)),w=Lf.apply(t,Pt(f)),S=Lf.apply(t,Pt(h));Oa(this.viewMatrix,E,w,S),this.viewUncenteredMatrix=Ko(this.viewMatrix),aa(this.viewMatrix,this.viewMatrix,Lf(-s[0],s[1],0)),oa(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),oa(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=Ot(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),Vw=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var Hw=[108.92361,34.54083];window.forceWebGL=!0;var Ww="f59bcf249433f8b05caaee19f349b3d7",Xw=(0,Lo.b2)()(Uw=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"version","GAODE2.x"),ce(Re(e),"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;e.emit("mapchange");var c=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:e.map.getZoom()-1,center:c,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(Cs.P20_2),e.cameraChangedCallback(e.viewport))})),e}return Se(o,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMercator=Zn.apply(void 0,Pt(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(e,t){var n=t||this.sceneCenterMercator,r=this._sub(Zn(e[0],e[1]),n);return e[2]&&r.push(e[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(e,t){var n=this,r=Zn(t[0],t[1]);return"number"==typeof e[0]?this.lngLatToCoordByLayer(e,r):e.map((function(e){return Array.isArray(e)&&"number"==typeof e[0]?n.lngLatToCoordByLayer(e,r):e.map((function(e){return n.lngLatToCoordByLayer(e,r)}))}))}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e||Hw),this.setCustomCoordCenter(e||Hw)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(Zn(e[0],e[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=Cn("div","l7-marker-container2",t)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lngLatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),o=Yo();return aa(o,o,Lf(i[0],i[1],t)),sa(o,o,Lf(r[0],r[1],r[2])),la(o,o,n[0]),ca(o,o,n[1]),ha(o,o,n[2]),o}},{key:"init",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g,y,_,x,b;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Ww:l,h=t.mapInstance,p=t.plugin,f=void 0===p?[]:p,t.version,d=v(t,Vw),this.viewport=new Gw,window.AMap||h){e.next=6;break}return f.push("Map3D"),e.next=6,VE().load({key:c,version:"2.0",plugins:f});case 6:h?(this.map=h,this.$mapContainer=this.map.getContainer(),g=this.map.getCenter(),null===(m=this.map.customCoords)||void 0===m||m.setCenter([g.lng,g.lat]),this.setCustomCoordCenter([g.lng,g.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(_=pe({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d)).zoom&&(_.zoom+=1),c===Ww&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;")),x=new AMap.Map(this.$mapContainer,_),this.map=x,b=x.getCenter(),null===(y=this.map.customCoords)||void 0===y||y.setCenter([b.lng,b.lat]),this.setCustomCoordCenter([b.lng,b.lat]),x.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var e,t=null===(e=this.map.customCoords)||void 0===e?void 0:e.getCameraParams(),n=t.fov,r=t.near,i=t.far,o=t.aspect,a=t.position,s=t.lookAt,u=t.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(Cs.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}}]),o}(Tw))||Uw;var Zw,qw=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getServiceConstructor",value:function(){return Xw}}]),i}(jE),Yw=r(3056),Kw=r.n(Yw);function Qw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jw(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function $w(e,t,n){return Math.min(n,Math.max(t,e))}function eS(e,t,n){return e*(1-n)+t*n}function tS(e,t,n,r){var i=new(Kw())(e,t,n,r);return function(e){return i.solve(e)}}var nS=tS(.25,.1,.25,1);function rS(){return null==Zw&&(Zw=window.matchMedia("(prefers-reduced-motion: reduce)")),Zw.matches}var iS=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),oS=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,aS=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function sS(e){var t=oS(e);return{cancel:function(){return aS(t)}}}var uS=6371008.8,lS=function(){function e(t,n){if(Te(this,e),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return Se(e,[{key:"wrap",value:function(){return new e(Jw(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return uS*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===ue(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),cS=function(){function e(t,n){Te(this,e),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return Se(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof lS?new lS(e.lng,e.lat):lS.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof lS?new lS(e.lng,e.lat):lS.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof lS)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(lS.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new lS(n.lng,n.lat),this.ne=new lS(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new lS((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new lS(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new lS(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=lS.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),hS=function(){function e(t,n){Te(this,e),this.x=t,this.y=n}return Se(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),pS=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Te(this,e),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return Se(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=eS(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=eS(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=eS(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=eS(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=$w((this.left+e-this.right)/2,0,e),r=$w((this.top+t-this.bottom)/2,0,t);return new hS(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),fS=2*Math.PI*uS;function dS(e){return fS*Math.cos(e*Math.PI/180)}function vS(e){return(180+e)/360}function mS(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function gS(e,t){return e/dS(t)}function yS(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var _S=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Te(this,e),this.x=+t,this.y=+n,this.z=+r}return Se(e,[{key:"toLngLat",value:function(){return new lS(360*this.x-180,yS(this.y))}},{key:"toAltitude",value:function(){return this.z*dS(yS(this.y))}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/fS*(e=yS(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=lS.convert(t);return new e(vS(r.lng),mS(r.lat),gS(n,r.lat))}}]),e}();function xS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bS=function(){function e(t,n,r,i,o){Te(this,e),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new lS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new pS,this.posMatrixCache={},this.alignedPosMatrixCache={}}return Se(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new hS(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-Jw(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new ri(4),ri!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=$w(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=$w(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new hS(vS(e.lng)*this.worldSize,mS(t)*this.worldSize)}},{key:"unproject",value:function(e){return new _S(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new _S(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);gs(t,t,this.pixelMatrixInverse),gs(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,l=t[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new _S(eS(o,a,h)/this.worldSize,eS(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new cS).extend(this.pointLocation(new hS(0,0))).extend(this.pointLocation(new hS(this.width,0))).extend(this.pointLocation(new hS(this.width,this.height))).extend(this.pointLocation(new hS(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new cS([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new hS(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return gs(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new hS(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new hS(r,i),new hS(o,i),new hS(o,a),new hS(r,a),new hS(r,i)]}},{key:"coordinatePoint",value:function(e){var t=ms(e.x*this.worldSize,e.y*this.worldSize,0,1);return gs(t,t,this.pixelMatrix),new hS(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return _S.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=mS(c[1])*this.worldSize,e=(o=mS(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=vS(h[0])*this.worldSize,t=(s=vS(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var p=this.point,f=Math.max(t||0,e||0);if(f)return this.center=this.unproject(new hS(t?(s+a)/2:p.x,e?(o+i)/2:p.y)),this.zoom+=this.scaleZoom(f),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=p.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=p.x,g=u.x/2;m-g<a&&(n=a+g),m+g>s&&(n=s-g)}void 0===n&&void 0===r||(this.center=this.unproject(new hS(void 0!==n?n:p.x,void 0!==r?r:p.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin($w(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);Ra(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,sa(c,c,[1,-1,1]),aa(c,c,[0,0,-this.cameraToCenterDistance]),la(c,c,this._pitch),ha(c,c,this.angle),aa(c,c,[-a,-s,0]),this.mercatorMatrix=sa([],c,[this.worldSize,this.worldSize,this.worldSize]),sa(c,c,[1,1,gS(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=na([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*h+d*p,m=s-Math.round(s)+f*p+d*h,g=new Float64Array(c);if(aa(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,sa(c=Yo(),c,[this.width/2,-this.height/2,1]),aa(c,c,[1,-1,0]),this.labelPlaneMatrix=c,sa(c=Yo(),c,[1,-1,1]),aa(c,c,[-1,-1,0]),sa(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=oa(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=na(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),ES=Sn.merge,wS=Se((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Te(this,e),ES(this,n),this.type=t}));var SS=Sn.merge,TS=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t;Te(this,i),ce(Re(t=r.call(this)),"renderFrameCallback",(function(){var e=Math.min((iS()-t.easeStart)/t.easeOptions.duration,1);t.onEaseFrame(t.easeOptions.easing(e)),e<1?t.easeFrameId=t.requestRenderFrame(t.renderFrameCallback):t.stop()})),t.options=e;var n=e.minZoom,o=e.maxZoom,a=e.minPitch,s=e.maxPitch,u=e.renderWorldCopies;return t.moving=!1,t.zooming=!1,t.bearingSnap=e.bearingSnap,t.pitchEnabled=e.pitchEnabled,t.rotateEnabled=e.rotateEnabled,t.transform=new bS(n,o,a,s,u),t}return Se(i,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new lS(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(SS({center:e},t),n)}},{key:"panBy",value:function(e,t,n){return e=hS.convert(e).mult(-1),this.panTo(this.transform.center,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(e[s]=a[s])}return e}({offset:e},t||{}),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(SS({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(SS({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,SS({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(SS({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=cS.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=lS.convert(e.center)),void 0!==e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),void 0!==e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),void 0===e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new wS("movestart",t)),this.emit("move",new wS("move",t)),r&&(this.emit("zoomstart",new wS("zoomstart",t)),this.emit("zoom",new wS("zoom",t)),this.emit("zoomend",new wS("zoomend",t))),i&&(this.emit("rotatestart",new wS("rotatestart",t)),this.emit("rotate",new wS("rotate",t)),this.emit("rotateend",new wS("rotateend",t))),o&&(this.emit("pitchstart",new wS("pitchstart",t)),this.emit("pitch",new wS("pitch",t)),this.emit("pitchend",new wS("pitchend",t))),this.emit("moveend",new wS("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=SS({offset:[0,0],duration:500,easing:nS},t)).animate||!t.essential&&rS())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,l=t.bearing?this.normalizeBearing(t.bearing,o):o,c=t.pitch?+t.pitch:a,h=t.padding?t.padding:r.padding,p=hS.convert(t.offset),f=r.centerPoint.add(p),d=r.pointLocation(f),v=lS.convert(t.center||d);this.normalizeCenter(v);var m,g,y=r.project(d),_=r.project(v).sub(y),x=r.zoomScale(u-i);t.around&&(m=lS.convert(t.around),g=r.locationPoint(m));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=eS(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=eS(o,l,t)),e.pitching&&e.pitchEnabled&&(r.pitch=eS(a,c,t)),e.padding&&(r.interpolatePadding(s,h,t),f=r.centerPoint.add(p)),m)r.setLocationAtPoint(m,g);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(v,1-t),E=r.unproject(y.add(_.mult(t*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?E.wrap():E,f)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&rS()){var r=function(e,t){var n,r={},i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Qw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qw(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(["center","zoom","bearing","pitch","around"]);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}(t);return this.jumpTo(r,n)}this.stop(),t=SS({offset:[0,0],speed:1.2,curve:1.42,easing:nS},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=t.zoom?$w(+t.zoom,i.minZoom,i.maxZoom):o,c=t.bearing?this.normalizeBearing(t.bearing,a):a,h=t.pitch?+t.pitch:s,p="padding"in t?t.padding:i.padding,f=i.zoomScale(l-o),d=hS.convert(t.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),g=lS.convert(t.center||m);this.normalizeCenter(g);var y=i.project(m),_=i.project(g).sub(y),x=t.curve,b=Math.max(i.width,i.height),E=b/f,w=_.mag();if("minZoom"in t){var S=$w(Math.min(t.minZoom,o,l),i.minZoom,i.maxZoom),T=b/i.zoomScale(S-o);x=Math.sqrt(T/w*2)}var A=x*x;function C(e){var t=(E*E-b*b+(e?-1:1)*A*A*w*w)/(2*(e?E:b)*A*w);return Math.log(Math.sqrt(t*t+1)-t)}function R(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}var k=C(0),I=function(e){return M(k)/M(k+x*e)},L=function(e){return b*((M(k)*(R(t=k+x*e)/M(t))-R(k))/A)/w;var t},P=(C(1)-k)/x;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(b-E)<1e-6)return this.easeTo(t,n);var O=E<b?-1:1;P=Math.abs(Math.log(E/b))/x,L=function(){return 0},I=function(e){return Math.exp(O*x*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*P/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(p),this.prepareEase(n,!1),this.ease((function(t){var r=t*P,f=1/I(r);i.zoom=1===t?l:o+i.scaleZoom(f),e.rotating&&(i.bearing=eS(a,c,t)),e.pitching&&(i.pitch=eS(s,h,t)),e.padding&&(i.interpolatePadding(u,p,t),v=i.centerPoint.add(d));var m=1===t?g:i.unproject(y.add(_.mult(L(r))).mult(f));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(hS.convert(e)),this.transform.pointLocation(hS.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=Jw(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new wS("move",e)),this.zooming&&this.emit("zoom",new wS("zoom",e)),this.rotating&&this.emit("rotate",new wS("rotate",e)),this.pitching&&this.emit("rotate",new wS("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new wS("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new wS("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new wS("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new wS("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new wS("zoomend",e)),r&&this.emit("rotateend",new wS("rotateend",e)),i&&this.emit("pitchend",new wS("pitchend",e)),this.emit("moveend",new wS("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=iS(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=SS({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=SS(i,r.padding);var a=this.transform,s=a.padding,u=a.project(lS.convert(e)),l=a.project(lS.convert(t)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),p=new hS(Math.max(c.x,h.x),Math.max(c.y,h.y)),f=new hS(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=p.sub(f),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0||v<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),y=hS.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new hS(y.x+_,y.y+x).mult(a.scale/a.zoomScale(g));return{center:a.unproject(u.add(l).div(2).sub(b)),zoom:g,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=SS(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),i}(ur.EventEmitter);function AS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return CS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?CS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function CS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var RS={};const MS=RS;RS.create=function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},RS.createNS=function(e,t){return window.document.createElementNS(e,t)};var kS=window.document&&window.document.documentElement.style;function IS(e){if(!kS)return e[0];var t,n=AS(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in kS)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var LS,PS=IS(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);RS.disableDrag=function(){kS&&PS&&(LS=kS[PS],kS[PS]="none")},RS.enableDrag=function(){kS&&PS&&(kS[PS]=LS)};var OS=IS(["transform","WebkitTransform"]);RS.setTransform=function(e,t){e.style[OS]=t};var DS=!1;try{var NS=Object.defineProperty({},"passive",{get:function(){DS=!0}});window.addEventListener("test",NS,NS),window.removeEventListener("test",NS,NS)}catch(e){DS=!1}RS.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&DS?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},RS.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&DS?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var FS=function e(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",e,!0)};RS.suppressClick=function(){window.addEventListener("click",FS,!0),setTimeout((function(){window.removeEventListener("click",FS,!0)}),0)},RS.mousePos=function(e,t){var n=e.getBoundingClientRect();return new hS(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},RS.touchPos=function(e,t){var n,r=e.getBoundingClientRect(),i=[],o=AS(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push(new hS(a.clientX-r.left-e.clientLeft,a.clientY-r.top-e.clientTop))}}catch(e){o.e(e)}finally{o.f()}return i},RS.mouseButton=function(e){return e.button},RS.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var BS=Sn.merge,zS=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e,t,n){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Te(this,i);var s=MS.mousePos(t.getCanvasContainer(),n),u=t.unproject(s);return(o=r.call(this,e,BS({point:s,lngLat:u,originalEvent:n},a))).defaultPrevented=!1,o.target=t,o}return Se(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(wS);var US=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e,t,n){var o;Te(this,i);var a="touchend"===e?n.changedTouches:n.touches,s=MS.touchPos(t.getCanvasContainer(),a),u=s.map((function(e){return t.unproject(e)})),l=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new hS(0,0)),c=t.unproject(l);return(o=r.call(this,e,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:n})).defaultPrevented=!1,o}return Se(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(wS);var jS=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e,t,n){var o;return Te(this,i),(o=r.call(this,e,{originalEvent:n})).defaultPrevented=!1,o}return Se(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(wS),GS=function(){function e(t){Te(this,e),this.map=t}return Se(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new zS(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new zS("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new zS(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),VS=function(){function e(t,n){Te(this,e),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return Se(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(MS.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=MS.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);MS.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),MS.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new wS("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(MS.remove(this.box),this.box=null),MS.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new wS(e,{originalEvent:t}))}}]),e}();const HS=VS;var WS=function(){function e(){Te(this,e),this.reset()}return Se(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();var XS=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ce(Re(e=r.call.apply(r,[this].concat(n))),"type","renderFrame"),e}return Se(i)}(wS);function ZS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qS=Sn.merge,YS={linearity:.3,easing:tS(0,0,.3,1)},KS=qS({deceleration:2500,maxSpeed:1400},YS),QS=qS({deceleration:20,maxSpeed:1400},YS),JS=qS({deceleration:1e3,maxSpeed:360},YS),$S=qS({deceleration:1e3,maxSpeed:90},YS),eT=function(){function e(t){Te(this,e),this.map=t,this.clear()}return Se(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:iS(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=iS();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new hS(0,0),pinchAround:void 0,around:void 0},r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ZS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ZS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=nT(n.pan.mag(),o,qS({},KS,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,tT(a,s)}if(n.zoom){var u=nT(n.zoom,o,QS);a.zoom=this.map.transform.zoom+u.amount,tT(a,u)}if(n.bearing){var l=nT(n.bearing,o,JS);a.bearing=this.map.transform.bearing+$w(l.amount,-179,179),tT(a,l)}if(n.pitch){var c=nT(n.pitch,o,$S);a.pitch=this.map.transform.pitch+c.amount,tT(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),qS(a,{noMoveStart:!0})}}}]),e}();function tT(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function nT(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=$w(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var rT={panStep:100,bearingStep:15,pitchStep:10},iT=function(){function e(){Te(this,e);var t=rT;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return Se(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:oT,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function oT(e){return e*(2-e)}const aT=iT;var sT,uT=function(){function e(t,n){Te(this,e),this.map=t,this.clickTolerance=n.clickTolerance}return Se(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new jS(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new zS(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new zS(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new zS(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new zS(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new zS(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new zS(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new US(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new US(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new US(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new US(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),lT=(ce(sT={},0,1),ce(sT,2,2),sT),cT=function(){function e(t){Te(this,e),this.reset(),this.clickTolerance=t.clickTolerance||1}return Se(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=MS.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=lT[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&MS.mouseButton(e)===this.eventButton&&(this.moved&&MS.suppressClick(),this.reset())}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}();var hT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"mousedown",value:function(e,t){gc(ke(i.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),i}(cT);var pT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),i}(cT);var fT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),i}(cT),dT=4.000244140625,vT=function(){function e(t,n){var r=this;Te(this,e),ce(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>dT?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((iS()-r.lastWheelEventTime)/200,1);o=eS(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return Se(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=iS(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%dT==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=MS.mousePos(this.el,e);this.around=lS.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=nS;if(this.prevEase){var n=this.prevEase,r=(iS()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=tS(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:iS(),duration:e,easing:t},t}}]),e}();const mT=vT;var gT=function(){function e(t,n){Te(this,e),this.clickZoom=t,this.tapZoom=n}return Se(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),yT=function(){function e(t,n,r){Te(this,e),this.el=t,this.mousePan=n,this.touchPan=r}return Se(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),_T=function(){function e(t,n,r){Te(this,e),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return Se(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),xT=function(){function e(t,n,r,i){Te(this,e),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return Se(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function bT(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}function ET(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wT=function(){function e(t){Te(this,e),this.reset(),this.numTouches=t.numTouches}return Se(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new hS(0,0),r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ET(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ET(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=bT(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=bT(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),ST=function(){function e(t){Te(this,e),this.singleTap=new wT(t),this.numTaps=t.numTaps,this.reset()}return Se(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),TT=function(){function e(){Te(this,e),this.tap=new ST({numTouches:1,numTaps:1}),this.reset()}return Se(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),AT=function(){function e(){Te(this,e),this.zoomIn=new ST({numTouches:1,numTaps:2}),this.zoomOut=new ST({numTouches:2,numTaps:1}),this.reset()}return Se(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),CT=function(){function e(t){Te(this,e),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return Se(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new hS(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=bT(n,t),i=new hS(0,0),o=new hS(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),e}(),RT=function(){function e(){Te(this,e),this.reset()}return Se(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=Ot(this.firstTwoTouches,2),i=r[0],o=r[1],a=MT(n,t,i),s=MT(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=Ot(this.firstTwoTouches,2),i=r[0],o=r[1],a=MT(n,t,i),s=MT(n,t,o);a&&s||(this.active&&MS.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function MT(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function kT(e){return Math.abs(e.y)>Math.abs(e.x)}var IT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"reset",value:function(){gc(ke(i.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,kT(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid)return this.lastPoints=e,this.active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return kT(e)&&kT(t)&&o}}}]),i}(RT);function LT(e,t){return 180*e.angleWith(t)/Math.PI}var PT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"reset",value:function(){gc(ke(i.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:LT(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=LT(e,this.startVector);return Math.abs(n)<t}}]),i}(RT);function OT(e,t){return Math.log(e/t)/Math.LN2}var DT=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"reset",value:function(){gc(ke(i.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(OT(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:OT(this.distance,n),pinchAround:t}}}]),i}(RT);function NT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return FT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?FT(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function FT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var BT=Sn.merge,zT=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function UT(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var jT=function(){function e(t,n){var r=this;Te(this,e),ce(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),ce(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,l=u?MS.touchPos(r.el,u):MS.mousePos(r.el,e),c=NT(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,p))f.reset();else{var m=t||e.type;f&&f[m]&&(v=f[m](e,l,u),r.mergeIHandlerResult(o,a,v,p,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||f.isActive())&&(s[p]=f)}}}catch(e){c.e(e)}finally{c.f()}var g={};for(var y in r.previousActiveHandlers)s[y]||(g[y]=i);r.previousActiveHandlers=s,(Object.keys(g).length||UT(o))&&(r.changes.push([o,a,g]),r.triggerRenderFrame()),(Object.keys(s).length||UT(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new eT(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;this.listeners=[],this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=NT(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=Ot(o.value,3),u=s[0],l=s[1],c=s[2];MS.addEventListener(u,l,u===window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(e){a.e(e)}finally{a.f()}}return Se(e,[{key:"destroy",value:function(){var e,t=NT(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=Ot(e.value,3),r=n[0],i=n[1],o=n[2];MS.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=NT(this.handlers);try{for(t.s();!(e=t.n()).done;)e.value.handler.reset()}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=NT(this.handlers);try{for(t.s();!(e=t.n()).done;)if(e.value.handler.isActive())return!0}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(zT(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){BT(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new XS("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new uT(t,e));var r=t.boxZoom=new HS(t,e);this.add("boxZoom",r);var i=new AT,o=new WS;t.doubleClickZoom=new gT(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new TT;this.add("tapDragZoom",a);var s=t.touchPitch=new IT;this.add("touchPitch",s);var u=new pT(e),l=new fT(e);t.dragRotate=new _T(e,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new hT(e),h=new CT(e);t.dragPan=new yT(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var p=new PT,f=new DT;t.touchZoomRotate=new xT(n,f,p,a),this.add("touchRotate",p,["touchPan","touchZoom"]),this.add("touchZoom",f,["touchPan","touchRotate"]);var d=t.scrollZoom=new mT(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new aT;this.add("keyboard",v),this.add("blockableMapEvent",new GS(t));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m++){var y=g[m];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=NT(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;this.el.contains(o)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=NT(this.changes);try{for(i.s();!(e=i.n()).done;){var o=Ot(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new hS(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),BT(n,s),BT(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!UT(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=zT(this.eventsInProgress),i=zT(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[l]){var c=e[l].originalEvent;this.fireEvent(l,c)}var h,p={};for(var f in this.eventsInProgress)if(this.eventsInProgress[f]){var d=this.eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[f],h=t[v]||m,p["".concat(f,"end")]=h)}for(var g in p)p[g]&&this.fireEvent(g,p[g]);var y=zT(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new wS("moveend",{originalEvent:h})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new wS(e,t?{originalEvent:t}:{}))}}]),e}();const GT=jT;var VT=null,HT=[],WT=(window.performance,function(e){var t=e;if(null!=VT){var n=t-VT;HT.push(n)}VT=t});function XT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ZT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ZT(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ZT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const qT=function(){function e(){Te(this,e),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return Se(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=XT(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=XT(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}();!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n"),Sn.merge;var YT=Sn.throttle,KT=function(){function e(t){var n=this;Te(this,e),ce(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),ce(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),ce(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=YT(this.updateHashUnthrottled,300)}return Se(e,[{key:"addTo",value:function(e){return this.map=e,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,p=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===c?(h=!0,"".concat(t,"=").concat(l)):e})).filter((function(e){return e}));return h||p.push("".concat(c,"=").concat(l)),"#".concat(p.join("&"))}return"#".concat(l)}}]),e}();const QT=KT;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n"),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var JT,$T,eA,tA,nA,rA,iA,oA,aA,sA,uA,lA,cA=Sn.merge,hA={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},pA=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t;Te(this,i),ce(Re(t=r.call(this,cA({},hA,e))),"renderTaskQueue",new qT),ce(Re(t),"trackResize",!0),ce(Re(t),"onWindowOnline",(function(){t.update()})),ce(Re(t),"onWindowResize",(function(e){t.trackResize&&t.resize({originalEvent:e}).update()})),t.initContainer(),t.resize(),t.handlers=new GT(Re(t),t.options),"undefined"!=typeof window&&(window.addEventListener("online",t.onWindowOnline,!1),window.addEventListener("resize",t.onWindowResize,!1),window.addEventListener("orientationchange",t.onWindowResize,!1));var n="string"==typeof e.hash&&e.hash||void 0;return e.hash&&(t.hash=new QT(n).addTo(Re(t))),t.hash&&t.hash.onHashChange()||(t.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(t.resize(),t.fitBounds(e.bounds,cA({},e.fitBoundsOptions,{duration:0})))),t}return Se(i,[{key:"resize",value:function(e){var t=Ot(this.containerDimensions(),2),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",e)),this.emit("move",new window.CustomEvent("move",e))),this.emit("resize",new window.CustomEvent("resize",e)),i&&this.emit("moveend",new window.CustomEvent("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(lS.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(hS.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(cS.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=sS((function(t){WT(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=sS((function(n){WT(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=Cn("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t),[e,t]}}]),i}(TS),fA={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},dA={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},vA=(JT=(0,Lo.b2)(),$T=(0,Lo.f3)(Oo.MapConfig),eA=(0,Lo.f3)(Oo.IGlobalConfigService),tA=(0,Lo.f3)(Oo.ICoordinateSystemService),nA=(0,Lo.f3)(Oo.IEventEmitter),JT((iA=function(){function e(){var t=this;Te(this,e),ce(this,"version","DEFAUlTMAP"),ce(this,"simpleMapCoord",new ow),ce(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),fs(this,"config",oA,this),fs(this,"configService",aA,this),fs(this,"coordinateSystemService",sA,this),fs(this,"eventEmitter",uA,this),ce(this,"handleCameraChanged",(function(e){var n=t.map.getCenter(),r=n.lat,i=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[i,r],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}))}return Se(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=Cn("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(e,t){-1!==Wh.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(dA[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(dA[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if("SIMPLE"===this.version)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return fA}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(Cs.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Cs.LNGLAT)}}]),e}(),oA=ds(iA.prototype,"config",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aA=ds(iA.prototype,"configService",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sA=ds(iA.prototype,"coordinateSystemService",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=ds(iA.prototype,"eventEmitter",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rA=iA))||rA),mA=["id","style","rotation","mapInstance","version","mapSize","interactive"],gA=["id","style","rotation","mapInstance","canvas","hasBaseMap"];var yA=(0,Lo.b2)()(lA=function(e){Ce(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Me(this,e)});function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=o.call.apply(o,[this].concat(n))),"version",Jn.DEFAULT),ce(Re(e),"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(Cs.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(Cs.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return Se(a,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=_S.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=_S.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=Yo();return aa(s,s,Lf(o.x-i.x,o.y-i.y,o.z||0-i.z)),sa(s,s,Lf(a*r[0],-a*r[1],a*r[2])),la(s,s,n[0]),ca(s,s,n[1]),ha(s,s,n[2]),s}},{key:"init",value:(n=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,f,d,m,g=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,l=t.version,c=void 0===l?"DEFAULTMAP":l,h=t.mapSize,p=void 0===h?1e4:h,f=t.interactive,d=void 0===f||f,m=v(t,mA),this.viewport=new iw,this.version=c,this.simpleMapCoord.setSize(p),"SIMPLE"===c&&m.center&&(m.center=this.simpleMapCoord.unproject(m.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new pA(pe({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},m))),this.map.on("load",(function(){g.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){g.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.config).id,n=t.style,r=void 0===n?"light":n,i=t.rotation,o=void 0===i?0:i,t.mapInstance,a=t.canvas,s=void 0===a?null:a,u=t.hasBaseMap,l=void 0!==u&&u,c=v(t,gA),this.viewport=new iw,this.$mapContainer=s,this.map=new pA(pe({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},c)),l?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),window.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,o=t.bearing,a=t.pitch;p.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}}]),a}(vA))||lA;var _A,xA=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getServiceConstructor",value:function(){return yA}}]),i}(jE),bA=r(2145),EA=r.n(bA),wA=function(){function e(){Te(this,e)}return Se(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new rw({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),SA=["id","attributionControl","style","token","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=EA();var TA=0,AA="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",CA=(0,Lo.b2)()(_A=function(e){Ce(o,e);var t,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(n);if(r){var i=ke(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Me(this,e)});function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ce(Re(e=i.call.apply(i,[this].concat(n))),"version","MAPBOX"),e}return Se(o,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=Yo();return aa(s,s,Lf(o.x-i.x,o.y-i.y,o.z||0-i.z)),sa(s,s,Lf(a*r[0],-a*r[1],a*r[2])),la(s,s,n[0]),ca(s,s,n[1]),ha(s,s,n[2]),s}},{key:"init",value:(t=ir(sr().mark((function e(){var t,n,r,i,o,a,s,u,l,c,h,p,f,d=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,l=void 0===u?AA:u,c=t.rotation,h=void 0===c?0:c,p=t.mapInstance,f=v(t,SA),this.viewport=new wA,p||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==AA||"blank"===s||window.mapboxgl.accessToken||p||console.warn(this.configService.getSceneWarninfo("MapToken")),p||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),p?(this.map=p,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(pe({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},f))),this.map.on("load",(function(){d.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,t){var n=new(EA().LngLat)(e[0],e[1]),r=new(EA().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=EA().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=EA().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+TA++,t.appendChild(n),n}}]),o}(vA))||_A;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var RA,MA,kA,IA,LA,PA,OA,DA,NA,FA,BA,zA,UA,jA,GA=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){return Te(this,i),r.apply(this,arguments)}return Se(i,[{key:"getServiceConstructor",value:function(){return CA}}]),i}(jE),VA=r(8281),HA=r.n(VA),WA=function(){function e(t,n){Te(this,e);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return Se(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),XA=(ce(RA={},hu.POINTS,"points"),ce(RA,hu.LINES,"lines"),ce(RA,hu.LINE_LOOP,"line loop"),ce(RA,hu.LINE_STRIP,"line strip"),ce(RA,hu.TRIANGLES,"triangles"),ce(RA,hu.TRIANGLE_FAN,"triangle fan"),ce(RA,hu.TRIANGLE_STRIP,"triangle strip"),RA),ZA=(ce(MA={},hu.STATIC_DRAW,"static"),ce(MA,hu.DYNAMIC_DRAW,"dynamic"),ce(MA,hu.STREAM_DRAW,"stream"),MA),qA=(ce(kA={},hu.BYTE,"int8"),ce(kA,hu.INT,"int32"),ce(kA,hu.UNSIGNED_BYTE,"uint8"),ce(kA,hu.UNSIGNED_SHORT,"uint16"),ce(kA,hu.UNSIGNED_INT,"uint32"),ce(kA,hu.FLOAT,"float"),kA),YA=(ce(IA={},hu.ALPHA,"alpha"),ce(IA,hu.LUMINANCE,"luminance"),ce(IA,hu.LUMINANCE_ALPHA,"luminance alpha"),ce(IA,hu.RGB,"rgb"),ce(IA,hu.RGBA,"rgba"),ce(IA,hu.RGBA4,"rgba4"),ce(IA,hu.RGB5_A1,"rgb5 a1"),ce(IA,hu.RGB565,"rgb565"),ce(IA,hu.DEPTH_COMPONENT,"depth"),ce(IA,hu.DEPTH_STENCIL,"depth stencil"),IA),KA=(ce(LA={},hu.DONT_CARE,"dont care"),ce(LA,hu.NICEST,"nice"),ce(LA,hu.FASTEST,"fast"),LA),QA=(ce(PA={},hu.NEAREST,"nearest"),ce(PA,hu.LINEAR,"linear"),ce(PA,hu.LINEAR_MIPMAP_LINEAR,"mipmap"),ce(PA,hu.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),ce(PA,hu.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),ce(PA,hu.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),PA),JA=(ce(OA={},hu.REPEAT,"repeat"),ce(OA,hu.CLAMP_TO_EDGE,"clamp"),ce(OA,hu.MIRRORED_REPEAT,"mirror"),OA),$A=(ce(DA={},hu.NONE,"none"),ce(DA,hu.BROWSER_DEFAULT_WEBGL,"browser"),DA),eC=(ce(NA={},hu.NEVER,"never"),ce(NA,hu.ALWAYS,"always"),ce(NA,hu.LESS,"less"),ce(NA,hu.LEQUAL,"lequal"),ce(NA,hu.GREATER,"greater"),ce(NA,hu.GEQUAL,"gequal"),ce(NA,hu.EQUAL,"equal"),ce(NA,hu.NOTEQUAL,"notequal"),NA),tC=(ce(FA={},hu.FUNC_ADD,"add"),ce(FA,hu.MIN_EXT,"min"),ce(FA,hu.MAX_EXT,"max"),ce(FA,hu.FUNC_SUBTRACT,"subtract"),ce(FA,hu.FUNC_REVERSE_SUBTRACT,"reverse subtract"),FA),nC=(ce(BA={},hu.ZERO,"zero"),ce(BA,hu.ONE,"one"),ce(BA,hu.SRC_COLOR,"src color"),ce(BA,hu.ONE_MINUS_SRC_COLOR,"one minus src color"),ce(BA,hu.SRC_ALPHA,"src alpha"),ce(BA,hu.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),ce(BA,hu.DST_COLOR,"dst color"),ce(BA,hu.ONE_MINUS_DST_COLOR,"one minus dst color"),ce(BA,hu.DST_ALPHA,"dst alpha"),ce(BA,hu.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),ce(BA,hu.CONSTANT_COLOR,"constant color"),ce(BA,hu.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),ce(BA,hu.CONSTANT_ALPHA,"constant alpha"),ce(BA,hu.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),ce(BA,hu.SRC_ALPHA_SATURATE,"src alpha saturate"),BA),rC=(ce(zA={},hu.NEVER,"never"),ce(zA,hu.ALWAYS,"always"),ce(zA,hu.LESS,"less"),ce(zA,hu.LEQUAL,"lequal"),ce(zA,hu.GREATER,"greater"),ce(zA,hu.GEQUAL,"gequal"),ce(zA,hu.EQUAL,"equal"),ce(zA,hu.NOTEQUAL,"notequal"),zA),iC=(ce(UA={},hu.ZERO,"zero"),ce(UA,hu.KEEP,"keep"),ce(UA,hu.REPLACE,"replace"),ce(UA,hu.INVERT,"invert"),ce(UA,hu.INCR,"increment"),ce(UA,hu.DECR,"decrement"),ce(UA,hu.INCR_WRAP,"increment wrap"),ce(UA,hu.DECR_WRAP,"decrement wrap"),UA),oC=(ce(jA={},hu.FRONT,"front"),ce(jA,hu.BACK,"back"),jA),aC=function(){function e(t,n){Te(this,e),ce(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:ZA[i||hu.STATIC_DRAW],type:qA[o||hu.UNSIGNED_BYTE]})}return Se(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),sC=function(){function e(t,n){Te(this,e);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:ZA[i||hu.STATIC_DRAW],type:qA[o||hu.UNSIGNED_BYTE],count:a})}return Se(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),uC=function(){function e(t,n){Te(this,e);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return Se(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}();function lC(){lC=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new k(r||[]);return i(a,"_invoke",{value:A(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",f="suspendedYield",d="executing",v="completed",m={};function g(){}function y(){}function _(){}var x={};l(x,a,(function(){return this}));var b=Object.getPrototypeOf,E=b&&b(b(I([])));E&&E!==n&&r.call(E,a)&&(x=E);var w=_.prototype=g.prototype=Object.create(x);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==ue(c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function A(t,n,r){var i=p;return function(o,a){if(i===d)throw new Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=C(s,r);if(u){if(u===m)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var l=h(t,n,r);if("normal"===l.type){if(i=r.done?v:f,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=v,r.method="throw",r.arg=l.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(ue(t)+" is not iterable")}return y.prototype=_,i(w,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(T.prototype),l(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new T(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),l(w,u,"Generator"),l(w,a,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}var cC={}.toString;const hC=function(e){return function(e,t){return cC.call(e)==="[object "+t+"]"}(e,"Number")},pC=function(e){return null==e},fC=r(623);var dC,vC,mC,gC,yC,_C,xC,bC,EC,wC,SC,TC,AC,CC,RC,MC,kC,IC,LC,PC,OC,DC,NC,FC,BC,zC,UC;function jC(e,t,n){return e<<16|t<<8|n}function GC(e){return e>>>8&255}function VC(e){return e>>>16&255}function HC(e){return 255&e}function WC(e){switch(e){case FC.F32:case FC.U32:case FC.S32:return 4;case FC.U16:case FC.S16:case FC.F16:return 2;case FC.U8:case FC.S8:return 1;default:throw new Error("whoops")}}function XC(e){return WC(VC(e))}function ZC(e){var t=HC(e);if(t&zC.Depth)return PC.Depth;if(t&zC.Normalized)return PC.Float;var n=VC(e);if(n===FC.F16||n===FC.F32)return PC.Float;if(n===FC.U8||n===FC.U16||n===FC.U32)return PC.Uint;if(n===FC.S8||n===FC.S16||n===FC.S32)return PC.Sint;throw new Error("whoops")}function qC(e,t){if(void 0===t&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function YC(e){if(null!=e)return e;throw new Error("Missing object")}function KC(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function QC(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function JC(e,t,n,r){return void 0===r&&(r=1),{r:e,g:t,b:n,a:r}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(dC||(dC={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"}(vC||(vC={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(mC||(mC={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(gC||(gC={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(yC||(yC={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(_C||(_C={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(xC||(xC={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(bC||(bC={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(EC||(EC={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(wC||(wC={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(SC||(SC={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(TC||(TC={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(AC||(AC={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}(CC||(CC={})),function(e){e.LOADED="loaded"}(RC||(RC={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(MC||(MC={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET"}(kC||(kC={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(IC||(IC={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(LC||(LC={})),function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"}(PC||(PC={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(OC||(OC={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(DC||(DC={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(NC||(NC={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}(FC||(FC={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(BC||(BC={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"}(zC||(zC={})),function(e){e[e.ALPHA=jC(FC.U8,BC.A,zC.None)]="ALPHA",e[e.U8_LUMINANCE=jC(FC.U8,BC.A,zC.None)]="U8_LUMINANCE",e[e.F16_LUMINANCE=jC(FC.F16,BC.A,zC.None)]="F16_LUMINANCE",e[e.F32_LUMINANCE=jC(FC.F32,BC.A,zC.None)]="F32_LUMINANCE",e[e.F16_R=jC(FC.F16,BC.R,zC.None)]="F16_R",e[e.F16_RG=jC(FC.F16,BC.RG,zC.None)]="F16_RG",e[e.F16_RGB=jC(FC.F16,BC.RGB,zC.None)]="F16_RGB",e[e.F16_RGBA=jC(FC.F16,BC.RGBA,zC.None)]="F16_RGBA",e[e.F32_R=jC(FC.F32,BC.R,zC.None)]="F32_R",e[e.F32_RG=jC(FC.F32,BC.RG,zC.None)]="F32_RG",e[e.F32_RGB=jC(FC.F32,BC.RGB,zC.None)]="F32_RGB",e[e.F32_RGBA=jC(FC.F32,BC.RGBA,zC.None)]="F32_RGBA",e[e.U8_R=jC(FC.U8,BC.R,zC.None)]="U8_R",e[e.U8_R_NORM=jC(FC.U8,BC.R,zC.Normalized)]="U8_R_NORM",e[e.U8_RG=jC(FC.U8,BC.RG,zC.None)]="U8_RG",e[e.U8_RG_NORM=jC(FC.U8,BC.RG,zC.Normalized)]="U8_RG_NORM",e[e.U8_RGB=jC(FC.U8,BC.RGB,zC.None)]="U8_RGB",e[e.U8_RGB_NORM=jC(FC.U8,BC.RGB,zC.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=jC(FC.U8,BC.RGB,zC.sRGB|zC.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=jC(FC.U8,BC.RGBA,zC.None)]="U8_RGBA",e[e.U8_RGBA_NORM=jC(FC.U8,BC.RGBA,zC.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=jC(FC.U8,BC.RGBA,zC.sRGB|zC.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=jC(FC.U16,BC.R,zC.None)]="U16_R",e[e.U16_R_NORM=jC(FC.U16,BC.R,zC.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=jC(FC.U16,BC.RG,zC.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=jC(FC.U16,BC.RGBA,zC.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=jC(FC.U16,BC.RGB,zC.None)]="U16_RGB",e[e.U32_R=jC(FC.U32,BC.R,zC.None)]="U32_R",e[e.U32_RG=jC(FC.U32,BC.RG,zC.None)]="U32_RG",e[e.S8_R=jC(FC.S8,BC.R,zC.None)]="S8_R",e[e.S8_R_NORM=jC(FC.S8,BC.R,zC.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=jC(FC.S8,BC.RG,zC.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=jC(FC.S8,BC.RGB,zC.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=jC(FC.S8,BC.RGBA,zC.Normalized)]="S8_RGBA_NORM",e[e.S16_R=jC(FC.S16,BC.R,zC.None)]="S16_R",e[e.S16_RG=jC(FC.S16,BC.RG,zC.None)]="S16_RG",e[e.S16_RG_NORM=jC(FC.S16,BC.RG,zC.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=jC(FC.S16,BC.RGB,zC.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=jC(FC.S16,BC.RGBA,zC.None)]="S16_RGBA",e[e.S16_RGBA_NORM=jC(FC.S16,BC.RGBA,zC.Normalized)]="S16_RGBA_NORM",e[e.S32_R=jC(FC.S32,BC.R,zC.None)]="S32_R",e[e.U16_RGBA_5551=jC(FC.U16_PACKED_5551,BC.RGBA,zC.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=jC(FC.U16_PACKED_565,BC.RGB,zC.Normalized)]="U16_RGB_565",e[e.BC1=jC(FC.BC1,BC.RGBA,zC.Normalized)]="BC1",e[e.BC1_SRGB=jC(FC.BC1,BC.RGBA,zC.Normalized|zC.sRGB)]="BC1_SRGB",e[e.BC2=jC(FC.BC2,BC.RGBA,zC.Normalized)]="BC2",e[e.BC2_SRGB=jC(FC.BC2,BC.RGBA,zC.Normalized|zC.sRGB)]="BC2_SRGB",e[e.BC3=jC(FC.BC3,BC.RGBA,zC.Normalized)]="BC3",e[e.BC3_SRGB=jC(FC.BC3,BC.RGBA,zC.Normalized|zC.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=jC(FC.BC4_UNORM,BC.R,zC.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=jC(FC.BC4_SNORM,BC.R,zC.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=jC(FC.BC5_UNORM,BC.RG,zC.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=jC(FC.BC5_SNORM,BC.RG,zC.Normalized)]="BC5_SNORM",e[e.D24=jC(FC.D24,BC.R,zC.Depth)]="D24",e[e.D24_S8=jC(FC.D24S8,BC.RG,zC.Depth|zC.Stencil)]="D24_S8",e[e.D32F=jC(FC.D32F,BC.R,zC.Depth)]="D32F",e[e.D32F_S8=jC(FC.D32FS8,BC.RG,zC.Depth|zC.Stencil)]="D32F_S8",e[e.U8_RGB_RT=jC(FC.U8,BC.RGB,zC.RenderTarget|zC.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=jC(FC.U8,BC.RGBA,zC.RenderTarget|zC.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=jC(FC.U8,BC.RGBA,zC.RenderTarget|zC.Normalized|zC.sRGB)]="U8_RGBA_RT_SRGB"}(UC||(UC={}));var $C=JC(0,0,0,0),eR=(JC(0,0,0,1),JC(1,1,1,0));function tR(e){return!(!e||0!=(e&e-1))}function nR(e,t){return null!=e?e:t}function rR(e,t){var n=t-1;return e+n&~n}function iR(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function oR(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e}function aR(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),iR(e.rgbBlendState,t.rgbBlendState),iR(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function sR(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=aR(e[n],t[n])}function uR(e){var t=Object.assign({},e);return t.attachmentsState=[],sR(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&QC(t.blendConstant),t.stencilFront=oR(void 0,e.stencilFront),t.stencilBack=oR(void 0,e.stencilBack),t}JC(1,1,1,1);var lR={blendMode:xC.ADD,blendSrcFactor:_C.ONE,blendDstFactor:_C.ZERO},cR={attachmentsState:[{channelWriteMask:IC.ALL,rgbBlendState:lR,alphaBlendState:lR}],blendConstant:QC($C),depthWrite:!0,depthCompare:mC.LEQUAL,stencilWrite:!1,stencilFront:{compare:mC.ALWAYS,passOp:LC.KEEP,depthFailOp:LC.KEEP,failOp:LC.KEEP},stencilBack:{compare:mC.ALWAYS,passOp:LC.KEEP,depthFailOp:LC.KEEP,failOp:LC.KEEP},cullMode:yC.NONE,frontFace:gC.CCW,polygonOffset:!1};!function(e,t){void 0===e&&(e=null),void 0===t&&(t=cR);var n=uR(t);null!==e&&function(e,t){void 0!==t.attachmentsState&&sR(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&KC(e.blendConstant,t.blendConstant),e.depthCompare=nR(t.depthCompare,e.depthCompare),e.depthWrite=nR(t.depthWrite,e.depthWrite),e.stencilWrite=nR(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&oR(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&oR(e.stencilBack,t.stencilBack),e.cullMode=nR(t.cullMode,e.cullMode),e.frontFace=nR(t.frontFace,e.frontFace),e.polygonOffset=nR(t.polygonOffset,e.polygonOffset)}(n,e)}({depthCompare:mC.ALWAYS,depthWrite:!1},cR);var hR,pR={texture:null,sampler:null,formatKind:PC.Float,dimension:MC.TEXTURE_2D};function fR(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp}var dR=/([^[]*)(\[[0-9]+\])?/;function vR(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(dR);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function mR(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function gR(e,t,n,r){var i=null,o=null;return function(a,s,u){var l=t(u,n),c=l.length,h=!1;if(null===i)i=new Float32Array(c),o=c,h=!0;else{qC(o===c,"Uniform length cannot change.");for(var p=0;p<c;++p)if(l[p]!==i[p]){h=!0;break}}return h&&(r(a,e,s,l),i.set(l)),h}}function yR(e,t,n,r){e[t](n,r)}function _R(e,t,n,r){e[t](n,!1,r)}var xR={},bR={},ER={},wR=[0];function SR(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(wR[0]=e,e=wR);var i=e.length;if(e instanceof n)return e;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=e[a];return o}function TR(e,t){return SR(e,t,Float32Array,xR)}function AR(e,t){return SR(e,t,Int32Array,bR)}function CR(e,t){return SR(e,t,Uint32Array,ER)}var RR=((hR={})[dC.FLOAT]=gR.bind(null,"uniform1fv",TR,1,yR),hR[dC.FLOAT_VEC2]=gR.bind(null,"uniform2fv",TR,2,yR),hR[dC.FLOAT_VEC3]=gR.bind(null,"uniform3fv",TR,3,yR),hR[dC.FLOAT_VEC4]=gR.bind(null,"uniform4fv",TR,4,yR),hR[dC.INT]=gR.bind(null,"uniform1iv",AR,1,yR),hR[dC.INT_VEC2]=gR.bind(null,"uniform2iv",AR,2,yR),hR[dC.INT_VEC3]=gR.bind(null,"uniform3iv",AR,3,yR),hR[dC.INT_VEC4]=gR.bind(null,"uniform4iv",AR,4,yR),hR[dC.BOOL]=gR.bind(null,"uniform1iv",AR,1,yR),hR[dC.BOOL_VEC2]=gR.bind(null,"uniform2iv",AR,2,yR),hR[dC.BOOL_VEC3]=gR.bind(null,"uniform3iv",AR,3,yR),hR[dC.BOOL_VEC4]=gR.bind(null,"uniform4iv",AR,4,yR),hR[dC.FLOAT_MAT2]=gR.bind(null,"uniformMatrix2fv",TR,4,_R),hR[dC.FLOAT_MAT3]=gR.bind(null,"uniformMatrix3fv",TR,9,_R),hR[dC.FLOAT_MAT4]=gR.bind(null,"uniformMatrix4fv",TR,16,_R),hR[dC.UNSIGNED_INT]=gR.bind(null,"uniform1uiv",CR,1,yR),hR[dC.UNSIGNED_INT_VEC2]=gR.bind(null,"uniform2uiv",CR,2,yR),hR[dC.UNSIGNED_INT_VEC3]=gR.bind(null,"uniform3uiv",CR,3,yR),hR[dC.UNSIGNED_INT_VEC4]=gR.bind(null,"uniform4uiv",CR,4,yR),hR[dC.FLOAT_MAT2x3]=gR.bind(null,"uniformMatrix2x3fv",TR,6,_R),hR[dC.FLOAT_MAT2x4]=gR.bind(null,"uniformMatrix2x4fv",TR,8,_R),hR[dC.FLOAT_MAT3x2]=gR.bind(null,"uniformMatrix3x2fv",TR,6,_R),hR[dC.FLOAT_MAT3x4]=gR.bind(null,"uniformMatrix3x4fv",TR,12,_R),hR[dC.FLOAT_MAT4x2]=gR.bind(null,"uniformMatrix4x2fv",TR,8,_R),hR[dC.FLOAT_MAT4x3]=gR.bind(null,"uniformMatrix4x3fv",TR,12,_R),hR[dC.SAMPLER_2D]=mR,hR[dC.SAMPLER_CUBE]=mR,hR[dC.SAMPLER_3D]=mR,hR[dC.SAMPLER_2D_SHADOW]=mR,hR[dC.SAMPLER_2D_ARRAY]=mR,hR[dC.SAMPLER_2D_ARRAY_SHADOW]=mR,hR[dC.SAMPLER_CUBE_SHADOW]=mR,hR[dC.INT_SAMPLER_2D]=mR,hR[dC.INT_SAMPLER_3D]=mR,hR[dC.INT_SAMPLER_CUBE]=mR,hR[dC.INT_SAMPLER_2D_ARRAY]=mR,hR[dC.UNSIGNED_INT_SAMPLER_2D]=mR,hR[dC.UNSIGNED_INT_SAMPLER_3D]=mR,hR[dC.UNSIGNED_INT_SAMPLER_CUBE]=mR,hR[dC.UNSIGNED_INT_SAMPLER_2D_ARRAY]=mR,hR);function MR(e,t,n){var r=RR[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}var kR={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function IR(e,t){return"#define ".concat(e," ").concat(t)}function LR(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function PR(e,t,n,r,i){var o;void 0===r&&(r=null),void 0===i&&(i=!0);var a="#version 100"===e.glslVersion,s="frag"===t&&(null===(o=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,u=n.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),l="";null!==r&&(l=Object.keys(r).map((function(e){return IR(e,r[e])})).join("\n"));var c=u.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",h=i?u.filter((function(e){return!e.startsWith("precision")})).join("\n"):u.join("\n"),p="";if(e.viewportOrigin===OC.UPPER_LEFT&&(p+="".concat(IR("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===DC.ZERO&&(p+="".concat(IR("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var f=0,d=0,v=0;h=h.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(f,", binding = ").concat(d++,") uniform ").concat(r)})),f++,d=0,qC(e.separateSamplerTextures),h=h.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,n,r,i,o){var a=LR(r);null===a&&(a=d++);var s=T(function(e){return[e,""]}(i),2),u=s[0],l=s[1];return"frag"===t?"\nlayout(set = ".concat(f,", binding = ").concat(2*a+0,") uniform texture").concat(u," T_").concat(o,";\nlayout(set = ").concat(f,", binding = ").concat(2*a+1,") uniform sampler").concat(l," S_").concat(o,";").trim():""})),h=h.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(v++,") ").concat(t)})),p+="".concat(IR("gl_VertexID","gl_VertexIndex"),"\n"),p+="".concat(IR("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var m=0;h=h.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,n,r,i){var o=LR(n);return null===o&&(o=m++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(o)}))}if(e.separateSamplerTextures)h=(h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var g=[];h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return g.push([n,t]),n})),a&&g.forEach((function(e){var t=T(e,2),n=t[0],r=t[1];h=h.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),h=h.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var y="".concat(a?"":e.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(p||"").concat(l?l+"\n":"","\n").concat(h,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(y=y.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),a){if("frag"===t&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))),"vert"===t&&(y=(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"attribute ".concat(t," ").concat(n,";\n")}))),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var _=[],x=(y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return _.push(t),"vec4 ".concat(t,";\n")}))).lastIndexOf("}");y=y.substring(0,x)+"\n    ".concat(_.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+y.substring(x)}else{var b;y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return b=n,"".concat(t," ").concat(n,";\n")})),b&&(x=y.lastIndexOf("}"),y=y.substring(0,x)+"\n  gl_FragColor = vec4(".concat(b,");\n")+y.substring(x))}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var OR=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return _(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(fC),DR=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.Bindings;var a=i.uniformBufferBindings,s=i.samplerBindings;return o.uniformBufferBindings=a||[],o.samplerBindings=s||[],o.bindingLayouts=o.createBindingLayouts(),o}return _(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=r,numSamplers:t+=i,bindingLayoutTables:n}},t}(OR);function NR(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function FR(e){switch(VC(e)){case FC.BC1:case FC.BC2:case FC.BC3:case FC.BC4_UNORM:case FC.BC4_SNORM:case FC.BC5_UNORM:case FC.BC5_SNORM:return!0;default:return!1}}function BR(e){if(HC(e)&zC.Normalized)return!1;var t=VC(e);return t===FC.S8||t===FC.S16||t===FC.S32||t===FC.U8||t===FC.U16||t===FC.U32}function zR(e){return e&TC.INDEX?dC.ELEMENT_ARRAY_BUFFER:e&TC.VERTEX?dC.ARRAY_BUFFER:e&TC.UNIFORM?dC.UNIFORM_BUFFER:void 0}function UR(e){var t=VC(e),n=GC(e),r=HC(e),i=function(e){switch(e){case FC.U8:return dC.UNSIGNED_BYTE;case FC.U16:return dC.UNSIGNED_SHORT;case FC.U32:return dC.UNSIGNED_INT;case FC.S8:return dC.BYTE;case FC.S16:return dC.SHORT;case FC.S32:return dC.INT;case FC.F16:return dC.HALF_FLOAT;case FC.F32:return dC.FLOAT;default:throw new Error("whoops")}}(t),o=function(e){switch(e){case BC.R:return 1;case BC.RG:return 2;case BC.RGB:return 3;case BC.RGBA:return 4;default:return 1}}(n);return{size:o,type:i,normalized:!!(r&zC.Normalized)}}function jR(e){switch(e){case bC.CLAMP_TO_EDGE:return dC.CLAMP_TO_EDGE;case bC.REPEAT:return dC.REPEAT;case bC.MIRRORED_REPEAT:return dC.MIRRORED_REPEAT;default:throw new Error("whoops")}}function GR(e,t){if(t===wC.LINEAR&&e===EC.BILINEAR)return dC.LINEAR_MIPMAP_LINEAR;if(t===wC.LINEAR&&e===EC.POINT)return dC.NEAREST_MIPMAP_LINEAR;if(t===wC.NEAREST&&e===EC.BILINEAR)return dC.LINEAR_MIPMAP_NEAREST;if(t===wC.NEAREST&&e===EC.POINT)return dC.NEAREST_MIPMAP_NEAREST;if(t===wC.NO_MIP&&e===EC.BILINEAR)return dC.LINEAR;if(t===wC.NO_MIP&&e===EC.POINT)return dC.NEAREST;throw new Error("Unknown texture filter mode")}function VR(e,t){void 0===t&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function HR(e){return e.gl_texture}function WR(e){return e.gl_sampler}function XR(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function ZR(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function qR(e){return e.blendMode==xC.ADD&&e.blendSrcFactor==_C.ONE&&e.blendDstFactor===_C.ZERO}function YR(e){if(e===MC.TEXTURE_2D)return dC.TEXTURE_2D;if(e===MC.TEXTURE_2D_ARRAY)return dC.TEXTURE_2D_ARRAY;if(e===MC.TEXTURE_CUBE_MAP)return dC.TEXTURE_CUBE_MAP;if(e===MC.TEXTURE_3D)return dC.TEXTURE_3D;throw new Error("whoops")}function KR(e,t,n,r){return e%n==0&&t%r==0}var QR,JR=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.Buffer;var a=i.viewOrSize,s=i.usage,u=i.hint,l=void 0===u?AC.STATIC:u,c=r.uniformBufferMaxPageByteSize,h=r.gl,p=s&TC.UNIFORM;p||(NR(h)?h.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var f,d=hC(a)?rR(a,4):rR(a.byteLength,4);if(o.gl_buffer_pages=[],p){for(var v=d;v>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(v,c),s,l)),v-=c;f=c}else o.gl_buffer_pages.push(o.createBufferPage(d,s,l)),f=d;return o.pageByteSize=f,o.byteSize=d,o.usage=s,o.gl_target=zR(s),hC(a)||o.setSubData(0,new Uint8Array(a.buffer)),p||(NR(h)?h.bindVertexArray(o.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return _(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n);for(var i=this.device.gl,o=this.pageByteSize,a=e+r,s=e,u=e%o;s<a;){var l=NR(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=VR(this,s);if(c.ubo)return;i.bindBuffer(l,c),NR(i)?i.bufferSubData(l,u,t,n,Math.min(a-s,o)):i.bufferSubData(l,u,t),s+=o,u=0,n+=o,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&TC.UNIFORM;if(!NR(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=zR(t),s=function(e){switch(e){case AC.STATIC:return dC.STATIC_DRAW;case AC.DYNAMIC:return dC.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,e,s),o},t}(OR),$R=function(e){function t(t){var n,r,i,o,a,s=t.id,u=t.device,l=t.descriptor,c=e.call(this,{id:s,device:u})||this;c.type=vC.InputLayout;var h=l.vertexBufferDescriptors,p=l.indexBufferFormat,f=l.program;qC(p===UC.U16_R||p===UC.U32_R||null===p);var d=null!==p?function(e){switch(e){case UC.U8_R:return dC.UNSIGNED_BYTE;case UC.U16_R:return dC.UNSIGNED_SHORT;case UC.U32_R:return dC.UNSIGNED_INT;default:throw new Error("whoops")}}(p):null,v=null!==p?XC(p):null,m=c.device.gl,g=c.device.ensureResourceExists(NR(m)?m.createVertexArray():u.OES_vertex_array_object.createVertexArrayOES());NR(m)?m.bindVertexArray(g):u.OES_vertex_array_object.bindVertexArrayOES(g),m.bindBuffer(m.ARRAY_BUFFER,VR(c.device.fallbackVertexBuffer));try{for(var y=S(l.vertexBufferDescriptors),_=y.next();!_.done;_=y.next()){var x=_.value,b=x.stepMode,E=x.attributes;try{for(var w=(i=void 0,S(E)),T=w.next();!T.done;T=w.next()){var A=T.value,C=A.shaderLocation,R=A.format,M=A.divisor,k=void 0===M?1:M,I=NR(m)?C:null===(a=f.attributes[C])||void 0===a?void 0:a.location,L=UR(R);if(A.vertexFormat=L,!pC(I)){BR(R);var P=L.size,O=L.type,D=L.normalized;m.vertexAttribPointer(I,P,O,D,0,0),b===CC.INSTANCE&&(NR(m)?m.vertexAttribDivisor(I,k):u.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(I,k)),m.enableVertexAttribArray(I)}}}catch(e){i={error:e}}finally{try{T&&!T.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{_&&!_.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}return NR(m)?m.bindVertexArray(null):u.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=g,c.indexBufferFormat=p,c.indexBufferType=d,c.indexBufferCompByteSize=v,c.program=f,c}return _(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(NR(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(OR),eM=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.fake,a=e.call(this,{id:n,device:r})||this;a.type=vC.Texture,i=x({dimension:MC.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,u,l=a.device.gl,c=a.clampmipLevelCount(i);if(a.immutable=i.usage===kC.RENDER_TARGET,a.pixelStore=i.pixelStore,a.format=i.format,a.dimension=i.dimension,a.formatKind=ZC(i.format),a.width=i.width,a.height=i.height,a.depthOrArrayLayers=i.depthOrArrayLayers,a.mipmaps=c>=1,!o){u=a.device.ensureResourceExists(l.createTexture());var h=a.device.translateTextureType(i.format),p=a.device.translateTextureInternalFormat(i.format);if(a.device.setActiveTexture(l.TEXTURE0),a.device.currentTextures[0]=null,a.preprocessImage(),i.dimension===MC.TEXTURE_2D){if(s=dC.TEXTURE_2D,l.bindTexture(s,u),a.immutable)if(NR(l))l.texStorage2D(s,c,p,i.width,i.height);else{var f=(p===dC.DEPTH_COMPONENT||a.isNPOT(),0);(a.format!==UC.D32F&&a.format!==UC.D24_S8||NR(l)||r.WEBGL_depth_texture)&&(l.texImage2D(s,f,p,i.width,i.height,0,p,h,null),a.mipmaps&&(a.mipmaps=!1,l.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_MIN_FILTER,dC.LINEAR),l.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_WRAP_S,dC.CLAMP_TO_EDGE),l.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_WRAP_T,dC.CLAMP_TO_EDGE)))}qC(1===i.depthOrArrayLayers)}else if(i.dimension===MC.TEXTURE_2D_ARRAY)s=dC.TEXTURE_2D_ARRAY,l.bindTexture(s,u),a.immutable&&NR(l)&&l.texStorage3D(s,c,p,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===MC.TEXTURE_3D)s=dC.TEXTURE_3D,l.bindTexture(s,u),a.immutable&&NR(l)&&l.texStorage3D(s,c,p,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==MC.TEXTURE_CUBE_MAP)throw new Error("whoops");s=dC.TEXTURE_CUBE_MAP,l.bindTexture(s,u),a.immutable&&NR(l)&&l.texStorage2D(s,c,p,i.width,i.height),qC(6===i.depthOrArrayLayers)}}return a.gl_texture=u,a.gl_target=s,a.mipLevelCount=c,a}return _(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var n=this.device.gl;FR(this.format);var r,i=this.gl_target===dC.TEXTURE_3D||this.gl_target===dC.TEXTURE_2D_ARRAY,o=this.gl_target===dC.TEXTURE_CUBE_MAP,a=(r=e[0],Object.prototype.toString.call(r)in kR);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var s,u,l=e[0];a?(s=this.width,u=this.height):(s=l.width,u=l.height,this.width=s,this.height=u),n.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=this.device.translateTextureType(this.format);this.preprocessImage();for(var p=0;p<this.depthOrArrayLayers;p++){var f=e[p],d=this.gl_target;o&&(d=dC.TEXTURE_CUBE_MAP_POSITIVE_X+p%6),this.immutable?n.texSubImage2D(d,t,0,0,s,u,c,h,f):NR(n)?i?n.texImage3D(d,t,c,s,u,this.depthOrArrayLayers,0,c,h,f):n.texImage2D(d,t,c,s,u,0,c,h,f):a?n.texImage2D(d,t,c,s,u,0,c,h,f):n.texImage2D(d,t,c,c,h,f)}this.mipmaps&&this.generateMipmap(i)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(HR(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===MC.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&VC(e.format)===FC.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(dC.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(dC.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(dC.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!NR(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,dC.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,dC.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,dC.TEXTURE_MIN_FILTER,dC.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,dC.TEXTURE_MAG_FILTER,dC.LINEAR)):t.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_MIN_FILTER,dC.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!(NR(this.device.gl)||tR(this.width)&&tR(this.height))},t}(OR),tM=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var a=o.device.gl,s=i.format,u=i.width,l=i.height,c=i.sampleCount,h=void 0===c?1:c,p=i.texture,f=!1;if(s!==UC.D32F&&s!==UC.D24_S8||!p||NR(a)||r.WEBGL_depth_texture||(p.destroy(),o.texture=null,f=!0),!f&&p)o.texture=p;else{o.gl_renderbuffer=o.device.ensureResourceExists(a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,o.gl_renderbuffer);var d=o.device.translateTextureInternalFormat(s,!0);NR(a)&&h>1?a.renderbufferStorageMultisample(dC.RENDERBUFFER,h,d,u,l):a.renderbufferStorage(dC.RENDERBUFFER,d,u,l)}return o.format=s,o.width=u,o.height=l,o.sampleCount=h,o}return _(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(OR);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(QR||(QR={}));var nM,rM=function(e){function t(t,n){var r=t.id,i=t.device,o=t.descriptor,a=e.call(this,{id:r,device:i})||this;a.rawVertexGLSL=n,a.type=vC.Program,a.uniformSetters={},a.attributes=[];var s=a.device.gl;return a.descriptor=o,a.gl_program=a.device.ensureResourceExists(s.createProgram()),a.gl_shader_vert=null,a.gl_shader_frag=null,a.compileState=QR.NeedsCompile,a.tryCompileProgram(),a}return _(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){var e,t;qC(this.compileState===QR.NeedsCompile);var n=this.descriptor,r=this.device.gl;(null===(e=n.vertex)||void 0===e?void 0:e.glsl)&&(null===(t=n.fragment)||void 0===t?void 0:t.glsl)&&(this.gl_shader_vert=this.compileShader(n.vertex.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.fragment.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=QR.Compiling,NR(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),r=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,r,i){var o=Number(r);return n.push({location:isNaN(o)?t[r]:o,name:i}),""})),n}(this.rawVertexGLSL,r),o=function(n){var r=t.getActiveAttrib(a.gl_program,n),o=r.name,s=r.type,u=r.size,l=t.getAttribLocation(a.gl_program,o),c=null===(e=i.find((function(e){return e.name===o})))||void 0===e?void 0:e.location;l>=0&&!pC(c)&&(a.attributes[c]={name:o,location:l,type:s,size:u})},a=this,s=0;s<n;s++)o(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=vR(r.name).name,o=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=MR(e,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=MR(e,o,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!NR(t)){var n=!1;for(var r in e){n||(t.useProgram(this.gl_program),n=!0);var i=e[r],o=this.uniformSetters[r];if(o){var a=i;a instanceof eM&&(a=a.textureIndex),o(a)}}}return this},t}(OR),iM=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.QueryPool;var a=o.device.gl;if(NR(a)){var s=i.elemCount,u=i.type;o.gl_query=function(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=o.device.ensureResourceExists(a.createQuery());return n}(s),o.gl_query_type=function(e){if(e===NC.OcclusionConservative)return dC.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(u)}return o}return _(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(NR(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(NR(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(OR),oM=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=vC.Readback,i.gl_pbo=null,i.gl_sync=null,i}return _(t,e),t.prototype.clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,o){!function a(){var s,u,l,c=r.clientWaitSync(e,t,0);c!=r.WAIT_FAILED?c!=r.TIMEOUT_EXPIRED?i():setTimeout(a,(s=n,u=0,l=r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL,s<u?u:s>l?l:s)):o()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,o){return E(this,void 0,void 0,(function(){var a;return w(this,(function(s){switch(s.label){case 0:return NR(a=this.device.gl)?(this.gl_sync=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0),a.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),a.bindBuffer(e,t),a.getBufferSubData(e,n,r,i,o),a.bindBuffer(e,null),[2,r];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),void 0===s&&(s=o.byteLength||0),E(this,void 0,void 0,(function(){var u,l,c,h,p;return w(this,(function(f){var d;return u=this.device.gl,l=e,c=this.device.translateTextureFormat(l.format),h=this.device.translateTextureType(l.format),d=l.format,p=WC(VC(d))*GC(d),NR(u)?(this.gl_pbo=this.device.ensureResourceExists(u.createBuffer()),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.bufferData(u.PIXEL_PACK_BUFFER,s,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),u.bindFramebuffer(dC.READ_FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(dC.READ_FRAMEBUFFER,dC.COLOR_ATTACHMENT0,dC.TEXTURE_2D,l.gl_texture,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.readPixels(t,n,r,i,c,h,a*p),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(u.PIXEL_PACK_BUFFER,this.gl_pbo,0,o,a,0)]):[2,this.readTextureSync(e,t,n,r,i,o,a,s)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){void 0===s&&(s=o.byteLength||0);var u=this.device.gl,l=e,c=this.device.translateTextureType(l.format);return u.bindFramebuffer(dC.FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(dC.FRAMEBUFFER,dC.COLOR_ATTACHMENT0,dC.TEXTURE_2D,l.gl_texture,0),u.pixelStorei(u.PACK_ALIGNMENT,4),u.readPixels(t,n,r,i,u.RGBA,c,o),o},t.prototype.readBuffer=function(e,t,n,r,i){return E(this,void 0,void 0,(function(){var o;return w(this,(function(a){return NR(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,VR(e,t),t,n,r,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),NR(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(OR),aM=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;return s.type=vC.RenderPipeline,s.drawMode=function(e){switch(e){case SC.TRIANGLES:return dC.TRIANGLES;case SC.POINTS:return dC.POINTS;case SC.TRIANGLE_STRIP:return dC.TRIANGLE_STRIP;case SC.LINES:return dC.LINES;case SC.LINE_STRIP:return dC.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=a.topology)&&void 0!==n?n:SC.TRIANGLES),s.program=a.program,s.inputLayout=a.inputLayout,s.megaState=x(x({},uR(cR)),a.megaStateDescriptor),s.colorAttachmentFormats=a.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,s.sampleCount=null!==(r=a.sampleCount)&&void 0!==r?r:1,s}return _(t,e),t}(OR),sM=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=vC.ComputePipeline,o.descriptor=i,o}return _(t,e),t}(OR),uM=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=S(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),lM=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=vC.Sampler;var u=s.device.gl;if(NR(u)){var l=s.device.ensureResourceExists(u.createSampler());u.samplerParameteri(l,dC.TEXTURE_WRAP_S,jR(a.addressModeU)),u.samplerParameteri(l,dC.TEXTURE_WRAP_T,jR(a.addressModeV)),u.samplerParameteri(l,dC.TEXTURE_WRAP_R,jR(null!==(n=a.addressModeW)&&void 0!==n?n:a.addressModeU)),u.samplerParameteri(l,dC.TEXTURE_MIN_FILTER,GR(a.minFilter,a.mipmapFilter)),u.samplerParameteri(l,dC.TEXTURE_MAG_FILTER,GR(a.magFilter,wC.NO_MIP)),void 0!==a.lodMinClamp&&u.samplerParameterf(l,dC.TEXTURE_MIN_LOD,a.lodMinClamp),void 0!==a.lodMaxClamp&&u.samplerParameterf(l,dC.TEXTURE_MAX_LOD,a.lodMaxClamp),void 0!==a.compareFunction&&(u.samplerParameteri(l,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(l,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var c=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(qC(a.minFilter===EC.BILINEAR&&a.magFilter===EC.BILINEAR&&a.mipmapFilter===wC.LINEAR),u.samplerParameterf(l,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=l}else s.descriptor=a;return s}return _(t,e),t.prototype.setTextureParameters=function(e,t,n){var r,i=this.device.gl,o=this.descriptor;this.isNPOT(t,n)?i.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_MIN_FILTER,dC.LINEAR):i.texParameteri(e,dC.TEXTURE_MIN_FILTER,GR(o.minFilter,o.mipmapFilter)),i.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_WRAP_S,jR(o.addressModeU)),i.texParameteri(dC.TEXTURE_2D,dC.TEXTURE_WRAP_T,jR(o.addressModeV)),i.texParameteri(e,dC.TEXTURE_MAG_FILTER,GR(o.magFilter,wC.NO_MIP));var a=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(qC(o.minFilter===EC.BILINEAR&&o.magFilter===EC.BILINEAR&&o.mipmapFilter===wC.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},t.prototype.destroy=function(){e.prototype.destroy.call(this),NR(this.device.gl)&&this.device.gl.deleteSampler(WR(this))},t.prototype.isNPOT=function(e,t){return!tR(e)||!tR(t)},t}(OR),cM=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),hM=function(){function e(e,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentDepthStencilResolveTo=null,this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=uR(cR),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=OC.LOWER_LEFT,this.clipSpaceNearZ=DC.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=YC(e.getContextAttributes()),NR(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),NR(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new eM({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:MC.TEXTURE_2D,mipLevelCount:1,usage:kC.RENDER_TARGET,format:!1===this.contextAttributes.alpha?UC.U8_RGB_RT:UC.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=PC.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(MC.TEXTURE_2D,PC.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(MC.TEXTURE_2D,PC.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:TC.VERTEX,hint:AC.STATIC}),NR(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(MC.TEXTURE_2D_ARRAY,PC.Float),this.fallbackTexture3D=this.createFallbackTexture(MC.TEXTURE_3D,PC.Float),this.fallbackTextureCube=this.createFallbackTexture(MC.TEXTURE_CUBE_MAP,PC.Float)),this.currentMegaState.depthCompare=mC.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=IC.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new uM)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===MC.TEXTURE_CUBE_MAP?6:1,r=t===PC.Depth?UC.D32F:UC.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:kC.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===PC.Float&&i.setImageData([new Uint8Array(4*n)]),HR(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(dC.MAX_VERTEX_ATTRIBS),NR(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(dC.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?A([],T(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,n){var r,i=this.scTexture;i.width=e,i.height=t,this.scPlatformFramebuffer=void 0===(r=n)?null:r},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case UC.ALPHA:return dC.ALPHA;case UC.U8_LUMINANCE:case UC.F16_LUMINANCE:case UC.F32_LUMINANCE:return dC.LUMINANCE;case UC.F16_R:return dC.R16F;case UC.F16_RG:return dC.RG16F;case UC.F16_RGB:return dC.RGB16F;case UC.F16_RGBA:return dC.RGBA16F;case UC.F32_R:return dC.R32F;case UC.F32_RG:return dC.RG32F;case UC.F32_RGB:return dC.RGB32F;case UC.F32_RGBA:return NR(this.gl)?dC.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:dC.RGBA;case UC.U8_R_NORM:return dC.R8;case UC.U8_RG_NORM:return dC.RG8;case UC.U8_RGB_NORM:case UC.U8_RGB_RT:return dC.RGB8;case UC.U8_RGB_SRGB:return dC.SRGB8;case UC.U8_RGBA_NORM:case UC.U8_RGBA_RT:return NR(this.gl)?dC.RGBA8:t?dC.RGBA4:dC.RGBA;case UC.U8_RGBA:return dC.RGBA;case UC.U8_RGBA_SRGB:case UC.U8_RGBA_RT_SRGB:return dC.SRGB8_ALPHA8;case UC.U16_R:return dC.R16UI;case UC.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case UC.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case UC.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case UC.U16_RGBA_5551:return dC.RGB5_A1;case UC.U16_RGB_565:return dC.RGB565;case UC.U32_R:return dC.R32UI;case UC.S8_RGBA_NORM:return dC.RGBA8_SNORM;case UC.S8_RG_NORM:return dC.RG8_SNORM;case UC.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case UC.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case UC.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case UC.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case UC.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case UC.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case UC.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case UC.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case UC.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case UC.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case UC.D32F_S8:return NR(this.gl)?dC.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?dC.DEPTH_STENCIL:dC.DEPTH_COMPONENT16;case UC.D24_S8:return NR(this.gl)?dC.DEPTH24_STENCIL8:this.WEBGL_depth_texture?dC.DEPTH_STENCIL:dC.DEPTH_COMPONENT16;case UC.D32F:return NR(this.gl)?dC.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?dC.DEPTH_COMPONENT:dC.DEPTH_COMPONENT16;case UC.D24:return NR(this.gl)?dC.DEPTH_COMPONENT24:this.WEBGL_depth_texture?dC.DEPTH_COMPONENT:dC.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(e){switch(VC(e)){case FC.U8:return dC.UNSIGNED_BYTE;case FC.U16:return dC.UNSIGNED_SHORT;case FC.U32:return dC.UNSIGNED_INT;case FC.S8:return dC.BYTE;case FC.F16:return dC.HALF_FLOAT;case FC.F32:return dC.FLOAT;case FC.U16_PACKED_5551:return dC.UNSIGNED_SHORT_5_5_5_1;case FC.D32F:return NR(this.gl)?dC.FLOAT:this.WEBGL_depth_texture?dC.UNSIGNED_INT:dC.UNSIGNED_BYTE;case FC.D24:return NR(this.gl)?dC.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?dC.UNSIGNED_SHORT:dC.UNSIGNED_BYTE;case FC.D24S8:return NR(this.gl)?dC.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?dC.UNSIGNED_INT_24_8_WEBGL:dC.UNSIGNED_BYTE;case FC.D32FS8:return dC.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateTextureFormat=function(e){if(FR(e)||e===UC.F32_LUMINANCE||e===UC.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=NR(this.gl)||!NR(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case UC.D24_S8:case UC.D32F_S8:return t?dC.DEPTH_STENCIL:dC.RGBA;case UC.D24:case UC.D32F:return t?dC.DEPTH_COMPONENT:dC.RGBA}var n=BR(e);switch(GC(e)){case BC.A:return dC.ALPHA;case BC.R:return n?dC.RED_INTEGER:dC.RED;case BC.RG:return n?dC.RG_INTEGER:dC.RG;case BC.RGB:return n?dC.RGB_INTEGER:dC.RGB;case BC.RGBA:return dC.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(NR(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){qC(e.compileState!==QR.NeedsCompile),e.compileState===QR.Compiling&&(e.compileState=QR.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new JR({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new eM({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new lM({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new tM({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height;return qC(1===t.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,n,r,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)&&(e.vertex.glsl=PR(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(r=e.fragment)||void 0===r?void 0:r.glsl)&&(e.fragment.glsl=PR(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new rM({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new DR({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new $R({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new aM({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new cM},e.prototype.createComputePipeline=function(e){return new sM({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new oM({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new iM({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,n,r,i,o,a,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(n=e.stencilClearValue)&&void 0!==n?n:"load";for(var u=0;u<s.length;u++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[u]=null!==(r=e.colorAttachmentLevel[u])&&void 0!==r?r:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[u]=null!==(i=e.colorResolveToLevel[u])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[u]=null!==(o=e.colorClearColor[u])&&void 0!==o?o:"load",e.colorStore||(e.colorStore=[]),e.colorStore[u]=null!==(a=e.colorStore[u])&&void 0!==a&&a},e.prototype.createRenderPass=function(e){qC(null===this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,o=e.colorResolveToLevel,a=e.depthStencilAttachment,s=e.depthClearValue,u=e.stencilClearValue,l=e.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var c=0;c<t.length;c++)this.setRenderPassParametersColor(c,t[c],n[c],i[c],o[c]);for(this.setRenderPassParametersDepthStencil(a,l),this.validateCurrentAttachments(),c=0;c<t.length;c++){var h=r[c];"load"!==h&&this.setRenderPassParametersClearColor(c,h.r,h.g,h.b,h.a)}return this.setRenderPassParametersClearDepthStencil(s,u),this},e.prototype.submitPass=function(e){qC(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,o){var a=this.gl,s=e,u=r;if(qC(1===u.mipLevelCount),qC(1===s.mipLevelCount),NR(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,0),a.blitFramebuffer(i,o,i+u.width,o+u.height,t,n,t+u.width,n+u.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var l=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(l,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case UC.BC1_SRGB:case UC.BC2_SRGB:case UC.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&KR(t,n,4,4);case UC.BC1:case UC.BC2:case UC.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&KR(t,n,4,4);case UC.BC4_UNORM:case UC.BC4_SNORM:case UC.BC5_UNORM:case UC.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&KR(t,n,4,4);case UC.U16_R_NORM:case UC.U16_RG_NORM:case UC.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case UC.F32_R:case UC.F32_RG:case UC.F32_RGB:case UC.F32_RGBA:return null!==this.OES_texture_float_linear;case UC.F16_R:case UC.F16_RG:case UC.F16_RGB:case UC.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===QR.NeedsCompile)throw new Error("whoops");if(e.compileState===QR.Compiling){var n;return(n=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),n}return e.compileState===QR.NeedsBind||e.compileState===QR.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===vC.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)XR(n[r],"".concat(t," Page ").concat(r));else if(e.type===vC.Texture)XR(HR(e),t);else if(e.type===vC.Sampler)XR(WR(e),t);else if(e.type===vC.RenderTarget){var i=e.gl_renderbuffer;null!==i&&XR(i,t)}else e.type===vC.InputLayout&&XR(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){qC(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){void 0===n&&(n=0);var r=this.gl;NR(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,VR(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,n){return"".concat(function(e,t,n){for(void 0===n&&(n="0");e.length<4;)e="".concat(n).concat(e);return e}(""+(t+n),0," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if(null===n)i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===vC.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(e,t,dC.TEXTURE_2D,HR(n.texture),r);else if(n.type===vC.Texture){var o=HR(n);n.dimension===MC.TEXTURE_2D?i.framebufferTexture2D(e,t,dC.TEXTURE_2D,o,r):NR(i)&&(n.dimension,MC.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=null!==t?HC(t.format):zC.Depth|zC.Stencil,i=!!(r&zC.Depth),o=!!(r&zC.Stencil);i&&o?NR(this.gl)||!NR(this.gl)&&this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(qC(e===i.sampleCount),qC(t===i.width),qC(n===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(qC(e===this.currentDepthStencilAttachment.sampleCount),qC(t===this.currentDepthStencilAttachment.width),qC(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e){var t=this.gl;if(NR(t)?t.bindFramebuffer(dC.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(dC.FRAMEBUFFER,this.renderPassDrawFramebuffer),NR(t)?t.drawBuffers([dC.COLOR_ATTACHMENT0,dC.COLOR_ATTACHMENT1,dC.COLOR_ATTACHMENT2,dC.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([dC.COLOR_ATTACHMENT0_WEBGL,dC.COLOR_ATTACHMENT1_WEBGL,dC.COLOR_ATTACHMENT2_WEBGL,dC.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=e;n<this.currentColorAttachments.length;n++){var r=NR(t)?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,i=NR(t)?dC.COLOR_ATTACHMENT0:dC.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(r,i+n,dC.RENDERBUFFER,null),t.framebufferTexture2D(r,i+n,dC.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i){var o=NR(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===n||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,(o||!o&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(o?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,(o?dC.COLOR_ATTACHMENT0:dC.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===r&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t){var n=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(NR(n)?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[e])&&o.channelWriteMask!==IC.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),o.channelWriteMask=IC.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==IC.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=IC.ALL),this.setScissorRectEnabled(!1),NR(a)?a.clearBufferfv(a.COLOR,e,[t,n,r,i]):(a.clearColor(t,n,r,i),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var n=this.gl;"load"!==e&&(qC(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),NR(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(qC(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),NR(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,n=this.gl,r=e,i=r.uniformBufferBindings,o=r.samplerBindings,a=r.bindingLayouts;qC(0<a.bindingLayoutTables.length);var s=a.bindingLayoutTables[0];qC(i.length>=s.numUniformBuffers),qC(o.length>=s.numSamplers);for(var u=0;u<i.length;u++)if(0!==(v=i[u]).size){var l=s.firstUniformBuffer+u,c=v.buffer,h=v.offset||0,p=v.size||c.byteSize;if(c!==this.currentUniformBuffers[l]||h!==this.currentUniformBufferByteOffsets[l]||p!==this.currentUniformBufferByteSizes[l]){var f=h%c.pageByteSize,d=c.gl_buffer_pages[h/c.pageByteSize|0];qC(f+p<=c.pageByteSize),NR(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,l,d,f,p),this.currentUniformBuffers[l]=c,this.currentUniformBufferByteOffsets[l]=h,this.currentUniformBufferByteSizes[l]=p}}for(u=0;u<s.numSamplers;u++){var v=o[u],m=s.firstSampler+u,g=null!==v&&null!==v.sampler?WR(v.sampler):null,y=null!==v&&null!==v.texture?HR(v.texture):null;if(this.currentSamplers[m]!==g&&(NR(n)&&n.bindSampler(m,g),this.currentSamplers[m]=g),this.currentTextures[m]!==y){if(this.setActiveTexture(n.TEXTURE0+m),null!==y){var _=YC(v).texture,b=_.gl_target,E=_.width,w=_.height;v.texture.textureIndex=m,n.bindTexture(b,y),NR(n)||null===(t=v.sampler)||void 0===t||t.setTextureParameters(b,E,w),this.debugGroupStatisticsTextureBind()}else{var S=x(x({},v),pR),T=S.dimension,A=S.formatKind;b=YR(T),n.bindTexture(b,this.getFallbackTexture(x({gl_target:b,formatKind:A},S)))}this.currentTextures[m]=y}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&IC.RED),!!(n.channelWriteMask&IC.GREEN),!!(n.channelWriteMask&IC.BLUE),!!(n.channelWriteMask&IC.ALPHA)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(qR(t.rgbBlendState)&&qR(t.alphaBlendState)?i.enableiOES(e,r.BLEND):qR(n.rgbBlendState)&&qR(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),o&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&IC.RED),!!(t.channelWriteMask&IC.GREEN),!!(t.channelWriteMask&IC.BLUE),!!(t.channelWriteMask&IC.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(qR(e.rgbBlendState)&&qR(e.alphaBlendState)?n.enable(n.BLEND):qR(t.rgbBlendState)&&qR(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t,n,r=this.gl,i=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var o=0;o<e.attachmentsState.length;o++)this.applyAttachmentStateIndexed(o,i.attachmentsState[0],e.attachmentsState[0]);else qC(1===e.attachmentsState.length),this.applyAttachmentState(i.attachmentsState[0],e.attachmentsState[0]);if(t=i.blendConstant,n=e.blendConstant,t.r===n.r&&t.g===n.g&&t.b===n.b&&t.a===n.a||(r.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),KC(i.blendConstant,e.blendConstant)),i.depthCompare!==e.depthCompare&&(r.depthFunc(e.depthCompare),i.depthCompare=e.depthCompare),!!i.depthWrite!=!!e.depthWrite&&(r.depthMask(e.depthWrite),i.depthWrite=e.depthWrite),!!i.stencilWrite!=!!e.stencilWrite&&(r.stencilMask(e.stencilWrite?255:0),i.stencilWrite=e.stencilWrite),!fR(i.stencilFront,e.stencilFront)){var a=e.stencilFront,s=a.passOp,u=a.failOp,l=a.depthFailOp,c=a.compare;i.stencilFront.passOp===s&&i.stencilFront.failOp===u&&i.stencilFront.depthFailOp===l||(r.stencilOpSeparate(r.FRONT,u,l,s),i.stencilFront.passOp=s,i.stencilFront.failOp=u,i.stencilFront.depthFailOp=l),i.stencilFront.compare!==c&&(this.setStencilReference(0),i.stencilFront.compare=c)}if(!fR(i.stencilBack,e.stencilBack)){var h=e.stencilBack;s=h.passOp,u=h.failOp,l=h.depthFailOp,c=h.compare,i.stencilBack.passOp===s&&i.stencilBack.failOp===u&&i.stencilBack.depthFailOp===l||(r.stencilOpSeparate(r.BACK,u,l,s),i.stencilBack.passOp=s,i.stencilBack.failOp=u,i.stencilBack.depthFailOp=l),i.stencilBack.compare!==c&&(this.setStencilReference(0),i.stencilBack.compare=c)}i.cullMode!==e.cullMode&&(i.cullMode===yC.NONE?r.enable(r.CULL_FACE):e.cullMode===yC.NONE&&r.disable(r.CULL_FACE),e.cullMode===yC.BACK?r.cullFace(r.BACK):e.cullMode===yC.FRONT?r.cullFace(r.FRONT):e.cullMode===yC.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),i.cullMode=e.cullMode),i.frontFace!==e.frontFace&&(r.frontFace(e.frontFace),i.frontFace=e.frontFace),i.polygonOffset!==e.polygonOffset&&(e.polygonOffset?(r.polygonOffset(1,1),r.enable(r.POLYGON_OFFSET_FILL)):r.disable(r.POLYGON_OFFSET_FILL),i.polygonOffset=e.polygonOffset)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)this.currentColorAttachments[t];this.currentDepthStencilAttachment&&qC(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&qC(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===QR.NeedsBind){var n=this.gl,r=t.gl_program,i=t.descriptor,o=ZR(i.vertex.glsl,/uniform (\w+) {([^]*?)}/g);if(NR(n))for(var a=0;a<o.length;a++){var s=T(o[a],2)[1],u=n.getUniformBlockIndex(r,s);-1!==u&&4294967295!==u&&n.uniformBlockBinding(r,u,a)}var l=ZR(i.vertex.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(a=0;a<l.length;a++){var c=T(l[a],3),h=c[1],p=c[2],f=n.getUniformLocation(r,h);n.uniform1i(f,parseInt(p))}t.compileState=QR.ReadyToUse}},e.prototype.setVertexInput=function(e,t,n){var r,i,o;if(null!==e){qC(this.currentPipeline.inputLayout===e);var a=e;this.bindVAO(a.vao);for(var s=this.gl,u=0;u<a.vertexBufferDescriptors.length;u++){var l=a.vertexBufferDescriptors[u],c=l.arrayStride,h=l.attributes;try{for(var p=(r=void 0,S(h)),f=p.next();!f.done;f=p.next()){var d=f.value,v=d.shaderLocation,m=d.offset,g=NR(s)?v:null===(o=a.program.attributes[v])||void 0===o?void 0:o.location;if(!pC(g)){var y=t[u];if(null===y)continue;var _=d.vertexFormat;s.bindBuffer(s.ARRAY_BUFFER,VR(y.buffer));var x=(y.offset||0)+m;s.vertexAttribPointer(g,_.size,_.type,_.normalized,c,x)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(qC(null!==n==(null!==a.indexBufferFormat)),null!==n){var b=n.buffer;qC(b.usage===TC.INDEX),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,VR(b)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else qC(null===this.currentPipeline.inputLayout),qC(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,o=this.gl,a=this.currentPipeline;if(t){var s=[a.drawMode,n||0,e,t];NR(o)?o.drawArraysInstanced.apply(o,A([],T(s),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,A([],T(s),!1))}else o.drawArrays(a.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))},e.prototype.drawIndexed=function(e,t,n,r,i){var o,a=this.gl,s=this.currentPipeline,u=YC(s.inputLayout),l=YC(this.currentIndexBufferByteOffset)+n*u.indexBufferCompByteSize;if(t){var c=[s.drawMode,e,u.indexBufferType,l,t];NR(a)?a.drawElementsInstanced.apply(a,A([],T(c),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,A([],T(c),!1))}else a.drawElements(s.drawMode,e,u.indexBufferType,l);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(NR(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(NR(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=NR(e),n=!1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];if(null!==i){var o=this.currentColorResolveTos[r],a=!1;null!==o&&(qC(i.width===o.width&&i.height===o.height),this.setScissorRectEnabled(!1),t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,i,this.currentColorAttachmentLevels[r]),a=!0,o===this.scTexture?e.bindFramebuffer(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[r])),t?(e.blitFramebuffer(0,0,i.width,i.height,0,0,o.width,o.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(i,o),n=!0),this.currentRenderPassDescriptor.colorStore[r]||a||(e.bindFramebuffer(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,e.COLOR_ATTACHMENT0,i,this.currentColorAttachmentLevels[r])),e.bindFramebuffer(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var s=this.currentDepthStencilAttachment;if(s){var u=this.currentDepthStencilResolveTo;a=!1,u&&(qC(s.width===u.width&&s.height===u.height),this.setScissorRectEnabled(!1),e.bindFramebuffer(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,s),this.bindFramebufferDepthStencilAttachment(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,u)),a=!0,t&&e.blitFramebuffer(0,0,s.width,s.height,0,0,u.width,u.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(a||(e.bindFramebuffer(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,s),a=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),a&&e.bindFramebuffer(t?dC.READ_FRAMEBUFFER:dC.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||e.bindFramebuffer(t?dC.DRAW_FRAMEBUFFER:dC.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){pC(this.currentStencilRef)||(this.gl.stencilFuncSeparate(dC.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(dC.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===dC.TEXTURE_2D)return n===PC.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===dC.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===dC.TEXTURE_3D)return this.fallbackTexture3D;if(t===dC.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:TC.VERTEX|TC.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:CC.VERTEX,attributes:[{format:UC.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:SC.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[UC.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:uR(cR)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[eR]}),i=this.getCanvas(),o=i.width,a=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),pM=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return E(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,l,c;return w(this,(function(h){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,o=void 0!==i&&i,a=t.preserveDrawingBuffer,s=void 0!==a&&a,u=t.premultipliedAlpha,l={antialias:o,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:void 0===u||u,xrCompatible:r},this.handleContextEvents(e),n.includes("webgl2")&&(c=e.getContext("webgl2",l)||e.getContext("experimental-webgl2",l)),!c&&n.includes("webgl1")&&(c=e.getContext("webgl",l)||e.getContext("experimental-webgl",l)),[2,new hM(c,{shaderDebug:!0,trackResources:!0})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)},e}(),fM="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&fM.decode();var dM=null;function vM(){return null!==dM&&0!==dM.byteLength||(dM=new Uint8Array(nM.memory.buffer)),dM}function mM(e,t){return e>>>=0,fM.decode(vM().subarray(e,e+t))}var gM=new Array(128).fill(void 0);gM.push(void 0,null,!0,!1);var yM=gM.length;function _M(e){return gM[e]}var xM=0,bM="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},EM="function"==typeof bM.encodeInto?function(e,t){return bM.encodeInto(e,t)}:function(e,t){var n=bM.encode(e);return t.set(n),{read:e.length,written:n.length}};function wM(e,t,n){if(void 0===n){var r=bM.encode(e),i=t(r.length,1)>>>0;return vM().subarray(i,i+r.length).set(r),xM=r.length,i}for(var o=e.length,a=t(o,1)>>>0,s=vM(),u=0;u<o;u++){var l=e.charCodeAt(u);if(l>127)break;s[a+u]=l}if(u!==o){0!==u&&(e=e.slice(u)),a=n(a,o,o=u+3*e.length,1)>>>0;var c=vM().subarray(a+u,a+o);u+=EM(e,c).written}return xM=u,a}var SM,TM,AM=null;function CM(){return null!==AM&&0!==AM.byteLength||(AM=new Int32Array(nM.memory.buffer)),AM}function RM(e,t,n){var r,i;try{var o=nM.__wbindgen_add_to_stack_pointer(-16),a=wM(e,nM.__wbindgen_malloc,nM.__wbindgen_realloc),s=xM,u=wM(t,nM.__wbindgen_malloc,nM.__wbindgen_realloc),l=xM;nM.glsl_compile(o,a,s,u,l,n);var c=CM()[o/4+0],h=CM()[o/4+1];return r=c,i=h,mM(c,h)}finally{nM.__wbindgen_add_to_stack_pointer(16),nM.__wbindgen_free(r,i,1)}}function MM(e,t){return kM.apply(this,arguments)}function kM(){return(kM=ir(lC().mark((function e(t,n){var r,i;return lC().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"==typeof Response&&t instanceof Response)){e.next=23;break}if("function"!=typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:case 20:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((i=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:i,module:t});case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function IM(){var e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return function(e){yM===gM.length&&gM.push(gM.length+1);var t=yM;return yM=gM[t],gM[t]=e,t}(mM(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){var t;_M(t=e),function(e){e<132||(gM[e]=yM,yM=e)}(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(_M(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log(_M(e),_M(t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(mM(e,t))},e}function LM(e,t){return nM=e.exports,PM.__wbindgen_wasm_module=t,AM=null,dM=null,nM}function PM(e){return OM.apply(this,arguments)}function OM(){return(OM=ir(lC().mark((function e(t){var n,r,i,o;return lC().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===nM){e.next=2;break}return e.abrupt("return",nM);case 2:return n=IM(),("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=MM,e.next=7,t;case 7:return e.t1=e.sent,e.t2=n,e.next=11,(0,e.t0)(e.t1,e.t2);case 11:return r=e.sent,i=r.instance,o=r.module,e.abrupt("return",LM(i,o));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function DM(e){if(e===UC.U8_R_NORM)return"r8unorm";if(e===UC.U8_RG_NORM)return"rg8unorm";if(e===UC.U8_RGBA_RT)return"bgra8unorm";if(e===UC.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===UC.U8_RGBA_NORM)return"rgba8unorm";if(e===UC.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===UC.S8_R_NORM)return"r8snorm";if(e===UC.S8_RG_NORM)return"rg8snorm";if(e===UC.S8_RGBA_NORM)return"rgba8snorm";if(e===UC.U32_R)return"r32uint";if(e===UC.F16_RGBA)return"rgba16float";if(e===UC.F32_RGBA)return"rgba32float";if(e===UC.D24)return"depth24plus";if(e===UC.D24_S8)return"depth24plus-stencil8";if(e===UC.D32F)return"depth32float";if(e===UC.D32F_S8)return"depth32float-stencil8";if(e===UC.BC1)return"bc1-rgba-unorm";if(e===UC.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===UC.BC2)return"bc2-rgba-unorm";if(e===UC.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===UC.BC3)return"bc3-rgba-unorm";if(e===UC.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===UC.BC4_SNORM)return"bc4-r-snorm";if(e===UC.BC4_UNORM)return"bc4-r-unorm";if(e===UC.BC5_SNORM)return"bc5-rg-snorm";if(e===UC.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function NM(e){if(e===MC.TEXTURE_2D)return"2d";if(e===MC.TEXTURE_CUBE_MAP)return"cube";if(e===MC.TEXTURE_2D_ARRAY)return"2d-array";if(e===MC.TEXTURE_3D)return"3d";throw new Error("whoops")}function FM(e){if(e===bC.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===bC.REPEAT)return"repeat";if(e===bC.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function BM(e){if(e===EC.BILINEAR)return"linear";if(e===EC.POINT)return"nearest";throw new Error("whoops")}function zM(e){if(e===wC.LINEAR)return"linear";if(e===wC.NEAREST)return"nearest";if(e===wC.NO_MIP)return"nearest";throw new Error("whoops")}function UM(e){return e.gpuBuffer}function jM(e){if(e===NC.OcclusionConservative)return"occlusion";throw new Error("whoops")}function GM(e){switch(e){case SC.TRIANGLES:return"triangle-list";case SC.POINTS:return"point-list";case SC.TRIANGLE_STRIP:return"triangle-strip";case SC.LINES:return"line-list";case SC.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function VM(e){if(e===yC.NONE)return"none";if(e===yC.FRONT)return"front";if(e===yC.BACK)return"back";throw new Error("whoops")}function HM(e){if(e===gC.CCW)return"ccw";if(e===gC.CW)return"cw";throw new Error("whoops")}function WM(e){if(e===_C.ZERO)return"zero";if(e===_C.ONE)return"one";if(e===_C.SRC)return"src";if(e===_C.ONE_MINUS_SRC)return"one-minus-src";if(e===_C.DST)return"dst";if(e===_C.ONE_MINUS_DST)return"one-minus-dst";if(e===_C.SRC_ALPHA)return"src-alpha";if(e===_C.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===_C.DST_ALPHA)return"dst-alpha";if(e===_C.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===_C.CONST)return"constant";if(e===_C.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===_C.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function XM(e){if(e===xC.ADD)return"add";if(e===xC.SUBSTRACT)return"subtract";if(e===xC.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===xC.MIN)return"min";if(e===xC.MAX)return"max";throw new Error("whoops")}function ZM(e){return{operation:XM(e.blendMode),srcFactor:WM(e.blendSrcFactor),dstFactor:WM(e.blendDstFactor)}}function qM(e){return e.blendMode===xC.ADD&&e.blendSrcFactor===_C.ONE&&e.blendDstFactor===_C.ZERO}function YM(e){return qM(e.rgbBlendState)&&qM(e.alphaBlendState)?void 0:{color:ZM(e.rgbBlendState),alpha:ZM(e.alphaBlendState)}}function KM(e){if(e===mC.NEVER)return"never";if(e===mC.LESS)return"less";if(e===mC.EQUAL)return"equal";if(e===mC.LEQUAL)return"less-equal";if(e===mC.GREATER)return"greater";if(e===mC.NOTEQUAL)return"not-equal";if(e===mC.GEQUAL)return"greater-equal";if(e===mC.ALWAYS)return"always";throw new Error("whoops")}function QM(e){if(e===LC.KEEP)return"keep";if(e===LC.REPLACE)return"replace";if(e===LC.ZERO)return"zero";if(e===LC.DECREMENT_CLAMP)return"decrement-clamp";if(e===LC.DECREMENT_WRAP)return"decrement-wrap";if(e===LC.INCREMENT_CLAMP)return"increment-clamp";if(e===LC.INCREMENT_WRAP)return"increment-wrap";if(e===LC.INVERT)return"invert";throw new Error("whoops")}function JM(e){if(e===CC.VERTEX)return"vertex";if(e===CC.INSTANCE)return"instance";throw new Error("whoops")}function $M(e){if(e===UC.U8_R)return"uint8x2";if(e===UC.U8_RG)return"uint8x2";if(e===UC.U8_RGB)return"uint8x4";if(e===UC.U8_RGBA)return"uint8x4";if(e===UC.U8_RG_NORM)return"unorm8x2";if(e===UC.U8_RGBA_NORM)return"unorm8x4";if(e===UC.S8_RGB_NORM)return"snorm8x4";if(e===UC.S8_RGBA_NORM)return"snorm8x4";if(e===UC.U16_RG_NORM)return"unorm16x2";if(e===UC.U16_RGBA_NORM)return"unorm16x4";if(e===UC.S16_RG_NORM)return"snorm16x2";if(e===UC.S16_RGBA_NORM)return"snorm16x4";if(e===UC.S16_RG)return"uint16x2";if(e===UC.F16_RG)return"float16x2";if(e===UC.F16_RGBA)return"float16x4";if(e===UC.F32_R)return"float32";if(e===UC.F32_RG)return"float32x2";if(e===UC.F32_RGB)return"float32x3";if(e===UC.F32_RGBA)return"float32x4";throw"whoops"}function ek(e,t,n,r){switch(void 0===n&&(n=!1),e){case UC.S8_R:case UC.S8_R_NORM:case UC.S8_RG_NORM:case UC.S8_RGB_NORM:case UC.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case UC.U8_R:case UC.U8_R_NORM:case UC.U8_RG:case UC.U8_RG_NORM:case UC.U8_RGB:case UC.U8_RGB_NORM:case UC.U8_RGB_SRGB:case UC.U8_RGBA:case UC.U8_RGBA_NORM:case UC.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(t));return r&&o.set(new Uint8Array(r)),o;case UC.S16_R:case UC.S16_RG:case UC.S16_RG_NORM:case UC.S16_RGB_NORM:case UC.S16_RGBA:case UC.S16_RGBA_NORM:var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&a.set(new Int16Array(r)),a;case UC.U16_R:case UC.U16_RGB:case UC.U16_RGBA_5551:case UC.U16_RGBA_NORM:case UC.U16_RG_NORM:case UC.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case UC.S32_R:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&u.set(new Int32Array(r)),u;case UC.U32_R:case UC.U32_RG:var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&l.set(new Uint32Array(r)),l;case UC.F32_R:case UC.F32_RG:case UC.F32_RGB:case UC.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&c.set(new Float32Array(r)),c}var h=(ArrayBuffer,new Uint8Array(t));return r&&h.set(new Uint8Array(r)),h}function tk(e){var t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(SM||(SM={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(TM||(TM={}));var nk,rk,ik,ok,ak,sk,uk,lk,ck,hk,pk=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return _(t,e),t.prototype.destroy=function(){},t}(fC),fk=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.Bindings;var a=i.pipeline;qC(!!a);var s=i.uniformBufferBindings,u=i.storageBufferBindings,l=i.samplerBindings;o.numUniformBuffers=(null==s?void 0:s.length)||0;var c=[[],[]],h=0;if(u&&u.length)for(var p=0;p<u.length;p++){var f=i.storageBufferBindings[p],d=f.binding,v=f.size,m=f.offset,g={buffer:UM(f.buffer),offset:null!=m?m:0,size:v};c[0].push({binding:null!=d?d:h++,resource:g})}if(s&&s.length)for(p=0;p<s.length;p++){var y=i.uniformBufferBindings[p];d=y.binding,v=y.size,m=y.offset,g={buffer:UM(y.buffer),offset:null!=m?m:0,size:v},c[0].push({binding:null!=d?d:h++,resource:g})}if(l&&l.length)for(h=0,p=0;p<l.length;p++){var _=x(x({},l[p]),pR),b=null!==(d=i.samplerBindings[p]).texture?d.texture:o.device.getFallbackTexture(_);_.dimension=b.dimension,_.formatKind=ZC(b.format);var E=b.gpuTextureView;c[1].push({binding:h++,resource:E});var w=(null!==d.sampler?d.sampler:o.device.getFallbackSampler(_)).gpuSampler;c[1].push({binding:h++,resource:w})}return o.gpuBindGroup=c.filter((function(e){return e.length>0})).map((function(e,t){return o.device.device.createBindGroup({layout:a.getBindGroupLayout(t),entries:e})})),o}return _(t,e),t}(pk),dk=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.Buffer;var a=i.usage,s=i.viewOrSize,u=!!(a&TC.MAP_READ);o.usage=function(e){var t=0;return e&TC.INDEX&&(t|=GPUBufferUsage.INDEX),e&TC.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&TC.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&TC.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&TC.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),t|GPUBufferUsage.COPY_DST}(a),u&&(o.usage=TC.MAP_READ|TC.COPY_DST);var l=!hC(s);return o.view=hC(s)?null:s,o.size=hC(s)?rR(s,4):rR(s.byteLength,4),hC(s)?o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!!u&&l}):(o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(o.gpuBuffer.getMappedRange()).set(s),o.gpuBuffer.unmap()),o}return _(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var o=t.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var u=new Uint8Array(t.buffer.slice(o,a));(t=new Uint8Array(s)).set(u),n=0,o=0,a=s,r=s}for(var l=15728640,c=0;a-(o+c)>l;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,l),c+=l;this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,r-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(pk),vk=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){qC(null===this.gpuComputePassEncoder),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=YC(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=e;this.gpuComputePassEncoder.setBindGroup(0,t.gpuBindGroup[0])},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),mk=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=i;var a=i.program.computeStage;if(null===a)return o;var s={layout:"auto",compute:x({},a)};return o.gpuComputePipeline=o.device.device.createComputePipeline(s),void 0!==o.name&&(o.gpuComputePipeline.label=o.name),o}return _(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(pk),gk=function(e){function t(t){var n,r,i,o,a=t.id,s=t.device,u=t.descriptor,l=e.call(this,{id:a,device:s})||this;l.type=vC.InputLayout;var c=[];try{for(var h=S(u.vertexBufferDescriptors),p=h.next();!p.done;p=h.next()){var f=p.value,d=f.arrayStride,v=f.stepMode,m=f.attributes;c.push({arrayStride:d,stepMode:JM(v),attributes:[]});try{for(var g=(i=void 0,S(m)),y=g.next();!y.done;y=g.next()){var _=y.value,x=_.shaderLocation,b=_.format,E=_.offset;c[c.length-1].attributes.push({shaderLocation:x,format:$M(b),offset:E})}}catch(e){i={error:e}}finally{try{y&&!y.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l.indexFormat=function(e){if(null!==e){if(e===UC.U16_R)return"uint16";if(e===UC.U32_R)return"uint32";throw new Error("whoops")}}(u.indexBufferFormat),l.buffers=c,l}return _(t,e),t}(pk),yk=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=vC.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=i,i.vertex&&(o.vertexStage=o.createShaderStage(i.vertex,"vertex")),i.fragment&&(o.fragmentStage=o.createShaderStage(i.fragment,"fragment")),i.compute&&(o.computeStage=o.createShaderStage(i.compute,"compute")),o}return _(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,o=e.wgsl,a=e.entryPoint,s=o;if(!s)try{s=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),new Error("whoops")}var u=function(e){if(!s.includes(e))return"continue";s=(s=s.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var l=S(["u_TextureFramebufferDepth"]),c=l.next();!c.done;c=l.next())u(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return{module:this.device.device.createShaderModule({code:s}),entryPoint:a||"main"}},t}(pk),_k=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=vC.QueryPool;var a=i.elemCount,s=i.type;return o.querySet=o.device.device.createQuerySet({type:jM(s),count:a}),o.resolveBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return _(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(pk),xk=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=vC.Readback,i}return _(t,e),t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),E(this,void 0,void 0,(function(){var s,u,l,c,h,p,f;return w(this,(function(d){return s=e,u=this.getBlockInformationFromFormat(s.gpuTextureformat),l=Math.ceil(r/u.width)*u.length,c=256*Math.ceil(l/256),h=c*i,p=this.device.createBuffer({usage:TC.STORAGE|TC.MAP_READ|TC.COPY_DST,hint:AC.STATIC,viewOrSize:h}),(f=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(0,0)}},{buffer:p.gpuBuffer,offset:0,bytesPerRow:c},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([f.finish()]),[2,this.readBuffer(p,0,o.byteLength===h?o:null,a,h,s.format)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,n,r,i,o,a,s){var u=this;void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=UC.U8_RGB),void 0===a&&(a=!1);var l=e,c=i||l.size,h=n||l.view,p=h&&h.constructor&&h.constructor.BYTES_PER_ELEMENT||XC(o),f=l;if(!(l.usage&TC.MAP_READ&&l.usage&TC.COPY_DST)){var d=this.device.device.createCommandEncoder();f=this.device.createBuffer({usage:TC.STORAGE|TC.MAP_READ|TC.COPY_DST,hint:AC.STATIC,viewOrSize:c}),d.copyBufferToBuffer(l.gpuBuffer,t,f.gpuBuffer,0,c),this.device.device.queue.submit([d.finish()])}return new Promise((function(e,n){f.gpuBuffer.mapAsync(TM.READ,t,c).then((function(){var n=f.gpuBuffer.getMappedRange(t,c),r=h;if(a)r=null===r?ek(o,c,!0,n):ek(o,r.buffer,void 0,n);else if(null===r)switch(p){case 1:(r=new Uint8Array(c)).set(new Uint8Array(n));break;case 2:r=u.getHalfFloatAsFloatRGBAArrayBuffer(c/2,n);break;case 4:(r=new Float32Array(c/4)).set(new Float32Array(n))}else switch(p){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=u.getHalfFloatAsFloatRGBAArrayBuffer(c/2,n,h);break;case 4:var i=h&&h.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}f.gpuBuffer.unmap(),e(r)}),(function(e){return n(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||(n=new Float32Array(e));for(var r=new Uint16Array(t);e--;)n[e]=tk(r[e]);return n},t.prototype.getBlockInformationFromFormat=function(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}},t}(pk),bk=function(){function e(e){this.device=e,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(e,t){return qC(t<e.mipLevelCount),1===e.mipLevelCount?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){var t,n,r,i,o,a;this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=e.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var u=0;u<e.colorAttachment.length;u++){var l=e.colorAttachment[u],c=e.colorResolveTo[u];if(null===l&&null!==c&&(l=c,c=null),this.gfxColorAttachment[u]=l,this.gfxColorResolveTo[u]=c,this.gfxColorAttachmentLevel[u]=(null===(t=e.colorAttachmentLevel)||void 0===t?void 0:t[u])||0,this.gfxColorResolveToLevel[u]=(null===(n=e.colorResolveToLevel)||void 0===n?void 0:n[u])||0,null===l){this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}void 0===this.gpuColorAttachments[u]&&(this.gpuColorAttachments[u]={}),(p=this.gpuColorAttachments[u]).view=this.getTextureView(l,(null===(r=this.gfxColorAttachmentLevel)||void 0===r?void 0:r[u])||0);var h=null!==(o=null===(i=e.colorClearColor)||void 0===i?void 0:i[u])&&void 0!==o?o:"load";"load"===h?p.loadOp="load":(p.loadOp="clear",p.clearValue=h),p.storeOp=(null===(a=e.colorStore)||void 0===a?void 0:a[u])?"store":"discard",p.resolveTarget=void 0,null!==c&&(l.sampleCount>1?p.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[u]):p.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var p,f=e.depthStencilAttachment;(p=this.gpuDepthStencilAttachment).view=f.gpuTextureView,HC(f.format)&zC.Depth?("load"===e.depthClearValue?p.depthLoadOp="load":(p.depthLoadOp="clear",p.depthClearValue=e.depthClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?p.depthStoreOp="store":p.depthStoreOp="discard"):(p.depthLoadOp=void 0,p.depthStoreOp=void 0),HC(f.format)&zC.Stencil?("load"===e.stencilClearValue?p.stencilLoadOp="load":(p.stencilLoadOp="clear",p.stencilClearValue=e.stencilClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?p.stencilStoreOp="store":p.stencilStoreOp="discard"):(p.stencilLoadOp=void 0,p.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=pC(e.occlusionQueryPool)?void 0:e.occlusionQueryPool.querySet},e.prototype.beginRenderPass=function(e){qC(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(e),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,o)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=YC(e.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(null!==e){var r=e;null!==n&&this.gpuRenderPassEncoder.setIndexBuffer(UM(n.buffer),YC(r.indexFormat),n.offset);for(var i=0;i<t.length;i++){var o=t[i];null!==o&&this.gpuRenderPassEncoder.setVertexBuffer(i,UM(o.buffer),o.offset)}}},e.prototype.setBindings=function(e){var t=e;this.gpuRenderPassEncoder.setBindGroup(0,t.gpuBindGroup[0]),t.gpuBindGroup[1]&&this.gpuRenderPassEncoder.setBindGroup(1,t.gpuBindGroup[1])},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.gpuRenderPassEncoder.draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.gpuRenderPassEncoder.drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.gpuRenderPassEncoder.drawIndirect(UM(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.gpuRenderPassEncoder.drawIndexedIndirect(UM(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var e=0;e<this.gfxColorAttachment.length;e++){var t=this.gfxColorAttachment[e],n=this.gfxColorResolveTo[e];null!==t&&null!==n&&1===t.sampleCount&&this.copyAttachment(n,this.gfxColorAttachmentLevel[e],t,this.gfxColorResolveToLevel[e])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(e,t,n,r){qC(1===n.sampleCount);var i={texture:n.gpuTexture,mipLevel:r},o={texture:e.gpuTexture,mipLevel:t};qC(n.width>>>r==e.width>>>t),qC(n.height>>>r==e.height>>>t),qC(!!(n.usage&SM.COPY_SRC)),qC(!!(e.usage&SM.COPY_DST)),this.commandEncoder.copyTextureToTexture(i,o,[e.width,e.height,1])},e}(),Ek=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=vC.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=i,o.device.createRenderPipelineInternal(o,!1),o}return _(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(pk),wk=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=vC.Sampler;var u=a.lodMinClamp,l=a.mipmapFilter===wC.NO_MIP?a.lodMinClamp:a.lodMaxClamp,c=null!==(n=a.maxAnisotropy)&&void 0!==n?n:1;return c>1&&qC(a.minFilter===EC.BILINEAR&&a.magFilter===EC.BILINEAR&&a.mipmapFilter===wC.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:FM(a.addressModeU),addressModeV:FM(a.addressModeV),addressModeW:FM(null!==(r=a.addressModeW)&&void 0!==r?r:a.addressModeU),lodMinClamp:u,lodMaxClamp:l,minFilter:BM(a.minFilter),magFilter:BM(a.magFilter),mipmapFilter:zM(a.mipmapFilter),compare:void 0!==a.compareFunction?KM(a.compareFunction):void 0,maxAnisotropy:c}),s}return _(t,e),t}(pk),Sk=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.skipCreate,a=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=vC.Texture;var u=i.format,l=i.dimension,c=i.width,h=i.height,p=i.depthOrArrayLayers,f=i.mipLevelCount,d=i.usage;return s.device.createTextureShared({format:u,dimension:null!=l?l:MC.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=p?p:1,mipLevelCount:null!=f?f:1,usage:d,sampleCount:null!=a?a:1},s,o),s}return _(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,o={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=e.createTexture(o),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s]},{texture:a,origin:[0,0,s]},[r,i]);return[a,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r,i,o,a=this.device.device;this.isImageBitmapOrCanvases(e)?(r=(n=T(this.textureFromImageBitmapOrCanvas(a,e,this.depthOrArrayLayers),3))[0],i=n[1],o=n[2]):this.isVideo(e)&&(r=a.importExternalTexture({source:e[0]})),this.width=i,this.height=o,this.gpuTexture=r,this.gpuTextureView=r.createView({dimension:NM(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(pk),Tk=function(){function e(e,t,n,r,i){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=SM.RENDER_ATTACHMENT|SM.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=OC.UPPER_LEFT,this.clipSpaceNearZ=DC.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.fallbackTexture2D=this.createFallbackTexture(MC.TEXTURE_2D,PC.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(MC.TEXTURE_2D,PC.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(MC.TEXTURE_2D_ARRAY,PC.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(MC.TEXTURE_3D,PC.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(MC.TEXTURE_CUBE_MAP,PC.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:bC.REPEAT,addressModeV:bC.REPEAT,minFilter:EC.POINT,magFilter:EC.POINT,mipmapFilter:wC.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:bC.REPEAT,addressModeV:bC.REPEAT,minFilter:EC.POINT,magFilter:EC.POINT,mipmapFilter:wC.NEAREST,compareFunction:mC.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new Sk({id:0,device:this,descriptor:{format:UC.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:MC.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new dk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new Sk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new wk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new Sk({id:this.getNextUniqueId(),device:this,descriptor:x(x({},e),{dimension:MC.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:kC.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=vC.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,o=t.depthOrArrayLayers,a=t.sampleCount,s=t.mipLevelCount,u=t.gpuTexture,l=t.gpuTextureView,c=t.usage;qC(!!(c&SM.RENDER_ATTACHMENT));var h=new Sk({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:o,dimension:MC.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return h.depthOrArrayLayers=o,h.sampleCount=a,h.gpuTexture=u,h.gpuTextureView=l,h},e.prototype.createProgram=function(e){var t,n;return(null===(t=e.vertex)||void 0===t?void 0:t.glsl)&&(e.vertex.glsl=PR(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=PR(this.queryVendorInfo(),"frag",e.fragment.glsl)),new yk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new yk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,o=DM(e.format),a=function(e){if(e===MC.TEXTURE_2D)return"2d";if(e===MC.TEXTURE_CUBE_MAP)return"2d";if(e===MC.TEXTURE_2D_ARRAY)return"2d";if(e===MC.TEXTURE_3D)return"3d";throw new Error("whoops")}(e.dimension),s=function(e){var t=0;return e&kC.SAMPLED&&(t|=SM.TEXTURE_BINDING|SM.COPY_DST),e&kC.RENDER_TARGET&&(t|=SM.RENDER_ATTACHMENT|SM.TEXTURE_BINDING|SM.COPY_SRC|SM.COPY_DST),t}(e.usage);if(t.gpuTextureformat=o,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var u=this.device.createTexture({size:r,mipLevelCount:i,format:o,dimension:a,sampleCount:e.sampleCount,usage:s}),l=u.createView();t.gpuTexture=u,t.gpuTextureView=l}},e.prototype.getFallbackSampler=function(e){return e.formatKind===PC.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===MC.TEXTURE_2D)return n===PC.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===MC.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===MC.TEXTURE_3D)return this.fallbackTexture3D;if(t===MC.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(e,t){var n=e===MC.TEXTURE_CUBE_MAP?6:1,r=t===PC.Float?UC.U8_RGBA_NORM:UC.D24;return this.createTexture({dimension:e,format:r,usage:kC.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new fk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new gk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new mk({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new Ek({id:this.getNextUniqueId(),device:this,descriptor:x({},e)})},e.prototype.createQueryPool=function(e,t){return new _k({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){var n;if(null===e.gpuRenderPipeline){var r=e.descriptor,i=r.program,o=i.vertexStage,a=i.fragmentStage;if(null!==o&&null!==a){var s=r.megaStateDescriptor||{},u=s.stencilBack,l=s.stencilFront,c=b(s,["stencilBack","stencilFront"]),h=uR(cR);r.megaStateDescriptor=x(x(x({},h),{stencilBack:x(x({},h.stencilBack),u),stencilFront:x(x({},h.stencilFront),l)}),c);var p=r.megaStateDescriptor.attachmentsState[0];r.colorAttachmentFormats.forEach((function(e,t){r.megaStateDescriptor.attachmentsState[t]||(r.megaStateDescriptor.attachmentsState[t]=aR(void 0,p))}));var f,d,v=(f=null!==(n=r.topology)&&void 0!==n?n:SC.TRIANGLES,d=r.megaStateDescriptor,{topology:GM(f),cullMode:VM(d.cullMode),frontFace:HM(d.frontFace)}),m=function(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:DM(t),blend:YM(e),writeMask:e.channelWriteMask}}(t,e[n])}))}(r.colorAttachmentFormats,r.megaStateDescriptor),g=function(e,t){if(!pC(e))return{format:DM(e),depthWriteEnabled:!!t.depthWrite,depthCompare:KM(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0,stencilFront:{compare:KM(t.stencilFront.compare),passOp:QM(t.stencilFront.passOp),failOp:QM(t.stencilFront.failOp),depthFailOp:QM(t.stencilFront.depthFailOp)},stencilBack:{compare:KM(t.stencilBack.compare),passOp:QM(t.stencilBack.passOp),failOp:QM(t.stencilBack.failOp),depthFailOp:QM(t.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}(r.depthStencilAttachmentFormat,r.megaStateDescriptor),y=void 0;null!==r.inputLayout&&(y=r.inputLayout.buffers);var _=r.sampleCount,E={layout:"auto",vertex:x(x({},o),{buffers:y}),primitive:v,depthStencil:g,multisample:{count:_},fragment:x(x({},a),{targets:m})};e.gpuRenderPipeline=this.device.createRenderPipeline(E)}}},e.prototype.createReadback=function(){return new xk({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();return void 0===t&&(t=new bk(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();return void 0===e&&(e=new vk),e.commandEncoder=this.device.createCommandEncoder(),e.beginComputePass(),e},e.prototype.submitPass=function(e){var t=this.device.queue,n=e,r=n.finish();t.submit([r]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,o){var a=this.device.createCommandEncoder(),s=e,u=r,l={texture:u.gpuTexture,origin:[i,o,0]},c={texture:s.gpuTexture,origin:[t,n,0]};qC(!!(u.usage&SM.COPY_SRC)),qC(!!(s.usage&SM.COPY_DST)),a.copyTextureToTexture(l,c,[u.width,u.height,1]),this.device.queue.submit([a.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(function(e){switch(VC(e)){case FC.BC1:case FC.BC2:case FC.BC3:case FC.BC4_SNORM:case FC.BC4_UNORM:case FC.BC5_SNORM:case FC.BC5_UNORM:return!0;default:return!1}}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(VC(e)){case FC.BC1:case FC.BC2:case FC.BC3:case FC.BC4_SNORM:case FC.BC4_UNORM:case FC.BC5_SNORM:case FC.BC5_UNORM:return 4;default:return 1}}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}switch(e){case UC.U16_RGBA_NORM:case UC.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===vC.Buffer)(n=e).gpuBuffer.label=t;else if(e.type===vC.Texture)(n=e).gpuTexture.label=t,n.gpuTextureView.label=t;else if(e.type===vC.RenderTarget)(n=e).gpuTexture.label=t,n.gpuTextureView.label=t;else if(e.type===vC.Sampler)(n=e).gpuSampler.label=t;else if(e.type===vC.RenderPipeline){var n;null!==(n=e).gpuRenderPipeline&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return null!==e.gpuRenderPipeline},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),Ak=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return E(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return w(this,(function(u){switch(u.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];t=null,u.label=1;case 1:return u.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=u.sent(),[3,4];case 3:return r=u.sent(),console.log(r),[3,4];case 4:return null===t?[2,null]:(i=["depth32float-stencil8","texture-compression-bc"].filter((function(e){return t.features.has(e)})),[4,t.requestDevice({requiredFeatures:i})]);case 5:if((o=u.sent())&&(a=this.pluginOptions.onContextLost,o.lost.then((function(){a&&a()}))),null===o)return[2,null];if(!(s=e.getContext("webgpu")))return[2,null];u.label=6;case 6:return u.trys.push([6,8,,9]),[4,PM(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return u.sent(),[3,9];case 9:return[2,new Tk(t,o,e,s,RM)]}}))}))},e}(),Ck=Sn.isPlainObject,Rk=Sn.isTypedArray,Mk=function(){function e(t,n){Te(this,e),ce(this,"destroyed",!1),ce(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,h=n.cull,p=n.instances,f={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:OC.LOWER_LEFT,clipSpaceNearZ:DC.NEGATIVE_ONE,supportMRT:!1},d={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){d[e]=t.prop(e)})));var v={};Object.keys(o).forEach((function(e){v[e]=o[e].get()}));var m={attributes:v,frag:ac(PR(f,"frag",i,null,!1)),uniforms:d,vert:ac(PR(f,"vert",r,null,!1)),colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:XA[void 0===s?hu.TRIANGLES:s]};p&&(m.instances=p),u?m.count=u:l&&(m.elements=l.get()),this.initDepthDrawParams({depth:c},m),this.initCullDrawParams({cull:h},m),this.drawCommand=t(m),this.drawParams=m}return Se(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=pe(pe({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=pe(pe({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=ue(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e;null===(e=this.drawParams)||void 0===e||null===(e=e.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:eC[n.func||hu.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:nC[r&&r.srcRGB||hu.SRC_ALPHA],srcAlpha:nC[r&&r.srcAlpha||hu.SRC_ALPHA],dstRGB:nC[r&&r.dstRGB||hu.ONE_MINUS_SRC_ALPHA],dstAlpha:nC[r&&r.dstAlpha||hu.ONE_MINUS_SRC_ALPHA]},equation:{rgb:tC[i&&i.rgb||hu.FUNC_ADD],alpha:tC[i&&i.alpha||hu.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,o=t.func,a=void 0===o?{cmp:hu.ALWAYS,ref:0,mask:-1}:o,s=t.opFront,u=void 0===s?{fail:hu.KEEP,zfail:hu.KEEP,zpass:hu.KEEP}:s,l=t.opBack,c=void 0===l?{fail:hu.KEEP,zfail:hu.KEEP,zpass:hu.KEEP}:l;return{enable:!!n,mask:i,func:pe(pe({},a),{},{cmp:rC[a.cmp]}),opFront:{fail:iC[u.fail],zfail:iC[u.zfail],zpass:iC[u.zpass]},opBack:{fail:iC[c.fail],zfail:iC[c.zfail],zpass:iC[c.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?hu.BACK:i;t.cull={enable:!!r,face:oC[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Rk(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Ck(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}(),kk=function(){function e(t,n){Te(this,e),ce(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?hu.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?hu.RGBA:c,p=n.mipmap,f=void 0!==p&&p,d=n.wrapS,v=void 0===d?hu.CLAMP_TO_EDGE:d,m=n.wrapT,g=void 0===m?hu.CLAMP_TO_EDGE:m,y=n.aniso,_=void 0===y?0:y,x=n.alignment,b=void 0===x?1:x,E=n.premultiplyAlpha,w=void 0!==E&&E,S=n.mag,T=void 0===S?hu.NEAREST:S,A=n.min,C=void 0===A?hu.NEAREST:A,R=n.colorSpace,M=void 0===R?hu.BROWSER_DEFAULT_WEBGL:R,k=n.x,I=void 0===k?0:k,L=n.y,P=void 0===L?0:L,O=n.copy,D=void 0!==O&&O;this.width=a,this.height=s;var N={width:a,height:s,type:qA[o],format:YA[h],wrapS:JA[v],wrapT:JA[g],mag:QA[T],min:QA[C],alignment:b,flipY:l,colorSpace:$A[M],premultiplyAlpha:w,aniso:_,x:I,y:P,copy:D};r&&(N.data=r),"number"==typeof f?N.mipmap=KA[f]:"boolean"==typeof f&&(N.mipmap=f),this.texture=t.texture(N)}return Se(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||null===(e=this.texture)||void 0===e||e.destroy(),this.isDestroy=!0}}]),e}(),Ik=(0,Lo.b2)()(nk=function(){function e(){var t=this;Te(this,e),ce(this,"uniformBuffers",[]),ce(this,"createModel",(function(e){return new Mk(t.gl,e)})),ce(this,"createAttribute",(function(e){return new WA(t.gl,e)})),ce(this,"createBuffer",(function(e){return new aC(t.gl,e)})),ce(this,"createElements",(function(e){return new sC(t.gl,e)})),ce(this,"createTexture2D",(function(e){return new kk(t.gl,e)})),ce(this,"createFramebuffer",(function(e){return new uC(t.gl,e)})),ce(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),ce(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),ce(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),ce(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),ce(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),ce(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),ce(this,"getCanvas",(function(){return t.canvas})),ce(this,"getGLContext",(function(){return t.gl._gl})),ce(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.gl)||void 0===e||null===(e=e._gl)||void 0===e||null===(e=e.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return Se(e,[{key:"init",value:(t=ir(sr().mark((function e(t,n,r){var i=this;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){HA()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||nk,Lk=function(){function e(t,n){Te(this,e);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor,l=n.shaderLocation;this.buffer=r,this.attribute={shaderLocation:l,buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return Se(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Pk=(ce(rk={},hu.FLOAT,Float32Array),ce(rk,hu.UNSIGNED_BYTE,Uint8Array),ce(rk,hu.SHORT,Int16Array),ce(rk,hu.UNSIGNED_SHORT,Uint16Array),ce(rk,hu.INT,Int32Array),ce(rk,hu.UNSIGNED_INT,Uint32Array),rk),Ok=(ce(ik={},hu.POINTS,SC.POINTS),ce(ik,hu.LINES,SC.LINES),ce(ik,hu.LINE_LOOP,SC.LINES),ce(ik,hu.LINE_STRIP,SC.LINE_STRIP),ce(ik,hu.TRIANGLES,SC.TRIANGLES),ce(ik,hu.TRIANGLE_FAN,SC.TRIANGLES),ce(ik,hu.TRIANGLE_STRIP,SC.TRIANGLE_STRIP),ik),Dk=(ce(ok={},1,UC.F32_R),ce(ok,2,UC.F32_RG),ce(ok,3,UC.F32_RGB),ce(ok,4,UC.F32_RGBA),ok),Nk=(ce(ak={},hu.STATIC_DRAW,AC.STATIC),ce(ak,hu.DYNAMIC_DRAW,AC.DYNAMIC),ce(ak,hu.STREAM_DRAW,AC.DYNAMIC),ak),Fk=(ce(sk={},hu.REPEAT,bC.REPEAT),ce(sk,hu.CLAMP_TO_EDGE,bC.CLAMP_TO_EDGE),ce(sk,hu.MIRRORED_REPEAT,bC.MIRRORED_REPEAT),sk),Bk=(ce(uk={},hu.NEVER,mC.NEVER),ce(uk,hu.ALWAYS,mC.ALWAYS),ce(uk,hu.LESS,mC.LESS),ce(uk,hu.LEQUAL,mC.LEQUAL),ce(uk,hu.GREATER,mC.GREATER),ce(uk,hu.GEQUAL,mC.GEQUAL),ce(uk,hu.EQUAL,mC.EQUAL),ce(uk,hu.NOTEQUAL,mC.NOTEQUAL),uk),zk=(ce(lk={},hu.FRONT,yC.FRONT),ce(lk,hu.BACK,yC.BACK),lk),Uk=(ce(ck={},hu.FUNC_ADD,xC.ADD),ce(ck,hu.MIN_EXT,xC.MIN),ce(ck,hu.MAX_EXT,xC.MAX),ce(ck,hu.FUNC_SUBTRACT,xC.SUBSTRACT),ce(ck,hu.FUNC_REVERSE_SUBTRACT,xC.REVERSE_SUBSTRACT),ck),jk=(ce(hk={},hu.ZERO,_C.ZERO),ce(hk,hu.ONE,_C.ONE),ce(hk,hu.SRC_COLOR,_C.SRC),ce(hk,hu.ONE_MINUS_SRC_COLOR,_C.ONE_MINUS_SRC),ce(hk,hu.SRC_ALPHA,_C.SRC_ALPHA),ce(hk,hu.ONE_MINUS_SRC_ALPHA,_C.ONE_MINUS_SRC_ALPHA),ce(hk,hu.DST_COLOR,_C.DST),ce(hk,hu.ONE_MINUS_DST_COLOR,_C.ONE_MINUS_DST),ce(hk,hu.DST_ALPHA,_C.DST_ALPHA),ce(hk,hu.ONE_MINUS_DST_ALPHA,_C.ONE_MINUS_DST_ALPHA),ce(hk,hu.CONSTANT_COLOR,_C.CONST),ce(hk,hu.ONE_MINUS_CONSTANT_COLOR,_C.ONE_MINUS_CONSTANT),ce(hk,hu.CONSTANT_ALPHA,_C.CONST),ce(hk,hu.ONE_MINUS_CONSTANT_ALPHA,_C.ONE_MINUS_CONSTANT),ce(hk,hu.SRC_ALPHA_SATURATE,_C.SRC_ALPHA_SATURATE),hk),Gk={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Vk(e){return Object.prototype.toString.call(e)in Gk}var Hk,Wk=function(){function e(t,n){Te(this,e),ce(this,"isDestroyed",!1);var r,i=n.data,o=n.usage,a=n.type,s=n.isUBO;r=Vk(i)?i:new Pk[this.type||hu.FLOAT](i),this.type=a,this.size=r.byteLength,this.buffer=t.createBuffer({viewOrSize:r,usage:s?TC.UNIFORM:TC.VERTEX,hint:Nk[o||hu.STATIC_DRAW]})}return Se(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t,n=e.data,r=e.offset;t=Vk(n)?n:new Pk[this.type||hu.FLOAT](n),this.buffer.setSubData(r,new Uint8Array(t.buffer))}}]),e}(),Xk=function(){function e(t,n){Te(this,e);var r,i=n.data,o=n.type,a=n.count,s=void 0===a?0:a;r=Vk(i)?i:new Pk[this.type||hu.UNSIGNED_INT](i),this.type=o,this.count=s,this.indexBuffer=t.createBuffer({viewOrSize:r,usage:TC.INDEX})}return Se(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(e){var t,n=e.data;t=Vk(n)?n:new Pk[this.type||hu.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}(),Zk=function(){function e(t,n){Te(this,e),ce(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?hu.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?hu.RGBA:c,p=n.wrapS,f=void 0===p?hu.CLAMP_TO_EDGE:p,d=n.wrapT,v=void 0===d?hu.CLAMP_TO_EDGE:d,m=n.alignment,g=void 0===m?1:m;this.width=a,this.height=s;var y=UC.U8_RGBA_RT;if(o===hu.UNSIGNED_BYTE&&h===hu.RGBA)y=UC.U8_RGBA_RT;else if(h===hu.LUMINANCE&&o===hu.FLOAT)y=UC.F32_LUMINANCE;else{if(h!==hu.LUMINANCE||o!==hu.UNSIGNED_BYTE)throw new Error("create texture error, type: ".concat(o,", format: ").concat(h));y=UC.U8_LUMINANCE}this.texture=t.createTexture({format:y,width:a,height:s,usage:kC.SAMPLED,pixelStore:{unpackFlipY:l,packAlignment:g}}),r&&this.texture.setImageData([r]),this.sampler=t.createSampler({addressModeU:Fk[f],addressModeV:Fk[v],minFilter:EC.POINT,magFilter:EC.BILINEAR,mipmapFilter:wC.NO_MIP,lodMinClamp:0,lodMaxClamp:0})}return Se(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(e){var t=e.data;this.texture.setImageData([t])}},{key:"bind",value:function(){}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||null===(e=this.texture)||void 0===e||e.destroy(),this.isDestroy=!0}}]),e}(),qk=function(){function e(t,n){Te(this,e),this.device=t;var r=n.width,i=n.height;n.color,r&&i&&(this.renderTarget=t.createRenderTarget({format:UC.U8_RGBA_RT,width:r,height:i}),this.width=r,this.height=i)}return Se(e,[{key:"get",value:function(){return this.renderTarget}},{key:"destroy",value:function(){this.renderTarget.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width===t&&this.height===n||(this.renderTarget&&this.renderTarget.destroy(),this.renderTarget=this.device.createRenderTarget({format:UC.U8_RGBA_RT,width:t,height:n}),this.width=t,this.height=n)}}]),e}(),Yk=Sn.isPlainObject,Kk=Sn.isTypedArray,Qk=function(){function e(t,n){var r=this;Te(this,e),ce(this,"destroyed",!1),ce(this,"uniforms",{}),ce(this,"vertexBuffers",[]),this.device=t,this.options=n;var i=n.vs,o=n.fs,a=n.attributes,s=n.uniforms,u=n.count,l=n.elements;this.options=n;var c=t.createProgram({vertex:{glsl:i},fragment:{glsl:o}});this.program=c,s&&(this.uniforms=this.extractUniforms(s));var h=[],p=0;Object.keys(a).forEach((function(e){var t=a[e],n=t.get();r.vertexBuffers.push(n.get());var i=t.attribute,o=i.offset,s=void 0===o?0:o,u=i.stride,l=void 0===u?0:u,c=i.size,f=void 0===c?1:c,d=i.divisor,v=void 0===d?0:d,m=i.shaderLocation,g=void 0===m?0:m;h.push({arrayStride:l||4*f,stepMode:CC.VERTEX,attributes:[{format:Dk[f],shaderLocation:g,offset:s,divisor:v}]}),p=n.size/f})),u||(this.options.count=p),l&&(this.indexBuffer=l.get());var f=t.createInputLayout({vertexBufferDescriptors:h,indexBufferFormat:l?UC.U32_R:null,program:c});this.inputLayout=f,this.pipeline=this.createPipeline(n)}return Se(e,[{key:"createPipeline",value:function(e){var t=e.primitive,n=void 0===t?hu.TRIANGLES:t,r=e.depth,i=e.cull,o=e.blend,a=this.initDepthDrawParams({depth:r}),s=!(!a||!a.enable),u=this.initCullDrawParams({cull:i}),l=!(!u||!u.enable),c=this.getBlendDrawParams({blend:o}),h=!(!c||!c.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:Ok[n],colorAttachmentFormats:[UC.U8_RGBA_RT],depthStencilAttachmentFormat:UC.D24_S8,megaStateDescriptor:{attachmentsState:[{channelWriteMask:IC.ALL,rgbBlendState:{blendMode:h&&c.equation.rgb||xC.ADD,blendSrcFactor:h&&c.func.srcRGB||_C.SRC_ALPHA,blendDstFactor:h&&c.func.dstRGB||_C.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:h&&c.equation.alpha||xC.ADD,blendSrcFactor:h&&c.func.srcAlpha||_C.ONE,blendDstFactor:h&&c.func.dstAlpha||_C.ONE_MINUS_SRC_ALPHA}}],blendConstant:$C,depthWrite:s,depthCompare:s&&a.func||mC.LESS,cullMode:l&&u.face||yC.NONE,stencilWrite:!1}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(e){this.uniforms=pe(pe({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e){var t=pe(pe({},this.options),e),n=t.count,r=void 0===n?0:n,i=t.instances,o=t.elements,a=t.uniforms,s=void 0===a?{}:a,u=t.uniformBuffers,l=t.textures;this.uniforms=pe(pe({},this.uniforms),this.extractUniforms(s));var c=this.device,h=c.width,p=c.height,f=this.device.renderPass;if(this.pipeline=this.createPipeline(t),f.setPipeline(this.pipeline),f.setVertexInput(this.inputLayout,this.vertexBuffers.map((function(e){return{buffer:e}})),o?{buffer:this.indexBuffer,offset:0}:null),f.setViewport(0,0,h,p),u&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:u.map((function(e,t){var n=e;return{binding:t,buffer:n.get(),size:n.size}})),samplerBindings:null==l?void 0:l.map((function(e){return{texture:e.texture,sampler:e.sampler}}))})),this.bindings&&(f.setBindings(this.bindings),this.program.setUniformsLegacy(this.uniforms)),o){var d=o.count;0===d?f.draw(r,i):f.drawIndexed(d,i)}else f.draw(r,i)}},{key:"destroy",value:function(){var e,t,n;this.program.destroy(),null===(e=this.vertexBuffers)||void 0===e||e.forEach((function(e){return e.destroy()})),null===(t=this.indexBuffer)||void 0===t||t.destroy(),null===(n=this.bindings)||void 0===n||n.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e){var t=e.depth;if(t)return{enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:Bk[t.func||hu.LESS],range:t.range||[0,1]}}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:jk[r&&r.srcRGB||hu.SRC_ALPHA],srcAlpha:jk[r&&r.srcAlpha||hu.SRC_ALPHA],dstRGB:jk[r&&r.dstRGB||hu.ONE_MINUS_SRC_ALPHA],dstAlpha:jk[r&&r.dstAlpha||hu.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Uk[i&&i.rgb||hu.FUNC_ADD],alpha:Uk[i&&i.alpha||hu.FUNC_ADD]},color:a}}},{key:"initCullDrawParams",value:function(e){var t=e.cull;if(t){var n=t.enable,r=t.face,i=void 0===r?hu.BACK:r;return{enable:!!n,face:zk[i]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Kk(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Yk(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}();function Jk(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}var $k=(0,Lo.b2)()(Hk=function(){function e(){var t=this;Te(this,e),ce(this,"uniformBuffers",[]),ce(this,"createModel",(function(e){return new Qk(t.device,e)})),ce(this,"createAttribute",(function(e){return new Lk(t.device,e)})),ce(this,"createBuffer",(function(e){return new Wk(t.device,e)})),ce(this,"createElements",(function(e){return new Xk(t.device,e)})),ce(this,"createTexture2D",(function(e){return new Zk(t.device,e)})),ce(this,"createFramebuffer",(function(e){return new qk(t.device,e)})),ce(this,"useFramebuffer",(function(){})),ce(this,"clear",(function(){})),ce(this,"viewport",(function(e){var n=e.width,r=e.height;t.width=n,t.height=r,t.device.width=n,t.device.height=r})),ce(this,"readPixels",(function(){return new Uint8Array})),ce(this,"getViewportSize",(function(){return{width:t.device.width,height:t.device.height}})),ce(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),ce(this,"getCanvas",(function(){return t.canvas})),ce(this,"getGLContext",(function(){return t.device.gl})),ce(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.uniformBuffers)||void 0===e||e.forEach((function(e){e.destroy()})),t.device.destroy()}))}var t;return Se(e,[{key:"init",value:(t=ir(sr().mark((function e(t,n){var r,i,o,a,s,u;return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.enableWebGPU,i=n.shaderCompilerPath,this.canvas=t,o=r?new Ak({shaderCompilerPath:i}):new pM({targets:["webgl2","webgl1"],onContextLost:function(e){console.warn("context lost",e)},onContextCreationError:function(e){console.warn("context creation error",e)},onContextRestored:function(e){console.warn("context restored",e)}}),e.next=5,o.createSwapChain(t);case 5:(a=e.sent).configureSwapChain(t.width,t.height),this.device=a.getDevice(),this.swapChain=a,s=this.device.gl,this.extensionObject={OES_texture_float:!Jk(s)&&this.device.OES_texture_float},u=this.device.createTexture({format:UC.U8_RGBA_RT,width:t.width,height:t.height,usage:kC.RENDER_TARGET}),this.renderTarget=this.device.createRenderTargetFromTexture(u),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:UC.D24_S8,width:t.width,height:t.height,usage:kC.RENDER_TARGET}));case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"beginFrame",value:function(){var e=this.swapChain.getOnscreenTexture();this.renderPass=this.device.createRenderPass({colorAttachment:[this.renderTarget],colorResolveTo:[e],colorClearColor:[$C],depthStencilAttachment:this.mainDepthRT,depthClearValue:1}),this.device.renderPass=this.renderPass}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Hk;var eI=["selectstart","selecting","selectend"],tI=function(e){Ce(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Te(this,i),ce(Re(t=r.call(this)),"isEnable",!1),ce(Re(t),"onDragStart",(function(e){t.box.style.display="block",t.startEvent=t.endEvent=e,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)})),ce(Re(t),"onDragging",(function(e){t.endEvent=e,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)})),ce(Re(t),"onDragEnd",(function(e){t.endEvent=e,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)})),t.scene=e,t.options=n,t}return Se(i,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Cn("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return Un(function(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}([ge([[t,n],[i,o]])]))}}]),i}(ur.EventEmitter),nI=function(){function e(t){Te(this,e);var n=t.id,r=t.map,i=t.canvas,o=t.hasBaseMap,a=t.renderer,s=void 0===a?"regl":a,u=Lh();this.container=u,r.setContainer(u,n,i,o),u.bind(Oo.IRendererService).to("regl"===s?Ik:$k).inSingletonScope(),this.sceneService=u.get(Oo.ISceneService),this.mapService=u.get(Oo.IMapService),this.iconService=u.get(Oo.IIconService),this.fontService=u.get(Oo.IFontService),this.controlService=u.get(Oo.IControlService),this.layerService=u.get(Oo.ILayerService),this.debugService=u.get(Oo.IDebugService),this.debugService.setEnable(t.debug),this.markerService=u.get(Oo.IMarkerService),this.interactionService=u.get(Oo.IInteractionService),this.popupService=u.get(Oo.IPopupService),this.boxSelect=new tI(this,{}),this.initComponent(n),this.sceneService.init(t),this.initControl()}var t,n,r,i,o;return Se(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(o=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"exportMap",value:(i=ir(sr().mark((function e(t){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this,n=Ph(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new Rm).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=Ph(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(r=ir(sr().mark((function e(t,n){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=ir(sr().mark((function e(){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=Ot(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(t=ir(sr().mark((function e(t,n){return sr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iconService.addImage(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;eI.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):Xh.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;eI.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):Xh.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===Xh.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;eI.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):Xh.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||pe(pe({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(Oo.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(e){return Oe.REGISTERED_PROTOCOLS[e]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){var t,n;this.controlService.init({container:(t=e,n=t,"string"==typeof t&&(n=window.document.getElementById(t)),n)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new Fp({position:n}))}}],[{key:"addProtocol",value:function(e,t){Oe.REGISTERED_PROTOCOLS[e]=t}},{key:"removeProtocol",value:function(e){delete Oe.REGISTERED_PROTOCOLS[e]}}]),e}(),rI=function(){function e(){this._events={}}return e.prototype.on=function(e,t,n){return this._events[e]||(this._events[e]=[]),this._events[e].push({callback:t,once:!!n}),this},e.prototype.once=function(e,t){return this.on(e,t,!0)},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[e]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete t._events[e],i--,o--),s.apply(t,n)}};a(i),a(o)},e.prototype.off=function(e,t){if(e)if(t){for(var n=this._events[e]||[],r=n.length,i=0;i<r;i++)n[i].callback===t&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[e]}else delete this._events[e];else this._events={};return this},e.prototype.getEvents=function(){return this._events},e}();const iI=rI;function oI(e,t){if(e)for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n]);return e}const aI='\n  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",\n  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",\n  SimSun, "sans-serif"';var sI,uI="l7plot-legend l7plot-legend__category",lI="l7plot-legend__title",cI="l7plot-legend__category-list",hI="l7plot-legend__list-item",pI="l7plot-legend__category-marker",fI="l7plot-legend__category-value",dI='<div class="'.concat(uI,'">\n  <div class="').concat(lI,'"></div>\n  <ul class="').concat(cI,'"></ul>\n</div>'),vI='<li class="'.concat(hI,'" data-index={index}>\n  <span class="').concat(pI,'" style="background:{color}"></span>\n  <span class="').concat(fI,'">{value}</span>\n</li>');const mI=((sI={})[uI]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:aI,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},sI[lI]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},sI[cI]={margin:"0px",listStyleType:"none",padding:"0px"},sI[hI]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},sI[pI]={width:"10px",height:"10px"},sI[fI]={paddingLeft:"8px"},sI);var gI,yI,_I,xI;function bI(e){for(var t=e.childNodes,n=t.length-1;n>=0;n--)e.removeChild(t[n])}var EI,wI=function(){function e(e){this.destroyed=!1,this.options=G({},this.getDefaultOptions(),e),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return e.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},e.prototype.getContainer=function(){return this.container},e.prototype.getParentContainer=function(){var e,t=this.options.parent;if(!t)return e;if(N(t)){var n=document.getElementById(t);if(!n)throw new Error("No parent id ".concat(t));e=n}else e=t;return e},e.prototype.initContainer=function(){var e=this.createDom(this.options.containerTpl),t=this.getParentContainer();return t&&t.appendChild(e),e},e.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},e.prototype.initCapture=function(){this.setCapture(this.options.capture)},e.prototype.update=function(e){this.options=G({},this.options,e),this.updateInner(e),this.afterUpdate(e)},e.prototype.updateInner=function(e){e.domStyles&&this.applyStyles()},e.prototype.afterUpdate=function(e){e.capture&&this.setCapture(e.capture)},e.prototype.setCapture=function(e){var t=e?"auto":"none";this.container.style.pointerEvents=t},e.prototype.applyStyles=function(){var e=this.options.domStyles;if(e){var t=this.container;this.applyChildrenStyles(t,e);var n,r=this.options.className;r&&(n=r,t.className.match(new RegExp("(\\s|^)".concat(n,"(\\s|$)"))))&&oI(t,e[r])}},e.prototype.applyChildrenStyles=function(e,t){L(t,(function(t,n){var r=e.getElementsByClassName(n);L(r,(function(e){oI(e,t)}))}))},e.prototype.applyStyle=function(e,t){var n=this.options.domStyles;n&&oI(t,n[e])},e.prototype.createDom=function(e){return void 0===e&&(e="<div></div>"),function(e){gI||(gI=document.createElement("table"),yI=document.createElement("tr"),_I=/^\s*<(\w+|!)[^>]*>/,xI={tr:document.createElement("tbody"),tbody:gI,thead:gI,tfoot:gI,td:yI,th:yI,"*":document.createElement("div")});var t=_I.test(e)&&RegExp.$1;t&&t in xI||(t="*");var n=xI[t];e="string"==typeof e?e.replace(/(^\s*)|(\s*$)/g,""):e,n.innerHTML=""+e;var r=n.childNodes[0];return r&&n.contains(r)&&n.removeChild(r),r}(e)},e.prototype.removeDom=function(){var e=this.container;e&&e.parentNode&&e.parentNode.removeChild(e)},e.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},e}(),SI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.prototype.getDefaultOptions=function(){return G({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:dI,itemTpl:vI,domStyles:mI,className:uI})},t.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(n),n}return e.prototype.initContainer.call(this)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){},t.prototype.cacheDoms=function(){var e=this.container,t=e.getElementsByClassName(lI)[0],n=e.getElementsByClassName(cI)[0];this.titleDom=t,this.listDom=n},t.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},t.prototype.show=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"visible"})},t.prototype.hide=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"hidden"})},t.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),e.prototype.updateInner.call(this,t)},t.prototype.renderCustomContent=function(e){var t=this.container.parentNode,n=this.getHtmlContentNode(e),r=this.container;t&&t.replaceChild(n,r),this.container=n,this.applyStyles()},t.prototype.getHtmlContentNode=function(e){var t=e(this.options.title||"",this.options.items);return N(t)?this.createDom(t):t},t.prototype.resetTitle=function(){var e=this.options.title;e?(this.showTitle(),this.setTitle(e)):this.hideTitle()},t.prototype.showTitle=function(){var e=this.titleDom;e&&oI(e,{display:"block"})},t.prototype.hideTitle=function(){var e=this.titleDom;e&&oI(e,{display:"none"})},t.prototype.setTitle=function(e){var t=this.titleDom;t&&(t.innerHTML=e)},t.prototype.renderItems=function(){var e=this;this.clearItemDoms();var t=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,n=this.options.itemTpl||vI,r=this.listDom;r&&(t.forEach((function(t){var i=""===t.value?"—":Array.isArray(t.value)?t.value.join(" - "):t.value,o=x(x({},t),{value:i}),a=F(n,o),s=e.createDom(a);r.appendChild(s)})),this.applyChildrenStyles(r,this.options.domStyles))},t.prototype.clearItemDoms=function(){this.listDom&&bI(this.listDom)},t.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},t}(wI),TI="l7plot-legend l7plot-legend__continue",AI="l7plot-legend__title",CI="l7plot-legend__ribbon-container",RI="l7plot-legend__ribbon",MI="l7plot-legend__gradient-bar",kI="l7plot-legend__value-range",II='<div class="'.concat(TI,'">\n  <div class="').concat(AI,'"></div>\n  <div class="').concat(CI,'"></div>\n</div>'),LI='<div class="'.concat(RI,'">\n  <span class="').concat(kI,'">{min}</span>\n  <div class="').concat(MI,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(kI,'">{max}</span>\n</div>');const PI=((EI={})[TI]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:aI,padding:"10px",lineHeight:1,fontSize:"12px"},EI[AI]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},EI[RI]={display:"flex",alignItems:"center"},EI[MI]={width:"140px",height:"14px",margin:"0px 5px"},EI[kI]={padding:"0px"},EI);var OI,DI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.prototype.getDefaultOptions=function(){return G({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:II,ribbonTpl:LI,domStyles:PI,className:TI})},t.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(n),n}return e.prototype.initContainer.call(this)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){},t.prototype.cacheDoms=function(){var e=this.container,t=e.getElementsByClassName(AI)[0],n=e.getElementsByClassName(CI)[0];this.titleDom=t,this.ribbonContainerDom=n},t.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},t.prototype.show=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"visible"})},t.prototype.hide=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"hidden"})},t.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),e.prototype.updateInner.call(this,t)},t.prototype.renderCustomContent=function(e){var t=this.container.parentNode,n=this.getHtmlContentNode(e),r=this.container;t&&t.replaceChild(n,r),this.container=n,this.applyStyles()},t.prototype.getHtmlContentNode=function(e){var t=e(this.options.title||"",this.options.min,this.options.max,this.options.colors);return N(t)?this.createDom(t):t},t.prototype.resetTitle=function(){var e=this.options.title;e?(this.showTitle(),this.setTitle(e)):this.hideTitle()},t.prototype.showTitle=function(){var e=this.titleDom;e&&oI(e,{display:"block"})},t.prototype.hideTitle=function(){var e=this.titleDom;e&&oI(e,{display:"none"})},t.prototype.setTitle=function(e){var t=this.titleDom;t&&(t.innerHTML=e)},t.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var e=this.options,t=e.min,n=e.max,r=e.colors,i=e.ribbonTpl,o=void 0===i?LI:i,a=this.ribbonContainerDom;if(a){var s="linear-gradient(to right, ".concat(r.join(", "),")"),u=F(o,{min:t,max:n,backgroundImage:s}),l=this.createDom(u);a.appendChild(l),this.applyChildrenStyles(a,this.options.domStyles)}},t.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&bI(this.ribbonContainerDom)},t.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},t}(wI),NI=function(e){function t(t){var n=e.call(this,t)||this;return n.legendComponents=[],n.options=t,n.legendComponents=n.initLegendComponents(t.items),n}return _(t,e),t.prototype.initLegendComponents=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if("category"===r.type){var i=new SI({title:r.options.title,items:r.options.items,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles});t.push(i)}else"continue"===r.type&&(i=new DI({title:r.options.title,min:r.options.min,max:r.options.max,colors:r.options.colors,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles}),t.push(i))}return t},t.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},t.prototype.onAdd=function(){var e=window.document.createElement("div");return e.className="l7plot-legend-container",this.legendComponents.forEach((function(t){var n=t.getContainer();e.appendChild(n)})),e},t.prototype.onRemove=function(){this.legendComponents.forEach((function(e){e.destroy()}))},t}(Rp),FI="l7plot-tooltip",BI="l7plot-tooltip__title",zI="l7plot-tooltip__list",UI="l7plot-tooltip__list-item",jI="l7plot-tooltip__name",GI="l7plot-tooltip__value",VI='<div class="'.concat(FI,'">\n  <div class="').concat(BI,'"></div>\n  <ul class="').concat(zI,'"></ul>\n</div>'),HI='<li class="'.concat(UI,'" data-index={index}>\n  <span class="').concat(jI,'">{name}</span>\n  <span class="').concat(GI,'">{value}</span>\n</li>');const WI=((OI={})[FI]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:aI,lineHeight:"20px",padding:"10px 10px 6px 10px"},OI[BI]={marginBottom:"4px"},OI[zI]={margin:"0px",listStyleType:"none",padding:"0px"},OI[UI]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},OI[jI]={},OI[GI]={marginLeft:"30px"},OI);var XI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.prototype.getDefaultOptions=function(){return G({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:VI,itemTpl:HI,domStyles:WI,className:FI})},t.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(n),n}return e.prototype.initContainer.call(this)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){},t.prototype.cacheDoms=function(){var e=this.container,t=e.getElementsByClassName(BI)[0],n=e.getElementsByClassName(zI)[0];this.titleDom=t,this.listDom=n},t.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},t.prototype.show=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"visible"})},t.prototype.hide=function(){var e=this.container;e&&!this.destroyed&&oI(e,{visibility:"hidden"})},t.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),e.prototype.updateInner.call(this,t)},t.prototype.renderCustomContent=function(e){var t=this.container.parentNode,n=this.getHtmlContentNode(e),r=this.container;t&&t.replaceChild(n,r),this.container=n,this.applyStyles()},t.prototype.getHtmlContentNode=function(e){var t=e(this.options.title||"",this.options.items);return N(t)?this.createDom(t):t},t.prototype.resetTitle=function(){var e=this.options.title;this.options.showTitle&&e?(this.showTitle(),this.setTitle(e)):this.hideTitle()},t.prototype.showTitle=function(){var e=this.titleDom;e&&oI(e,{display:"block"})},t.prototype.hideTitle=function(){var e=this.titleDom;e&&oI(e,{display:"none"})},t.prototype.setTitle=function(e){var t=this.titleDom;t&&(t.innerHTML=e)},t.prototype.renderItems=function(){var e=this;this.clearItemDoms();var t=this.options.items,n=this.options.itemTpl||HI,r=this.listDom;r&&(t.forEach((function(t){var i=x({},t),o=F(n,i),a=e.createDom(o);r.appendChild(a)})),this.applyChildrenStyles(r,this.options.domStyles))},t.prototype.clearItemDoms=function(){this.listDom&&bI(this.listDom)},t.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},t}(wI);const ZI=Array.isArray,qI="object"==typeof global&&global&&global.Object===Object&&global;var YI="object"==typeof self&&self&&self.Object===Object&&self;const KI=qI||YI||Function("return this")(),QI=KI.Symbol;var JI=Object.prototype,$I=JI.hasOwnProperty,eL=JI.toString,tL=QI?QI.toStringTag:void 0;var nL=Object.prototype.toString;var rL=QI?QI.toStringTag:void 0;const iL=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":rL&&rL in Object(e)?function(e){var t=$I.call(e,tL),n=e[tL];try{e[tL]=void 0;var r=!0}catch(e){}var i=eL.call(e);return r&&(t?e[tL]=n:delete e[tL]),i}(e):function(e){return nL.call(e)}(e)},oL=function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==iL(e)};var aL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sL=/^\w*$/;const uL=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},lL=KI["__core-js_shared__"];var cL,hL=(cL=/[^.]+$/.exec(lL&&lL.keys&&lL.keys.IE_PROTO||""))?"Symbol(src)_1."+cL:"";var pL=Function.prototype.toString;var fL=/^\[object .+?Constructor\]$/,dL=Function.prototype,vL=Object.prototype,mL=dL.toString,gL=vL.hasOwnProperty,yL=RegExp("^"+mL.call(gL).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const _L=function(e){return!(!uL(e)||(t=e,hL&&hL in t))&&(function(e){if(!uL(e))return!1;var t=iL(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}(e)?yL:fL).test(function(e){if(null!=e){try{return pL.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t},xL=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return _L(n)?n:void 0},bL=xL(Object,"create");var EL=Object.prototype.hasOwnProperty;var wL=Object.prototype.hasOwnProperty;function SL(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}SL.prototype.clear=function(){this.__data__=bL?bL(null):{},this.size=0},SL.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},SL.prototype.get=function(e){var t=this.__data__;if(bL){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return EL.call(t,e)?t[e]:void 0},SL.prototype.has=function(e){var t=this.__data__;return bL?void 0!==t[e]:wL.call(t,e)},SL.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=bL&&void 0===t?"__lodash_hash_undefined__":t,this};const TL=SL,AL=function(e,t){return e===t||e!=e&&t!=t},CL=function(e,t){for(var n=e.length;n--;)if(AL(e[n][0],t))return n;return-1};var RL=Array.prototype.splice;function ML(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ML.prototype.clear=function(){this.__data__=[],this.size=0},ML.prototype.delete=function(e){var t=this.__data__,n=CL(t,e);return!(n<0||(n==t.length-1?t.pop():RL.call(t,n,1),--this.size,0))},ML.prototype.get=function(e){var t=this.__data__,n=CL(t,e);return n<0?void 0:t[n][1]},ML.prototype.has=function(e){return CL(this.__data__,e)>-1},ML.prototype.set=function(e,t){var n=this.__data__,r=CL(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};const kL=ML,IL=xL(KI,"Map"),LL=function(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map};function PL(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}PL.prototype.clear=function(){this.size=0,this.__data__={hash:new TL,map:new(IL||kL),string:new TL}},PL.prototype.delete=function(e){var t=LL(this,e).delete(e);return this.size-=t?1:0,t},PL.prototype.get=function(e){return LL(this,e).get(e)},PL.prototype.has=function(e){return LL(this,e).has(e)},PL.prototype.set=function(e,t){var n=LL(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};const OL=PL;function DL(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(DL.Cache||OL),n}DL.Cache=OL;var NL,FL,BL,zL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,UL=/\\(\\)?/g,jL=(NL=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(zL,(function(e,n,r,i){t.push(r?i.replace(UL,"$1"):n||e)})),t},FL=DL(NL,(function(e){return 500===BL.size&&BL.clear(),e})),BL=FL.cache,FL);const GL=jL;var VL=QI?QI.prototype:void 0,HL=VL?VL.toString:void 0;const WL=function e(t){if("string"==typeof t)return t;if(ZI(t))return function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}(t,e)+"";if(oL(t))return HL?HL.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},XL=function(e){return null==e?"":WL(e)},ZL=function(e,t){return ZI(e)?e:function(e,t){if(ZI(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!oL(e))||sL.test(e)||!aL.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:GL(XL(e))},qL=function(e){if("string"==typeof e||oL(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},YL=function(e,t,n){var r=null==e?void 0:function(e,t){for(var n=0,r=(t=ZL(t,e)).length;null!=e&&n<r;)e=e[qL(t[n++])];return n&&n==r?e:void 0}(e,t);return void 0===r?n:r};var KL=(new Object).toString,QL=function(e,t){return KL.call(e)==="[object "+t+"]"},JL=function(e){return QL(e,"Array")},$L=function(e){if(!function(e){return"object"==typeof e&&null!==e}(e)||!QL(e,"Object"))return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},eP=function e(t,n,r,i){for(var o in r=r||0,i=i||5,n)if(Object.prototype.hasOwnProperty.call(n,o)){var a=n[o];a?$L(a)?($L(t[o])||(t[o]={}),r<i?e(t[o],a,r+1,i):t[o]=n[o]):JL(a)?(t[o]=[],t[o]=t[o].concat(a)):t[o]=a:t[o]=a}},tP=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r+=1)eP(e,t[r]);return e},nP=["mousemove","click"],rP=function(e){function t(t,n,r){var i=e.call(this)||this;i.currentVisible=!1,i.interactionTriggerHander=function(e){var t=e.feature,n=e.featureId,r=i.options,o=r.title,a=r.customTitle,s=r.items,u=r.customItems,l="Feature"===t.type&&t.geometry&&t.properties?t.properties:t,c=[];if(u){var h=u(t);if(!Array.isArray(h))throw new Error("customItems return array");c=h}else s&&s.forEach((function(e){if(N(e)){var t=e.split(".").pop()||e;void 0!==(r=YL(l,e))&&c.push({name:t,value:r})}else{var r,i=e.field,o=e.alias,a=e.customValue,s=o||i.split(".").pop()||i;void 0!==(r=YL(l,i))&&c.push({name:s,value:a?a(r,l,n):r})}}));var p={title:a?a(l):o,items:c};i.updateTooltip(e,p)},i.interactionUntriggerHander=function(){i.hideTooltip()},i.scene=t,i.interactionLayers=n,i.options=tP({},i.getDefaultOptions(),r);var o=i.options,a=o.offsets,s=o.title,u=o.showTitle,l=o.customContent,c=o.domStyles,h=o.anchor,p=o.className;return i.marker=new Cp({offsets:a,anchor:h,draggable:!1}),i.tooltipComponent=new XI({title:s,showTitle:u,items:[],customContent:l,domStyles:c,className:p}),i.setComponent(),i.initInteractionEvent(),i}return _(t,e),t.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:Xe["TOP-LEFT"]}},t.prototype.update=function(e){this.marker.remove(),this.currentVisible=!1,this.options=tP({},this.options,e);var t=this.options,n=t.offsets,r=t.showTitle,i=t.customContent,o=t.domStyles,a=t.anchor,s=t.className;this.marker=new Cp({offsets:n,anchor:a,draggable:!1}),this.tooltipComponent.update({showTitle:r,customContent:i,domStyles:o,className:s}),this.setComponent()},t.prototype.initInteractionEvent=function(){var e=this,t=this.options.trigger||"mousemove";if(!nP.includes(t))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach((function(n){var r=n.layer;r.on(t,e.interactionTriggerHander),r.on("un".concat(t),e.interactionUntriggerHander)}))},t.prototype.unBindInteractionEvent=function(){var e=this,t=this.options.trigger||"mousemove";this.interactionLayers.forEach((function(n){var r=n.layer;r.off(t,e.interactionTriggerHander),r.off("un".concat(t),e.interactionUntriggerHander)}))},t.prototype.updateTooltip=function(e,t){var n=e.lngLat,r=e.x,i=e.y;if(this.options.showComponent&&(this.updateComponent(t),this.setPostion(n)),this.currentVisible){var o={type:"tooltip:change",data:t,lngLat:n,x:r,y:i};this.emit("tooltip:change",o)}else{this.showTooltip();var a={type:"tooltip:show",data:t,lngLat:n,x:r,y:i};this.emit("tooltip:show",a)}},t.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},t.prototype.hideTooltip=function(){this.currentVisible&&(this.options.showComponent&&this.marker.remove(),this.currentVisible=!1,this.emit("tooltip:hide",{type:"tooltip:hide"}))},t.prototype.updateComponent=function(e){H(this.lastComponentOptions,e)||(this.tooltipComponent.update(e),this.lastComponentOptions=e)},t.prototype.setComponent=function(){var e=this.tooltipComponent.getContainer(),t=window.document.createElement("div");t.style.cursor="auto",t.style.userSelect="text",t.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){t.addEventListener(e,(function(e){return e.stopPropagation()}))})),t.appendChild(e),this.marker.setElement(t)},t.prototype.setPostion=function(e){this.marker.setLnglat(e)},t.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},t}(iI),iP=r(9014),oP=r(9417),aP=r(3555);function sP(e){var t,n,r,i={point:{default:{fill:e.pointFillColor,size:e.pointSize,stroke:e.pointBorderColor,lineWidth:e.pointBorder,fillOpacity:e.pointFillOpacity},active:{fill:e.pointActiveFillColor},selected:{fill:e.pointSelectedFillColor}}};return{mapStyle:e.mapStyle,defaultColor:e.brandColor,subColor:e.subColor,semanticRed:e.paletteSemanticRed,semanticGreen:e.paletteSemanticGreen,fontFamily:e.fontFamily,colors10:e.paletteQualitative10,colors20:e.paletteQualitative20,sequenceColors:e.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:i.point.default},active:{style:i.point.active},selected:{style:i.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(t={},t[oP.rC]={visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:"".concat(e.legendContainerBorderRadius,"px"),color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(e.legendTextFontSize,"px")},t[oP.O6]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},t[oP.fL]={margin:"0px",padding:"0px"},t[oP.jp]={marginBottom:"2px"},t[oP.Bc]={width:"10px",height:"10px"},t[oP.Tf]={paddingLeft:"8px"},t)},continue:{domStyles:(n={},n[aP.rC]={visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:"".concat(e.legendContainerBorderRadius,"px"),color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(e.legendTextFontSize,"px")},n[aP.O6]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},n[aP.el]={display:"flex",alignItems:"center"},n[aP.bl]={width:"140px",height:"14px",margin:"0px 5px"},n[aP.VI]={padding:"0px"},n)}},tooltip:{domStyles:(r={},r[iP.rC]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:e.tooltipContainerFillColor,boxShadow:e.tooltipContainerShadow,borderRadius:"".concat(e.tooltipContainerBorderRadius,"px"),color:e.tooltipTextFillColor,fontSize:"".concat(e.tooltipTextFontSize,"px"),fontFamily:e.fontFamily,lineHeight:e.tooltipTextLineHeight},r[iP.O6]={marginBottom:"4px"},r[iP.fL]={margin:"0px",padding:"0px"},r[iP.jp]={marginBottom:"4px"},r[iP.bX]={color:e.tooltipItemNameFillColor},r[iP.Tf]={color:e.tooltipItemValueFillColor,marginLeft:"30px"},r)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:e.labelFillColor,fontSize:e.labelFontSize,fontFamily:e.fontFamily,fillColorDark:e.labelFillColorDark,fillColorLight:e.labelFillColorLight}}}}}var uP="#000",lP="#595959",cP=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],hP=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],pP=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],fP=function(e){void 0===e&&(e={});var t=e.mapStyle,n=void 0===t?"light":t,r=e.subColor,i=void 0===r?"rgba(0,0,0,0.05)":r,o=e.paletteQualitative10,a=void 0===o?cP:o,s=e.paletteQualitative20,u=void 0===s?hP:s,l=e.paletteSemanticRed,c=void 0===l?"#F4664A":l,h=e.paletteSemanticGreen,p=void 0===h?"#30BF78":h,f=e.paletteSemanticYellow,d=void 0===f?"#FAAD14":f,v=e.paletteSequence,m=void 0===v?pP:v,g=e.fontFamily,y=void 0===g?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':g,_=e.brandColor,x=void 0===_?a[0]:_;return{mapStyle:n,brandColor:x,subColor:i,paletteQualitative10:a,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:d,paletteSequence:m,fontFamily:y,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:lP,legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:lP,tooltipItemNameFillColor:lP,tooltipItemValueFillColor:lP,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:lP,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:x,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:"#FFFFFF",pointActiveBorderColor:uP,pointSelectedBorderColor:uP}},dP=(fP(),"#000"),vP="#FFFFFF",mP="#A6A6A6",gP=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],yP=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],_P=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],xP=function(e){void 0===e&&(e={});var t=e.mapStyle,n=void 0===t?"dark":t,r=e.subColor,i=void 0===r?"rgba(255,255,255,0.05)":r,o=e.paletteQualitative10,a=void 0===o?gP:o,s=e.paletteQualitative20,u=void 0===s?yP:s,l=e.paletteSemanticRed,c=void 0===l?"#F4664A":l,h=e.paletteSemanticGreen,p=void 0===h?"#30BF78":h,f=e.paletteSemanticYellow,d=void 0===f?"#FAAD14":f,v=e.paletteSequence,m=void 0===v?_P:v,g=e.fontFamily,y=void 0===g?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':g,_=e.brandColor;return{mapStyle:n,brandColor:void 0===_?a[0]:_,subColor:i,paletteQualitative10:a,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:d,paletteSequence:m,fontFamily:y,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:mP,legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:mP,tooltipItemNameFillColor:mP,tooltipItemValueFillColor:mP,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:mP,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:gP[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:dP,pointActiveBorderColor:vP,pointSelectedBorderColor:vP}};function bP(e){var t=e.styleSheet,n=void 0===t?{}:t,r=b(e,["styleSheet"]),i=fP(n);return G({},sP(i),r)}xP();var EP,wP=bP({}),SP=function(e){var t=e.styleSheet,n=void 0===t?{}:t,r=b(e,["styleSheet"]),i=xP(n);return G({},sP(i),r)}({}),TP={default:wP,light:wP,dark:SP};function AP(e){return void 0===e&&(e="default"),function(e,t,n){for(var r=0,i=N(t)?t.split("."):t;e&&r<i.length;)e=e[i[r++]];return void 0===e||r<i.length?n:e}(TP,function(e){return function(e){return null==e}(e)?"":e.toString()}(e).toLowerCase(),TP.default)}!function(e){e.Map="map",e.Amap="amap",e.AmapV1="amapv1",e.AmapV2="amapv2",e.Mapbox="mapbox"}(EP||(EP={}));var CP,RP,MP=function(e){function t(t,n){void 0===t&&(t=[]),void 0===n&&(n={});var r=e.call(this)||this;return r.name=n.name?n.name:q("layerGroup"),r.layers=t,r}return _(t,e),t.prototype.addTo=function(e){var t=this;this.scene=e;var n=0,r=this.layers.length;this.layers.forEach((function(i){i.once("inited",(function(e){n++,t.emit("inited",e),n===r&&t.emit("inited-all")})),i.addTo(e)}))},t.prototype.hasLayer=function(e){return this.layers.some((function(t){return t===e}))},t.prototype.addLayer=function(e){var t=this;this.layers.push(e),this.scene&&(e.once("inited",(function(e){return t.emit("inited",e)})),e.addTo(this.scene))},t.prototype.removeLayer=function(e){var t=this.layers.findIndex((function(t){return t===e}));return-1!==t&&(this.layers.splice(t,1),this.scene&&e.remove(this.scene),!0)},t.prototype.getLayers=function(){return this.layers},t.prototype.getInteractionLayers=function(){return this.layers.filter((function(e){return e.interaction}))},t.prototype.getLayer=function(e){return this.layers.find((function(t){return t.layer.id===e}))},t.prototype.getLayerByName=function(e){return this.layers.find((function(t){return t.name===e}))},t.prototype.removeAllLayer=function(){var e=this;this.layers.forEach((function(t){e.scene&&t.remove(e.scene)})),this.layers=[]},t.prototype.isEmpty=function(){return 0===this.layers.length},t}(iI),kP=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],IP=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],LP=["inited","add","remove","dataUpdate","click","unclick","dblclick","undblclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"],PP={map:{type:EP.Amap},logo:!0},OP=function(e){function t(t){var n=e.call(this)||this;return n.inited=!1,n.sceneLoaded=!1,n.layersLoaded=!1,n.loaded=!1,n.layerGroup=new MP,n.options=tP({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createContainer=function(e){var t=this.options,n=t.width,r=t.height,i="string"==typeof e?document.getElementById(e):e;return i.style.position||(i.style.position="relative"),n&&(i.style.width||(i.style.width="".concat(n,"px"))),r&&(i.style.height||(i.style.height="".concat(r,"px"))),i},t.prototype.createTheme=function(){return I(this.options.theme)?tP({},AP("default"),bP(this.options.theme)):AP(this.options.theme)},t.prototype.createMap=function(){var e=this.options.map?this.options.map:PP.map,t=e.type,n=b(e,["type"]),r=Object.assign({style:this.theme.mapStyle},n);return t===EP.Amap?new qw(r):t===EP.AmapV1?new jw(r):t===EP.AmapV2?new qw(r):t===EP.Mapbox?new GA(r):new xA(r)},t.prototype.createScene=function(){var e=this.options,t=e.logo,n=e.antialias,r=e.preserveDrawingBuffer,i=B(t)?{logoVisible:t}:{logoVisible:null==t?void 0:t.visible,logoPosition:null==t?void 0:t.position},o=Object.assign({antialias:n,preserveDrawingBuffer:r},i),a=this.createMap();return new nI(x({id:this.container,map:a},o))},t.prototype.registerResources=function(){var e=this;n.size&&n.forEach((function(t,n){!e.scene.hasImage(n)&&e.scene.addImage(n,t)})),u.size&&u.forEach((function(t,n){e.scene.addFontFace(n,t)})),h.size&&h.forEach((function(t,n){e.scene.addIconFont(n,t)}))},t.prototype.update=function(e){this.updateOption(e),e.map&&!H(this.lastOptions.map,this.options.map)&&this.updateMap(e.map),this.render(),this.emit("update")},t.prototype.updateOption=function(e){this.lastOptions=this.options,this.options=tP({},this.options,e)},t.prototype.updateMap=function(e){var t;if(this.scene){var n=e.style,r=e.center,i=e.zoom,o=e.rotation,a=e.pitch;z(a)||this.scene.setPitch(a),z(o)||this.scene.setRotation(o),n&&n!==(null===(t=this.lastOptions.map)||void 0===t?void 0:t.style)&&this.scene.setMapStyle(n),i&&r&&this.scene.setZoomAndCenter(i,r)}},t.prototype.changeSize=function(e,t){this.options.width===e&&this.options.height===t||(this.container.style.width="".concat(e,"px"),this.container.style.height="".concat(t,"px"),this.options=Object.assign(this.options,{width:e,height:t}))},t.prototype.on=function(e,t,n){return this.proxyEventHander("on",e,t,n),this},t.prototype.once=function(e,t){return this.proxyEventHander("once",e,t),this},t.prototype.off=function(e,t){return this.proxyEventHander("off",e,t),this},t.prototype.proxyEventHander=function(t,n,r,i){var o=kP.find((function(e){return e.adaptation===n}));if(o)this.scene[t](o.original,r);else if(-1!==IP.indexOf(n))this.scene[t](n,r);else if(n.includes("Layer:")){var a=T(n.split(":"),2),s=a[0],u=a[1];if(!this[s]||!this[s][t]||-1===LP.indexOf(u))throw new Error('No event name "'.concat(n,'"'));this[s][t](u,r)}else e.prototype[t].call(this,n,r,i)},t.prototype.getScene=function(){return this.scene},t.prototype.getMap=function(){var e,t,n,r;return(null===(e=this.options.map)||void 0===e?void 0:e.type)===EP.Amap||(null===(t=this.options.map)||void 0===t?void 0:t.type)===EP.AmapV2||(null===(n=this.options.map)||void 0===n?void 0:n.type)===EP.Mapbox||(null===(r=this.options.map)||void 0===r||r.type,EP.Map),this.scene.map},t.prototype.addLayer=function(e){this.layerGroup.addLayer(e)},t.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},t.prototype.getLayers=function(){return this.layerGroup.getLayers()},t.prototype.getLayerByName=function(e){return this.layerGroup.getLayerByName(e)},t.prototype.removeLayer=function(e){return this.layerGroup.removeLayer(e)},t.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},t.prototype.zoomIn=function(){this.scene.zoomIn()},t.prototype.zoomOut=function(){this.scene.zoomOut()},t.prototype.setPitch=function(e){this.scene.setPitch(e)},t.prototype.fitBounds=function(e){this.scene.fitBounds(e)},t.prototype.setMapStatus=function(e){this.scene.setMapStatus(e)},t.prototype.setBgColor=function(e){this.scene.setBgColor(e)},t.prototype.initComponents=function(){this.initControls(),this.initTooltip()},t.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},t.prototype.initControls=function(){var e=this.options,t=e.zoom,n=e.scale,r=e.layerMenu,i=e.legend;n&&this.addScaleControl(n),t&&this.addZoomControl(t),r&&this.addLayerMenuControl(r),i&&(this.addLegendControl(i),this.emit("add-legend"))},t.prototype.updateControls=function(){var e=this.options,t=e.zoom,n=e.scale,r=e.layerMenu,i=e.legend;H(this.lastOptions.zoom,t)||(t?this.updateZoomControl(t):this.removeZoomControl()),H(this.lastOptions.scale,n)||(n?this.updateScaleControl(n):this.removeScaleControl()),H(this.lastOptions.layerMenu,r)||(r?this.updateLayerMenuControl(r):this.removeLayerMenuControl()),H(this.lastOptions.legend,i)||(i?this.updateLegendControl(i):this.removeLegendControl())},t.prototype.addZoomControl=function(e){this.zoomControl||(this.zoomControl=new Up(e),this.scene.addControl(this.zoomControl))},t.prototype.updateZoomControl=function(e){this.zoomControl?(this.removeZoomControl(),this.addZoomControl(e)):this.addZoomControl(e)},t.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},t.prototype.addScaleControl=function(e){this.scaleControl||(this.scaleControl=new Bp(e),this.scene.addControl(this.scaleControl))},t.prototype.updateScaleControl=function(e){this.scaleControl?(this.removeScaleControl(),this.addScaleControl(e)):this.addScaleControl(e)},t.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},t.prototype.addLayerMenuControl=function(e){var t={};this.layerGroup.getLayers().forEach((function(e){var n=e.name,r=e.layer;t[n]=r}))},t.prototype.updateLayerMenuControl=function(e){this.removeLayerMenuControl(),this.addLayerMenuControl(e)},t.prototype.removeLayerMenuControl=function(){},t.prototype.getLegendOptions=function(){return{}},t.prototype.addLegendControl=function(e){if(!this.legendControl){var t=this.theme.components.legend,n=tP({},this.getLegendOptions(),e),r=n.type,i=n.position,o=b(n,["type","position"]),a=[];if("category"===r){var s=tP({},{domStyles:t.category.domStyles},o);a.push({type:r,options:s})}else if("continue"===r){var u=tP({},{domStyles:t.continue.domStyles},o);a.push({type:r,options:u})}a.length&&(this.legendControl=new NI({position:i,items:a}),this.scene.addControl(this.legendControl))}},t.prototype.updateLegendControl=function(e){this.legendControl?(this.removeLegendControl(),this.addLegendControl(e)):this.addLegendControl(e)},t.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},t.prototype.initTooltip=function(){var e=this;this.tooltip&&this.tooltip.destroy();var t=this.options.tooltip;if(t){var n=tP({},{domStyles:this.theme.components.tooltip.domStyles},t),r=this.layerGroup.getInteractionLayers();this.tooltip=new rP(this.scene,r,n),this.tooltip.on("*",(function(t){return e.emit(t.type,t)}))}},t.prototype.exportPng=function(e){return this.scene.exportPng(e)},t.prototype.destroy=function(){var t;e.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy(),this.scene.destroy()},t.DefaultOptions=PP,t}(iI);!function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"}(CP||(CP={})),function(e){e.TextLayer="textLayer",e.DotLayer="dotLayer",e.IconLayer="iconLayer",e.DotDensity="dotDensityLayer",e.ColumnLayer="columnLayer",e.HeatmapLayer="heatmapLayer",e.GridLayer="gridLayer",e.HexbinLayer="hexbinLayer",e.LinesLayer="linesLayer",e.PathLayer="pathLayer",e.ArcLayer="arcLayer",e.AreaLayer="areaLayer",e.PrismLayer="prismLayer"}(RP||(RP={}));var DP=function(){function e(){}return e.aggregation=function(e,t){var n=t.type,r={type:void 0===n?"grid":n,size:t.radius,method:t.method,field:t.field};e.transforms?(e.transforms=e.transforms.filter((function(e){return e.type!==r.type})),e.transforms.push(r)):e.transforms=[r]},e}(),NP=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],FP=function(e){function t(t){var n=e.call(this)||this;return n.options=tP({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return _(t,e),t.prototype.getDefaultOptions=function(){return{}},t.prototype.pickLayerConfig=function(e){return X(e,NP)},t.prototype.addTo=function(e){e.addLayer(this.layer)},t.prototype.remove=function(e){e.removeLayer(this.layer)},t.prototype.update=function(e){this.updateOption(e),this.updateConfig(e)},t.prototype.updateOption=function(e){this.lastOptions=this.options,this.options=tP({},this.options,e)},t.prototype.updateConfig=function(e){z(e.zIndex)||H(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(e.zIndex),z(e.blend)||H(this.lastOptions.blend,this.options.blend)||this.setBlend(e.blend),z(e.minZoom)||H(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(e.minZoom),z(e.maxZoom)||H(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMinZoom(e.maxZoom),z(e.visible)||H(this.lastOptions.visible,this.options.visible)||(e.visible?this.show():this.hide())},t.prototype.render=function(){this.layer.renderLayers()},t.prototype.setSource=function(e){if(e instanceof Ap)this.layer.setSource(e);else{var t=e.data,n=e.aggregation,r=b(e,["data","aggregation"]);n&&DP.aggregation(r,n),this.layer.getSource()?this.layer.setData(t,r):this.layer.source(t,r)}},t.prototype.changeData=function(e){this.setSource(e)},t.prototype.setIndex=function(e){this.layer.setIndex(e)},t.prototype.setBlend=function(e){this.layer.setBlend(e)},t.prototype.setMinZoom=function(e){this.layer.setMinZoom(e)},t.prototype.setMaxZoom=function(e){this.layer.setMaxZoom(e)},t.prototype.show=function(){this.layer.inited&&this.layer.show()},t.prototype.hide=function(){this.layer.inited&&this.layer.hide()},t.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},t.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},t.prototype.fitBounds=function(e){this.layer.fitBounds(e)},t.prototype.on=function(t,n){return-1!==LP.indexOf(t)?this.layer.on(t,n):e.prototype.on.call(this,t,n),this},t.prototype.once=function(t,n){return-1!==LP.indexOf(t)?this.layer.once(t,n):e.prototype.once.call(this,t,n),this},t.prototype.off=function(t,n){return-1!==LP.indexOf(t)?this.layer.off(t,n):e.prototype.off.call(this,t,n),this},t.LayerType=RP,t.LayerConfigkeys=NP,t}(iI);function BP(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={};return e.forEach((function(e,t){i[e]=n[t]})),delete i[void 0],t(i)}}var zP,UP=function(){function e(){}return e.shape=function(t,n){if(N(n))t.shape(n);else if(M(n)){var r=[];t.shape(r.join("*"),BP(r,n))}else if(I(n)){var i=n.field?n.field:"";M(n.value)?(r=k(i)?i:i.split("*"),t.shape(i,BP(r,n.value))):t.shape(i,n.value),N(i)&&n.scale&&e.scale(t,i,n.scale)}},e.size=function(t,n){if(function(e){return R(e,"Number")}(n))t.size(n);else if(k(n))t.size(n);else if(M(n)){var r=[];t.size(r.join("*"),BP(r,n))}else if(I(n)){var i=n.field?n.field:"";M(n.value)?(r=k(i)?i:i.split("*"),t.size(i,BP(r,n.value))):t.size(i,n.value),N(i)&&n.scale&&e.scale(t,i,n.scale)}},e.color=function(t,n){if(N(n))t.color(n);else if(M(n)){var r=[];t.color(r.join("*"),BP(r,n))}else if(I(n)){var i=n.field?n.field:"";M(n.value)?(r=k(i)?i:i.split("*"),t.color(i,BP(r,n.value))):t.color(i,n.value),N(i)&&n.scale&&e.scale(t,i,n.scale)}},e.style=function(e,t){t&&e.style(t)},e.state=function(e,t){var n=t.active,r=t.select;n&&e.active(n),r&&e.select(r)},e.rotate=function(e,t){N(t)||M(t)||I(t)},e.texture=function(e,t){N(t)&&e.texture(t)},e.animate=function(e,t){(B(t)||I(t))&&e.animate(t)},e.scale=function(e,t,n){e.scale(t,n)},e.filter=function(e,t){var n=t.field?t.field:"",r=k(n)?n:n.split("*");e.filter(r.join("*"),BP(r,t.value))},e}(),jP={style:{fontSize:12}},GP=[],VP=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.TextLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new um(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return jP},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.field,r=t.content,i=t.style,o=void 0===i?{}:i,a=t.state,s=o.fontSize,u=o.fill,l={field:n||r||"",value:"text"};UP.shape(e,l),s&&UP.size(e,s),u&&UP.color(e,u),o&&UP.style(e,o),a&&UP.state(e,a)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.DefaultOptions=jP,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(GP),t}(FP);!function(e){e.Dot="dot",e.DotDensity="dotDensity",e.Heatmap="heatmap",e.Grid="grid",e.Hexbin="hexbin",e.Path="path",e.Flow="flow",e.Area="area",e.Choropleth="choropleth"}(zP||(zP={}));var HP={autoFit:!1},WP=function(e){function t(t,n){var r=this;if("string"==typeof t||t instanceof Element){if(void 0===n)throw new Error("options is undefined");(r=e.call(this,n)||this).container=r.createContainer(t),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.initSource()}else r=e.call(this,t)||this;return r}return _(t,e),t.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},t.prototype.initLayersEvent=function(){},t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createSource=function(){var e=this.options.source,t=e.data,n=e.aggregation,r=b(e,["data","aggregation"]);return n&&DP.aggregation(r,n),new Ap(t,r)},t.prototype.createLabelLayer=function(e,t,n){var r=n||{},i=r.visible,o=r.minZoom,a=r.maxZoom,s=r.zIndex;return new VP(x({name:"labelLayer",visible:i,minZoom:o,maxZoom:a,zIndex:(void 0===s?0:s)+.1,source:e},t))},t.prototype.updateLabelLayer=function(e,t,n,r){t?r?r.update(x({},t)):(r=this.createLabelLayer(e,t,n),this.layerGroup.addLayer(r)):!1===t&&r&&this.layerGroup.removeLayer(r)},t.prototype.render=function(){var e=this,t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){e.onSceneLoaded()}))),this.initLayersEvent()},t.prototype.onSceneLoaded=function(){var e=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(function(){e.onLayersLoaded()})),this.layerGroup.addTo(this.scene)},t.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},t.prototype.attachToScene=function(e,t){this.scene=e,this.theme=t||AP("default"),this.registerResources(),this.initSource()},t.prototype.unattachFromScene=function(){var e;this.removeAllLayer(),null===(e=this.tooltip)||void 0===e||e.destroy()},t.prototype.addToScene=function(e){this.attachToScene(e)},t.prototype.removeFromScene=function(){var e;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(e=this.tooltip)||void 0===e||e.destroy()},t.prototype.update=function(e){if(this.updateOption(e),e.map&&!H(this.lastOptions.map,this.options.map)&&this.updateMap(e.map),this.scene.setEnableRender(!1),e.source&&!H(this.lastOptions.source,this.options.source)){var t=e.source,n=t.data,r=b(t,["data"]);this.changeData(n,r)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},t.prototype.changeData=function(e,t){var n=this;this.options.source=tP({},this.options.source,x({data:e},t));var r=this.options.source,i=r.aggregation,o=b(r,["aggregation"]);i&&DP.aggregation(o,i),this.source.setData(this.options.source.data,o);var a=this.options.legend;a&&setTimeout((function(){n.updateLegendControl(a)})),this.emit("change-data")},t.DefaultOptions=HP,t.PlotType=zP,t}(OP),XP=tP({},WP.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}}),ZP=/\s/;var qP=/^\s+/;const YP=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&ZP.test(e.charAt(t)););return t}(e)+1).replace(qP,""):e};var KP=/^[-+]0x[0-9a-f]+$/i,QP=/^0b[01]+$/i,JP=/^0o[0-7]+$/i,$P=parseInt;const eO=function(e){if("number"==typeof e)return e;if(oL(e))return NaN;if(uL(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=uL(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=YP(e);var n=QP.test(e);return n||JP.test(e)?$P(e.slice(2),n?2:8):KP.test(e)?NaN:+e};const tO=function(e){var t=function(e){return e?1/0===(e=eO(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),n=t%1;return t==t?n?t-n:t:0};var nO=KI.isFinite,rO=Math.min;const iO=function(e){var t=Math[e];return function(e,n){if(e=eO(e),(n=null==n?0:rO(tO(n),292))&&nO(e)){var r=(XL(e)+"e").split("e"),i=t(r[0]+"e"+(+r[1]+n));return+((r=(XL(i)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round");var oO=function(e){return function(e){return!Array.isArray(e[0].value)}(e)?e:e.map((function(e){return x(x({},e),{value:[iO(e.value[0],2),iO(e.value[1],2)]})}))},aO={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},sO=["shape","color","size","style","state","animate"],uO=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.DotLayer,n.interaction=!0;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new um(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return aO},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.shape,r=t.color,i=t.size,o=t.style,a=t.state,s=t.animate;n&&UP.shape(e,n),i&&UP.size(e,i),r&&UP.color(e,r),o&&UP.style(e,o),a&&UP.state(e,a),s&&UP.animate(e,s)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.prototype.getColorLegendItems=function(){var e=this.layer.getLegendItems("color");return Array.isArray(e)&&0!==e.length?oO(e):[]},t.DefaultOptions=aO,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(sO),t}(FP),lO=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Dot,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.dotLayer=new uO(x({source:e},X(this.options,uO.LayerOptionsKeys)));var t=new MP([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(e,this.options.label,this.options),t.addLayer(this.labelLayer)),t},t.prototype.updateLayers=function(e){var t=X(e,uO.LayerOptionsKeys);this.dotLayer.update(t),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.prototype.getLegendOptions=function(){var e=this.dotLayer.getColorLegendItems();return 0!==e.length?{type:"category",items:e}:{}},t.DefaultOptions=XP,t}(WP),cO=function e(t){return t&&"object"===ue(t)?(Array.isArray(t)?n=t.map((function(t){return e(t)})):(n={},Object.keys(t).forEach((function(r){return n[r]=e(t[r])}))),n):t;var n},hO=["source"],pO=function(e){var t=e.source,n=v(e,hO);return pe(pe({},cO(n)),{},{source:pe({},t)})},fO=["data"],dO=["onReady","map","source"],vO=["data"],mO=["onReady","map","source"];function gO(e,t){var n=(0,m.useRef)(),r=(0,m.useRef)(),i=(0,m.useRef)(null),o=t.onReady;return(0,m.useEffect)((function(){if(n.current&&r.current&&!H(r.current,t)){var e,i,o,a=r.current,s=(a.onReady,a.map),u=a.source,l=u.data,c=v(u,fO),h=v(a,dO),p=(t.onReady,t.map),f=t.source,d=f.data,m=v(f,vO),g=v(t,mO);if(i=!H(s,p),e=!H(c,m)||l!==d,o=!H(h,g),r.current=pO(t),i){var y=X(p,["center","pitch","rotation","zoom","style"]);n.current.updateMap(y)}e&&(n.current.loaded?n.current.changeData(d,m):n.current.once("loaded",(function(){var e;null===(e=n.current)||void 0===e||e.changeData(d,m)}))),o&&(n.current.loaded?n.current.update(g):n.current.once("loaded",(function(){var e;null===(e=n.current)||void 0===e||e.update(g)})))}}),[t]),(0,m.useEffect)((function(){return i.current?(r.current||(r.current=pO(t)),n.current=new e(i.current,pe({},t)),o&&n.current.once("loaded",(function(){o(n.current)})),function(){n.current&&(n.current.destroy(),n.current=void 0)}):function(){return null}}),[]),{plotRef:n,containerRef:i}}var yO=function(e,t){e&&(M(e)?e(t):e.current=t)},_O="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/errorBoundary/index.tsx",xO=function(e){Ce(i,e);var t,n,r=(t=i,n=Ie(),function(){var e,r=ke(t);if(n){var i=ke(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Me(this,e)});function i(){var e;Te(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).state={hasError:!1},e.renderError=function(t){var n=e.props.errorTemplate;return"function"==typeof n?n(t):n||g().createElement("h5",{__self:Re(e),__source:{fileName:_O,lineNumber:33,columnNumber:48}},"组件出错了，请核查后重试： ",t.message)},e}return Se(i,[{key:"render",value:function(){return this.state.hasError?this.renderError(this.state.error):g().createElement(m.Fragment,{__self:this,__source:{fileName:_O,lineNumber:41,columnNumber:12}},this.props.children)}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}},{key:"getDerivedStateFromProps",value:function(e,t){return t.children!==e.children?{children:e.children,hasError:!1,error:void 0}:null}}]),i}(g().Component);const bO=xO;var EO=function(){return EO=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},EO.apply(this,arguments)},wO=function(e){var t=e.animate,n=e.backgroundColor,r=e.backgroundOpacity,i=e.baseUrl,o=e.children,a=e.foregroundColor,s=e.foregroundOpacity,u=e.gradientRatio,l=e.uniqueKey,c=e.interval,h=e.rtl,p=e.speed,f=e.style,d=e.title,v=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["animate","backgroundColor","backgroundOpacity","baseUrl","children","foregroundColor","foregroundOpacity","gradientRatio","uniqueKey","interval","rtl","speed","style","title"]),g=l||Math.random().toString(36).substring(6),y=g+"-diff",_=g+"-animated-diff",x=g+"-aria",b=h?{transform:"scaleX(-1)"}:null,E="0; "+c+"; 1",w=p+"s";return(0,m.createElement)("svg",EO({"aria-labelledby":x,role:"img",style:EO(EO({},f),b)},v),d?(0,m.createElement)("title",{id:x},d):null,(0,m.createElement)("rect",{role:"presentation",x:"0",y:"0",width:"100%",height:"100%",clipPath:"url("+i+"#"+y+")",style:{fill:"url("+i+"#"+_+")"}}),(0,m.createElement)("defs",{role:"presentation"},(0,m.createElement)("clipPath",{id:y},o),(0,m.createElement)("linearGradient",{id:_},(0,m.createElement)("stop",{offset:"0%",stopColor:n,stopOpacity:r},t&&(0,m.createElement)("animate",{attributeName:"offset",values:-u+"; "+-u+"; 1",keyTimes:E,dur:w,repeatCount:"indefinite"})),(0,m.createElement)("stop",{offset:"50%",stopColor:a,stopOpacity:s},t&&(0,m.createElement)("animate",{attributeName:"offset",values:-u/2+"; "+-u/2+"; "+(1+u/2),keyTimes:E,dur:w,repeatCount:"indefinite"})),(0,m.createElement)("stop",{offset:"100%",stopColor:n,stopOpacity:r},t&&(0,m.createElement)("animate",{attributeName:"offset",values:"0; 0; "+(1+u),keyTimes:E,dur:w,repeatCount:"indefinite"})))))};wO.defaultProps={animate:!0,backgroundColor:"#f5f6f7",backgroundOpacity:1,baseUrl:"",foregroundColor:"#eee",foregroundOpacity:1,gradientRatio:2,id:null,interval:.25,rtl:!1,speed:1.2,style:{},title:"Loading..."};var SO=function(e){return e.children?(0,m.createElement)(wO,EO({},e)):(0,m.createElement)(TO,EO({},e))},TO=function(e){return(0,m.createElement)(SO,EO({viewBox:"0 0 476 124"},e),(0,m.createElement)("rect",{x:"48",y:"8",width:"88",height:"6",rx:"3"}),(0,m.createElement)("rect",{x:"48",y:"26",width:"52",height:"6",rx:"3"}),(0,m.createElement)("rect",{x:"0",y:"56",width:"410",height:"6",rx:"3"}),(0,m.createElement)("rect",{x:"0",y:"72",width:"380",height:"6",rx:"3"}),(0,m.createElement)("rect",{x:"0",y:"88",width:"178",height:"6",rx:"3"}),(0,m.createElement)("circle",{cx:"20",cy:"20",r:"20"}))};const AO=SO;var CO="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/util/createLoading.tsx",RO=void 0;const MO=function(e){var t=e.loadingTemplate;return g().createElement("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",left:0,top:0,zIndex:99,backgroundColor:"#fff"},__self:RO,__source:{fileName:CO,lineNumber:30,columnNumber:5}},t||g().createElement(AO,{viewBox:"0 0 400 180",width:200,height:90,speed:1,__self:RO,__source:{fileName:CO,lineNumber:14,columnNumber:7}},g().createElement("rect",{x:"20",y:"5",rx:"0",ry:"0",width:"1",height:"170",__self:RO,__source:{fileName:CO,lineNumber:15,columnNumber:9}}),g().createElement("rect",{x:"20",y:"175",rx:"0",ry:"0",width:"360",height:"1",__self:RO,__source:{fileName:CO,lineNumber:16,columnNumber:9}}),g().createElement("rect",{x:"40",y:"75",rx:"0",ry:"0",width:"35",height:"100",__self:RO,__source:{fileName:CO,lineNumber:17,columnNumber:9}}),g().createElement("rect",{x:"80",y:"125",rx:"0",ry:"0",width:"35",height:"50",__self:RO,__source:{fileName:CO,lineNumber:18,columnNumber:9}}),g().createElement("rect",{x:"120",y:"105",rx:"0",ry:"0",width:"35",height:"70",__self:RO,__source:{fileName:CO,lineNumber:19,columnNumber:9}}),g().createElement("rect",{x:"160",y:"35",rx:"0",ry:"0",width:"35",height:"140",__self:RO,__source:{fileName:CO,lineNumber:20,columnNumber:9}}),g().createElement("rect",{x:"200",y:"55",rx:"0",ry:"0",width:"35",height:"120",__self:RO,__source:{fileName:CO,lineNumber:21,columnNumber:9}}),g().createElement("rect",{x:"240",y:"15",rx:"0",ry:"0",width:"35",height:"160",__self:RO,__source:{fileName:CO,lineNumber:22,columnNumber:9}}),g().createElement("rect",{x:"280",y:"135",rx:"0",ry:"0",width:"35",height:"40",__self:RO,__source:{fileName:CO,lineNumber:23,columnNumber:9}}),g().createElement("rect",{x:"320",y:"85",rx:"0",ry:"0",width:"35",height:"90",__self:RO,__source:{fileName:CO,lineNumber:24,columnNumber:9}})))};var kO=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],IO="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/dot-map/index.tsx",LO=void 0,PO=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,kO),c=gO(lO,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:LO,__source:{fileName:IO,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:LO,__source:{fileName:IO,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:LO,__source:{fileName:IO,lineNumber:38,columnNumber:7}}))}));const OO=PO;var DO=tP({},WP.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}}),NO={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"heatmap",size:{value:[0,1]},style:{intensity:3,radius:20,opacity:1,colorsRamp:[{color:"rgba(33,102,172,0.0)",position:0},{color:"rgb(103,169,207)",position:.2},{color:"rgb(209,229,240)",position:.4},{color:"rgb(253,219,199)",position:.6},{color:"rgb(239,138,98)",position:.8},{color:"rgb(178,24,43,1.0)",position:1}]}},FO=["shape","color","size","style","state"],BO=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.HeatmapLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new ov(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return NO},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.shape,r=t.size,i=t.style,o=t.state;n&&UP.shape(e,n),r&&UP.size(e,r),i&&("colorsRamp"in i&&(i.rampColors=function(e){var t=e.colorsRamp,n={colors:[],positions:[]};return t.forEach((function(e){var t=e.color,r=e.position;n.colors.push(t),n.positions.push(r)})),n}(i)),UP.style(e,i)),o&&UP.state(e,o)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.DefaultOptions=NO,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(FO),t}(FP),zO=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Heatmap,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.heatmapLayer=new BO(x({source:e},X(this.options,BO.LayerOptionsKeys)));var t=new MP([this.heatmapLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),t.addLayer(this.labelLayer)),t},t.prototype.updateLayers=function(e){var t=X(e,BO.LayerOptionsKeys);this.heatmapLayer.update(t),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.prototype.getLegendOptions=function(){var e,t=this.heatmapLayer.layer.getLegendItems("size");return Array.isArray(t)&&0!==t.length?{type:"continue",min:t[0].value,max:t[t.length-1].value,colors:null===(e=this.heatmapLayer.options.style)||void 0===e?void 0:e.colorsRamp.map((function(e){return e.color}))}:{}},t.DefaultOptions=DO,t}(WP),UO=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],jO="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/geographic-heatmap/index.tsx",GO=void 0,VO=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,UO),c=gO(zO,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:GO,__source:{fileName:jO,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:GO,__source:{fileName:jO,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:GO,__source:{fileName:jO,lineNumber:38,columnNumber:7}}))}));const HO=VO;var WO=tP({},WP.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",radius:15e3,method:"sum"}}}),XO={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",field:"",radius:15e3,method:"sum"}},shape:"square",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},ZO=["shape","color","size","style","state"],qO=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.GridLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new ov(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return XO},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.shape,r=t.color,i=t.size,o=t.style,a=t.state;n&&UP.shape(e,n),i&&UP.size(e,i),r&&UP.color(e,r),o&&UP.style(e,o),a&&UP.state(e,a)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.DefaultOptions=XO,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(ZO),t}(FP),YO=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Grid,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.gridLayer=new qO(x({source:e},X(this.options,qO.LayerOptionsKeys)));var t=new MP([this.gridLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),t.addLayer(this.labelLayer)),t},t.prototype.updateLayers=function(e){var t=X(e,qO.LayerOptionsKeys);this.gridLayer.update(t),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.DefaultOptions=WO,t}(WP),KO=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],QO="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/grid-map/index.tsx",JO=void 0,$O=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,KO),c=gO(YO,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:JO,__source:{fileName:QO,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:JO,__source:{fileName:QO,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:JO,__source:{fileName:QO,lineNumber:38,columnNumber:7}}))}));const eD=$O;var tD=tP({},WP.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",radius:15e3,method:"sum"}}}),nD={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",field:"",radius:15e3,method:"sum"}},shape:"hexagon",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},rD=["shape","color","size","style","state"],iD=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.HexbinLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new ov(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return nD},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.shape,r=t.color,i=t.size,o=t.style,a=t.state;n&&UP.shape(e,n),i&&UP.size(e,i),r&&UP.color(e,r),o&&UP.style(e,o),a&&UP.state(e,a)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.DefaultOptions=nD,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(rD),t}(FP),oD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Hexbin,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.hexbinLayer=new iD(x({source:e},X(this.options,iD.LayerOptionsKeys)));var t=new MP([this.hexbinLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),t.addLayer(this.labelLayer)),t},t.prototype.updateLayers=function(e){var t=X(e,iD.LayerOptionsKeys);this.hexbinLayer.update(t),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.DefaultOptions=tD,t}(WP),aD=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],sD="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/hexbin-map/index.tsx",uD=void 0,lD=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,aD),c=gO(oD,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:uD,__source:{fileName:sD,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:uD,__source:{fileName:sD,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:uD,__source:{fileName:sD,lineNumber:38,columnNumber:7}}))}));const cD=lD;var hD=tP({},WP.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}}),pD={},fD=["shape","color","size","style","state","animate"],dD=function(e){function t(t){var n=e.call(this,t)||this;n.type=FP.LayerType.LinesLayer,n.interaction=!0;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||q(n.type),n.layer=new Iv(x(x({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return _(t,e),t.prototype.getDefaultOptions=function(){return pD},t.prototype.mappingLayer=function(e,t){!function(e,t){var n=t.shape,r=t.color,i=t.size,o=t.style,a=t.state,s=t.animate,u=t.texture;n&&UP.shape(e,n),i&&UP.size(e,i),r&&UP.color(e,r),o&&UP.style(e,o),a&&UP.state(e,a),s&&UP.animate(e,s),u&&UP.texture(e,u)}(e,t)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},t.prototype.getColorLegendItems=function(){var e=this.layer.getLegendItems("color");return Array.isArray(e)&&0!==e.length?oO(e):[]},t.DefaultOptions=pD,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(fD),t}(FP),vD=["color","size","style","state","animate"],mD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=dD.LayerType.PathLayer,t}return _(t,e),t.prototype.getDefaultOptions=function(){return tP({},dD.DefaultOptions,{shape:"line"})},t.LayerOptionsKeys=dD.LayerConfigkeys.concat(vD),t}(dD),gD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Path,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){return this.pathLayer=new mD(x({source:e},X(this.options,mD.LayerOptionsKeys))),new MP([this.pathLayer])},t.prototype.updateLayers=function(e){var t=X(e,mD.LayerOptionsKeys);this.pathLayer.update(t)},t.prototype.getLegendOptions=function(){var e=this.pathLayer.getColorLegendItems();return 0!==e.length?{type:"category",items:e}:{}},t.DefaultOptions=hD,t}(WP),yD=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],_D="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/path-map/index.tsx",xD=void 0,bD=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,yD),c=gO(gD,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:xD,__source:{fileName:_D,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:xD,__source:{fileName:_D,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:xD,__source:{fileName:_D,lineNumber:38,columnNumber:7}}))}));const ED=bD;var wD=tP({},WP.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"}),SD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=dD.LayerType.ArcLayer,t}return _(t,e),t.prototype.getDefaultOptions=function(){return tP({},dD.DefaultOptions,{shape:"arc"})},t}(dD),TD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Flow,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.flowLayer=new SD(x({name:"flowLayer",source:e},X(this.options,SD.LayerOptionsKeys)));var t=new MP([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(e),t.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(e,this.options.label),t.addLayer(this.labelLayer)),t},t.prototype.parserPointData=function(e){var t=[];return e.data.dataArray.forEach((function(e){var n=T(e.coordinates,2)[1];t.push(x(x({},e),{coordinates:n}))})),t},t.prototype.createRadiationLayer=function(e){var t=this,n=this.parserPointData(e),r=this.options.radiation||{},i=r.enabled,o=void 0===i||i,a=r.color,s=r.size,u=void 0===s?20:s,l=r.shape,c=void 0===l?"circle":l,h=r.animate,p=new uO({name:"radiationLayer",source:{data:n,parser:{type:"json",coordinates:"coordinates"}},visible:o,color:a,size:u,shape:c,animate:void 0===h||h}),f=function(){var e=t.parserPointData(t.source);p.layer.setData(e)};return e.on("update",f),p.on("remove",(function(){e.off("update",f)})),p},t.prototype.createLabelLayer=function(e,t){var n=this,r=this.parserPointData(e),i=this.options,o=i.visible,a=i.minZoom,s=i.maxZoom,u=i.zIndex,l=new VP(x({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"coordinates"}},visible:o,minZoom:a,maxZoom:s,zIndex:(void 0===u?0:u)+.1},t)),c=function(){var e=n.parserPointData(n.source);l.layer.setData(e)};return e.on("update",c),l.on("remove",(function(){e.off("update",c)})),l},t.prototype.updateLayers=function(e){var t=X(e,SD.LayerOptionsKeys);if(this.flowLayer.update(t),e.radiation)if(this.radiationLayer){var n=x(x({},e.radiation),{visible:e.radiation.enabled});this.radiationLayer.update(n)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.prototype.getLegendOptions=function(){var e=this.flowLayer.getColorLegendItems();return 0!==e.length?{type:"category",items:e}:{}},t.DefaultOptions=wD,t}(WP),AD=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],CD="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/flow-map/index.tsx",RD=void 0,MD=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,AD),c=gO(TD,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:RD,__source:{fileName:CD,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:RD,__source:{fileName:CD,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:RD,__source:{fileName:CD,lineNumber:38,columnNumber:7}}))}));const kD=MD;var ID=tP({},WP.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}}),LD="#2f54eb",PD={active:{fill:!1,stroke:LD,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:LD,lineWidth:1.5,lineOpacity:.8}},OD=function(e){return z(e)||(!1===e.active?PD.active=Object.assign(PD.active,{fill:!1,stroke:!1}):"object"==typeof e.active&&(!1===e.active.fill?PD.active.fill=!1:"string"==typeof e.active.fill&&(PD.active.fill=e.active.fill),!1===e.active.stroke?PD.active.stroke=!1:"string"==typeof e.active.stroke&&(PD.active.stroke=e.active.stroke),"number"==typeof e.active.lineWidth&&(PD.active.lineWidth=e.active.lineWidth),"number"==typeof e.active.lineOpacity&&(PD.active.lineOpacity=e.active.lineOpacity)),!1===e.select?PD.select=Object.assign(PD.select,{fill:!1,stroke:!1}):"object"==typeof e.select&&(!1===e.select.fill?PD.select.fill=!1:"string"==typeof e.select.fill&&(PD.select.fill=e.select.fill),!1===e.select.stroke?PD.select.stroke=!1:"string"==typeof e.select.stroke&&(PD.select.stroke=e.select.stroke),"number"==typeof e.select.lineWidth&&(PD.select.lineWidth=e.select.lineWidth),"number"==typeof e.select.lineOpacity&&(PD.select.lineOpacity=e.select.lineOpacity))),PD},DD={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},ND=["color","style","state","enabledMultiSelect"],FD=function(e){function t(t){var n=e.call(this,t)||this;n.selectData=[],n.type=FP.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(e){var t=e.feature,r=e.featureId;n.setHighlightLayerSource(t,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(e){var t=n.options.enabledMultiSelect,r=e.feature,i=e.featureId,o=U(n.selectData),a=o.findIndex((function(e){return e.featureId===i}));if(-1===a)t?o.push({feature:r,featureId:i}):o=[{feature:r,featureId:i}],n.emit("select",r,U(o));else{var s=o[a];t?o.splice(a,1):o=[],n.emit("unselect",s,U(o))}n.setSelectLayerSource(o)};var r=n.options,i=r.name,o=r.source,a=r.visible,s=r.minZoom,u=r.maxZoom,l=r.zIndex,c=void 0===l?0:l,h=n.pickLayerConfig(n.options),p=OD(n.options.state);return n.name=i||q(n.type),n.layer=new gm(x(x({},h),{name:n.name})),n.strokeLayer=new Iv({name:"strokeLayer",visible:a,zIndex:c,minZoom:s,maxZoom:u}),n.highlightLayer=new Iv({name:"highlightLayer",visible:a&&Boolean(p.active.stroke),zIndex:c+.1,minZoom:s,maxZoom:u}),n.selectFillLayer=new gm({name:"selectFillLayer",visible:a&&Boolean(p.select.fill),zIndex:c+.1,minZoom:s,maxZoom:u}),n.selectStrokeLayer=new Iv({name:"selectStrokeLayer",visible:a&&Boolean(p.select.stroke),zIndex:c+.1,minZoom:s,maxZoom:u}),n.mappingLayer(n.options),n.setSource(o),n.initEvent(),n}return _(t,e),t.prototype.getDefaultOptions=function(){return DD},t.prototype.mappingLayer=function(e){!function(e,t,n,r,i,o){var a=o.color,s=o.style,u=o.state,l=OD(u),c={active:!1!==l.active.fill&&{color:l.active.fill},select:!1},h={opacity:null==s?void 0:s.opacity},p=null==s?void 0:s.lineWidth,f=null==s?void 0:s.stroke,d={opacity:null==s?void 0:s.lineOpacity,dashArray:null==s?void 0:s.lineDash,lineType:null==s?void 0:s.lineType};if(UP.shape(e,"fill"),a&&UP.color(e,a),h&&UP.style(e,h),c&&UP.state(e,c),UP.shape(t,"line"),p&&UP.size(t,p),f&&UP.color(t,f),d&&UP.style(t,d),l.active.stroke){var v=l.active.stroke,m=l.active.lineWidth||p,g={opacity:l.active.lineOpacity};UP.shape(n,"line"),m&&UP.size(n,m),v&&UP.color(n,v),g&&UP.style(n,g)}if(l.select.fill){var y=l.select.fill;UP.shape(r,"fill"),y&&UP.color(r,y),h&&UP.style(r,h),UP.state(r,{select:!1,active:!1})}if(l.select.stroke){var _=l.select.stroke,x=(m=l.select.lineWidth||p,{opacity:l.select.lineOpacity});UP.shape(i,"line"),m&&UP.size(i,m),_&&UP.color(i,_),x&&UP.style(i,x)}}(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,e)},t.prototype.setSource=function(t){e.prototype.setSource.call(this,t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},t.prototype.setStrokeLayerSource=function(){var e=this.layer.getSource();if(e)this.strokeLayer.setSource(e);else{var t=this.layer.sourceOption,n=t.data,r=t.options;this.strokeLayer.source(n,r)}},t.prototype.setHighlightLayerSource=function(e,t){if(void 0===t&&(t=-999),this.highlightLayerData!==t){var n=e?[e]:[];this.highlightLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.highlightLayerData=t}},t.prototype.setSelectLayerSource=function(e){if(void 0===e&&(e=[]),this.selectData.length!==e.length||!H(this.selectData.map((function(e){return e.featureId})),e.map((function(e){return e.featureId})))){var t=e.map((function(e){return e.feature}));this.selectFillLayer.setData({type:"FeatureCollection",features:t},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:t},{parser:{type:"geojson"}}),this.selectData=e}},t.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},t.prototype.addTo=function(e){e.addLayer(this.layer),e.addLayer(this.strokeLayer),e.addLayer(this.highlightLayer),e.addLayer(this.selectFillLayer),e.addLayer(this.selectStrokeLayer)},t.prototype.remove=function(e){e.removeLayer(this.layer),e.removeLayer(this.strokeLayer),e.removeLayer(this.highlightLayer),e.removeLayer(this.selectFillLayer),e.removeLayer(this.selectStrokeLayer)},t.prototype.update=function(t){if(e.prototype.update.call(this,t),this.mappingLayer(this.options),this.options.visible){z(t.state)||H(this.lastOptions.state,this.options.state)||this.updateHighlightLayer();var n=OD(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},t.prototype.updateHighlightLayer=function(){var e=OD(this.options.state),t=OD(this.lastOptions.state);t.active.stroke!==e.active.stroke&&(e.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),t.select.fill!==e.select.fill&&(e.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),t.select.stroke!==e.select.stroke&&(e.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},t.prototype.setIndex=function(e){this.layer.setIndex(e),this.strokeLayer.setIndex(e),this.highlightLayer.setIndex(e+.1),this.selectFillLayer.setIndex(e+.1),this.selectStrokeLayer.setIndex(e+.1)},t.prototype.setMinZoom=function(e){this.layer.setMinZoom(e),this.strokeLayer.setMinZoom(e),this.highlightLayer.setMinZoom(e),this.selectFillLayer.setMinZoom(e),this.selectStrokeLayer.setMinZoom(e)},t.prototype.setMaxZoom=function(e){this.layer.setMaxZoom(e),this.strokeLayer.setMaxZoom(e),this.highlightLayer.setMaxZoom(e),this.selectFillLayer.setMaxZoom(e),this.selectStrokeLayer.setMaxZoom(e)},t.prototype.show=function(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},t.prototype.hide=function(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},t.prototype.getColorLegendItems=function(){var e=this.layer.getLegendItems("color");return Array.isArray(e)&&0!==e.length?oO(e):[]},t.prototype.setActive=function(e){},t.prototype.setSelect=function(e){},t.DefaultOptions=DD,t.LayerOptionsKeys=FP.LayerConfigkeys.concat(ND),t}(FP),BD=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Area,t}return _(t,e),t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.createLayers=function(e){this.areaLayer=new FD(x({source:e},X(this.options,FD.LayerOptionsKeys)));var t=new MP([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(e,this.options.label,this.options),t.addLayer(this.labelLayer)),t},t.prototype.updateLayers=function(e){var t=X(e,FD.LayerOptionsKeys);this.areaLayer.update(t),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.prototype.initLayersEvent=function(){},t.prototype.getLegendOptions=function(){var e=this.areaLayer.getColorLegendItems();return 0!==e.length?{type:"category",items:e}:{}},t.DefaultOptions=ID,t}(WP),zD=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],UD="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/area-map/index.tsx",jD=void 0,GD=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,zD),c=gO(BD,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:jD,__source:{fileName:UD,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:jD,__source:{fileName:UD,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:jD,__source:{fileName:UD,lineNumber:38,columnNumber:7}}))}));const VD=GD;var HD=new Map,WD=tP({},WP.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),XD={world:"country",country:"province",province:"city",city:"district",district:"district"},ZD="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",qD="".concat(ZD,"/choropleth-data"),YD={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}};function KD(e){return e}function QD(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,o=function(e,t){var n=function(e){if(null==e)return KD;var t,n,r=e.scale[0],i=e.scale[1],o=e.translate[0],a=e.translate[1];return function(e,s){s||(t=n=0);var u=2,l=e.length,c=new Array(l);for(c[0]=(t+=e[0])*r+o,c[1]=(n+=e[1])*i+a;u<l;)c[u]=e[u],++u;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],o=0,a=i.length;o<a;++o)t.push(n(i[o],o));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,a)}function o(e){return n(e)}function a(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=a(e);t.length<4;)t.push(t[0]);return t}function u(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=o(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(o);break;case"LineString":n=a(t.arcs);break;case"MultiLineString":n=t.arcs.map(a);break;case"Polygon":n=u(t.arcs);break;case"MultiPolygon":n=t.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(t)}(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}var JD=function(e){return X(e,["source","color","style","state","label","tooltip"])},$D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=WP.PlotType.Choropleth,t.chinaBoundaryData={type:"FeatureCollection",features:[]},t.currentDistrictData={type:"FeatureCollection",features:[]},t.drillSteps=[],t.drillStacks=[],t.onDrillDownHander=function(e){var n,r=t.options.drill,i=r.steps,o=r.onDown,a=null===(n=e.feature)||void 0===n?void 0:n.properties,s=a.adcode;if(t.drillStacks.length!==i.length+1){var u=t.drillStacks.slice(-1)[0],l=t.drillStacks.length-1,c=t.drillSteps[l],h=c.level,p=c.granularity,f=void 0===p?XD[h]:p,d=b(c,["level","granularity"]),v={nativeEvent:!0,from:{level:u.level,adcode:u.adcode,granularity:u.granularity},to:{level:h,adcode:s,granularity:f,properties:a}},m=function(e){void 0===e&&(e={});var n={level:h,adcode:s,granularity:f},r=tP({},d,e);t.changeView(n,r).then((function(e){e&&(t.drillStacks.push(e),t.emit("drilldown",v))}))};o?o(v.from,v.to,m):m()}},t.onDrillUpHander=function(){var e=t.options.drill.onUp;if(0!==t.drillStacks.length&&1!==t.drillStacks.length){var n=t.drillStacks.length-1,r=t.drillStacks[n],i=t.drillStacks[n-1],o={nativeEvent:!0,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i.level,adcode:i.adcode,granularity:i.granularity}},a=function(e){void 0===e&&(e={});var n=o.to,r=tP({},i.config,e);t.changeView(n,r).then((function(e){e&&(t.drillStacks.pop(),t.emit("drillup",o))}))};e?e(o.from,o.to,a):a()}},t}return _(t,e),t.prototype.initSource=function(){var e=this;this.getInitDistrictData().then((function(){e.source=e.createSource(),e.render(),e.inited=!0}))},t.prototype.render=function(){var e=this;if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{var t=this.createLayers(this.source);this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){e.onSceneLoaded()})),this.initLayersEvent()}},t.prototype.update=function(e){var t,n,r,i=this;if(this.updateOption(e),e.map&&!H(this.lastOptions.map,this.options.map)&&this.updateMap(e.map),e.drill&&!1!==e.drill.enabled&&!H(null===(t=this.lastOptions.drill)||void 0===t?void 0:t.steps,null===(n=this.options.drill)||void 0===n?void 0:n.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),e.viewLevel&&!H(this.lastOptions.viewLevel,this.options.viewLevel)){var o=null===(r=e.source)||void 0===r?void 0:r.joinBy.geoData;this.getDistrictData(o).then((function(){var t=i.options.source,n=t.data,r=b(t,["data"]);i.changeData(n,r),i.updateLayers(e),i.render(),i.updateComponents(),i.emit("update")}))}else{if(e.source&&!H(this.lastOptions.source,this.options.source)){var a=this.options.source,s=a.data,u=b(a,["data"]);this.changeData(s,u)}this.updateLayers(e),this.render(),this.updateComponents(),this.emit("update")}},t.prototype.getDefaultOptions=function(){return t.DefaultOptions},t.prototype.parserSourceConfig=function(e){var t=e.data,n=e.joinBy,r=b(e,["data","joinBy"]),i=n.sourceField,o=n.geoField,a=n.geoData,s={type:"join",sourceField:i,targetField:o,data:t};return r.transforms?r.transforms.push(s):r.transforms=[s],r.parser&&delete r.parser,{data:a,sourceCFG:r}},t.prototype.createSource=function(){var e=this.parserSourceConfig(this.options.source),t=e.data,n=e.sourceCFG;return new Ap(t,n)},t.prototype.changeData=function(e,t){var n=this;this.options.source=tP({},this.options.source,x({data:e},t));var r=this.parserSourceConfig(this.options.source),i=r.data,o=r.sourceCFG;this.source.setData(i,o);var a=this.options.legend;a&&setTimeout((function(){n.updateLegendControl(a)})),this.emit("change-data")},t.prototype.createLayers=function(e){this.fillAreaLayer=new FD(x({name:"fillAreaLayer",source:e},X(this.options,FD.LayerOptionsKeys)));var t=new MP([this.fillAreaLayer]);return this.options.chinaBorder&&this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach((function(e){return t.addLayer(e)})),this.options.label&&(this.labelLayer=this.createLabelLayer(e,this.options.label),t.addLayer(this.labelLayer)),t},t.prototype.createCountryBoundaryLayer=function(e,t){var n=function(e,t){var n=t||{},r=n.visible,i=n.minZoom,o=n.maxZoom,a=n.zIndex,s=void 0===a?0:a,u=n.chinaBorder,l="object"==typeof u?tP({},YD,u):YD,c=e.features.filter((function(e){var t=e.properties;return["coast","national"].includes(null==t?void 0:t.type)})),h=e.features.filter((function(e){var t=e.properties;return"dispute"===(null==t?void 0:t.type)})),p=e.features.filter((function(e){var t=e.properties;return"hkm"===(null==t?void 0:t.type)})),f=new mD({name:"chinaBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:{field:"type",value:function(e){var t=e.type;return l[t].color}},size:{field:"type",value:function(e){var t=e.type;return l[t].width}},style:{opacity:l.national.opacity}});return{chinaBoundaryLayer:f,chinaHkmBoundaryLayer:new mD({name:"chinaHkmBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:p},parser:{type:"geojson"}},color:l.hkm.color,size:l.hkm.width,style:{opacity:l.hkm.opacity,lineType:"dash",dashArray:l.hkm.dashArray}}),chinaDisputeBoundaryLayer:new mD({name:"chinaDisputeBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:h},parser:{type:"geojson"}},color:l.dispute.color,size:l.dispute.width,style:{opacity:l.dispute.opacity,lineType:"dash",dashArray:l.dispute.dashArray}})}}(e,t),r=n.chinaBoundaryLayer,i=n.chinaHkmBoundaryLayer,o=n.chinaDisputeBoundaryLayer;return this.chinaBoundaryLayer=r,this.chinaHkmBoundaryLayer=i,this.chinaDisputeBoundaryLayer=o,[r,i,o]},t.prototype.createLabelLayer=function(e,t){var n=this,r=e.originData.features.map((function(e){var t=e.properties;return Object.assign({},t,{centroid:t.centroid||t.center})})).filter((function(e){return e.centroid})),i=this.options,o=i.visible,a=i.minZoom,s=i.maxZoom,u=i.zIndex,l=void 0===u?0:u,c=new VP(x({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"centroid"},transforms:e.transforms},visible:o,minZoom:a,maxZoom:s,zIndex:l+.1},t)),h=function(){var t=n.source.originData.features.map((function(e){return e.properties})).filter((function(e){return e.centroid}));c.layer.setData(t,{transforms:e.transforms})};return e.on("update",h),c.on("remove",(function(){e.off("update",h)})),c},t.prototype.updateLayers=function(e){var t=this,n=X(e,FD.LayerOptionsKeys);this.fillAreaLayer.update(n);var r=function(){t.createCountryBoundaryLayer(t.chinaBoundaryData,t.options).forEach((function(e){return t.layerGroup.addLayer(e)}))},i=function(){t.chinaBoundaryLayer&&t.layerGroup.removeLayer(t.chinaBoundaryLayer),t.chinaHkmBoundaryLayer&&t.layerGroup.removeLayer(t.chinaHkmBoundaryLayer),t.chinaDisputeBoundaryLayer&&t.layerGroup.removeLayer(t.chinaDisputeBoundaryLayer)};e.chinaBorder?this.chinaBoundaryLayer?(i(),r()):r():!1===e.chinaBorder&&i(),this.updateLabelLayer(this.source,e.label,this.options,this.labelLayer)},t.prototype.initLayersEvent=function(){this.initDrillEvent()},t.prototype.initDrillEvent=function(){if(this.lastOptions.drill){var e=this.lastOptions.drill,t=e.triggerUp,n=void 0===t?"unclick":t,r=e.triggerDown,i=void 0===r?"click":r;this.fillAreaLayer.off(n,this.onDrillUpHander),this.fillAreaLayer.off(i,this.onDrillDownHander)}if(this.options.drill&&!1!==this.options.drill.enabled){var o=this.options.drill,a=o.steps,s=o.triggerUp,u=void 0===s?"unclick":s,l=o.triggerDown,c=void 0===l?"click":l,h=a.map((function(e){return"string"==typeof e?{level:e,granularity:XD[e]}:(e.granularity||(e.granularity=XD[e.level]),e)}));if(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],i=r.level,o=r.granularity;if(t[n].level!==i||t[n].granularity!==o)return!1}return!0}(h,this.drillSteps)||(this.drillSteps=h,this.drillStacks=[]),!this.drillStacks.length){var p=this.options.viewLevel,f=p.level,d=p.adcode,v=p.granularity,m=void 0===v?XD[f]:v,g=JD(this.options);this.drillStacks=[{level:f,adcode:d,granularity:m,config:g}]}this.fillAreaLayer.on(u,this.onDrillUpHander),this.fillAreaLayer.on(c,this.onDrillDownHander)}},t.prototype.drillReset=function(){this.drillStacks=[]},t.prototype.getCurrentDrillSteps=function(){return this.drillStacks.map((function(e){return X(e,["level","adcode","granularity"])}))},t.prototype.getLegendOptions=function(){var e=this.fillAreaLayer.getColorLegendItems();return 0!==e.length?{type:"category",items:e}:{}},t.prototype.fetchData=function(e,t,n){return E(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c;return w(this,(function(h){switch(h.label){case 0:return p=r="".concat(t,"_").concat(e,"_").concat(n),(i=HD.get(p))?[2,i]:(o=function(e){var t={url:qD,type:"topojson",extension:"topo.json"};return z(e)||("string"==typeof e?t.url=e:(t.url=(null==e?void 0:e.url)||qD,t.type=e.type,t.extension="topojson"===e.type?"topo.json":"json")),t}(this.options.geoArea),a=o.url,s=o.type,u=o.extension,(c=this.options.customFetchGeoData)?[4,c({url:a,level:e,adcode:t,granularity:n,extension:u})]:[3,2]);case 1:return l=h.sent(),[3,5];case 2:return[4,fetch("".concat(a,"/").concat(e,"/").concat(r,".").concat(u))];case 3:return[4,h.sent().json()];case 4:l=h.sent(),h.label=5;case 5:return"topojson"===s&&(l=function(e){try{return t=e,"string"==typeof(n="json")&&(n=t.objects[n]),"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map((function(e){return QD(t,e)}))}:QD(t,n)}catch(e){throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}var t,n}(l)),function(e,t){HD.set(e,t)}(r,l),[2,l]}var p}))}))},t.prototype.getInitDistrictData=function(){var e;return E(this,void 0,void 0,(function(){var t,n,r,i;return w(this,(function(o){switch(o.label){case 0:t=this.fetchData("country","100000","boundary"),n=null===(e=this.options.source)||void 0===e?void 0:e.joinBy.geoData,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all([t,this.getDistrictData(n)])];case 2:return i=T.apply(void 0,[o.sent(),1]),this.chinaBoundaryData=i[0],[3,4];case 3:throw r=o.sent(),new Error("Failed to get china boundary data，".concat(r));case 4:return[2]}}))}))},t.prototype.getDistrictData=function(e){return E(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u;return w(this,(function(l){switch(l.label){case 0:t=this.options.viewLevel,n=t.level,r=t.adcode,i=t.granularity,o=void 0===i?XD[n]:i,a=e?Promise.resolve(e):this.fetchData(n,r,o),l.label=1;case 1:return l.trys.push([1,3,,4]),s=this,[4,a];case 2:return s.currentDistrictData=l.sent(),this.options.source=tP({},this.options.source,{joinBy:{geoData:this.currentDistrictData}}),[3,4];case 3:throw u=l.sent(),new Error("Failed to get district data，".concat(u));case 4:return[2]}}))}))},t.prototype.drillDown=function(e,t){var n=this;void 0===t&&(t={});var r=this.drillStacks.slice(-1)[0],i=e.level,o=e.adcode,a=e.granularity,s={nativeEvent:!1,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i,adcode:o,granularity:a}};this.changeView(e,t).then((function(e){e&&(n.drillStacks.push(e),n.emit("drilldown",s))}))},t.prototype.drillUp=function(e,t){var n=this;void 0===e&&(e={});var r=this.drillStacks.length;if(![0,1].includes(r)){var i=t?this.drillStacks.findIndex((function(e){return e.level===t})):-1,o=-1!==i,a=o?i:r-2,s=this.drillStacks[a],u=s.config,l=b(s,["config"]),c=tP({},u,e),h=this.drillStacks[this.drillStacks.length-1],p={nativeEvent:!1,from:{level:h.level,adcode:h.adcode,granularity:h.granularity},to:{level:l.level,adcode:l.adcode,granularity:l.granularity}};this.changeView(l,c).then((function(e){e&&(o?n.drillStacks.splice(i+1):n.drillStacks.pop(),n.emit("drillup",p))}))}},t.prototype.changeView=function(e,t){return void 0===t&&(t={}),E(this,void 0,void 0,(function(){var n,r,i,o,a,s;return w(this,(function(u){switch(u.label){case 0:return n=e.level,r=e.adcode,i=e.granularity,o=void 0===i?XD[n]:i,[4,this.fetchData(n,r,o)];case 1:return(a=u.sent()).features.length?(s=tP({},JD(this.options),t,{viewLevel:{level:n,adcode:r,granularity:o},source:{joinBy:{geoData:a}}}),this.update(s),[2,{level:n,adcode:r,granularity:o,config:s}]):[2]}}))}))},t.DefaultOptions=WD,t.GeoDataUrl=ZD,t.GeoAreaUrl=qD,t}(WP),eN=["chartRef","containerStyle","className","loading","loadingTemplate","errorTemplate"],tN="/Users/liufu/publicWorkspace/ant-design-charts/packages/maps/src/components/choropleth-map/index.tsx",nN=void 0,rN=(0,m.forwardRef)((function(e,t){var n=e.chartRef,r=e.containerStyle,i=void 0===r?{height:"inherit"}:r,o=e.className,a=e.loading,s=e.loadingTemplate,u=e.errorTemplate,l=v(e,eN),c=gO($D,l),h=c.plotRef,p=c.containerRef;return(0,m.useEffect)((function(){yO(n,h.current)}),[h.current]),(0,m.useImperativeHandle)(t,(function(){return{getChart:function(){return h.current}}})),g().createElement(bO,{errorTemplate:u,__self:nN,__source:{fileName:tN,lineNumber:36,columnNumber:5}},a&&g().createElement(MO,{loadingTemplate:s,__self:nN,__source:{fileName:tN,lineNumber:37,columnNumber:19}}),g().createElement("div",{className:o,style:i,ref:p,__self:nN,__source:{fileName:tN,lineNumber:38,columnNumber:7}}))}));const iN=rN})(),i})()));
//# sourceMappingURL=maps.min.js.map