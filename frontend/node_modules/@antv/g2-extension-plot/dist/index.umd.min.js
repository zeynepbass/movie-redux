!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g"),require("@antv/g2")):"function"==typeof define&&define.amd?define(["exports","@antv/g","@antv/g2"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G2=t.G2||{},t.G2.ExtensionPlot={}),t.window.G,t.window.G2)}(this,(function(t,e,n){"use strict";function r(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var o=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},i=function(t,e){if(!o(t))return t;for(var n=[],r=0;t.length>r;r++){var i=t[r];e(i,r)&&n.push(i)}return n},a=function(t){return null==t},c={}.toString,s=function(t,e){return c.call(t)==="[object "+e+"]"},u=function(t){return Array.isArray?Array.isArray(t):s(t,"Array")};function l(t,e){var n,r;if(t)if(u(t))for(var o=0,i=t.length;i>o&&!1!==e(t[o],o);o++);else if(r=typeof(n=t),null!==n&&"object"===r||"function"===r)for(var a in t)if(t.hasOwnProperty(a)&&!1===e(t[a],a))break}var f=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return l(t,(function(n,r){(function(t){return"function"==typeof t})(t)&&"prototype"===r||e.push(r)})),e},d=function(t){return"object"==typeof t&&null!==t},h=function(t){if(!d(t)||!s(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},p=function(t,e,n){if(!u(t)&&!h(t))return t;var r=n;return l(t,(function(t,n){r=e(r,t,n)})),r},v=function(t){return s(t,"String")};function y(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function g(t,e){if(Object.hasOwn)return Object.hasOwn(t,e);if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}function b(t,e,n,r){for(var o in n=n||0,r=r||5,e)if(g(e,o)){var i=e[o];null!==i&&h(i)?(h(t[o])||(t[o]={}),r>n?b(t[o],i,n+1,r):t[o]=e[o]):u(i)?(t[o]=[],t[o]=t[o].concat(i)):void 0!==i&&(t[o]=i)}}var x=function(t){for(var e=[],n=1;arguments.length>n;n++)e[n-1]=arguments[n];for(var r=0;e.length>r;r+=1)b(t,e[r]);return t},O=function(t,e,n){for(var r=0,o=v(e)?e.split("."):e;t&&o.length>r;)t=t[o[r++]];return void 0===t||o.length>r?n:t},m=Object.prototype.hasOwnProperty,w=function(t,e){if(null===t||!h(t))return{};var n={};return l(e,(function(e){m.call(t,e)&&(n[e]=t[e])})),n};function j(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function E(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=k)):void 0===e&&(e=B);for(var n,r,o,i,a,c=new S(t),s=[c];n=s.pop();)if((o=e(n.data))&&(a=(o=Array.from(o)).length))for(n.children=o,i=a-1;i>=0;--i)s.push(r=o[i]=new S(o[i])),r.parent=n,r.depth=n.depth+1;return c.eachBefore(A)}function B(t){return t.children}function k(t){return Array.isArray(t)?t[1]:null}function P(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function A(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function S(t){this.data=t,this.depth=this.height=0,this.parent=null}function T(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function C(){var t=1,e=1,n=0,r=!1;function o(o){var i=o.height+1;return o.x0=o.y0=n,o.x1=t,o.y1=e/i,o.eachBefore(function(t,e){return function(r){r.children&&function(t,e,n,r,o){for(var i,a=t.children,c=-1,s=a.length,u=t.value&&(r-e)/t.value;++c<s;)(i=a[c]).y0=n,i.y1=o,i.x0=e,i.x1=e+=i.value*u}(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var o=r.x0,i=r.y0,a=r.x1-n,c=r.y1-n;o>a&&(o=a=(o+a)/2),i>c&&(i=c=(i+c)/2),r.x0=o,r.y0=i,r.x1=a,r.y1=c}}(e,i)),r&&o.eachBefore(T),o}return o.round=function(t){return arguments.length?(r=!!t,o):r},o.size=function(n){return arguments.length?(t=+n[0],e=+n[1],o):[t,e]},o.padding=function(t){return arguments.length?(n=+t,o):n},o}S.prototype=E.prototype={constructor:S,count:function(){return this.eachAfter(j)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,o,i=this,a=[i],c=[],s=-1;i=a.pop();)if(c.push(i),n=i.children)for(r=0,o=n.length;o>r;++r)a.push(n[r]);for(;i=c.pop();)t.call(e,i,++s,this);return this},eachBefore:function(t,e){for(var n,r,o=this,i=[o],a=-1;o=i.pop();)if(t.call(e,o,++a,this),n=o.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,o=r&&r.length;--o>=0;)n+=r[o].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),o=null;t=n.pop(),e=r.pop();for(;t===e;)o=t,t=n.pop(),e=r.pop();return o}(e,t),r=[e];e!==n;)r.push(e=e.parent);for(var o=r.length;t!==n;)r.splice(o,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return E(this).eachBefore(P)},[Symbol.iterator]:function*(){var t,e,n,r,o=this,i=[o];do{for(t=i.reverse(),i=[];o=t.pop();)if(yield o,e=o.children)for(n=0,r=e.length;r>n;++n)i.push(e[n])}while(i.length)}};const L={field:"value",size:[1,1],round:!1,padding:0,sort:(t,e)=>e.value-t.value,as:["x","y"],ignoreParentValue:!0},M="nodeIndex",z="childNodeCount",G="nodeAncestor",I="Invalid field: it must be a string!";function $(t,e){var n,r,c,s;n={},c=e,(r=L)&&y(n,r),c&&y(n,c),s&&y(n,s);const l=(e=n).as;if(!u(l)||2!==l.length)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');let f;try{f=function(t,e){const{field:n,fields:r}=t;if(v(n))return n;if(u(n))return console.warn(I),n[0];if(console.warn(I+" will try to get fields instead."),v(r))return r;if(u(r)&&r.length)return r[0];if(e)return e;throw new TypeError(I)}(e)}catch(t){console.warn(t)}const d=(t=>C().size(e.size).round(e.round).padding(e.padding)(E(t).sum((t=>{return!a(n=t.children)&&(o(n)?n.length:Object.keys(n).length)?e.ignoreParentValue?0:t[f]-p(t.children,((t,e)=>t+e[f]),0):t[f];var n})).sort(e.sort)))(t),h=l[0],g=l[1];return d.each((t=>{var e,n;t[h]=[t.x0,t.x1,t.x1,t.x0],t[g]=[t.y1,t.y1,t.y0,t.y0],t.name=t.name||(null===(e=t.data)||void 0===e?void 0:e.name)||(null===(n=t.data)||void 0===n?void 0:n.label),t.data.name=t.name,["x0","x1","y0","y1"].forEach((e=>{-1===l.indexOf(e)&&delete t[e]}))})),function(t){const e=[];if(t&&t.each){let n,r;t.each((t=>{var o,a;t.parent!==n?(n=t.parent,r=0):r+=1;const c=i(((null===(o=t.ancestors)||void 0===o?void 0:o.call(t))||[]).map((t=>e.find((e=>e.name===t.name))||t)),(({depth:e})=>e>0&&t.depth>e));t[G]=c,t[z]=(null===(a=t.children)||void 0===a?void 0:a.length)||0,t[M]=r,e.push(t)}))}else t&&t.eachNode&&t.eachNode((t=>{e.push(t)}));return e}(d)}const _="sunburst",D="markType",N="path",R="ancestor-node";const q={id:_,encode:{x:"x",y:"y",key:N,color:R,value:"value"},axis:{x:!1,y:!1},style:{[D]:_,stroke:"#fff",lineWidth:.5,fillOpacity:"fillOpacity",[z]:z,depth:"depth"},state:{active:{zIndex:2,stroke:"#000"},inactive:{zIndex:1,stroke:"#fff"}},legend:!1,interaction:{drillDown:!0},coordinate:{type:"polar",innerRadius:.2}},V=t=>{const{encode:e,data:n=[]}=t,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);r.length>o;o++)0>e.indexOf(r[o])&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(t,["encode","data","legend"]),o=Object.assign(Object.assign({},r.coordinate),{innerRadius:Math.max(O(r,["coordinate","innerRadius"],.2),1e-5)}),i=Object.assign(Object.assign({},q.encode),e),{value:a}=i,c=function(t){const{data:e,encode:n}=t,{color:r,value:o}=n,i=$(e,{field:o,type:"hierarchy.partition",as:["x","y"]}),a=[];return i.forEach((t=>{var e,n,i,c;if(0===t.depth)return null;let s=t.data.name;const u=[s];let l=Object.assign({},t);for(;l.depth>1;)s=`${null===(e=l.parent.data)||void 0===e?void 0:e.name} / ${s}`,u.unshift(null===(n=l.parent.data)||void 0===n?void 0:n.name),l=l.parent;const f=Object.assign(Object.assign(Object.assign({},w(t.data,[o])),{[N]:s,[R]:l.data.name}),t);r&&r!==R&&(f[r]=t.data[r]||(null===(c=null===(i=t.parent)||void 0===i?void 0:i.data)||void 0===c?void 0:c[r])),a.push(f)})),a.map((t=>Object.assign(Object.assign({},t),{x:t.x.slice(0,2),y:[t.y[2],t.y[0]],fillOpacity:Math.pow(.85,t.depth)})))}({encode:i,data:n});return[x({},q,Object.assign(Object.assign({type:"rect",data:c,encode:i,tooltip:{title:"path",items:[t=>({name:a,value:t[a]})]}},r),{coordinate:o}))]};V.props={};const F=t=>t.querySelectorAll(".element").filter((t=>O(t,["style",D])===_));const W={rootText:"root",style:{fill:"rgba(0, 0, 0, 0.85)",fontSize:12,y:1},active:{fill:"rgba(0, 0, 0, 0.5)"}};function H(t={}){const{breadCrumb:o={},fixedColor:i=!0}=t,a=x({},W,o);return t=>{const{update:o,setState:c,container:s,view:u,options:l}=t,d=n.select(s).select("."+n.PLOT_CLASS_NAME).node();const h=l.marks.find((({id:t})=>t===_)),{state:p}=h,v=new e.Group;d.appendChild(v);const y=(t,n)=>r(this,void 0,void 0,(function*(){if(v.removeChildren(),t){const n=new e.Text({style:Object.assign({x:0,text:a.rootText,depth:0},a.style)});v.appendChild(n);let r="";const o=null==t?void 0:t.split(" / ");let i=a.style.y,c=v.getBBox().width;const s=d.getBBox().width,u=o.map(((t,n)=>{const o=new e.Text({style:Object.assign(Object.assign({x:c,text:" / "},a.style),{y:i})});v.appendChild(o),c+=o.getBBox().width,r=`${r}${t} / `;const u=new e.Text({name:r.replace(/\s\/\s$/,""),style:Object.assign(Object.assign({text:t,x:c,depth:n+1},a.style),{y:i})});return v.appendChild(u),c+=u.getBBox().width,c>s&&(i=v.getBBox().height,c=0,o.attr({x:c,y:i}),c+=o.getBBox().width,u.attr({x:c,y:i}),c+=u.getBBox().width),u}));[n,...u].forEach(((t,e)=>{if(e===u.length)return;const n=Object.assign({},t.attributes);t.attr("cursor","pointer"),t.addEventListener("mouseenter",(()=>{t.attr(a.active)})),t.addEventListener("mouseleave",(()=>{t.attr(n)})),t.addEventListener("click",(()=>{y(t.name,O(t,["style","depth"]))}))}))}c("drillDown",(e=>{const{marks:r}=e,o=r.map((e=>{if(e.id!==_&&"rect"!==e.type)return e;const{data:r}=e,o=Object.fromEntries(["color"].map((t=>[t,{domain:u.scale[t].getOptions().domain}]))),a=r.filter((e=>{const r=e.path;if(i&&(e[R]=r.split(" / ")[n]),!t)return!0;return RegExp(`^${t}.+`).test(r)}));return x({},e,i?{data:a}:{data:a,scale:o})}));return Object.assign(Object.assign({},e),{marks:o})})),yield o()})),g=t=>{const e=t.target;if(O(e,["style",D])!==_||"rect"!==O(e,["markType"])||!O(e,["style",z]))return;const n=O(e,["__data__","key"]),r=O(e,["style","depth"]);e.style.cursor="pointer",y(n,r)};d.addEventListener("click",g);const b=f(Object.assign(Object.assign({},p.active),p.inactive)),m=()=>{F(d).forEach((t=>{const e=O(t,["style",z]);if("pointer"!==O(t,["style","cursor"])&&e){t.style.cursor="pointer";const e=w(t.attributes,b);t.addEventListener("mouseenter",(()=>{t.attr(p.active)})),t.addEventListener("mouseleave",(()=>{t.attr(x(e,p.inactive))}))}}))};return d.addEventListener("mousemove",m),()=>{v.remove(),d.removeEventListener("click",g),d.removeEventListener("mousemove",m)}}}e.runtime.enableCSSParsing=!1,t.DrillDown=H,t.Sunburst=V,t.plotlib=function(){return{"interaction.drillDown":H,"mark.sunburst":V}}}));
//# sourceMappingURL=index.umd.min.js.map
